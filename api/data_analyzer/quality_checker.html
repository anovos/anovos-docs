
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Stable Features yield Resilient Models. Documentation for the Feature Engineering Library Anovos.">
      
      
        <meta name="author" content="Anovos Developers, Mobilewalla">
      
      
        <link rel="canonical" href="https://docs.anovos.ai/api/data_analyzer/quality_checker.html">
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>quality_checker - Anovos Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script id="__analytics">function __md_analytics(){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-52258647-20","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");ga("send","event","feedback","click",t,e),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){ga("send","pageview",e.pathname)})});var e=document.createElement("script");e.async=!0,e.src="https://www.google-analytics.com/analytics.js",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
<!-- Extra styles for API docs, cf. https://github.com/pdoc3/pdoc/blob/master/pdoc/templates/html.mako -->
<link rel="preload stylesheet" as="style"
      href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css"
      integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style"
      href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css"
      integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/${hljs_style}.min.css" crossorigin>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"
        integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>

<!-- Extra style sheets (can't be set in mkdocs.yml due to content hash) -->
<link
        rel="stylesheet"
        href="../../assets/stylesheets/main.css"
/>

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#quality_checker" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
<a href="https://join.slack.com/t/featureengineers/shared_invite/zt-17pkc3f5d-33SUtV8Wx48CpiIRNuQ7JA" style="color: white;">
      <span class="twemoji fa-slack">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg>
    </span>
    Join us in the <strong>#anovos</strong> channel on the <em>Feature Engineers Community Slack!</em>
</a>

          </div>
          
        </aside>
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="Anovos Documentation" class="md-header__button md-logo" aria-label="Anovos Documentation" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Anovos Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              <code>quality_checker</code>
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
            </label>
          
        
          
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a
  href="https://github.com/anovos/anovos"
  title="Go to repository"
  class="md-source"
  data-md-component="source"
>
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    anovos/anovos
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="Anovos Documentation" class="md-nav__button md-logo" aria-label="Anovos Documentation" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    Anovos Documentation
  </label>
  
    <div class="md-nav__source">
      <a
  href="https://github.com/anovos/anovos"
  title="Go to repository"
  class="md-source"
  data-md-component="source"
>
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    anovos/anovos
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../about.html" class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started.html" class="md-nav__link">
        Getting Started 🚀
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Using Anovos
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Using Anovos" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Using Anovos
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" type="checkbox" id="__nav_4_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_1">
          Setting up
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Setting up" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Setting up
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/setting-up/locally.html" class="md-nav__link">
        Locally
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/setting-up/on_aws.html" class="md-nav__link">
        On AWS EMR
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/setting-up/on_azure_databricks.html" class="md-nav__link">
        On Azure Databricks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/setting-up/on_aks.html" class="md-nav__link">
        On Azure Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/setting-up/on_google_colab.html" class="md-nav__link">
        On Google Colab
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/setting-up/spark_cluster.html" class="md-nav__link">
        On a Spark cluster
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/workflow.html" class="md-nav__link">
        Workflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/config_file.html" class="md-nav__link">
        Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_4" type="checkbox" id="__nav_4_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_4">
          Data Reports
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Data Reports" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          Data Reports
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/data-reports/overview.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/data-reports/intermediate_report.html" class="md-nav__link">
        Intermediate Report
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/data-reports/final_report.html" class="md-nav__link">
        Final Report
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/data-reports/html_report.html" class="md-nav__link">
        HTML Report
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/feature_mapper.html" class="md-nav__link">
        Feature Mapper
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/mlflow.html" class="md-nav__link">
        MLflow Integration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/feature_store.html" class="md-nav__link">
        Feature Store Integration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/scaling.html" class="md-nav__link">
        Scaling Up
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/limitations.html" class="md-nav__link">
        Limitations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/roadmap.html" class="md-nav__link">
        Roadmap
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Community
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Community" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Community
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../community/contributing.html" class="md-nav__link">
        Contributing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../community/communication.html" class="md-nav__link">
        Communication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../community/code-of-conduct.html" class="md-nav__link">
        Code of Conduct
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          API Docs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API Docs" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          API Docs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../_index.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../workflow.html" class="md-nav__link">
        <code>workflow</code>
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_3" type="checkbox" id="__nav_6_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6_3">
          data_analyzer
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="data_analyzer" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          data_analyzer
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="_index.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="association_eval_varclus.html" class="md-nav__link">
        <code>association_eval_varclus</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="association_evaluator.html" class="md-nav__link">
        <code>association_evaluator</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="geospatial_analyzer.html" class="md-nav__link">
        <code>geospatial_analyzer</code>
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          <code>quality_checker</code>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="quality_checker.html" class="md-nav__link md-nav__link--active">
        <code>quality_checker</code>
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="stats_generator.html" class="md-nav__link">
        <code>stats_generator</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="ts_analyzer.html" class="md-nav__link">
        <code>ts_analyzer</code>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_4" type="checkbox" id="__nav_6_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_4">
          data_ingest
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="data_ingest" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_4">
          <span class="md-nav__icon md-icon"></span>
          data_ingest
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_ingest/_index.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_ingest/data_ingest.html" class="md-nav__link">
        <code>data_ingest</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_ingest/data_sampling.html" class="md-nav__link">
        <code>data_sampling</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_ingest/geo_auto_detection.html" class="md-nav__link">
        <code>geo_auto_detection</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_ingest/ts_auto_detection.html" class="md-nav__link">
        <code>ts_auto_detection</code>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_5" type="checkbox" id="__nav_6_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_5">
          data_report
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="data_report" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_5">
          <span class="md-nav__icon md-icon"></span>
          data_report
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_report/_index.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_report/basic_report_generation.html" class="md-nav__link">
        <code>basic_report_generation</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_report/report_generation.html" class="md-nav__link">
        <code>report_generation</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_report/report_preprocessing.html" class="md-nav__link">
        <code>report_preprocessing</code>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_6" type="checkbox" id="__nav_6_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_6">
          data_transformer
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="data_transformer" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_6">
          <span class="md-nav__icon md-icon"></span>
          data_transformer
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_transformer/_index.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_transformer/datetime.html" class="md-nav__link">
        <code>datetime</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_transformer/geo_utils.html" class="md-nav__link">
        <code>geo_utils</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_transformer/geospatial.html" class="md-nav__link">
        <code>geospatial</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_transformer/transformers.html" class="md-nav__link">
        <code>transformers</code>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_7" type="checkbox" id="__nav_6_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_7">
          drift_stability
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="drift_stability" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_7">
          <span class="md-nav__icon md-icon"></span>
          drift_stability
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../drift_stability/_index.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../drift_stability/drift_detector.html" class="md-nav__link">
        <code>drift_detector</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../drift_stability/stability.html" class="md-nav__link">
        <code>stability</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../drift_stability/validations.html" class="md-nav__link">
        <code>validations</code>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_8" type="checkbox" id="__nav_6_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_8">
          feature_recommender
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="feature_recommender" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_8">
          <span class="md-nav__icon md-icon"></span>
          feature_recommender
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../feature_recommender/_index.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../feature_recommender/featrec_init.html" class="md-nav__link">
        <code>featrec_init</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../feature_recommender/feature_explorer.html" class="md-nav__link">
        <code>feature_explorer</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../feature_recommender/feature_mapper.html" class="md-nav__link">
        <code>feature_mapper</code>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_9" type="checkbox" id="__nav_6_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_9">
          feature_store
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="feature_store" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_9">
          <span class="md-nav__icon md-icon"></span>
          feature_store
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../feature_store/_index.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../feature_store/feast_exporter.html" class="md-nav__link">
        <code>feast_exporter</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../feature_store/feature_retrieval.html" class="md-nav__link">
        <code>feature_retrieval</code>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_10" type="checkbox" id="__nav_6_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_10">
          shared
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="shared" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_10">
          <span class="md-nav__icon md-icon"></span>
          shared
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../shared/_index.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../shared/spark.html" class="md-nav__link">
        <code>spark</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../shared/utils.html" class="md-nav__link">
        <code>utils</code>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../license.html" class="md-nav__link">
        License
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/anovos/anovos-docs/edit/main/docs/api/data_analyzer/quality_checker.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="quality_checker"><code>quality_checker</code></h1>
<p>This submodule focuses on assessing the data quality at both row-level and column-level and also provides an
appropriate treatment option to fix quality issues.</p>
<p>At the row level, the following checks are done:</p>
<ul>
<li>duplicate_detection</li>
<li>nullRows_detection</li>
</ul>
<p>At the column level, the following checks are done:</p>
<ul>
<li>nullColumns_detection</li>
<li>outlier_detection</li>
<li>IDness_detection</li>
<li>biasedness_detection</li>
<li>invalidEntries_detection</li>
</ul>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># coding=utf-8</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="sd">This submodule focuses on assessing the data quality at both row-level and column-level and also provides an</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="sd">appropriate treatment option to fix quality issues.</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="sd">At the row level, the following checks are done:</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="sd">- duplicate_detection</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="sd">- nullRows_detection</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="sd">At the column level, the following checks are done:</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="sd">- nullColumns_detection</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="sd">- outlier_detection</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="sd">- IDness_detection</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="sd">- biasedness_detection</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="sd">- invalidEntries_detection</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="kn">import</span> <span class="nn">copy</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="kn">import</span> <span class="nn">functools</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="kn">import</span> <span class="nn">re</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="kn">import</span> <span class="nn">warnings</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">functions</span> <span class="k">as</span> <span class="n">F</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">types</span> <span class="k">as</span> <span class="n">T</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="kn">from</span> <span class="nn">anovos.data_analyzer.stats_generator</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>    <span class="n">measures_of_cardinality</span><span class="p">,</span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>    <span class="n">missingCount_computation</span><span class="p">,</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>    <span class="n">mode_computation</span><span class="p">,</span>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>    <span class="n">uniqueCount_computation</span><span class="p">,</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="p">)</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="kn">from</span> <span class="nn">anovos.data_ingest.data_ingest</span> <span class="kn">import</span> <span class="n">read_dataset</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="kn">from</span> <span class="nn">anovos.data_transformer.transformers</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>    <span class="n">auto_imputation</span><span class="p">,</span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>    <span class="n">imputation_matrixFactorization</span><span class="p">,</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>    <span class="n">imputation_MMM</span><span class="p">,</span>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>    <span class="n">imputation_sklearn</span><span class="p">,</span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="p">)</span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a><span class="kn">from</span> <span class="nn">anovos.shared.utils</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>    <span class="n">attributeType_segregation</span><span class="p">,</span>
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>    <span class="n">get_dtype</span><span class="p">,</span>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>    <span class="n">transpose_dataframe</span><span class="p">,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a><span class="p">)</span>
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a><span class="k">def</span> <span class="nf">duplicate_detection</span><span class="p">(</span>
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a>    <span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span> <span class="n">treatment</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a><span class="p">):</span>
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a><span class="sd">    As the name implies, this function detects duplication in the input dataset. This means, for a pair of</span>
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a><span class="sd">    duplicate rows, the values in each column coincide. Duplication check is confined to the list of columns passed</span>
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a><span class="sd">    in the arguments. As part of treatment, duplicated rows are removed. This function returns two dataframes in</span>
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a><span class="sd">    tuple format; the 1st dataframe is the input dataset after deduplication (if treated else the original dataset).</span>
<a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a><span class="sd">    The 2nd dataframe is of schema – metric, value and contains the total number of rows, number of unique rows,</span>
<a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a><span class="sd">    number of duplicate rows and percentage of duplicate rows in total.</span>
<a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a><span class="sd">    spark</span>
<a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a><span class="sd">    idf</span>
<a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-67" name="__codelineno-0-67" href="#__codelineno-0-67"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-0-68" name="__codelineno-0-68" href="#__codelineno-0-68"></a><span class="sd">        List of columns to analyse e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-69" name="__codelineno-0-69" href="#__codelineno-0-69"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-70" name="__codelineno-0-70" href="#__codelineno-0-70"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-71" name="__codelineno-0-71" href="#__codelineno-0-71"></a><span class="sd">        &quot;all&quot; can be passed to include all columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-0-72" name="__codelineno-0-72" href="#__codelineno-0-72"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in drop_cols argument</span>
<a id="__codelineno-0-73" name="__codelineno-0-73" href="#__codelineno-0-73"></a><span class="sd">        is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74" href="#__codelineno-0-74"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-0-75" name="__codelineno-0-75" href="#__codelineno-0-75"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-76" name="__codelineno-0-76" href="#__codelineno-0-76"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-77" name="__codelineno-0-77" href="#__codelineno-0-77"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78" href="#__codelineno-0-78"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-0-79" name="__codelineno-0-79" href="#__codelineno-0-79"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-0-80" name="__codelineno-0-80" href="#__codelineno-0-80"></a><span class="sd">    treatment</span>
<a id="__codelineno-0-81" name="__codelineno-0-81" href="#__codelineno-0-81"></a><span class="sd">        Boolean argument – True or False. If True, duplicate rows are removed from the input dataframe. (Default value = True)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82" href="#__codelineno-0-82"></a><span class="sd">    print_impact</span>
<a id="__codelineno-0-83" name="__codelineno-0-83" href="#__codelineno-0-83"></a><span class="sd">        True, False</span>
<a id="__codelineno-0-84" name="__codelineno-0-84" href="#__codelineno-0-84"></a><span class="sd">        This argument is to print out the statistics.(Default value = False)</span>
<a id="__codelineno-0-85" name="__codelineno-0-85" href="#__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86" href="#__codelineno-0-86"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-87" name="__codelineno-0-87" href="#__codelineno-0-87"></a><span class="sd">    -------</span>
<a id="__codelineno-0-88" name="__codelineno-0-88" href="#__codelineno-0-88"></a><span class="sd">    if print_impact is True:</span>
<a id="__codelineno-0-89" name="__codelineno-0-89" href="#__codelineno-0-89"></a><span class="sd">        odf : DataFrame</span>
<a id="__codelineno-0-90" name="__codelineno-0-90" href="#__codelineno-0-90"></a><span class="sd">            de-duplicated dataframe if treated, else original input dataframe.</span>
<a id="__codelineno-0-91" name="__codelineno-0-91" href="#__codelineno-0-91"></a><span class="sd">        odf_print : DataFrame</span>
<a id="__codelineno-0-92" name="__codelineno-0-92" href="#__codelineno-0-92"></a><span class="sd">            schema [metric, value] and contains metrics - number of rows, number of unique rows,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93" href="#__codelineno-0-93"></a><span class="sd">            number of duplicate rows and percentage of duplicate rows in total.</span>
<a id="__codelineno-0-94" name="__codelineno-0-94" href="#__codelineno-0-94"></a><span class="sd">    if print_impact is False:</span>
<a id="__codelineno-0-95" name="__codelineno-0-95" href="#__codelineno-0-95"></a><span class="sd">        odf : DataFrame</span>
<a id="__codelineno-0-96" name="__codelineno-0-96" href="#__codelineno-0-96"></a><span class="sd">            de-duplicated dataframe if treated, else original input dataframe.</span>
<a id="__codelineno-0-97" name="__codelineno-0-97" href="#__codelineno-0-97"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-98" name="__codelineno-0-98" href="#__codelineno-0-98"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">treatment</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-99" name="__codelineno-0-99" href="#__codelineno-0-99"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-100" name="__codelineno-0-100" href="#__codelineno-0-100"></a>            <span class="s2">&quot;The original idf will be the only output. Set print_impact=True to perform detection without treatment&quot;</span>
<a id="__codelineno-0-101" name="__codelineno-0-101" href="#__codelineno-0-101"></a>        <span class="p">)</span>
<a id="__codelineno-0-102" name="__codelineno-0-102" href="#__codelineno-0-102"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-0-103" name="__codelineno-0-103" href="#__codelineno-0-103"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104" href="#__codelineno-0-104"></a>        <span class="n">num_cols</span><span class="p">,</span> <span class="n">cat_cols</span><span class="p">,</span> <span class="n">other_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)</span>
<a id="__codelineno-0-105" name="__codelineno-0-105" href="#__codelineno-0-105"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span> <span class="o">+</span> <span class="n">cat_cols</span>
<a id="__codelineno-0-106" name="__codelineno-0-106" href="#__codelineno-0-106"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-107" name="__codelineno-0-107" href="#__codelineno-0-107"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-108" name="__codelineno-0-108" href="#__codelineno-0-108"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-109" name="__codelineno-0-109" href="#__codelineno-0-109"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-110" name="__codelineno-0-110" href="#__codelineno-0-110"></a>
<a id="__codelineno-0-111" name="__codelineno-0-111" href="#__codelineno-0-111"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-0-112" name="__codelineno-0-112" href="#__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113" href="#__codelineno-0-113"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-114" name="__codelineno-0-114" href="#__codelineno-0-114"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-115" name="__codelineno-0-115" href="#__codelineno-0-115"></a>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116" href="#__codelineno-0-116"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-117" name="__codelineno-0-117" href="#__codelineno-0-117"></a>    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
<a id="__codelineno-0-118" name="__codelineno-0-118" href="#__codelineno-0-118"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-119" name="__codelineno-0-119" href="#__codelineno-0-119"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120" href="#__codelineno-0-120"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Non-Boolean input for treatment&quot;</span><span class="p">)</span>
<a id="__codelineno-0-121" name="__codelineno-0-121" href="#__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122" href="#__codelineno-0-122"></a>    <span class="n">odf_tmp</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">)</span>
<a id="__codelineno-0-123" name="__codelineno-0-123" href="#__codelineno-0-123"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">odf_tmp</span> <span class="k">if</span> <span class="n">treatment</span> <span class="k">else</span> <span class="n">idf</span>
<a id="__codelineno-0-124" name="__codelineno-0-124" href="#__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125" href="#__codelineno-0-125"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-126" name="__codelineno-0-126" href="#__codelineno-0-126"></a>        <span class="n">idf_count</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-0-127" name="__codelineno-0-127" href="#__codelineno-0-127"></a>        <span class="n">odf_tmp_count</span> <span class="o">=</span> <span class="n">odf_tmp</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-0-128" name="__codelineno-0-128" href="#__codelineno-0-128"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
<a id="__codelineno-0-129" name="__codelineno-0-129" href="#__codelineno-0-129"></a>            <span class="p">[</span>
<a id="__codelineno-0-130" name="__codelineno-0-130" href="#__codelineno-0-130"></a>                <span class="p">[</span><span class="s2">&quot;rows_count&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">idf_count</span><span class="p">)],</span>
<a id="__codelineno-0-131" name="__codelineno-0-131" href="#__codelineno-0-131"></a>                <span class="p">[</span><span class="s2">&quot;unique_rows_count&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">odf_tmp_count</span><span class="p">)],</span>
<a id="__codelineno-0-132" name="__codelineno-0-132" href="#__codelineno-0-132"></a>                <span class="p">[</span><span class="s2">&quot;duplicate_rows&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">idf_count</span> <span class="o">-</span> <span class="n">odf_tmp_count</span><span class="p">)],</span>
<a id="__codelineno-0-133" name="__codelineno-0-133" href="#__codelineno-0-133"></a>                <span class="p">[</span><span class="s2">&quot;duplicate_pct&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">((</span><span class="n">idf_count</span> <span class="o">-</span> <span class="n">odf_tmp_count</span><span class="p">)</span> <span class="o">/</span> <span class="n">idf_count</span><span class="p">,</span> <span class="mi">4</span><span class="p">)],</span>
<a id="__codelineno-0-134" name="__codelineno-0-134" href="#__codelineno-0-134"></a>            <span class="p">],</span>
<a id="__codelineno-0-135" name="__codelineno-0-135" href="#__codelineno-0-135"></a>            <span class="n">schema</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;metric&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">],</span>
<a id="__codelineno-0-136" name="__codelineno-0-136" href="#__codelineno-0-136"></a>        <span class="p">)</span>
<a id="__codelineno-0-137" name="__codelineno-0-137" href="#__codelineno-0-137"></a>
<a id="__codelineno-0-138" name="__codelineno-0-138" href="#__codelineno-0-138"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No. of Rows: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idf_count</span><span class="p">))</span>
<a id="__codelineno-0-139" name="__codelineno-0-139" href="#__codelineno-0-139"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No. of UNIQUE Rows: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">odf_tmp_count</span><span class="p">))</span>
<a id="__codelineno-0-140" name="__codelineno-0-140" href="#__codelineno-0-140"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No. of Duplicate Rows: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idf_count</span> <span class="o">-</span> <span class="n">odf_tmp_count</span><span class="p">))</span>
<a id="__codelineno-0-141" name="__codelineno-0-141" href="#__codelineno-0-141"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-142" name="__codelineno-0-142" href="#__codelineno-0-142"></a>            <span class="s2">&quot;Percentage of Duplicate Rows: &quot;</span>
<a id="__codelineno-0-143" name="__codelineno-0-143" href="#__codelineno-0-143"></a>            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">idf_count</span> <span class="o">-</span> <span class="n">odf_tmp_count</span><span class="p">)</span> <span class="o">/</span> <span class="n">idf_count</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<a id="__codelineno-0-144" name="__codelineno-0-144" href="#__codelineno-0-144"></a>        <span class="p">)</span>
<a id="__codelineno-0-145" name="__codelineno-0-145" href="#__codelineno-0-145"></a>
<a id="__codelineno-0-146" name="__codelineno-0-146" href="#__codelineno-0-146"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-147" name="__codelineno-0-147" href="#__codelineno-0-147"></a>        <span class="k">return</span> <span class="n">odf</span><span class="p">,</span> <span class="n">odf_print</span>
<a id="__codelineno-0-148" name="__codelineno-0-148" href="#__codelineno-0-148"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149" href="#__codelineno-0-149"></a>        <span class="k">return</span> <span class="n">odf</span>
<a id="__codelineno-0-150" name="__codelineno-0-150" href="#__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151" href="#__codelineno-0-151"></a>
<a id="__codelineno-0-152" name="__codelineno-0-152" href="#__codelineno-0-152"></a><span class="k">def</span> <span class="nf">nullRows_detection</span><span class="p">(</span>
<a id="__codelineno-0-153" name="__codelineno-0-153" href="#__codelineno-0-153"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-154" name="__codelineno-0-154" href="#__codelineno-0-154"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-155" name="__codelineno-0-155" href="#__codelineno-0-155"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-0-156" name="__codelineno-0-156" href="#__codelineno-0-156"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-157" name="__codelineno-0-157" href="#__codelineno-0-157"></a>    <span class="n">treatment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-158" name="__codelineno-0-158" href="#__codelineno-0-158"></a>    <span class="n">treatment_threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<a id="__codelineno-0-159" name="__codelineno-0-159" href="#__codelineno-0-159"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-160" name="__codelineno-0-160" href="#__codelineno-0-160"></a><span class="p">):</span>
<a id="__codelineno-0-161" name="__codelineno-0-161" href="#__codelineno-0-161"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-162" name="__codelineno-0-162" href="#__codelineno-0-162"></a><span class="sd">    This function inspects the row quality and computes the number of columns that are missing for a row. This</span>
<a id="__codelineno-0-163" name="__codelineno-0-163" href="#__codelineno-0-163"></a><span class="sd">    metric is further aggregated to check how many columns are missing for how many rows (or % rows). Intuition</span>
<a id="__codelineno-0-164" name="__codelineno-0-164" href="#__codelineno-0-164"></a><span class="sd">    is if too many columns are missing for a row, removing it from the modeling may give better results than relying</span>
<a id="__codelineno-0-165" name="__codelineno-0-165" href="#__codelineno-0-165"></a><span class="sd">    on its imputed values. Therefore as part of the treatment, rows with missing columns above the specified</span>
<a id="__codelineno-0-166" name="__codelineno-0-166" href="#__codelineno-0-166"></a><span class="sd">    threshold are removed. This function returns two dataframes in tuple format; the 1st dataframe is the input</span>
<a id="__codelineno-0-167" name="__codelineno-0-167" href="#__codelineno-0-167"></a><span class="sd">    dataset after filtering rows with a high number of missing columns (if treated else the original dataframe).</span>
<a id="__codelineno-0-168" name="__codelineno-0-168" href="#__codelineno-0-168"></a><span class="sd">    The 2nd dataframe is of schema – null_cols_count, row_count, row_pct, flagged/treated.</span>
<a id="__codelineno-0-169" name="__codelineno-0-169" href="#__codelineno-0-169"></a>
<a id="__codelineno-0-170" name="__codelineno-0-170" href="#__codelineno-0-170"></a><span class="sd">    | null_cols_count | row_count | row_pct | flagged |</span>
<a id="__codelineno-0-171" name="__codelineno-0-171" href="#__codelineno-0-171"></a><span class="sd">    |-----------------|-----------|---------|---------|</span>
<a id="__codelineno-0-172" name="__codelineno-0-172" href="#__codelineno-0-172"></a><span class="sd">    | 5               | 11        | 3.0E-4  | 0       |</span>
<a id="__codelineno-0-173" name="__codelineno-0-173" href="#__codelineno-0-173"></a><span class="sd">    | 7               | 1306      | 0.0401  | 1       |</span>
<a id="__codelineno-0-174" name="__codelineno-0-174" href="#__codelineno-0-174"></a>
<a id="__codelineno-0-175" name="__codelineno-0-175" href="#__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176" href="#__codelineno-0-176"></a><span class="sd">    Interpretation: 1306 rows (4.01% of total rows) have 7 missing columns and flagged for are removal because</span>
<a id="__codelineno-0-177" name="__codelineno-0-177" href="#__codelineno-0-177"></a><span class="sd">    null_cols_count is above the threshold. If treatment is True, then flagged column is renamed as treated to</span>
<a id="__codelineno-0-178" name="__codelineno-0-178" href="#__codelineno-0-178"></a><span class="sd">    show rows which has been removed.</span>
<a id="__codelineno-0-179" name="__codelineno-0-179" href="#__codelineno-0-179"></a>
<a id="__codelineno-0-180" name="__codelineno-0-180" href="#__codelineno-0-180"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-181" name="__codelineno-0-181" href="#__codelineno-0-181"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-182" name="__codelineno-0-182" href="#__codelineno-0-182"></a><span class="sd">    spark</span>
<a id="__codelineno-0-183" name="__codelineno-0-183" href="#__codelineno-0-183"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-0-184" name="__codelineno-0-184" href="#__codelineno-0-184"></a><span class="sd">    idf</span>
<a id="__codelineno-0-185" name="__codelineno-0-185" href="#__codelineno-0-185"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-186" name="__codelineno-0-186" href="#__codelineno-0-186"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-0-187" name="__codelineno-0-187" href="#__codelineno-0-187"></a><span class="sd">        List of columns to analyse e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-188" name="__codelineno-0-188" href="#__codelineno-0-188"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-189" name="__codelineno-0-189" href="#__codelineno-0-189"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-190" name="__codelineno-0-190" href="#__codelineno-0-190"></a><span class="sd">        &quot;all&quot; can be passed to include all columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-0-191" name="__codelineno-0-191" href="#__codelineno-0-191"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in drop_cols argument</span>
<a id="__codelineno-0-192" name="__codelineno-0-192" href="#__codelineno-0-192"></a><span class="sd">        is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-0-193" name="__codelineno-0-193" href="#__codelineno-0-193"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-0-194" name="__codelineno-0-194" href="#__codelineno-0-194"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-195" name="__codelineno-0-195" href="#__codelineno-0-195"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-196" name="__codelineno-0-196" href="#__codelineno-0-196"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-197" name="__codelineno-0-197" href="#__codelineno-0-197"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-0-198" name="__codelineno-0-198" href="#__codelineno-0-198"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-0-199" name="__codelineno-0-199" href="#__codelineno-0-199"></a><span class="sd">    treatment</span>
<a id="__codelineno-0-200" name="__codelineno-0-200" href="#__codelineno-0-200"></a><span class="sd">        Boolean argument – True or False. If True, rows with high no. of null columns (defined by</span>
<a id="__codelineno-0-201" name="__codelineno-0-201" href="#__codelineno-0-201"></a><span class="sd">        treatment_threshold argument) are removed from the input dataframe. (Default value = False)</span>
<a id="__codelineno-0-202" name="__codelineno-0-202" href="#__codelineno-0-202"></a><span class="sd">    treatment_threshold</span>
<a id="__codelineno-0-203" name="__codelineno-0-203" href="#__codelineno-0-203"></a><span class="sd">        Defines % of columns allowed to be Null per row and takes value between 0 to 1.</span>
<a id="__codelineno-0-204" name="__codelineno-0-204" href="#__codelineno-0-204"></a><span class="sd">        If % of null columns is above the threshold for a row, it is removed from the dataframe.</span>
<a id="__codelineno-0-205" name="__codelineno-0-205" href="#__codelineno-0-205"></a><span class="sd">        There is no row removal if the threshold is 1.0. And if the threshold is 0, all rows with</span>
<a id="__codelineno-0-206" name="__codelineno-0-206" href="#__codelineno-0-206"></a><span class="sd">        null value are removed. (Default value = 0.8)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207" href="#__codelineno-0-207"></a><span class="sd">    print_impact</span>
<a id="__codelineno-0-208" name="__codelineno-0-208" href="#__codelineno-0-208"></a><span class="sd">        True, False</span>
<a id="__codelineno-0-209" name="__codelineno-0-209" href="#__codelineno-0-209"></a><span class="sd">        This argument is to print out the statistics.(Default value = False)</span>
<a id="__codelineno-0-210" name="__codelineno-0-210" href="#__codelineno-0-210"></a>
<a id="__codelineno-0-211" name="__codelineno-0-211" href="#__codelineno-0-211"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-212" name="__codelineno-0-212" href="#__codelineno-0-212"></a><span class="sd">    -------</span>
<a id="__codelineno-0-213" name="__codelineno-0-213" href="#__codelineno-0-213"></a><span class="sd">    odf : DataFrame</span>
<a id="__codelineno-0-214" name="__codelineno-0-214" href="#__codelineno-0-214"></a><span class="sd">        Dataframe after row removal if treated, else original input dataframe.</span>
<a id="__codelineno-0-215" name="__codelineno-0-215" href="#__codelineno-0-215"></a><span class="sd">    odf_print : DataFrame</span>
<a id="__codelineno-0-216" name="__codelineno-0-216" href="#__codelineno-0-216"></a><span class="sd">        schema [null_cols_count, row_count, row_pct, flagged/treated].</span>
<a id="__codelineno-0-217" name="__codelineno-0-217" href="#__codelineno-0-217"></a><span class="sd">        null_cols_count is defined as no. of missing columns in a row.</span>
<a id="__codelineno-0-218" name="__codelineno-0-218" href="#__codelineno-0-218"></a><span class="sd">        row_count is no. of rows with null_cols_count missing columns.</span>
<a id="__codelineno-0-219" name="__codelineno-0-219" href="#__codelineno-0-219"></a><span class="sd">        row_pct is row_count divided by number of rows.</span>
<a id="__codelineno-0-220" name="__codelineno-0-220" href="#__codelineno-0-220"></a><span class="sd">        flagged/treated is 1 if null_cols_count is more than (threshold  X Number of Columns), else 0.</span>
<a id="__codelineno-0-221" name="__codelineno-0-221" href="#__codelineno-0-221"></a>
<a id="__codelineno-0-222" name="__codelineno-0-222" href="#__codelineno-0-222"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-223" name="__codelineno-0-223" href="#__codelineno-0-223"></a>
<a id="__codelineno-0-224" name="__codelineno-0-224" href="#__codelineno-0-224"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-225" name="__codelineno-0-225" href="#__codelineno-0-225"></a>        <span class="n">num_cols</span><span class="p">,</span> <span class="n">cat_cols</span><span class="p">,</span> <span class="n">other_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)</span>
<a id="__codelineno-0-226" name="__codelineno-0-226" href="#__codelineno-0-226"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span> <span class="o">+</span> <span class="n">cat_cols</span>
<a id="__codelineno-0-227" name="__codelineno-0-227" href="#__codelineno-0-227"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-228" name="__codelineno-0-228" href="#__codelineno-0-228"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-229" name="__codelineno-0-229" href="#__codelineno-0-229"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-230" name="__codelineno-0-230" href="#__codelineno-0-230"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-231" name="__codelineno-0-231" href="#__codelineno-0-231"></a>
<a id="__codelineno-0-232" name="__codelineno-0-232" href="#__codelineno-0-232"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-0-233" name="__codelineno-0-233" href="#__codelineno-0-233"></a>
<a id="__codelineno-0-234" name="__codelineno-0-234" href="#__codelineno-0-234"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-235" name="__codelineno-0-235" href="#__codelineno-0-235"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-236" name="__codelineno-0-236" href="#__codelineno-0-236"></a>
<a id="__codelineno-0-237" name="__codelineno-0-237" href="#__codelineno-0-237"></a>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
<a id="__codelineno-0-238" name="__codelineno-0-238" href="#__codelineno-0-238"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-239" name="__codelineno-0-239" href="#__codelineno-0-239"></a>    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
<a id="__codelineno-0-240" name="__codelineno-0-240" href="#__codelineno-0-240"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-241" name="__codelineno-0-241" href="#__codelineno-0-241"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-242" name="__codelineno-0-242" href="#__codelineno-0-242"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Non-Boolean input for treatment&quot;</span><span class="p">)</span>
<a id="__codelineno-0-243" name="__codelineno-0-243" href="#__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244" href="#__codelineno-0-244"></a>    <span class="n">treatment_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">treatment_threshold</span><span class="p">)</span>
<a id="__codelineno-0-245" name="__codelineno-0-245" href="#__codelineno-0-245"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">treatment_threshold</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">treatment_threshold</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-246" name="__codelineno-0-246" href="#__codelineno-0-246"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Treatment Threshold Value&quot;</span><span class="p">)</span>
<a id="__codelineno-0-247" name="__codelineno-0-247" href="#__codelineno-0-247"></a>
<a id="__codelineno-0-248" name="__codelineno-0-248" href="#__codelineno-0-248"></a>    <span class="k">def</span> <span class="nf">null_count</span><span class="p">(</span><span class="o">*</span><span class="n">cols</span><span class="p">):</span>
<a id="__codelineno-0-249" name="__codelineno-0-249" href="#__codelineno-0-249"></a>        <span class="k">return</span> <span class="n">cols</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-250" name="__codelineno-0-250" href="#__codelineno-0-250"></a>
<a id="__codelineno-0-251" name="__codelineno-0-251" href="#__codelineno-0-251"></a>    <span class="n">f_null_count</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">udf</span><span class="p">(</span><span class="n">null_count</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">LongType</span><span class="p">())</span>
<a id="__codelineno-0-252" name="__codelineno-0-252" href="#__codelineno-0-252"></a>
<a id="__codelineno-0-253" name="__codelineno-0-253" href="#__codelineno-0-253"></a>    <span class="n">odf_tmp</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;null_cols_count&quot;</span><span class="p">,</span> <span class="n">f_null_count</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_cols</span><span class="p">))</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-254" name="__codelineno-0-254" href="#__codelineno-0-254"></a>        <span class="s2">&quot;flagged&quot;</span><span class="p">,</span>
<a id="__codelineno-0-255" name="__codelineno-0-255" href="#__codelineno-0-255"></a>        <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
<a id="__codelineno-0-256" name="__codelineno-0-256" href="#__codelineno-0-256"></a>            <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;null_cols_count&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">*</span> <span class="n">treatment_threshold</span><span class="p">),</span> <span class="mi">1</span>
<a id="__codelineno-0-257" name="__codelineno-0-257" href="#__codelineno-0-257"></a>        <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-258" name="__codelineno-0-258" href="#__codelineno-0-258"></a>    <span class="p">)</span>
<a id="__codelineno-0-259" name="__codelineno-0-259" href="#__codelineno-0-259"></a>
<a id="__codelineno-0-260" name="__codelineno-0-260" href="#__codelineno-0-260"></a>    <span class="k">if</span> <span class="n">treatment_threshold</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-261" name="__codelineno-0-261" href="#__codelineno-0-261"></a>        <span class="n">odf_tmp</span> <span class="o">=</span> <span class="n">odf_tmp</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-262" name="__codelineno-0-262" href="#__codelineno-0-262"></a>            <span class="s2">&quot;flagged&quot;</span><span class="p">,</span>
<a id="__codelineno-0-263" name="__codelineno-0-263" href="#__codelineno-0-263"></a>            <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;null_cols_count&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-264" name="__codelineno-0-264" href="#__codelineno-0-264"></a>        <span class="p">)</span>
<a id="__codelineno-0-265" name="__codelineno-0-265" href="#__codelineno-0-265"></a>
<a id="__codelineno-0-266" name="__codelineno-0-266" href="#__codelineno-0-266"></a>    <span class="n">odf_print</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-267" name="__codelineno-0-267" href="#__codelineno-0-267"></a>        <span class="n">odf_tmp</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;null_cols_count&quot;</span><span class="p">,</span> <span class="s2">&quot;flagged&quot;</span><span class="p">)</span>
<a id="__codelineno-0-268" name="__codelineno-0-268" href="#__codelineno-0-268"></a>        <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;row_count&quot;</span><span class="p">))</span>
<a id="__codelineno-0-269" name="__codelineno-0-269" href="#__codelineno-0-269"></a>        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;row_pct&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;row_count&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">idf</span><span class="o">.</span><span class="n">count</span><span class="p">()),</span> <span class="mi">4</span><span class="p">))</span>
<a id="__codelineno-0-270" name="__codelineno-0-270" href="#__codelineno-0-270"></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;null_cols_count&quot;</span><span class="p">,</span> <span class="s2">&quot;row_count&quot;</span><span class="p">,</span> <span class="s2">&quot;row_pct&quot;</span><span class="p">,</span> <span class="s2">&quot;flagged&quot;</span><span class="p">)</span>
<a id="__codelineno-0-271" name="__codelineno-0-271" href="#__codelineno-0-271"></a>        <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;null_cols_count&quot;</span><span class="p">)</span>
<a id="__codelineno-0-272" name="__codelineno-0-272" href="#__codelineno-0-272"></a>    <span class="p">)</span>
<a id="__codelineno-0-273" name="__codelineno-0-273" href="#__codelineno-0-273"></a>
<a id="__codelineno-0-274" name="__codelineno-0-274" href="#__codelineno-0-274"></a>    <span class="k">if</span> <span class="n">treatment</span><span class="p">:</span>
<a id="__codelineno-0-275" name="__codelineno-0-275" href="#__codelineno-0-275"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf_tmp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;flagged&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="s2">&quot;null_cols_count&quot;</span><span class="p">,</span> <span class="s2">&quot;flagged&quot;</span><span class="p">])</span>
<a id="__codelineno-0-276" name="__codelineno-0-276" href="#__codelineno-0-276"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">odf_print</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;flagged&quot;</span><span class="p">,</span> <span class="s2">&quot;treated&quot;</span><span class="p">)</span>
<a id="__codelineno-0-277" name="__codelineno-0-277" href="#__codelineno-0-277"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-278" name="__codelineno-0-278" href="#__codelineno-0-278"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-279" name="__codelineno-0-279" href="#__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280" href="#__codelineno-0-280"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-281" name="__codelineno-0-281" href="#__codelineno-0-281"></a>        <span class="n">odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">odf</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
<a id="__codelineno-0-282" name="__codelineno-0-282" href="#__codelineno-0-282"></a>
<a id="__codelineno-0-283" name="__codelineno-0-283" href="#__codelineno-0-283"></a>    <span class="k">return</span> <span class="n">odf</span><span class="p">,</span> <span class="n">odf_print</span>
<a id="__codelineno-0-284" name="__codelineno-0-284" href="#__codelineno-0-284"></a>
<a id="__codelineno-0-285" name="__codelineno-0-285" href="#__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286" href="#__codelineno-0-286"></a><span class="k">def</span> <span class="nf">nullColumns_detection</span><span class="p">(</span>
<a id="__codelineno-0-287" name="__codelineno-0-287" href="#__codelineno-0-287"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-288" name="__codelineno-0-288" href="#__codelineno-0-288"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-289" name="__codelineno-0-289" href="#__codelineno-0-289"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">,</span>
<a id="__codelineno-0-290" name="__codelineno-0-290" href="#__codelineno-0-290"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-291" name="__codelineno-0-291" href="#__codelineno-0-291"></a>    <span class="n">treatment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-292" name="__codelineno-0-292" href="#__codelineno-0-292"></a>    <span class="n">treatment_method</span><span class="o">=</span><span class="s2">&quot;row_removal&quot;</span><span class="p">,</span>
<a id="__codelineno-0-293" name="__codelineno-0-293" href="#__codelineno-0-293"></a>    <span class="n">treatment_configs</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-0-294" name="__codelineno-0-294" href="#__codelineno-0-294"></a>    <span class="n">stats_missing</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-0-295" name="__codelineno-0-295" href="#__codelineno-0-295"></a>    <span class="n">stats_unique</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-0-296" name="__codelineno-0-296" href="#__codelineno-0-296"></a>    <span class="n">stats_mode</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-0-297" name="__codelineno-0-297" href="#__codelineno-0-297"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-298" name="__codelineno-0-298" href="#__codelineno-0-298"></a><span class="p">):</span>
<a id="__codelineno-0-299" name="__codelineno-0-299" href="#__codelineno-0-299"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-300" name="__codelineno-0-300" href="#__codelineno-0-300"></a><span class="sd">    This function inspects the column quality and computes the number of rows that are missing for a column. This</span>
<a id="__codelineno-0-301" name="__codelineno-0-301" href="#__codelineno-0-301"></a><span class="sd">    function also leverages statistics computed as part of the State Generator module. Statistics are not computed</span>
<a id="__codelineno-0-302" name="__codelineno-0-302" href="#__codelineno-0-302"></a><span class="sd">    twice if already available.</span>
<a id="__codelineno-0-303" name="__codelineno-0-303" href="#__codelineno-0-303"></a>
<a id="__codelineno-0-304" name="__codelineno-0-304" href="#__codelineno-0-304"></a><span class="sd">    As part of treatments, it currently supports the following methods – Mean Median Mode (MMM), row_removal,</span>
<a id="__codelineno-0-305" name="__codelineno-0-305" href="#__codelineno-0-305"></a><span class="sd">    column_removal, KNN, regression, Matrix Factorization (MF), auto imputation (auto).</span>
<a id="__codelineno-0-306" name="__codelineno-0-306" href="#__codelineno-0-306"></a><span class="sd">    - MMM replaces null value with the measure of central tendency (mode for categorical features and mean/median for numerical features).</span>
<a id="__codelineno-0-307" name="__codelineno-0-307" href="#__codelineno-0-307"></a><span class="sd">    - row_removal removes all rows with any missing value (output of this treatment is same as nullRows_detection with treatment_threshold of 0).</span>
<a id="__codelineno-0-308" name="__codelineno-0-308" href="#__codelineno-0-308"></a><span class="sd">    - column_removal remove a column if %rows with a missing value is above treatment_threshold.</span>
<a id="__codelineno-0-309" name="__codelineno-0-309" href="#__codelineno-0-309"></a><span class="sd">    - KNN/regression create an imputation model for every to-be-imputed column based on the rest of columns in the list_of_cols columns.</span>
<a id="__codelineno-0-310" name="__codelineno-0-310" href="#__codelineno-0-310"></a><span class="sd">      KNN leverages sklearn.impute.KNNImputer and regression sklearn.impute.IterativeImputer. Since sklearn algorithms are not</span>
<a id="__codelineno-0-311" name="__codelineno-0-311" href="#__codelineno-0-311"></a><span class="sd">      scalable, we create imputation model on sample dataset and apply that model on the whole dataset in distributed manner using</span>
<a id="__codelineno-0-312" name="__codelineno-0-312" href="#__codelineno-0-312"></a><span class="sd">      pyspark pandas udf.</span>
<a id="__codelineno-0-313" name="__codelineno-0-313" href="#__codelineno-0-313"></a><span class="sd">    - Matrix Factorization leverages pyspark.ml.recommendation.ALS algorithm.</span>
<a id="__codelineno-0-314" name="__codelineno-0-314" href="#__codelineno-0-314"></a><span class="sd">    - auto imputation compares all imputation methods and select the best imputation method based on the least RMSE.</span>
<a id="__codelineno-0-315" name="__codelineno-0-315" href="#__codelineno-0-315"></a>
<a id="__codelineno-0-316" name="__codelineno-0-316" href="#__codelineno-0-316"></a><span class="sd">    This function returns two dataframes in tuple format – 1st dataframe is input dataset after imputation (if</span>
<a id="__codelineno-0-317" name="__codelineno-0-317" href="#__codelineno-0-317"></a><span class="sd">    treated else the original dataset) and  2nd dataframe is of schema – attribute, missing_count, missing_pct.</span>
<a id="__codelineno-0-318" name="__codelineno-0-318" href="#__codelineno-0-318"></a>
<a id="__codelineno-0-319" name="__codelineno-0-319" href="#__codelineno-0-319"></a>
<a id="__codelineno-0-320" name="__codelineno-0-320" href="#__codelineno-0-320"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-321" name="__codelineno-0-321" href="#__codelineno-0-321"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-322" name="__codelineno-0-322" href="#__codelineno-0-322"></a><span class="sd">    spark</span>
<a id="__codelineno-0-323" name="__codelineno-0-323" href="#__codelineno-0-323"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-0-324" name="__codelineno-0-324" href="#__codelineno-0-324"></a><span class="sd">    idf</span>
<a id="__codelineno-0-325" name="__codelineno-0-325" href="#__codelineno-0-325"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-326" name="__codelineno-0-326" href="#__codelineno-0-326"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-0-327" name="__codelineno-0-327" href="#__codelineno-0-327"></a><span class="sd">        List of columns to inspect e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-328" name="__codelineno-0-328" href="#__codelineno-0-328"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-329" name="__codelineno-0-329" href="#__codelineno-0-329"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-330" name="__codelineno-0-330" href="#__codelineno-0-330"></a><span class="sd">        &quot;all&quot; can be passed to include all (non-array) columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-0-331" name="__codelineno-0-331" href="#__codelineno-0-331"></a><span class="sd">        &quot;missing&quot; (default) can be passed to include only those columns with missing values.</span>
<a id="__codelineno-0-332" name="__codelineno-0-332" href="#__codelineno-0-332"></a><span class="sd">        One of the usecases where &quot;all&quot; may be preferable over &quot;missing&quot; is when the user wants to save</span>
<a id="__codelineno-0-333" name="__codelineno-0-333" href="#__codelineno-0-333"></a><span class="sd">        the imputation model for the future use e.g. a column may not have missing value in the training</span>
<a id="__codelineno-0-334" name="__codelineno-0-334" href="#__codelineno-0-334"></a><span class="sd">        dataset but missing values may possibly appear in the prediction dataset.</span>
<a id="__codelineno-0-335" name="__codelineno-0-335" href="#__codelineno-0-335"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-0-336" name="__codelineno-0-336" href="#__codelineno-0-336"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols.</span>
<a id="__codelineno-0-337" name="__codelineno-0-337" href="#__codelineno-0-337"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-0-338" name="__codelineno-0-338" href="#__codelineno-0-338"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-339" name="__codelineno-0-339" href="#__codelineno-0-339"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-340" name="__codelineno-0-340" href="#__codelineno-0-340"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-341" name="__codelineno-0-341" href="#__codelineno-0-341"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-0-342" name="__codelineno-0-342" href="#__codelineno-0-342"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-0-343" name="__codelineno-0-343" href="#__codelineno-0-343"></a><span class="sd">    treatment</span>
<a id="__codelineno-0-344" name="__codelineno-0-344" href="#__codelineno-0-344"></a><span class="sd">        Boolean argument – True or False. If True, missing values are treated as per treatment_method argument. (Default value = False)</span>
<a id="__codelineno-0-345" name="__codelineno-0-345" href="#__codelineno-0-345"></a><span class="sd">    treatment_method</span>
<a id="__codelineno-0-346" name="__codelineno-0-346" href="#__codelineno-0-346"></a><span class="sd">        &quot;MMM&quot;, &quot;row_removal&quot;, &quot;column_removal&quot;, &quot;KNN&quot;, &quot;regression&quot;, &quot;MF&quot;, &quot;auto&quot;.</span>
<a id="__codelineno-0-347" name="__codelineno-0-347" href="#__codelineno-0-347"></a><span class="sd">        (Default value = &quot;row_removal&quot;)</span>
<a id="__codelineno-0-348" name="__codelineno-0-348" href="#__codelineno-0-348"></a><span class="sd">    treatment_configs</span>
<a id="__codelineno-0-349" name="__codelineno-0-349" href="#__codelineno-0-349"></a><span class="sd">        Takes input in dictionary format.</span>
<a id="__codelineno-0-350" name="__codelineno-0-350" href="#__codelineno-0-350"></a><span class="sd">        For column_removal treatment, key ‘treatment_threshold’ is provided with a value between 0 to 1 (remove column</span>
<a id="__codelineno-0-351" name="__codelineno-0-351" href="#__codelineno-0-351"></a><span class="sd">        if % of rows with missing value is above this threshold)</span>
<a id="__codelineno-0-352" name="__codelineno-0-352" href="#__codelineno-0-352"></a><span class="sd">        For row_removal, this argument can be skipped.</span>
<a id="__codelineno-0-353" name="__codelineno-0-353" href="#__codelineno-0-353"></a><span class="sd">        For MMM, arguments corresponding to imputation_MMM function (transformer module) are provided,</span>
<a id="__codelineno-0-354" name="__codelineno-0-354" href="#__codelineno-0-354"></a><span class="sd">        where each key is an argument from imputation_MMM function.</span>
<a id="__codelineno-0-355" name="__codelineno-0-355" href="#__codelineno-0-355"></a><span class="sd">        For KNN, arguments corresponding to imputation_sklearn function (transformer module) are provided,</span>
<a id="__codelineno-0-356" name="__codelineno-0-356" href="#__codelineno-0-356"></a><span class="sd">        where each key is an argument from imputation_sklearn function. method_type should be &quot;KNN&quot;</span>
<a id="__codelineno-0-357" name="__codelineno-0-357" href="#__codelineno-0-357"></a><span class="sd">        For regression, arguments corresponding to imputation_sklearn function (transformer module) are provided,</span>
<a id="__codelineno-0-358" name="__codelineno-0-358" href="#__codelineno-0-358"></a><span class="sd">        where each key is an argument from imputation_sklearn function. method_type should be &quot;regression&quot;</span>
<a id="__codelineno-0-359" name="__codelineno-0-359" href="#__codelineno-0-359"></a><span class="sd">        For MF, arguments corresponding to imputation_matrixFactorization function (transformer module) are provided,</span>
<a id="__codelineno-0-360" name="__codelineno-0-360" href="#__codelineno-0-360"></a><span class="sd">        where each key is an argument from imputation_matrixFactorization function.</span>
<a id="__codelineno-0-361" name="__codelineno-0-361" href="#__codelineno-0-361"></a><span class="sd">        For auto, arguments corresponding to auto_imputation function (transformer module) are provided,</span>
<a id="__codelineno-0-362" name="__codelineno-0-362" href="#__codelineno-0-362"></a><span class="sd">        where each key is an argument from auto_imputation function. (Default value = {})</span>
<a id="__codelineno-0-363" name="__codelineno-0-363" href="#__codelineno-0-363"></a><span class="sd">    stats_missing</span>
<a id="__codelineno-0-364" name="__codelineno-0-364" href="#__codelineno-0-364"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-0-365" name="__codelineno-0-365" href="#__codelineno-0-365"></a><span class="sd">        to read pre-saved statistics on missing count/pct i.e. if measures_of_counts or</span>
<a id="__codelineno-0-366" name="__codelineno-0-366" href="#__codelineno-0-366"></a><span class="sd">        missingCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-0-367" name="__codelineno-0-367" href="#__codelineno-0-367"></a><span class="sd">    stats_unique</span>
<a id="__codelineno-0-368" name="__codelineno-0-368" href="#__codelineno-0-368"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-0-369" name="__codelineno-0-369" href="#__codelineno-0-369"></a><span class="sd">        to read pre-saved statistics on unique value count i.e. if measures_of_cardinality or</span>
<a id="__codelineno-0-370" name="__codelineno-0-370" href="#__codelineno-0-370"></a><span class="sd">        uniqueCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-0-371" name="__codelineno-0-371" href="#__codelineno-0-371"></a><span class="sd">    stats_mode</span>
<a id="__codelineno-0-372" name="__codelineno-0-372" href="#__codelineno-0-372"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-0-373" name="__codelineno-0-373" href="#__codelineno-0-373"></a><span class="sd">        to read pre-saved statistics on most frequently seen values i.e. if measures_of_centralTendency or</span>
<a id="__codelineno-0-374" name="__codelineno-0-374" href="#__codelineno-0-374"></a><span class="sd">        mode_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-0-375" name="__codelineno-0-375" href="#__codelineno-0-375"></a><span class="sd">    print_impact</span>
<a id="__codelineno-0-376" name="__codelineno-0-376" href="#__codelineno-0-376"></a><span class="sd">        True, False</span>
<a id="__codelineno-0-377" name="__codelineno-0-377" href="#__codelineno-0-377"></a><span class="sd">        This argument is to print out the statistics or the impact of imputation (if applicable).(Default value = False)</span>
<a id="__codelineno-0-378" name="__codelineno-0-378" href="#__codelineno-0-378"></a>
<a id="__codelineno-0-379" name="__codelineno-0-379" href="#__codelineno-0-379"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-380" name="__codelineno-0-380" href="#__codelineno-0-380"></a><span class="sd">    -------</span>
<a id="__codelineno-0-381" name="__codelineno-0-381" href="#__codelineno-0-381"></a><span class="sd">    odf : DataFrame</span>
<a id="__codelineno-0-382" name="__codelineno-0-382" href="#__codelineno-0-382"></a><span class="sd">        Imputed dataframe if treated, else original input dataframe.</span>
<a id="__codelineno-0-383" name="__codelineno-0-383" href="#__codelineno-0-383"></a><span class="sd">    odf_print : DataFrame</span>
<a id="__codelineno-0-384" name="__codelineno-0-384" href="#__codelineno-0-384"></a><span class="sd">        schema [attribute, missing_count, missing_pct].</span>
<a id="__codelineno-0-385" name="__codelineno-0-385" href="#__codelineno-0-385"></a><span class="sd">        missing_count is number of rows with null values for an attribute, and</span>
<a id="__codelineno-0-386" name="__codelineno-0-386" href="#__codelineno-0-386"></a><span class="sd">        missing_pct is missing_count divided by number of rows.</span>
<a id="__codelineno-0-387" name="__codelineno-0-387" href="#__codelineno-0-387"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-388" name="__codelineno-0-388" href="#__codelineno-0-388"></a>    <span class="k">if</span> <span class="n">stats_missing</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-0-389" name="__codelineno-0-389" href="#__codelineno-0-389"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">)</span>
<a id="__codelineno-0-390" name="__codelineno-0-390" href="#__codelineno-0-390"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-391" name="__codelineno-0-391" href="#__codelineno-0-391"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_missing</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-0-392" name="__codelineno-0-392" href="#__codelineno-0-392"></a>            <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_count&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_pct&quot;</span>
<a id="__codelineno-0-393" name="__codelineno-0-393" href="#__codelineno-0-393"></a>        <span class="p">)</span>
<a id="__codelineno-0-394" name="__codelineno-0-394" href="#__codelineno-0-394"></a>
<a id="__codelineno-0-395" name="__codelineno-0-395" href="#__codelineno-0-395"></a>    <span class="n">missing_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-396" name="__codelineno-0-396" href="#__codelineno-0-396"></a>        <span class="n">odf_print</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-397" name="__codelineno-0-397" href="#__codelineno-0-397"></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-0-398" name="__codelineno-0-398" href="#__codelineno-0-398"></a>        <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-399" name="__codelineno-0-399" href="#__codelineno-0-399"></a>        <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-400" name="__codelineno-0-400" href="#__codelineno-0-400"></a>    <span class="p">)</span>
<a id="__codelineno-0-401" name="__codelineno-0-401" href="#__codelineno-0-401"></a>
<a id="__codelineno-0-402" name="__codelineno-0-402" href="#__codelineno-0-402"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-403" name="__codelineno-0-403" href="#__codelineno-0-403"></a>        <span class="n">num_cols</span><span class="p">,</span> <span class="n">cat_cols</span><span class="p">,</span> <span class="n">other_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)</span>
<a id="__codelineno-0-404" name="__codelineno-0-404" href="#__codelineno-0-404"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span> <span class="o">+</span> <span class="n">cat_cols</span>
<a id="__codelineno-0-405" name="__codelineno-0-405" href="#__codelineno-0-405"></a>
<a id="__codelineno-0-406" name="__codelineno-0-406" href="#__codelineno-0-406"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;missing&quot;</span><span class="p">:</span>
<a id="__codelineno-0-407" name="__codelineno-0-407" href="#__codelineno-0-407"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">missing_cols</span>
<a id="__codelineno-0-408" name="__codelineno-0-408" href="#__codelineno-0-408"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-409" name="__codelineno-0-409" href="#__codelineno-0-409"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-410" name="__codelineno-0-410" href="#__codelineno-0-410"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-411" name="__codelineno-0-411" href="#__codelineno-0-411"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-412" name="__codelineno-0-412" href="#__codelineno-0-412"></a>
<a id="__codelineno-0-413" name="__codelineno-0-413" href="#__codelineno-0-413"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-0-414" name="__codelineno-0-414" href="#__codelineno-0-414"></a>
<a id="__codelineno-0-415" name="__codelineno-0-415" href="#__codelineno-0-415"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-416" name="__codelineno-0-416" href="#__codelineno-0-416"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No Null Detection - No column(s) to analyze&quot;</span><span class="p">)</span>
<a id="__codelineno-0-417" name="__codelineno-0-417" href="#__codelineno-0-417"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-418" name="__codelineno-0-418" href="#__codelineno-0-418"></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">StructType</span><span class="p">(</span>
<a id="__codelineno-0-419" name="__codelineno-0-419" href="#__codelineno-0-419"></a>            <span class="p">[</span>
<a id="__codelineno-0-420" name="__codelineno-0-420" href="#__codelineno-0-420"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-421" name="__codelineno-0-421" href="#__codelineno-0-421"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-422" name="__codelineno-0-422" href="#__codelineno-0-422"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-423" name="__codelineno-0-423" href="#__codelineno-0-423"></a>            <span class="p">]</span>
<a id="__codelineno-0-424" name="__codelineno-0-424" href="#__codelineno-0-424"></a>        <span class="p">)</span>
<a id="__codelineno-0-425" name="__codelineno-0-425" href="#__codelineno-0-425"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">emptyRDD</span><span class="p">()</span><span class="o">.</span><span class="n">toDF</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
<a id="__codelineno-0-426" name="__codelineno-0-426" href="#__codelineno-0-426"></a>        <span class="k">return</span> <span class="n">odf</span><span class="p">,</span> <span class="n">odf_print</span>
<a id="__codelineno-0-427" name="__codelineno-0-427" href="#__codelineno-0-427"></a>
<a id="__codelineno-0-428" name="__codelineno-0-428" href="#__codelineno-0-428"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-429" name="__codelineno-0-429" href="#__codelineno-0-429"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-430" name="__codelineno-0-430" href="#__codelineno-0-430"></a>
<a id="__codelineno-0-431" name="__codelineno-0-431" href="#__codelineno-0-431"></a>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
<a id="__codelineno-0-432" name="__codelineno-0-432" href="#__codelineno-0-432"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-433" name="__codelineno-0-433" href="#__codelineno-0-433"></a>    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
<a id="__codelineno-0-434" name="__codelineno-0-434" href="#__codelineno-0-434"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-435" name="__codelineno-0-435" href="#__codelineno-0-435"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-436" name="__codelineno-0-436" href="#__codelineno-0-436"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Non-Boolean input for treatment&quot;</span><span class="p">)</span>
<a id="__codelineno-0-437" name="__codelineno-0-437" href="#__codelineno-0-437"></a>    <span class="k">if</span> <span class="n">treatment_method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
<a id="__codelineno-0-438" name="__codelineno-0-438" href="#__codelineno-0-438"></a>        <span class="s2">&quot;MMM&quot;</span><span class="p">,</span>
<a id="__codelineno-0-439" name="__codelineno-0-439" href="#__codelineno-0-439"></a>        <span class="s2">&quot;row_removal&quot;</span><span class="p">,</span>
<a id="__codelineno-0-440" name="__codelineno-0-440" href="#__codelineno-0-440"></a>        <span class="s2">&quot;column_removal&quot;</span><span class="p">,</span>
<a id="__codelineno-0-441" name="__codelineno-0-441" href="#__codelineno-0-441"></a>        <span class="s2">&quot;KNN&quot;</span><span class="p">,</span>
<a id="__codelineno-0-442" name="__codelineno-0-442" href="#__codelineno-0-442"></a>        <span class="s2">&quot;regression&quot;</span><span class="p">,</span>
<a id="__codelineno-0-443" name="__codelineno-0-443" href="#__codelineno-0-443"></a>        <span class="s2">&quot;MF&quot;</span><span class="p">,</span>
<a id="__codelineno-0-444" name="__codelineno-0-444" href="#__codelineno-0-444"></a>        <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
<a id="__codelineno-0-445" name="__codelineno-0-445" href="#__codelineno-0-445"></a>    <span class="p">):</span>
<a id="__codelineno-0-446" name="__codelineno-0-446" href="#__codelineno-0-446"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for method_type&quot;</span><span class="p">)</span>
<a id="__codelineno-0-447" name="__codelineno-0-447" href="#__codelineno-0-447"></a>
<a id="__codelineno-0-448" name="__codelineno-0-448" href="#__codelineno-0-448"></a>    <span class="n">treatment_threshold</span> <span class="o">=</span> <span class="n">treatment_configs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;treatment_threshold&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-449" name="__codelineno-0-449" href="#__codelineno-0-449"></a>    <span class="k">if</span> <span class="n">treatment_threshold</span><span class="p">:</span>
<a id="__codelineno-0-450" name="__codelineno-0-450" href="#__codelineno-0-450"></a>        <span class="n">treatment_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">treatment_threshold</span><span class="p">)</span>
<a id="__codelineno-0-451" name="__codelineno-0-451" href="#__codelineno-0-451"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-452" name="__codelineno-0-452" href="#__codelineno-0-452"></a>        <span class="k">if</span> <span class="n">treatment_method</span> <span class="o">==</span> <span class="s2">&quot;column_removal&quot;</span><span class="p">:</span>
<a id="__codelineno-0-453" name="__codelineno-0-453" href="#__codelineno-0-453"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for column removal threshold&quot;</span><span class="p">)</span>
<a id="__codelineno-0-454" name="__codelineno-0-454" href="#__codelineno-0-454"></a>
<a id="__codelineno-0-455" name="__codelineno-0-455" href="#__codelineno-0-455"></a>    <span class="n">odf_print</span> <span class="o">=</span> <span class="n">odf_print</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-0-456" name="__codelineno-0-456" href="#__codelineno-0-456"></a>
<a id="__codelineno-0-457" name="__codelineno-0-457" href="#__codelineno-0-457"></a>    <span class="k">if</span> <span class="n">treatment</span><span class="p">:</span>
<a id="__codelineno-0-458" name="__codelineno-0-458" href="#__codelineno-0-458"></a>        <span class="k">if</span> <span class="n">treatment_threshold</span><span class="p">:</span>
<a id="__codelineno-0-459" name="__codelineno-0-459" href="#__codelineno-0-459"></a>            <span class="n">threshold_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-460" name="__codelineno-0-460" href="#__codelineno-0-460"></a>                <span class="n">odf_print</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-0-461" name="__codelineno-0-461" href="#__codelineno-0-461"></a>                <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">treatment_threshold</span><span class="p">)</span>
<a id="__codelineno-0-462" name="__codelineno-0-462" href="#__codelineno-0-462"></a>                <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-0-463" name="__codelineno-0-463" href="#__codelineno-0-463"></a>                <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-464" name="__codelineno-0-464" href="#__codelineno-0-464"></a>                <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-465" name="__codelineno-0-465" href="#__codelineno-0-465"></a>            <span class="p">)</span>
<a id="__codelineno-0-466" name="__codelineno-0-466" href="#__codelineno-0-466"></a>
<a id="__codelineno-0-467" name="__codelineno-0-467" href="#__codelineno-0-467"></a>        <span class="k">if</span> <span class="n">treatment_method</span> <span class="o">==</span> <span class="s2">&quot;column_removal&quot;</span><span class="p">:</span>
<a id="__codelineno-0-468" name="__codelineno-0-468" href="#__codelineno-0-468"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="n">threshold_cols</span><span class="p">)</span>
<a id="__codelineno-0-469" name="__codelineno-0-469" href="#__codelineno-0-469"></a>            <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-470" name="__codelineno-0-470" href="#__codelineno-0-470"></a>                <span class="n">odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-0-471" name="__codelineno-0-471" href="#__codelineno-0-471"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Removed Columns: &quot;</span><span class="p">,</span> <span class="n">threshold_cols</span><span class="p">)</span>
<a id="__codelineno-0-472" name="__codelineno-0-472" href="#__codelineno-0-472"></a>
<a id="__codelineno-0-473" name="__codelineno-0-473" href="#__codelineno-0-473"></a>        <span class="k">if</span> <span class="n">treatment_method</span> <span class="o">==</span> <span class="s2">&quot;row_removal&quot;</span><span class="p">:</span>
<a id="__codelineno-0-474" name="__codelineno-0-474" href="#__codelineno-0-474"></a>            <span class="n">remove_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-475" name="__codelineno-0-475" href="#__codelineno-0-475"></a>                <span class="n">odf_print</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-0-476" name="__codelineno-0-476" href="#__codelineno-0-476"></a>                <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-0-477" name="__codelineno-0-477" href="#__codelineno-0-477"></a>                <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-0-478" name="__codelineno-0-478" href="#__codelineno-0-478"></a>                <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-479" name="__codelineno-0-479" href="#__codelineno-0-479"></a>                <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-480" name="__codelineno-0-480" href="#__codelineno-0-480"></a>            <span class="p">)</span>
<a id="__codelineno-0-481" name="__codelineno-0-481" href="#__codelineno-0-481"></a>            <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">remove_cols</span><span class="p">]</span>
<a id="__codelineno-0-482" name="__codelineno-0-482" href="#__codelineno-0-482"></a>            <span class="k">if</span> <span class="n">treatment_threshold</span><span class="p">:</span>
<a id="__codelineno-0-483" name="__codelineno-0-483" href="#__codelineno-0-483"></a>                <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">threshold_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">remove_cols</span><span class="p">]</span>
<a id="__codelineno-0-484" name="__codelineno-0-484" href="#__codelineno-0-484"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-0-485" name="__codelineno-0-485" href="#__codelineno-0-485"></a>
<a id="__codelineno-0-486" name="__codelineno-0-486" href="#__codelineno-0-486"></a>            <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-487" name="__codelineno-0-487" href="#__codelineno-0-487"></a>                <span class="n">odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-0-488" name="__codelineno-0-488" href="#__codelineno-0-488"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before Count: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idf</span><span class="o">.</span><span class="n">count</span><span class="p">()))</span>
<a id="__codelineno-0-489" name="__codelineno-0-489" href="#__codelineno-0-489"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After Count: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">odf</span><span class="o">.</span><span class="n">count</span><span class="p">()))</span>
<a id="__codelineno-0-490" name="__codelineno-0-490" href="#__codelineno-0-490"></a>
<a id="__codelineno-0-491" name="__codelineno-0-491" href="#__codelineno-0-491"></a>        <span class="k">if</span> <span class="n">treatment_method</span> <span class="o">==</span> <span class="s2">&quot;MMM&quot;</span><span class="p">:</span>
<a id="__codelineno-0-492" name="__codelineno-0-492" href="#__codelineno-0-492"></a>            <span class="k">if</span> <span class="n">stats_unique</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-0-493" name="__codelineno-0-493" href="#__codelineno-0-493"></a>                <span class="n">remove_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-494" name="__codelineno-0-494" href="#__codelineno-0-494"></a>                    <span class="n">uniqueCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-0-495" name="__codelineno-0-495" href="#__codelineno-0-495"></a>                    <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;unique_values&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-496" name="__codelineno-0-496" href="#__codelineno-0-496"></a>                    <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-0-497" name="__codelineno-0-497" href="#__codelineno-0-497"></a>                    <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-498" name="__codelineno-0-498" href="#__codelineno-0-498"></a>                    <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-499" name="__codelineno-0-499" href="#__codelineno-0-499"></a>                <span class="p">)</span>
<a id="__codelineno-0-500" name="__codelineno-0-500" href="#__codelineno-0-500"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-501" name="__codelineno-0-501" href="#__codelineno-0-501"></a>                <span class="n">remove_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-502" name="__codelineno-0-502" href="#__codelineno-0-502"></a>                    <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_unique</span><span class="p">)</span>
<a id="__codelineno-0-503" name="__codelineno-0-503" href="#__codelineno-0-503"></a>                    <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;unique_values&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-504" name="__codelineno-0-504" href="#__codelineno-0-504"></a>                    <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-0-505" name="__codelineno-0-505" href="#__codelineno-0-505"></a>                    <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-506" name="__codelineno-0-506" href="#__codelineno-0-506"></a>                    <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-507" name="__codelineno-0-507" href="#__codelineno-0-507"></a>                <span class="p">)</span>
<a id="__codelineno-0-508" name="__codelineno-0-508" href="#__codelineno-0-508"></a>            <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">remove_cols</span><span class="p">]</span>
<a id="__codelineno-0-509" name="__codelineno-0-509" href="#__codelineno-0-509"></a>            <span class="k">if</span> <span class="n">treatment_threshold</span><span class="p">:</span>
<a id="__codelineno-0-510" name="__codelineno-0-510" href="#__codelineno-0-510"></a>                <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">threshold_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">remove_cols</span><span class="p">]</span>
<a id="__codelineno-0-511" name="__codelineno-0-511" href="#__codelineno-0-511"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">imputation_MMM</span><span class="p">(</span>
<a id="__codelineno-0-512" name="__codelineno-0-512" href="#__codelineno-0-512"></a>                <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-513" name="__codelineno-0-513" href="#__codelineno-0-513"></a>                <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-514" name="__codelineno-0-514" href="#__codelineno-0-514"></a>                <span class="n">list_of_cols</span><span class="p">,</span>
<a id="__codelineno-0-515" name="__codelineno-0-515" href="#__codelineno-0-515"></a>                <span class="o">**</span><span class="n">treatment_configs</span><span class="p">,</span>
<a id="__codelineno-0-516" name="__codelineno-0-516" href="#__codelineno-0-516"></a>                <span class="n">stats_missing</span><span class="o">=</span><span class="n">stats_missing</span><span class="p">,</span>
<a id="__codelineno-0-517" name="__codelineno-0-517" href="#__codelineno-0-517"></a>                <span class="n">stats_mode</span><span class="o">=</span><span class="n">stats_mode</span><span class="p">,</span>
<a id="__codelineno-0-518" name="__codelineno-0-518" href="#__codelineno-0-518"></a>                <span class="n">print_impact</span><span class="o">=</span><span class="n">print_impact</span>
<a id="__codelineno-0-519" name="__codelineno-0-519" href="#__codelineno-0-519"></a>            <span class="p">)</span>
<a id="__codelineno-0-520" name="__codelineno-0-520" href="#__codelineno-0-520"></a>
<a id="__codelineno-0-521" name="__codelineno-0-521" href="#__codelineno-0-521"></a>        <span class="k">if</span> <span class="n">treatment_method</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;KNN&quot;</span><span class="p">,</span> <span class="s2">&quot;regression&quot;</span><span class="p">,</span> <span class="s2">&quot;MF&quot;</span><span class="p">,</span> <span class="s2">&quot;auto&quot;</span><span class="p">):</span>
<a id="__codelineno-0-522" name="__codelineno-0-522" href="#__codelineno-0-522"></a>
<a id="__codelineno-0-523" name="__codelineno-0-523" href="#__codelineno-0-523"></a>            <span class="k">if</span> <span class="n">treatment_threshold</span><span class="p">:</span>
<a id="__codelineno-0-524" name="__codelineno-0-524" href="#__codelineno-0-524"></a>                <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">threshold_cols</span>
<a id="__codelineno-0-525" name="__codelineno-0-525" href="#__codelineno-0-525"></a>            <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">num_cols</span><span class="p">]</span>
<a id="__codelineno-0-526" name="__codelineno-0-526" href="#__codelineno-0-526"></a>            <span class="n">func_mapping</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-527" name="__codelineno-0-527" href="#__codelineno-0-527"></a>                <span class="s2">&quot;KNN&quot;</span><span class="p">:</span> <span class="n">imputation_sklearn</span><span class="p">,</span>
<a id="__codelineno-0-528" name="__codelineno-0-528" href="#__codelineno-0-528"></a>                <span class="s2">&quot;regression&quot;</span><span class="p">:</span> <span class="n">imputation_sklearn</span><span class="p">,</span>
<a id="__codelineno-0-529" name="__codelineno-0-529" href="#__codelineno-0-529"></a>                <span class="s2">&quot;MF&quot;</span><span class="p">:</span> <span class="n">imputation_matrixFactorization</span><span class="p">,</span>
<a id="__codelineno-0-530" name="__codelineno-0-530" href="#__codelineno-0-530"></a>                <span class="s2">&quot;auto&quot;</span><span class="p">:</span> <span class="n">auto_imputation</span><span class="p">,</span>
<a id="__codelineno-0-531" name="__codelineno-0-531" href="#__codelineno-0-531"></a>            <span class="p">}</span>
<a id="__codelineno-0-532" name="__codelineno-0-532" href="#__codelineno-0-532"></a>            <span class="n">func</span> <span class="o">=</span> <span class="n">func_mapping</span><span class="p">[</span><span class="n">treatment_method</span><span class="p">]</span>
<a id="__codelineno-0-533" name="__codelineno-0-533" href="#__codelineno-0-533"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span>
<a id="__codelineno-0-534" name="__codelineno-0-534" href="#__codelineno-0-534"></a>                <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-535" name="__codelineno-0-535" href="#__codelineno-0-535"></a>                <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-536" name="__codelineno-0-536" href="#__codelineno-0-536"></a>                <span class="n">list_of_cols</span><span class="p">,</span>
<a id="__codelineno-0-537" name="__codelineno-0-537" href="#__codelineno-0-537"></a>                <span class="o">**</span><span class="n">treatment_configs</span><span class="p">,</span>
<a id="__codelineno-0-538" name="__codelineno-0-538" href="#__codelineno-0-538"></a>                <span class="n">stats_missing</span><span class="o">=</span><span class="n">stats_missing</span><span class="p">,</span>
<a id="__codelineno-0-539" name="__codelineno-0-539" href="#__codelineno-0-539"></a>                <span class="n">print_impact</span><span class="o">=</span><span class="n">print_impact</span>
<a id="__codelineno-0-540" name="__codelineno-0-540" href="#__codelineno-0-540"></a>            <span class="p">)</span>
<a id="__codelineno-0-541" name="__codelineno-0-541" href="#__codelineno-0-541"></a>
<a id="__codelineno-0-542" name="__codelineno-0-542" href="#__codelineno-0-542"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-543" name="__codelineno-0-543" href="#__codelineno-0-543"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-544" name="__codelineno-0-544" href="#__codelineno-0-544"></a>        <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-545" name="__codelineno-0-545" href="#__codelineno-0-545"></a>            <span class="n">odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-0-546" name="__codelineno-0-546" href="#__codelineno-0-546"></a>
<a id="__codelineno-0-547" name="__codelineno-0-547" href="#__codelineno-0-547"></a>    <span class="k">return</span> <span class="n">odf</span><span class="p">,</span> <span class="n">odf_print</span>
<a id="__codelineno-0-548" name="__codelineno-0-548" href="#__codelineno-0-548"></a>
<a id="__codelineno-0-549" name="__codelineno-0-549" href="#__codelineno-0-549"></a>
<a id="__codelineno-0-550" name="__codelineno-0-550" href="#__codelineno-0-550"></a><span class="k">def</span> <span class="nf">outlier_detection</span><span class="p">(</span>
<a id="__codelineno-0-551" name="__codelineno-0-551" href="#__codelineno-0-551"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-552" name="__codelineno-0-552" href="#__codelineno-0-552"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-553" name="__codelineno-0-553" href="#__codelineno-0-553"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-0-554" name="__codelineno-0-554" href="#__codelineno-0-554"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-555" name="__codelineno-0-555" href="#__codelineno-0-555"></a>    <span class="n">detection_side</span><span class="o">=</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span>
<a id="__codelineno-0-556" name="__codelineno-0-556" href="#__codelineno-0-556"></a>    <span class="n">detection_configs</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-557" name="__codelineno-0-557" href="#__codelineno-0-557"></a>        <span class="s2">&quot;pctile_lower&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
<a id="__codelineno-0-558" name="__codelineno-0-558" href="#__codelineno-0-558"></a>        <span class="s2">&quot;pctile_upper&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
<a id="__codelineno-0-559" name="__codelineno-0-559" href="#__codelineno-0-559"></a>        <span class="s2">&quot;stdev_lower&quot;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
<a id="__codelineno-0-560" name="__codelineno-0-560" href="#__codelineno-0-560"></a>        <span class="s2">&quot;stdev_upper&quot;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
<a id="__codelineno-0-561" name="__codelineno-0-561" href="#__codelineno-0-561"></a>        <span class="s2">&quot;IQR_lower&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>
<a id="__codelineno-0-562" name="__codelineno-0-562" href="#__codelineno-0-562"></a>        <span class="s2">&quot;IQR_upper&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>
<a id="__codelineno-0-563" name="__codelineno-0-563" href="#__codelineno-0-563"></a>        <span class="s2">&quot;min_validation&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-564" name="__codelineno-0-564" href="#__codelineno-0-564"></a>    <span class="p">},</span>
<a id="__codelineno-0-565" name="__codelineno-0-565" href="#__codelineno-0-565"></a>    <span class="n">treatment</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-566" name="__codelineno-0-566" href="#__codelineno-0-566"></a>    <span class="n">treatment_method</span><span class="o">=</span><span class="s2">&quot;value_replacement&quot;</span><span class="p">,</span>
<a id="__codelineno-0-567" name="__codelineno-0-567" href="#__codelineno-0-567"></a>    <span class="n">pre_existing_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-568" name="__codelineno-0-568" href="#__codelineno-0-568"></a>    <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-0-569" name="__codelineno-0-569" href="#__codelineno-0-569"></a>    <span class="n">sample_size</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span>
<a id="__codelineno-0-570" name="__codelineno-0-570" href="#__codelineno-0-570"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-0-571" name="__codelineno-0-571" href="#__codelineno-0-571"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-572" name="__codelineno-0-572" href="#__codelineno-0-572"></a><span class="p">):</span>
<a id="__codelineno-0-573" name="__codelineno-0-573" href="#__codelineno-0-573"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-574" name="__codelineno-0-574" href="#__codelineno-0-574"></a><span class="sd">    In Machine Learning, outlier detection identifies values that deviate drastically from the rest of the</span>
<a id="__codelineno-0-575" name="__codelineno-0-575" href="#__codelineno-0-575"></a><span class="sd">    attribute values. An outlier may be caused simply by chance, measurement error, or inherent heavy-tailed</span>
<a id="__codelineno-0-576" name="__codelineno-0-576" href="#__codelineno-0-576"></a><span class="sd">    distribution. This function identifies extreme values in both directions (or any direction provided by the user</span>
<a id="__codelineno-0-577" name="__codelineno-0-577" href="#__codelineno-0-577"></a><span class="sd">    via detection_side argument). By default, outlier is identified by 3 different methodologies and tagged an outlier</span>
<a id="__codelineno-0-578" name="__codelineno-0-578" href="#__codelineno-0-578"></a><span class="sd">    only if it is validated by at least 2 methods. Users can customize the methodologies they would like to apply and</span>
<a id="__codelineno-0-579" name="__codelineno-0-579" href="#__codelineno-0-579"></a><span class="sd">    the minimum number of methodologies to be validated under detection_configs argument.</span>
<a id="__codelineno-0-580" name="__codelineno-0-580" href="#__codelineno-0-580"></a>
<a id="__codelineno-0-581" name="__codelineno-0-581" href="#__codelineno-0-581"></a><span class="sd">    - Percentile Method: In this methodology, a value higher than a certain (default 95th) percentile value is considered</span>
<a id="__codelineno-0-582" name="__codelineno-0-582" href="#__codelineno-0-582"></a><span class="sd">      as an outlier. Similarly, a value lower than a certain (default 5th) percentile value is considered as an outlier.</span>
<a id="__codelineno-0-583" name="__codelineno-0-583" href="#__codelineno-0-583"></a>
<a id="__codelineno-0-584" name="__codelineno-0-584" href="#__codelineno-0-584"></a><span class="sd">    - Standard Deviation Method: In this methodology, if a value is a certain number of standard deviations (default 3)</span>
<a id="__codelineno-0-585" name="__codelineno-0-585" href="#__codelineno-0-585"></a><span class="sd">      away from the mean, it is identified as an outlier.</span>
<a id="__codelineno-0-586" name="__codelineno-0-586" href="#__codelineno-0-586"></a>
<a id="__codelineno-0-587" name="__codelineno-0-587" href="#__codelineno-0-587"></a><span class="sd">    - Interquartile Range (IQR) Method: if a value is a certain number of IQRs (default 1.5) below Q1 or above Q3,</span>
<a id="__codelineno-0-588" name="__codelineno-0-588" href="#__codelineno-0-588"></a><span class="sd">    it is identified as an outlier. Q1 is in first quantile/25th percentile, Q3 is in third quantile/75th percentile,</span>
<a id="__codelineno-0-589" name="__codelineno-0-589" href="#__codelineno-0-589"></a><span class="sd">    and IQR is the difference between third quantile &amp; first quantile.</span>
<a id="__codelineno-0-590" name="__codelineno-0-590" href="#__codelineno-0-590"></a>
<a id="__codelineno-0-591" name="__codelineno-0-591" href="#__codelineno-0-591"></a><span class="sd">    As part of treatments available, outlier values can be replaced by null so that it can be imputed by a reliable</span>
<a id="__codelineno-0-592" name="__codelineno-0-592" href="#__codelineno-0-592"></a><span class="sd">    imputation methodology (null_replacement). It can also be replaced by maximum or minimum permissible by above</span>
<a id="__codelineno-0-593" name="__codelineno-0-593" href="#__codelineno-0-593"></a><span class="sd">    methodologies (value_replacement). Lastly, rows can be removed if it is identified with any outlier (row_removal).</span>
<a id="__codelineno-0-594" name="__codelineno-0-594" href="#__codelineno-0-594"></a>
<a id="__codelineno-0-595" name="__codelineno-0-595" href="#__codelineno-0-595"></a><span class="sd">    This function returns two dataframes in tuple format – 1st dataframe is input dataset after treating outlier (the</span>
<a id="__codelineno-0-596" name="__codelineno-0-596" href="#__codelineno-0-596"></a><span class="sd">    original dataset if no treatment) and  2nd dataframe is of schema – attribute, lower_outliers, upper_outliers. If</span>
<a id="__codelineno-0-597" name="__codelineno-0-597" href="#__codelineno-0-597"></a><span class="sd">    outliers are checked only for upper end, then lower_outliers column will be shown all zero. Similarly if checked</span>
<a id="__codelineno-0-598" name="__codelineno-0-598" href="#__codelineno-0-598"></a><span class="sd">    only for lower end, then upper_outliers will be zero for all attributes.</span>
<a id="__codelineno-0-599" name="__codelineno-0-599" href="#__codelineno-0-599"></a>
<a id="__codelineno-0-600" name="__codelineno-0-600" href="#__codelineno-0-600"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-601" name="__codelineno-0-601" href="#__codelineno-0-601"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-602" name="__codelineno-0-602" href="#__codelineno-0-602"></a><span class="sd">    spark</span>
<a id="__codelineno-0-603" name="__codelineno-0-603" href="#__codelineno-0-603"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-0-604" name="__codelineno-0-604" href="#__codelineno-0-604"></a><span class="sd">    idf</span>
<a id="__codelineno-0-605" name="__codelineno-0-605" href="#__codelineno-0-605"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-606" name="__codelineno-0-606" href="#__codelineno-0-606"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-0-607" name="__codelineno-0-607" href="#__codelineno-0-607"></a><span class="sd">        List of numerical columns to analyse e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-608" name="__codelineno-0-608" href="#__codelineno-0-608"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-609" name="__codelineno-0-609" href="#__codelineno-0-609"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-610" name="__codelineno-0-610" href="#__codelineno-0-610"></a><span class="sd">        &quot;all&quot; can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-0-611" name="__codelineno-0-611" href="#__codelineno-0-611"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in drop_cols argument</span>
<a id="__codelineno-0-612" name="__codelineno-0-612" href="#__codelineno-0-612"></a><span class="sd">        is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-0-613" name="__codelineno-0-613" href="#__codelineno-0-613"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-0-614" name="__codelineno-0-614" href="#__codelineno-0-614"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-615" name="__codelineno-0-615" href="#__codelineno-0-615"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-616" name="__codelineno-0-616" href="#__codelineno-0-616"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-617" name="__codelineno-0-617" href="#__codelineno-0-617"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-0-618" name="__codelineno-0-618" href="#__codelineno-0-618"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-0-619" name="__codelineno-0-619" href="#__codelineno-0-619"></a><span class="sd">    detection_side</span>
<a id="__codelineno-0-620" name="__codelineno-0-620" href="#__codelineno-0-620"></a><span class="sd">        &quot;upper&quot;, &quot;lower&quot;, &quot;both&quot;.</span>
<a id="__codelineno-0-621" name="__codelineno-0-621" href="#__codelineno-0-621"></a><span class="sd">        &quot;lower&quot; detects outliers in the lower spectrum of the column range, whereas &quot;upper&quot; detects in the upper spectrum.</span>
<a id="__codelineno-0-622" name="__codelineno-0-622" href="#__codelineno-0-622"></a><span class="sd">        &quot;both&quot; detects in both upper and lower end of the spectrum. (Default value = &quot;upper&quot;)</span>
<a id="__codelineno-0-623" name="__codelineno-0-623" href="#__codelineno-0-623"></a><span class="sd">    detection_configs</span>
<a id="__codelineno-0-624" name="__codelineno-0-624" href="#__codelineno-0-624"></a><span class="sd">        Takes input in dictionary format with keys representing upper &amp; lower parameter for</span>
<a id="__codelineno-0-625" name="__codelineno-0-625" href="#__codelineno-0-625"></a><span class="sd">        three outlier detection methodologies.</span>
<a id="__codelineno-0-626" name="__codelineno-0-626" href="#__codelineno-0-626"></a><span class="sd">        a) Percentile Method: lower and upper percentile threshold can be set via &quot;pctile_lower&quot; &amp; &quot;pctile_upper&quot; (default 0.05 &amp; 0.95)</span>
<a id="__codelineno-0-627" name="__codelineno-0-627" href="#__codelineno-0-627"></a><span class="sd">        Any value above &quot;pctile_upper&quot; is considered as an outlier. Similarly, a value lower than &quot;pctile_lower&quot; is considered as an outlier.</span>
<a id="__codelineno-0-628" name="__codelineno-0-628" href="#__codelineno-0-628"></a><span class="sd">        b) Standard Deviation Method: In this methodology, if a value which is below (mean - &quot;stdev_lower&quot; * standard deviation) or above</span>
<a id="__codelineno-0-629" name="__codelineno-0-629" href="#__codelineno-0-629"></a><span class="sd">        (mean + &quot;stdev_upper&quot; * standard deviation), then it is identified as an outlier (default 3.0 &amp; 3.0).</span>
<a id="__codelineno-0-630" name="__codelineno-0-630" href="#__codelineno-0-630"></a><span class="sd">        c) Interquartile Range (IQR) Method: A value which is below (Q1 – &quot;IQR_lower&quot; * IQR) or above (Q3 + &quot;IQR_lower&quot; * IQR)</span>
<a id="__codelineno-0-631" name="__codelineno-0-631" href="#__codelineno-0-631"></a><span class="sd">        is identified as outliers, where Q1 is first quartile/25th percentile, Q3 is third quartile/75th percentile and IQR is difference between</span>
<a id="__codelineno-0-632" name="__codelineno-0-632" href="#__codelineno-0-632"></a><span class="sd">        third quartile &amp; first quartile (default 1.5 &amp; 1.5).</span>
<a id="__codelineno-0-633" name="__codelineno-0-633" href="#__codelineno-0-633"></a><span class="sd">        If an attribute value is less (more) than its derived lower (upper) bound value, it is considered as outlier by a methodology.</span>
<a id="__codelineno-0-634" name="__codelineno-0-634" href="#__codelineno-0-634"></a><span class="sd">        A attribute value is considered as outlier if it is declared as outlier by at least &#39;min_validation&#39; methodologies (default 2).</span>
<a id="__codelineno-0-635" name="__codelineno-0-635" href="#__codelineno-0-635"></a><span class="sd">        If &#39;min_validation&#39; is not specified, the total number of methodologies will be used. In addition, it cannot be larger than the</span>
<a id="__codelineno-0-636" name="__codelineno-0-636" href="#__codelineno-0-636"></a><span class="sd">        total number of methodologies applied.</span>
<a id="__codelineno-0-637" name="__codelineno-0-637" href="#__codelineno-0-637"></a><span class="sd">        If detection_side is &quot;upper&quot;, then &quot;pctile_lower&quot;, &quot;stdev_lower&quot; and &quot;IQR_lower&quot; will be ignored and vice versa.</span>
<a id="__codelineno-0-638" name="__codelineno-0-638" href="#__codelineno-0-638"></a><span class="sd">        Examples (detection_side = &quot;lower&quot;)</span>
<a id="__codelineno-0-639" name="__codelineno-0-639" href="#__codelineno-0-639"></a><span class="sd">        - If detection_configs={&quot;pctile_lower&quot;: 0.05, &quot;stdev_lower&quot;: 3.0, &quot;min_validation&quot;: 1}, Percentile and Standard Deviation</span>
<a id="__codelineno-0-640" name="__codelineno-0-640" href="#__codelineno-0-640"></a><span class="sd">        methods will be applied and a value is considered as outlier if at least 1 methodology categorizes it as an outlier.</span>
<a id="__codelineno-0-641" name="__codelineno-0-641" href="#__codelineno-0-641"></a><span class="sd">        - If detection_configs={&quot;pctile_lower&quot;: 0.05, &quot;stdev_lower&quot;: 3.0}, since &quot;min_validation&quot; is not specified, 2 will be used</span>
<a id="__codelineno-0-642" name="__codelineno-0-642" href="#__codelineno-0-642"></a><span class="sd">        because there are 2 methodologies specified. A value is considered as outlier if at both 2 methodologies categorize it as an outlier.</span>
<a id="__codelineno-0-643" name="__codelineno-0-643" href="#__codelineno-0-643"></a><span class="sd">    treatment</span>
<a id="__codelineno-0-644" name="__codelineno-0-644" href="#__codelineno-0-644"></a><span class="sd">        Boolean argument - True or False. If True, outliers are treated as per treatment_method argument.</span>
<a id="__codelineno-0-645" name="__codelineno-0-645" href="#__codelineno-0-645"></a><span class="sd">        If treatment is False, print_impact should be True to perform detection without treatment. (Default value = True)</span>
<a id="__codelineno-0-646" name="__codelineno-0-646" href="#__codelineno-0-646"></a><span class="sd">    treatment_method</span>
<a id="__codelineno-0-647" name="__codelineno-0-647" href="#__codelineno-0-647"></a><span class="sd">        &quot;null_replacement&quot;, &quot;row_removal&quot;, &quot;value_replacement&quot;.</span>
<a id="__codelineno-0-648" name="__codelineno-0-648" href="#__codelineno-0-648"></a><span class="sd">        In &quot;null_replacement&quot;, outlier values are replaced by null so that it can be imputed by a</span>
<a id="__codelineno-0-649" name="__codelineno-0-649" href="#__codelineno-0-649"></a><span class="sd">        reliable imputation methodology. In &quot;value_replacement&quot;, outlier values are replaced by</span>
<a id="__codelineno-0-650" name="__codelineno-0-650" href="#__codelineno-0-650"></a><span class="sd">        maximum or minimum permissible value by above methodologies. Lastly in &quot;row_removal&quot;, rows</span>
<a id="__codelineno-0-651" name="__codelineno-0-651" href="#__codelineno-0-651"></a><span class="sd">        are removed if it is found with any outlier. (Default value = &quot;value_replacement&quot;)</span>
<a id="__codelineno-0-652" name="__codelineno-0-652" href="#__codelineno-0-652"></a><span class="sd">    pre_existing_model</span>
<a id="__codelineno-0-653" name="__codelineno-0-653" href="#__codelineno-0-653"></a><span class="sd">        Boolean argument – True or False. True if the model with upper/lower permissible values</span>
<a id="__codelineno-0-654" name="__codelineno-0-654" href="#__codelineno-0-654"></a><span class="sd">        for each attribute exists already to be used, False otherwise. (Default value = False)</span>
<a id="__codelineno-0-655" name="__codelineno-0-655" href="#__codelineno-0-655"></a><span class="sd">    model_path</span>
<a id="__codelineno-0-656" name="__codelineno-0-656" href="#__codelineno-0-656"></a><span class="sd">        If pre_existing_model is True, this argument is path for the pre-saved model.</span>
<a id="__codelineno-0-657" name="__codelineno-0-657" href="#__codelineno-0-657"></a><span class="sd">        If pre_existing_model is False, this field can be used for saving the model.</span>
<a id="__codelineno-0-658" name="__codelineno-0-658" href="#__codelineno-0-658"></a><span class="sd">        Default &quot;NA&quot; means there is neither pre-existing model nor there is a need to save one.</span>
<a id="__codelineno-0-659" name="__codelineno-0-659" href="#__codelineno-0-659"></a><span class="sd">    sample_size</span>
<a id="__codelineno-0-660" name="__codelineno-0-660" href="#__codelineno-0-660"></a><span class="sd">        The maximum number of rows used to calculate the thresholds of outlier detection. Relevant computation includes</span>
<a id="__codelineno-0-661" name="__codelineno-0-661" href="#__codelineno-0-661"></a><span class="sd">        percentiles, means, standard deviations and quantiles calculation. The computed thresholds will be applied over</span>
<a id="__codelineno-0-662" name="__codelineno-0-662" href="#__codelineno-0-662"></a><span class="sd">        all rows in the original idf to detect outliers. If the number of rows of idf is smaller than sample_size,</span>
<a id="__codelineno-0-663" name="__codelineno-0-663" href="#__codelineno-0-663"></a><span class="sd">        the original idf will be used. (Default value = 1000000)</span>
<a id="__codelineno-0-664" name="__codelineno-0-664" href="#__codelineno-0-664"></a><span class="sd">    output_mode</span>
<a id="__codelineno-0-665" name="__codelineno-0-665" href="#__codelineno-0-665"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-0-666" name="__codelineno-0-666" href="#__codelineno-0-666"></a><span class="sd">        “replace” option replaces original columns with treated column. “append” option append treated</span>
<a id="__codelineno-0-667" name="__codelineno-0-667" href="#__codelineno-0-667"></a><span class="sd">        column to the input dataset with a postfix &quot;_outliered&quot; e.g. column X is appended as X_outliered. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-0-668" name="__codelineno-0-668" href="#__codelineno-0-668"></a><span class="sd">    print_impact</span>
<a id="__codelineno-0-669" name="__codelineno-0-669" href="#__codelineno-0-669"></a><span class="sd">        True, False</span>
<a id="__codelineno-0-670" name="__codelineno-0-670" href="#__codelineno-0-670"></a><span class="sd">        This argument is to calculate and print out the impact of treatment (if applicable).</span>
<a id="__codelineno-0-671" name="__codelineno-0-671" href="#__codelineno-0-671"></a><span class="sd">        If treatment is False, print_impact should be True to perform detection without treatment. (Default value = False).</span>
<a id="__codelineno-0-672" name="__codelineno-0-672" href="#__codelineno-0-672"></a>
<a id="__codelineno-0-673" name="__codelineno-0-673" href="#__codelineno-0-673"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-674" name="__codelineno-0-674" href="#__codelineno-0-674"></a><span class="sd">    -------</span>
<a id="__codelineno-0-675" name="__codelineno-0-675" href="#__codelineno-0-675"></a><span class="sd">    if print_impact is True:</span>
<a id="__codelineno-0-676" name="__codelineno-0-676" href="#__codelineno-0-676"></a><span class="sd">        odf : DataFrame</span>
<a id="__codelineno-0-677" name="__codelineno-0-677" href="#__codelineno-0-677"></a><span class="sd">            Dataframe with outliers treated if treatment is True, else original input dataframe.</span>
<a id="__codelineno-0-678" name="__codelineno-0-678" href="#__codelineno-0-678"></a><span class="sd">        odf_print : DataFrame</span>
<a id="__codelineno-0-679" name="__codelineno-0-679" href="#__codelineno-0-679"></a><span class="sd">            schema [attribute, lower_outliers, upper_outliers, excluded_due_to_skewness].</span>
<a id="__codelineno-0-680" name="__codelineno-0-680" href="#__codelineno-0-680"></a><span class="sd">            lower_outliers is no. of outliers found in the lower spectrum of the attribute range,</span>
<a id="__codelineno-0-681" name="__codelineno-0-681" href="#__codelineno-0-681"></a><span class="sd">            upper_outliers is outlier count in the upper spectrum, and</span>
<a id="__codelineno-0-682" name="__codelineno-0-682" href="#__codelineno-0-682"></a><span class="sd">            excluded_due_to_skewness is 0 or 1 indicating whether an attribute is excluded from detection due to skewness.</span>
<a id="__codelineno-0-683" name="__codelineno-0-683" href="#__codelineno-0-683"></a><span class="sd">    if print_impact is False:</span>
<a id="__codelineno-0-684" name="__codelineno-0-684" href="#__codelineno-0-684"></a><span class="sd">        odf : DataFrame</span>
<a id="__codelineno-0-685" name="__codelineno-0-685" href="#__codelineno-0-685"></a><span class="sd">            Dataframe with outliers treated if treatment is True, else original input dataframe.</span>
<a id="__codelineno-0-686" name="__codelineno-0-686" href="#__codelineno-0-686"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-687" name="__codelineno-0-687" href="#__codelineno-0-687"></a>    <span class="n">column_order</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">columns</span>
<a id="__codelineno-0-688" name="__codelineno-0-688" href="#__codelineno-0-688"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-689" name="__codelineno-0-689" href="#__codelineno-0-689"></a>
<a id="__codelineno-0-690" name="__codelineno-0-690" href="#__codelineno-0-690"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">treatment</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-691" name="__codelineno-0-691" href="#__codelineno-0-691"></a>        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pre_existing_model</span> <span class="ow">and</span> <span class="n">model_path</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span><span class="p">)</span> <span class="o">|</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-0-692" name="__codelineno-0-692" href="#__codelineno-0-692"></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-693" name="__codelineno-0-693" href="#__codelineno-0-693"></a>                <span class="s2">&quot;The original idf will be the only output. Set print_impact=True to perform detection without treatment&quot;</span>
<a id="__codelineno-0-694" name="__codelineno-0-694" href="#__codelineno-0-694"></a>            <span class="p">)</span>
<a id="__codelineno-0-695" name="__codelineno-0-695" href="#__codelineno-0-695"></a>            <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-0-696" name="__codelineno-0-696" href="#__codelineno-0-696"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-697" name="__codelineno-0-697" href="#__codelineno-0-697"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-0-698" name="__codelineno-0-698" href="#__codelineno-0-698"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-699" name="__codelineno-0-699" href="#__codelineno-0-699"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-700" name="__codelineno-0-700" href="#__codelineno-0-700"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-701" name="__codelineno-0-701" href="#__codelineno-0-701"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-702" name="__codelineno-0-702" href="#__codelineno-0-702"></a>
<a id="__codelineno-0-703" name="__codelineno-0-703" href="#__codelineno-0-703"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-0-704" name="__codelineno-0-704" href="#__codelineno-0-704"></a>
<a id="__codelineno-0-705" name="__codelineno-0-705" href="#__codelineno-0-705"></a>    <span class="n">schema</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">StructType</span><span class="p">(</span>
<a id="__codelineno-0-706" name="__codelineno-0-706" href="#__codelineno-0-706"></a>        <span class="p">[</span>
<a id="__codelineno-0-707" name="__codelineno-0-707" href="#__codelineno-0-707"></a>            <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-708" name="__codelineno-0-708" href="#__codelineno-0-708"></a>            <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;lower_outliers&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-709" name="__codelineno-0-709" href="#__codelineno-0-709"></a>            <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;upper_outliers&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-710" name="__codelineno-0-710" href="#__codelineno-0-710"></a>        <span class="p">]</span>
<a id="__codelineno-0-711" name="__codelineno-0-711" href="#__codelineno-0-711"></a>    <span class="p">)</span>
<a id="__codelineno-0-712" name="__codelineno-0-712" href="#__codelineno-0-712"></a>    <span class="n">empty_odf_print</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">emptyRDD</span><span class="p">()</span><span class="o">.</span><span class="n">toDF</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
<a id="__codelineno-0-713" name="__codelineno-0-713" href="#__codelineno-0-713"></a>
<a id="__codelineno-0-714" name="__codelineno-0-714" href="#__codelineno-0-714"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-715" name="__codelineno-0-715" href="#__codelineno-0-715"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No Outlier Check - No numerical column to analyze&quot;</span><span class="p">)</span>
<a id="__codelineno-0-716" name="__codelineno-0-716" href="#__codelineno-0-716"></a>        <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-717" name="__codelineno-0-717" href="#__codelineno-0-717"></a>            <span class="n">empty_odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-0-718" name="__codelineno-0-718" href="#__codelineno-0-718"></a>            <span class="k">return</span> <span class="n">idf</span><span class="p">,</span> <span class="n">empty_odf_print</span>
<a id="__codelineno-0-719" name="__codelineno-0-719" href="#__codelineno-0-719"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-720" name="__codelineno-0-720" href="#__codelineno-0-720"></a>            <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-0-721" name="__codelineno-0-721" href="#__codelineno-0-721"></a>
<a id="__codelineno-0-722" name="__codelineno-0-722" href="#__codelineno-0-722"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-723" name="__codelineno-0-723" href="#__codelineno-0-723"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-724" name="__codelineno-0-724" href="#__codelineno-0-724"></a>    <span class="k">if</span> <span class="n">detection_side</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span> <span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="s2">&quot;both&quot;</span><span class="p">):</span>
<a id="__codelineno-0-725" name="__codelineno-0-725" href="#__codelineno-0-725"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for detection_side&quot;</span><span class="p">)</span>
<a id="__codelineno-0-726" name="__codelineno-0-726" href="#__codelineno-0-726"></a>    <span class="k">if</span> <span class="n">treatment_method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;null_replacement&quot;</span><span class="p">,</span> <span class="s2">&quot;row_removal&quot;</span><span class="p">,</span> <span class="s2">&quot;value_replacement&quot;</span><span class="p">):</span>
<a id="__codelineno-0-727" name="__codelineno-0-727" href="#__codelineno-0-727"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for treatment_method&quot;</span><span class="p">)</span>
<a id="__codelineno-0-728" name="__codelineno-0-728" href="#__codelineno-0-728"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">):</span>
<a id="__codelineno-0-729" name="__codelineno-0-729" href="#__codelineno-0-729"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for output_mode&quot;</span><span class="p">)</span>
<a id="__codelineno-0-730" name="__codelineno-0-730" href="#__codelineno-0-730"></a>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
<a id="__codelineno-0-731" name="__codelineno-0-731" href="#__codelineno-0-731"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-732" name="__codelineno-0-732" href="#__codelineno-0-732"></a>    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
<a id="__codelineno-0-733" name="__codelineno-0-733" href="#__codelineno-0-733"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-734" name="__codelineno-0-734" href="#__codelineno-0-734"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-735" name="__codelineno-0-735" href="#__codelineno-0-735"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Non-Boolean input for treatment&quot;</span><span class="p">)</span>
<a id="__codelineno-0-736" name="__codelineno-0-736" href="#__codelineno-0-736"></a>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_existing_model</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
<a id="__codelineno-0-737" name="__codelineno-0-737" href="#__codelineno-0-737"></a>        <span class="n">pre_existing_model</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-738" name="__codelineno-0-738" href="#__codelineno-0-738"></a>    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_existing_model</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
<a id="__codelineno-0-739" name="__codelineno-0-739" href="#__codelineno-0-739"></a>        <span class="n">pre_existing_model</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-740" name="__codelineno-0-740" href="#__codelineno-0-740"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-741" name="__codelineno-0-741" href="#__codelineno-0-741"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Non-Boolean input for pre_existing_model&quot;</span><span class="p">)</span>
<a id="__codelineno-0-742" name="__codelineno-0-742" href="#__codelineno-0-742"></a>    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;pctile_lower&quot;</span><span class="p">,</span> <span class="s2">&quot;pctile_upper&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-743" name="__codelineno-0-743" href="#__codelineno-0-743"></a>        <span class="k">if</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">detection_configs</span><span class="p">:</span>
<a id="__codelineno-0-744" name="__codelineno-0-744" href="#__codelineno-0-744"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">detection_configs</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">detection_configs</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-745" name="__codelineno-0-745" href="#__codelineno-0-745"></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for &quot;</span> <span class="o">+</span> <span class="n">arg</span><span class="p">)</span>
<a id="__codelineno-0-746" name="__codelineno-0-746" href="#__codelineno-0-746"></a>
<a id="__codelineno-0-747" name="__codelineno-0-747" href="#__codelineno-0-747"></a>    <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-0-748" name="__codelineno-0-748" href="#__codelineno-0-748"></a>        <span class="n">df_model</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/outlier_numcols&quot;</span><span class="p">)</span>
<a id="__codelineno-0-749" name="__codelineno-0-749" href="#__codelineno-0-749"></a>        <span class="n">model_dict_list</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-750" name="__codelineno-0-750" href="#__codelineno-0-750"></a>            <span class="n">df_model</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-0-751" name="__codelineno-0-751" href="#__codelineno-0-751"></a>            <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="p">{</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
<a id="__codelineno-0-752" name="__codelineno-0-752" href="#__codelineno-0-752"></a>            <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-753" name="__codelineno-0-753" href="#__codelineno-0-753"></a>        <span class="p">)</span>
<a id="__codelineno-0-754" name="__codelineno-0-754" href="#__codelineno-0-754"></a>        <span class="n">model_dict</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-755" name="__codelineno-0-755" href="#__codelineno-0-755"></a>        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">model_dict_list</span><span class="p">:</span>
<a id="__codelineno-0-756" name="__codelineno-0-756" href="#__codelineno-0-756"></a>            <span class="n">model_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-0-757" name="__codelineno-0-757" href="#__codelineno-0-757"></a>
<a id="__codelineno-0-758" name="__codelineno-0-758" href="#__codelineno-0-758"></a>        <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-759" name="__codelineno-0-759" href="#__codelineno-0-759"></a>        <span class="n">present_cols</span><span class="p">,</span> <span class="n">skewed_cols</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<a id="__codelineno-0-760" name="__codelineno-0-760" href="#__codelineno-0-760"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-761" name="__codelineno-0-761" href="#__codelineno-0-761"></a>            <span class="n">param</span> <span class="o">=</span> <span class="n">model_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-762" name="__codelineno-0-762" href="#__codelineno-0-762"></a>            <span class="k">if</span> <span class="n">param</span><span class="p">:</span>
<a id="__codelineno-0-763" name="__codelineno-0-763" href="#__codelineno-0-763"></a>                <span class="k">if</span> <span class="s2">&quot;skewed_attribute&quot;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
<a id="__codelineno-0-764" name="__codelineno-0-764" href="#__codelineno-0-764"></a>                    <span class="n">skewed_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-765" name="__codelineno-0-765" href="#__codelineno-0-765"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-766" name="__codelineno-0-766" href="#__codelineno-0-766"></a>                    <span class="n">param</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span> <span class="k">else</span> <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">param</span><span class="p">]</span>
<a id="__codelineno-0-767" name="__codelineno-0-767" href="#__codelineno-0-767"></a>                    <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
<a id="__codelineno-0-768" name="__codelineno-0-768" href="#__codelineno-0-768"></a>                    <span class="n">present_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-769" name="__codelineno-0-769" href="#__codelineno-0-769"></a>
<a id="__codelineno-0-770" name="__codelineno-0-770" href="#__codelineno-0-770"></a>        <span class="n">diff_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">present_cols</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">skewed_cols</span><span class="p">))</span>
<a id="__codelineno-0-771" name="__codelineno-0-771" href="#__codelineno-0-771"></a>        <span class="k">if</span> <span class="n">diff_cols</span><span class="p">:</span>
<a id="__codelineno-0-772" name="__codelineno-0-772" href="#__codelineno-0-772"></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Columns not found in model_path: &quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">diff_cols</span><span class="p">))</span>
<a id="__codelineno-0-773" name="__codelineno-0-773" href="#__codelineno-0-773"></a>        <span class="k">if</span> <span class="n">skewed_cols</span><span class="p">:</span>
<a id="__codelineno-0-774" name="__codelineno-0-774" href="#__codelineno-0-774"></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-775" name="__codelineno-0-775" href="#__codelineno-0-775"></a>                <span class="s2">&quot;Columns excluded from outlier detection due to highly skewed distribution: &quot;</span>
<a id="__codelineno-0-776" name="__codelineno-0-776" href="#__codelineno-0-776"></a>                <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">skewed_cols</span><span class="p">)</span>
<a id="__codelineno-0-777" name="__codelineno-0-777" href="#__codelineno-0-777"></a>            <span class="p">)</span>
<a id="__codelineno-0-778" name="__codelineno-0-778" href="#__codelineno-0-778"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">present_cols</span>
<a id="__codelineno-0-779" name="__codelineno-0-779" href="#__codelineno-0-779"></a>
<a id="__codelineno-0-780" name="__codelineno-0-780" href="#__codelineno-0-780"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-781" name="__codelineno-0-781" href="#__codelineno-0-781"></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No Outlier Check - No numerical column to analyze&quot;</span><span class="p">)</span>
<a id="__codelineno-0-782" name="__codelineno-0-782" href="#__codelineno-0-782"></a>            <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-783" name="__codelineno-0-783" href="#__codelineno-0-783"></a>                <span class="n">empty_odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-0-784" name="__codelineno-0-784" href="#__codelineno-0-784"></a>                <span class="k">return</span> <span class="n">idf</span><span class="p">,</span> <span class="n">empty_odf_print</span>
<a id="__codelineno-0-785" name="__codelineno-0-785" href="#__codelineno-0-785"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-786" name="__codelineno-0-786" href="#__codelineno-0-786"></a>                <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-0-787" name="__codelineno-0-787" href="#__codelineno-0-787"></a>
<a id="__codelineno-0-788" name="__codelineno-0-788" href="#__codelineno-0-788"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-789" name="__codelineno-0-789" href="#__codelineno-0-789"></a>        <span class="n">check_dict</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-790" name="__codelineno-0-790" href="#__codelineno-0-790"></a>            <span class="s2">&quot;pctile&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lower&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;upper&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
<a id="__codelineno-0-791" name="__codelineno-0-791" href="#__codelineno-0-791"></a>            <span class="s2">&quot;stdev&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lower&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;upper&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
<a id="__codelineno-0-792" name="__codelineno-0-792" href="#__codelineno-0-792"></a>            <span class="s2">&quot;IQR&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lower&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;upper&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
<a id="__codelineno-0-793" name="__codelineno-0-793" href="#__codelineno-0-793"></a>        <span class="p">}</span>
<a id="__codelineno-0-794" name="__codelineno-0-794" href="#__codelineno-0-794"></a>        <span class="n">side_mapping</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-795" name="__codelineno-0-795" href="#__codelineno-0-795"></a>            <span class="s2">&quot;lower&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;lower&quot;</span><span class="p">],</span>
<a id="__codelineno-0-796" name="__codelineno-0-796" href="#__codelineno-0-796"></a>            <span class="s2">&quot;upper&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;upper&quot;</span><span class="p">],</span>
<a id="__codelineno-0-797" name="__codelineno-0-797" href="#__codelineno-0-797"></a>            <span class="s2">&quot;both&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="s2">&quot;upper&quot;</span><span class="p">],</span>
<a id="__codelineno-0-798" name="__codelineno-0-798" href="#__codelineno-0-798"></a>        <span class="p">}</span>
<a id="__codelineno-0-799" name="__codelineno-0-799" href="#__codelineno-0-799"></a>
<a id="__codelineno-0-800" name="__codelineno-0-800" href="#__codelineno-0-800"></a>        <span class="k">for</span> <span class="n">methodology</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;pctile&quot;</span><span class="p">,</span> <span class="s2">&quot;stdev&quot;</span><span class="p">,</span> <span class="s2">&quot;IQR&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-801" name="__codelineno-0-801" href="#__codelineno-0-801"></a>            <span class="k">for</span> <span class="n">side</span> <span class="ow">in</span> <span class="n">side_mapping</span><span class="p">[</span><span class="n">detection_side</span><span class="p">]:</span>
<a id="__codelineno-0-802" name="__codelineno-0-802" href="#__codelineno-0-802"></a>                <span class="k">if</span> <span class="n">methodology</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">side</span> <span class="ow">in</span> <span class="n">detection_configs</span><span class="p">:</span>
<a id="__codelineno-0-803" name="__codelineno-0-803" href="#__codelineno-0-803"></a>                    <span class="n">check_dict</span><span class="p">[</span><span class="n">methodology</span><span class="p">][</span><span class="n">side</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-804" name="__codelineno-0-804" href="#__codelineno-0-804"></a>
<a id="__codelineno-0-805" name="__codelineno-0-805" href="#__codelineno-0-805"></a>        <span class="n">methodologies</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-806" name="__codelineno-0-806" href="#__codelineno-0-806"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">check_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
<a id="__codelineno-0-807" name="__codelineno-0-807" href="#__codelineno-0-807"></a>            <span class="n">val_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<a id="__codelineno-0-808" name="__codelineno-0-808" href="#__codelineno-0-808"></a>            <span class="k">if</span> <span class="n">detection_side</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span><span class="p">:</span>
<a id="__codelineno-0-809" name="__codelineno-0-809" href="#__codelineno-0-809"></a>                <span class="k">if</span> <span class="n">val_list</span> <span class="ow">in</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
<a id="__codelineno-0-810" name="__codelineno-0-810" href="#__codelineno-0-810"></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<a id="__codelineno-0-811" name="__codelineno-0-811" href="#__codelineno-0-811"></a>                        <span class="s2">&quot;Invalid input for detection_configs. If detection_side is &#39;both&#39;, the methodologies used on both sides should be the same&quot;</span>
<a id="__codelineno-0-812" name="__codelineno-0-812" href="#__codelineno-0-812"></a>                    <span class="p">)</span>
<a id="__codelineno-0-813" name="__codelineno-0-813" href="#__codelineno-0-813"></a>                <span class="k">if</span> <span class="n">val_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-814" name="__codelineno-0-814" href="#__codelineno-0-814"></a>                    <span class="n">methodologies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<a id="__codelineno-0-815" name="__codelineno-0-815" href="#__codelineno-0-815"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-816" name="__codelineno-0-816" href="#__codelineno-0-816"></a>                <span class="k">if</span> <span class="n">val</span><span class="p">[</span><span class="n">detection_side</span><span class="p">]:</span>
<a id="__codelineno-0-817" name="__codelineno-0-817" href="#__codelineno-0-817"></a>                    <span class="n">methodologies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<a id="__codelineno-0-818" name="__codelineno-0-818" href="#__codelineno-0-818"></a>        <span class="n">num_methodologies</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">methodologies</span><span class="p">)</span>
<a id="__codelineno-0-819" name="__codelineno-0-819" href="#__codelineno-0-819"></a>
<a id="__codelineno-0-820" name="__codelineno-0-820" href="#__codelineno-0-820"></a>        <span class="k">if</span> <span class="s2">&quot;min_validation&quot;</span> <span class="ow">in</span> <span class="n">detection_configs</span><span class="p">:</span>
<a id="__codelineno-0-821" name="__codelineno-0-821" href="#__codelineno-0-821"></a>            <span class="k">if</span> <span class="n">detection_configs</span><span class="p">[</span><span class="s2">&quot;min_validation&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">num_methodologies</span><span class="p">:</span>
<a id="__codelineno-0-822" name="__codelineno-0-822" href="#__codelineno-0-822"></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<a id="__codelineno-0-823" name="__codelineno-0-823" href="#__codelineno-0-823"></a>                    <span class="s2">&quot;Invalid input for min_validation of detection_configs. It cannot be larger than the total number of methodologies on any side that detection will be applied over.&quot;</span>
<a id="__codelineno-0-824" name="__codelineno-0-824" href="#__codelineno-0-824"></a>                <span class="p">)</span>
<a id="__codelineno-0-825" name="__codelineno-0-825" href="#__codelineno-0-825"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-826" name="__codelineno-0-826" href="#__codelineno-0-826"></a>            <span class="c1"># if min_validation is not present, num of specified methodologies will be used</span>
<a id="__codelineno-0-827" name="__codelineno-0-827" href="#__codelineno-0-827"></a>            <span class="n">detection_configs</span><span class="p">[</span><span class="s2">&quot;min_validation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_methodologies</span>
<a id="__codelineno-0-828" name="__codelineno-0-828" href="#__codelineno-0-828"></a>
<a id="__codelineno-0-829" name="__codelineno-0-829" href="#__codelineno-0-829"></a>        <span class="n">empty_params</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-0-830" name="__codelineno-0-830" href="#__codelineno-0-830"></a>
<a id="__codelineno-0-831" name="__codelineno-0-831" href="#__codelineno-0-831"></a>        <span class="n">idf_count</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-0-832" name="__codelineno-0-832" href="#__codelineno-0-832"></a>        <span class="k">if</span> <span class="n">idf_count</span> <span class="o">&gt;</span> <span class="n">sample_size</span><span class="p">:</span>
<a id="__codelineno-0-833" name="__codelineno-0-833" href="#__codelineno-0-833"></a>            <span class="n">idf_sample</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">sample_size</span> <span class="o">/</span> <span class="n">idf_count</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-0-834" name="__codelineno-0-834" href="#__codelineno-0-834"></a>                <span class="n">list_of_cols</span>
<a id="__codelineno-0-835" name="__codelineno-0-835" href="#__codelineno-0-835"></a>            <span class="p">)</span>
<a id="__codelineno-0-836" name="__codelineno-0-836" href="#__codelineno-0-836"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-837" name="__codelineno-0-837" href="#__codelineno-0-837"></a>            <span class="n">idf_sample</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-0-838" name="__codelineno-0-838" href="#__codelineno-0-838"></a>
<a id="__codelineno-0-839" name="__codelineno-0-839" href="#__codelineno-0-839"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-840" name="__codelineno-0-840" href="#__codelineno-0-840"></a>            <span class="k">if</span> <span class="n">get_dtype</span><span class="p">(</span><span class="n">idf_sample</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;decimal&quot;</span><span class="p">):</span>
<a id="__codelineno-0-841" name="__codelineno-0-841" href="#__codelineno-0-841"></a>                <span class="n">idf_sample</span> <span class="o">=</span> <span class="n">idf_sample</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">DoubleType</span><span class="p">()))</span>
<a id="__codelineno-0-842" name="__codelineno-0-842" href="#__codelineno-0-842"></a>
<a id="__codelineno-0-843" name="__codelineno-0-843" href="#__codelineno-0-843"></a>        <span class="n">pctiles</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-844" name="__codelineno-0-844" href="#__codelineno-0-844"></a>            <span class="n">detection_configs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pctile_lower&quot;</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
<a id="__codelineno-0-845" name="__codelineno-0-845" href="#__codelineno-0-845"></a>            <span class="n">detection_configs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pctile_upper&quot;</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">),</span>
<a id="__codelineno-0-846" name="__codelineno-0-846" href="#__codelineno-0-846"></a>        <span class="p">]</span>
<a id="__codelineno-0-847" name="__codelineno-0-847" href="#__codelineno-0-847"></a>        <span class="n">pctile_params</span> <span class="o">=</span> <span class="n">idf_sample</span><span class="o">.</span><span class="n">approxQuantile</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="n">pctiles</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-0-848" name="__codelineno-0-848" href="#__codelineno-0-848"></a>        <span class="n">skewed_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-849" name="__codelineno-0-849" href="#__codelineno-0-849"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="n">pctile_params</span><span class="p">):</span>
<a id="__codelineno-0-850" name="__codelineno-0-850" href="#__codelineno-0-850"></a>            <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-0-851" name="__codelineno-0-851" href="#__codelineno-0-851"></a>                <span class="n">skewed_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-852" name="__codelineno-0-852" href="#__codelineno-0-852"></a>
<a id="__codelineno-0-853" name="__codelineno-0-853" href="#__codelineno-0-853"></a>        <span class="k">if</span> <span class="n">skewed_cols</span><span class="p">:</span>
<a id="__codelineno-0-854" name="__codelineno-0-854" href="#__codelineno-0-854"></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-855" name="__codelineno-0-855" href="#__codelineno-0-855"></a>                <span class="s2">&quot;Columns excluded from outlier detection due to highly skewed distribution: &quot;</span>
<a id="__codelineno-0-856" name="__codelineno-0-856" href="#__codelineno-0-856"></a>                <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">skewed_cols</span><span class="p">)</span>
<a id="__codelineno-0-857" name="__codelineno-0-857" href="#__codelineno-0-857"></a>            <span class="p">)</span>
<a id="__codelineno-0-858" name="__codelineno-0-858" href="#__codelineno-0-858"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">skewed_cols</span><span class="p">:</span>
<a id="__codelineno-0-859" name="__codelineno-0-859" href="#__codelineno-0-859"></a>                <span class="n">idx</span> <span class="o">=</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-860" name="__codelineno-0-860" href="#__codelineno-0-860"></a>                <span class="n">list_of_cols</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
<a id="__codelineno-0-861" name="__codelineno-0-861" href="#__codelineno-0-861"></a>                <span class="n">pctile_params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
<a id="__codelineno-0-862" name="__codelineno-0-862" href="#__codelineno-0-862"></a>
<a id="__codelineno-0-863" name="__codelineno-0-863" href="#__codelineno-0-863"></a>        <span class="k">if</span> <span class="s2">&quot;pctile&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">methodologies</span><span class="p">:</span>
<a id="__codelineno-0-864" name="__codelineno-0-864" href="#__codelineno-0-864"></a>            <span class="n">pctile_params</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">empty_params</span><span class="p">)</span>
<a id="__codelineno-0-865" name="__codelineno-0-865" href="#__codelineno-0-865"></a>
<a id="__codelineno-0-866" name="__codelineno-0-866" href="#__codelineno-0-866"></a>        <span class="k">if</span> <span class="s2">&quot;stdev&quot;</span> <span class="ow">in</span> <span class="n">methodologies</span><span class="p">:</span>
<a id="__codelineno-0-867" name="__codelineno-0-867" href="#__codelineno-0-867"></a>            <span class="n">exprs</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="n">F</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">stddev</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">]</span>
<a id="__codelineno-0-868" name="__codelineno-0-868" href="#__codelineno-0-868"></a>            <span class="n">stats</span> <span class="o">=</span> <span class="n">idf_sample</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">exprs</span><span class="p">)</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-869" name="__codelineno-0-869" href="#__codelineno-0-869"></a>
<a id="__codelineno-0-870" name="__codelineno-0-870" href="#__codelineno-0-870"></a>            <span class="n">mean</span><span class="p">,</span> <span class="n">stdev</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)],</span> <span class="n">stats</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="p">:]</span>
<a id="__codelineno-0-871" name="__codelineno-0-871" href="#__codelineno-0-871"></a>            <span class="n">stdev_lower</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span> <span class="o">-</span> <span class="n">detection_configs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-872" name="__codelineno-0-872" href="#__codelineno-0-872"></a>                <span class="s2">&quot;stdev_lower&quot;</span><span class="p">,</span> <span class="mf">0.0</span>
<a id="__codelineno-0-873" name="__codelineno-0-873" href="#__codelineno-0-873"></a>            <span class="p">)</span> <span class="o">*</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">stdev</span><span class="p">)</span>
<a id="__codelineno-0-874" name="__codelineno-0-874" href="#__codelineno-0-874"></a>            <span class="n">stdev_upper</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span> <span class="o">+</span> <span class="n">detection_configs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-875" name="__codelineno-0-875" href="#__codelineno-0-875"></a>                <span class="s2">&quot;stdev_upper&quot;</span><span class="p">,</span> <span class="mf">0.0</span>
<a id="__codelineno-0-876" name="__codelineno-0-876" href="#__codelineno-0-876"></a>            <span class="p">)</span> <span class="o">*</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">stdev</span><span class="p">)</span>
<a id="__codelineno-0-877" name="__codelineno-0-877" href="#__codelineno-0-877"></a>            <span class="n">stdev_params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">stdev_lower</span><span class="p">,</span> <span class="n">stdev_upper</span><span class="p">))</span>
<a id="__codelineno-0-878" name="__codelineno-0-878" href="#__codelineno-0-878"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-879" name="__codelineno-0-879" href="#__codelineno-0-879"></a>            <span class="n">stdev_params</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">empty_params</span><span class="p">)</span>
<a id="__codelineno-0-880" name="__codelineno-0-880" href="#__codelineno-0-880"></a>
<a id="__codelineno-0-881" name="__codelineno-0-881" href="#__codelineno-0-881"></a>        <span class="k">if</span> <span class="s2">&quot;IQR&quot;</span> <span class="ow">in</span> <span class="n">methodologies</span><span class="p">:</span>
<a id="__codelineno-0-882" name="__codelineno-0-882" href="#__codelineno-0-882"></a>            <span class="n">quantiles</span> <span class="o">=</span> <span class="n">idf_sample</span><span class="o">.</span><span class="n">approxQuantile</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">],</span> <span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-0-883" name="__codelineno-0-883" href="#__codelineno-0-883"></a>            <span class="n">IQR_params</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-884" name="__codelineno-0-884" href="#__codelineno-0-884"></a>                <span class="p">[</span>
<a id="__codelineno-0-885" name="__codelineno-0-885" href="#__codelineno-0-885"></a>                    <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">detection_configs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;IQR_lower&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-886" name="__codelineno-0-886" href="#__codelineno-0-886"></a>                    <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">detection_configs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;IQR_upper&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-887" name="__codelineno-0-887" href="#__codelineno-0-887"></a>                <span class="p">]</span>
<a id="__codelineno-0-888" name="__codelineno-0-888" href="#__codelineno-0-888"></a>                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">quantiles</span>
<a id="__codelineno-0-889" name="__codelineno-0-889" href="#__codelineno-0-889"></a>            <span class="p">]</span>
<a id="__codelineno-0-890" name="__codelineno-0-890" href="#__codelineno-0-890"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-891" name="__codelineno-0-891" href="#__codelineno-0-891"></a>            <span class="n">IQR_params</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">empty_params</span><span class="p">)</span>
<a id="__codelineno-0-892" name="__codelineno-0-892" href="#__codelineno-0-892"></a>
<a id="__codelineno-0-893" name="__codelineno-0-893" href="#__codelineno-0-893"></a>        <span class="n">n</span> <span class="o">=</span> <span class="n">detection_configs</span><span class="p">[</span><span class="s2">&quot;min_validation&quot;</span><span class="p">]</span>
<a id="__codelineno-0-894" name="__codelineno-0-894" href="#__codelineno-0-894"></a>        <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-895" name="__codelineno-0-895" href="#__codelineno-0-895"></a>        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">pctile_params</span><span class="p">,</span> <span class="n">stdev_params</span><span class="p">,</span> <span class="n">IQR_params</span><span class="p">)):</span>
<a id="__codelineno-0-896" name="__codelineno-0-896" href="#__codelineno-0-896"></a>            <span class="n">lower</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
<a id="__codelineno-0-897" name="__codelineno-0-897" href="#__codelineno-0-897"></a>                <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-898" name="__codelineno-0-898" href="#__codelineno-0-898"></a>            <span class="p">)[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-899" name="__codelineno-0-899" href="#__codelineno-0-899"></a>            <span class="n">upper</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-900" name="__codelineno-0-900" href="#__codelineno-0-900"></a>            <span class="k">if</span> <span class="n">detection_side</span> <span class="o">==</span> <span class="s2">&quot;lower&quot;</span><span class="p">:</span>
<a id="__codelineno-0-901" name="__codelineno-0-901" href="#__codelineno-0-901"></a>                <span class="n">param</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-0-902" name="__codelineno-0-902" href="#__codelineno-0-902"></a>            <span class="k">elif</span> <span class="n">detection_side</span> <span class="o">==</span> <span class="s2">&quot;upper&quot;</span><span class="p">:</span>
<a id="__codelineno-0-903" name="__codelineno-0-903" href="#__codelineno-0-903"></a>                <span class="n">param</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">upper</span><span class="p">]</span>
<a id="__codelineno-0-904" name="__codelineno-0-904" href="#__codelineno-0-904"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-905" name="__codelineno-0-905" href="#__codelineno-0-905"></a>                <span class="n">param</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">]</span>
<a id="__codelineno-0-906" name="__codelineno-0-906" href="#__codelineno-0-906"></a>            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
<a id="__codelineno-0-907" name="__codelineno-0-907" href="#__codelineno-0-907"></a>
<a id="__codelineno-0-908" name="__codelineno-0-908" href="#__codelineno-0-908"></a>        <span class="c1"># Saving model File if required</span>
<a id="__codelineno-0-909" name="__codelineno-0-909" href="#__codelineno-0-909"></a>        <span class="k">if</span> <span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span>
<a id="__codelineno-0-910" name="__codelineno-0-910" href="#__codelineno-0-910"></a>            <span class="k">if</span> <span class="n">detection_side</span> <span class="o">==</span> <span class="s2">&quot;lower&quot;</span><span class="p">:</span>
<a id="__codelineno-0-911" name="__codelineno-0-911" href="#__codelineno-0-911"></a>                <span class="n">skewed_param</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;skewed_attribute&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-0-912" name="__codelineno-0-912" href="#__codelineno-0-912"></a>            <span class="k">elif</span> <span class="n">detection_side</span> <span class="o">==</span> <span class="s2">&quot;upper&quot;</span><span class="p">:</span>
<a id="__codelineno-0-913" name="__codelineno-0-913" href="#__codelineno-0-913"></a>                <span class="n">skewed_param</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;skewed_attribute&quot;</span><span class="p">]</span>
<a id="__codelineno-0-914" name="__codelineno-0-914" href="#__codelineno-0-914"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-915" name="__codelineno-0-915" href="#__codelineno-0-915"></a>                <span class="n">skewed_param</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;skewed_attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;skewed_attribute&quot;</span><span class="p">]</span>
<a id="__codelineno-0-916" name="__codelineno-0-916" href="#__codelineno-0-916"></a>
<a id="__codelineno-0-917" name="__codelineno-0-917" href="#__codelineno-0-917"></a>            <span class="n">schema</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">StructType</span><span class="p">(</span>
<a id="__codelineno-0-918" name="__codelineno-0-918" href="#__codelineno-0-918"></a>                <span class="p">[</span>
<a id="__codelineno-0-919" name="__codelineno-0-919" href="#__codelineno-0-919"></a>                    <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-920" name="__codelineno-0-920" href="#__codelineno-0-920"></a>                    <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;parameters&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">ArrayType</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">()),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-921" name="__codelineno-0-921" href="#__codelineno-0-921"></a>                <span class="p">]</span>
<a id="__codelineno-0-922" name="__codelineno-0-922" href="#__codelineno-0-922"></a>            <span class="p">)</span>
<a id="__codelineno-0-923" name="__codelineno-0-923" href="#__codelineno-0-923"></a>            <span class="n">df_model</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
<a id="__codelineno-0-924" name="__codelineno-0-924" href="#__codelineno-0-924"></a>                <span class="nb">zip</span><span class="p">(</span>
<a id="__codelineno-0-925" name="__codelineno-0-925" href="#__codelineno-0-925"></a>                    <span class="n">list_of_cols</span> <span class="o">+</span> <span class="n">skewed_cols</span><span class="p">,</span>
<a id="__codelineno-0-926" name="__codelineno-0-926" href="#__codelineno-0-926"></a>                    <span class="n">params</span> <span class="o">+</span> <span class="p">[</span><span class="n">skewed_param</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">skewed_cols</span><span class="p">),</span>
<a id="__codelineno-0-927" name="__codelineno-0-927" href="#__codelineno-0-927"></a>                <span class="p">),</span>
<a id="__codelineno-0-928" name="__codelineno-0-928" href="#__codelineno-0-928"></a>                <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
<a id="__codelineno-0-929" name="__codelineno-0-929" href="#__codelineno-0-929"></a>            <span class="p">)</span>
<a id="__codelineno-0-930" name="__codelineno-0-930" href="#__codelineno-0-930"></a>            <span class="n">df_model</span><span class="o">.</span><span class="n">coalesce</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span>
<a id="__codelineno-0-931" name="__codelineno-0-931" href="#__codelineno-0-931"></a>                <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/outlier_numcols&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span>
<a id="__codelineno-0-932" name="__codelineno-0-932" href="#__codelineno-0-932"></a>            <span class="p">)</span>
<a id="__codelineno-0-933" name="__codelineno-0-933" href="#__codelineno-0-933"></a>
<a id="__codelineno-0-934" name="__codelineno-0-934" href="#__codelineno-0-934"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">treatment</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-935" name="__codelineno-0-935" href="#__codelineno-0-935"></a>                <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-0-936" name="__codelineno-0-936" href="#__codelineno-0-936"></a>
<a id="__codelineno-0-937" name="__codelineno-0-937" href="#__codelineno-0-937"></a>    <span class="k">def</span> <span class="nf">composite_outlier_pandas</span><span class="p">(</span><span class="n">col_param</span><span class="p">):</span>
<a id="__codelineno-0-938" name="__codelineno-0-938" href="#__codelineno-0-938"></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
<a id="__codelineno-0-939" name="__codelineno-0-939" href="#__codelineno-0-939"></a>            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;raise&quot;</span><span class="p">)</span>
<a id="__codelineno-0-940" name="__codelineno-0-940" href="#__codelineno-0-940"></a>            <span class="k">if</span> <span class="n">detection_side</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="s2">&quot;both&quot;</span><span class="p">):</span>
<a id="__codelineno-0-941" name="__codelineno-0-941" href="#__codelineno-0-941"></a>                <span class="n">lower_v</span> <span class="o">=</span> <span class="p">((</span><span class="n">v</span> <span class="o">-</span> <span class="n">col_param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-942" name="__codelineno-0-942" href="#__codelineno-0-942"></a>            <span class="k">if</span> <span class="n">detection_side</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span> <span class="s2">&quot;both&quot;</span><span class="p">):</span>
<a id="__codelineno-0-943" name="__codelineno-0-943" href="#__codelineno-0-943"></a>                <span class="n">upper_v</span> <span class="o">=</span> <span class="p">((</span><span class="n">v</span> <span class="o">-</span> <span class="n">col_param</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-944" name="__codelineno-0-944" href="#__codelineno-0-944"></a>
<a id="__codelineno-0-945" name="__codelineno-0-945" href="#__codelineno-0-945"></a>            <span class="k">if</span> <span class="n">detection_side</span> <span class="o">==</span> <span class="s2">&quot;upper&quot;</span><span class="p">:</span>
<a id="__codelineno-0-946" name="__codelineno-0-946" href="#__codelineno-0-946"></a>                <span class="k">return</span> <span class="n">upper_v</span>
<a id="__codelineno-0-947" name="__codelineno-0-947" href="#__codelineno-0-947"></a>            <span class="k">elif</span> <span class="n">detection_side</span> <span class="o">==</span> <span class="s2">&quot;lower&quot;</span><span class="p">:</span>
<a id="__codelineno-0-948" name="__codelineno-0-948" href="#__codelineno-0-948"></a>                <span class="k">return</span> <span class="n">lower_v</span>
<a id="__codelineno-0-949" name="__codelineno-0-949" href="#__codelineno-0-949"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-950" name="__codelineno-0-950" href="#__codelineno-0-950"></a>                <span class="k">return</span> <span class="n">lower_v</span> <span class="o">+</span> <span class="n">upper_v</span>
<a id="__codelineno-0-951" name="__codelineno-0-951" href="#__codelineno-0-951"></a>
<a id="__codelineno-0-952" name="__codelineno-0-952" href="#__codelineno-0-952"></a>        <span class="k">return</span> <span class="n">inner</span>
<a id="__codelineno-0-953" name="__codelineno-0-953" href="#__codelineno-0-953"></a>
<a id="__codelineno-0-954" name="__codelineno-0-954" href="#__codelineno-0-954"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-955" name="__codelineno-0-955" href="#__codelineno-0-955"></a>
<a id="__codelineno-0-956" name="__codelineno-0-956" href="#__codelineno-0-956"></a>    <span class="n">list_odf</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-957" name="__codelineno-0-957" href="#__codelineno-0-957"></a>    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-958" name="__codelineno-0-958" href="#__codelineno-0-958"></a>        <span class="n">f_composite_outlier</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">pandas_udf</span><span class="p">(</span>
<a id="__codelineno-0-959" name="__codelineno-0-959" href="#__codelineno-0-959"></a>            <span class="n">composite_outlier_pandas</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">index</span><span class="p">]),</span> <span class="n">returnType</span><span class="o">=</span><span class="n">T</span><span class="o">.</span><span class="n">IntegerType</span><span class="p">()</span>
<a id="__codelineno-0-960" name="__codelineno-0-960" href="#__codelineno-0-960"></a>        <span class="p">)</span>
<a id="__codelineno-0-961" name="__codelineno-0-961" href="#__codelineno-0-961"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_outliered&quot;</span><span class="p">,</span> <span class="n">f_composite_outlier</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a id="__codelineno-0-962" name="__codelineno-0-962" href="#__codelineno-0-962"></a>
<a id="__codelineno-0-963" name="__codelineno-0-963" href="#__codelineno-0-963"></a>        <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-964" name="__codelineno-0-964" href="#__codelineno-0-964"></a>            <span class="n">odf_agg_col</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-965" name="__codelineno-0-965" href="#__codelineno-0-965"></a>                <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_outliered&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">()</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_outliered&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-0-966" name="__codelineno-0-966" href="#__codelineno-0-966"></a>            <span class="p">)</span>
<a id="__codelineno-0-967" name="__codelineno-0-967" href="#__codelineno-0-967"></a>            <span class="n">odf_print_col</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-968" name="__codelineno-0-968" href="#__codelineno-0-968"></a>                <span class="n">odf_agg_col</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-969" name="__codelineno-0-969" href="#__codelineno-0-969"></a>                    <span class="s2">&quot;lower_outliers&quot;</span><span class="p">,</span>
<a id="__codelineno-0-970" name="__codelineno-0-970" href="#__codelineno-0-970"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;-1&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;-1&quot;</span> <span class="ow">in</span> <span class="n">odf_agg_col</span><span class="o">.</span><span class="n">columns</span> <span class="k">else</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-971" name="__codelineno-0-971" href="#__codelineno-0-971"></a>                <span class="p">)</span>
<a id="__codelineno-0-972" name="__codelineno-0-972" href="#__codelineno-0-972"></a>                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-973" name="__codelineno-0-973" href="#__codelineno-0-973"></a>                    <span class="s2">&quot;upper_outliers&quot;</span><span class="p">,</span>
<a id="__codelineno-0-974" name="__codelineno-0-974" href="#__codelineno-0-974"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;1&quot;</span> <span class="ow">in</span> <span class="n">odf_agg_col</span><span class="o">.</span><span class="n">columns</span> <span class="k">else</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-975" name="__codelineno-0-975" href="#__codelineno-0-975"></a>                <span class="p">)</span>
<a id="__codelineno-0-976" name="__codelineno-0-976" href="#__codelineno-0-976"></a>                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;excluded_due_to_skewness&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-0-977" name="__codelineno-0-977" href="#__codelineno-0-977"></a>                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
<a id="__codelineno-0-978" name="__codelineno-0-978" href="#__codelineno-0-978"></a>                <span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-0-979" name="__codelineno-0-979" href="#__codelineno-0-979"></a>                    <span class="s2">&quot;attribute&quot;</span><span class="p">,</span>
<a id="__codelineno-0-980" name="__codelineno-0-980" href="#__codelineno-0-980"></a>                    <span class="s2">&quot;lower_outliers&quot;</span><span class="p">,</span>
<a id="__codelineno-0-981" name="__codelineno-0-981" href="#__codelineno-0-981"></a>                    <span class="s2">&quot;upper_outliers&quot;</span><span class="p">,</span>
<a id="__codelineno-0-982" name="__codelineno-0-982" href="#__codelineno-0-982"></a>                    <span class="s2">&quot;excluded_due_to_skewness&quot;</span><span class="p">,</span>
<a id="__codelineno-0-983" name="__codelineno-0-983" href="#__codelineno-0-983"></a>                <span class="p">)</span>
<a id="__codelineno-0-984" name="__codelineno-0-984" href="#__codelineno-0-984"></a>                <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-985" name="__codelineno-0-985" href="#__codelineno-0-985"></a>            <span class="p">)</span>
<a id="__codelineno-0-986" name="__codelineno-0-986" href="#__codelineno-0-986"></a>            <span class="n">list_odf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">odf_print_col</span><span class="p">)</span>
<a id="__codelineno-0-987" name="__codelineno-0-987" href="#__codelineno-0-987"></a>
<a id="__codelineno-0-988" name="__codelineno-0-988" href="#__codelineno-0-988"></a>        <span class="k">if</span> <span class="n">treatment</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">treatment_method</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;value_replacement&quot;</span><span class="p">,</span> <span class="s2">&quot;null_replacement&quot;</span><span class="p">)):</span>
<a id="__codelineno-0-989" name="__codelineno-0-989" href="#__codelineno-0-989"></a>            <span class="n">replace_vals</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-990" name="__codelineno-0-990" href="#__codelineno-0-990"></a>                <span class="s2">&quot;value_replacement&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span>
<a id="__codelineno-0-991" name="__codelineno-0-991" href="#__codelineno-0-991"></a>                <span class="s2">&quot;null_replacement&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-992" name="__codelineno-0-992" href="#__codelineno-0-992"></a>            <span class="p">}</span>
<a id="__codelineno-0-993" name="__codelineno-0-993" href="#__codelineno-0-993"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-994" name="__codelineno-0-994" href="#__codelineno-0-994"></a>                <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_outliered&quot;</span><span class="p">,</span>
<a id="__codelineno-0-995" name="__codelineno-0-995" href="#__codelineno-0-995"></a>                <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
<a id="__codelineno-0-996" name="__codelineno-0-996" href="#__codelineno-0-996"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_outliered&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">replace_vals</span><span class="p">[</span><span class="n">treatment_method</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-997" name="__codelineno-0-997" href="#__codelineno-0-997"></a>                <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
<a id="__codelineno-0-998" name="__codelineno-0-998" href="#__codelineno-0-998"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
<a id="__codelineno-0-999" name="__codelineno-0-999" href="#__codelineno-0-999"></a>                        <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_outliered&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000" href="#__codelineno-0-1000"></a>                        <span class="n">replace_vals</span><span class="p">[</span><span class="n">treatment_method</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001" href="#__codelineno-0-1001"></a>                    <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002" href="#__codelineno-0-1002"></a>                <span class="p">),</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003" href="#__codelineno-0-1003"></a>            <span class="p">)</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004" href="#__codelineno-0-1004"></a>            <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005" href="#__codelineno-0-1005"></a>                <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_outliered&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006" href="#__codelineno-0-1006"></a>
<a id="__codelineno-0-1007" name="__codelineno-0-1007" href="#__codelineno-0-1007"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008" href="#__codelineno-0-1008"></a>
<a id="__codelineno-0-1009" name="__codelineno-0-1009" href="#__codelineno-0-1009"></a>        <span class="k">def</span> <span class="nf">unionAll</span><span class="p">(</span><span class="n">dfs</span><span class="p">):</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010" href="#__codelineno-0-1010"></a>            <span class="n">first</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">dfs</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011" href="#__codelineno-0-1011"></a>            <span class="k">return</span> <span class="n">first</span><span class="o">.</span><span class="n">sql_ctx</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012" href="#__codelineno-0-1012"></a>                <span class="n">first</span><span class="o">.</span><span class="n">sql_ctx</span><span class="o">.</span><span class="n">_sc</span><span class="o">.</span><span class="n">union</span><span class="p">([</span><span class="n">df</span><span class="o">.</span><span class="n">rdd</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dfs</span><span class="p">]),</span> <span class="n">first</span><span class="o">.</span><span class="n">schema</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013" href="#__codelineno-0-1013"></a>            <span class="p">)</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014" href="#__codelineno-0-1014"></a>
<a id="__codelineno-0-1015" name="__codelineno-0-1015" href="#__codelineno-0-1015"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">unionAll</span><span class="p">(</span><span class="n">list_odf</span><span class="p">)</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016" href="#__codelineno-0-1016"></a>
<a id="__codelineno-0-1017" name="__codelineno-0-1017" href="#__codelineno-0-1017"></a>        <span class="k">if</span> <span class="n">skewed_cols</span><span class="p">:</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018" href="#__codelineno-0-1018"></a>            <span class="n">skewed_cols_print</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">skewed_cols</span><span class="p">]</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019" href="#__codelineno-0-1019"></a>            <span class="n">skewed_cols_odf_print</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020" href="#__codelineno-0-1020"></a>                <span class="n">skewed_cols_print</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">odf_print</span><span class="o">.</span><span class="n">columns</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021" href="#__codelineno-0-1021"></a>            <span class="p">)</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022" href="#__codelineno-0-1022"></a>            <span class="n">odf_print</span> <span class="o">=</span> <span class="n">unionAll</span><span class="p">([</span><span class="n">odf_print</span><span class="p">,</span> <span class="n">skewed_cols_odf_print</span><span class="p">])</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023" href="#__codelineno-0-1023"></a>
<a id="__codelineno-0-1024" name="__codelineno-0-1024" href="#__codelineno-0-1024"></a>        <span class="n">odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">skewed_cols</span><span class="p">),</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025" href="#__codelineno-0-1025"></a>
<a id="__codelineno-0-1026" name="__codelineno-0-1026" href="#__codelineno-0-1026"></a>    <span class="k">if</span> <span class="n">treatment</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">treatment_method</span> <span class="o">==</span> <span class="s2">&quot;row_removal&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027" href="#__codelineno-0-1027"></a>        <span class="n">conditions</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028" href="#__codelineno-0-1028"></a>            <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_outliered&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_outliered&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">())</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029" href="#__codelineno-0-1029"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030" href="#__codelineno-0-1030"></a>        <span class="p">]</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031" href="#__codelineno-0-1031"></a>        <span class="n">conditions_combined</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">&amp;</span> <span class="n">b</span><span class="p">,</span> <span class="n">conditions</span><span class="p">)</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032" href="#__codelineno-0-1032"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">conditions_combined</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033" href="#__codelineno-0-1033"></a>            <span class="o">*</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_outliered&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">]</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034" href="#__codelineno-0-1034"></a>        <span class="p">)</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035" href="#__codelineno-0-1035"></a>
<a id="__codelineno-0-1036" name="__codelineno-0-1036" href="#__codelineno-0-1036"></a>    <span class="k">if</span> <span class="n">treatment</span><span class="p">:</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037" href="#__codelineno-0-1037"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038" href="#__codelineno-0-1038"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">column_order</span><span class="p">)</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039" href="#__codelineno-0-1039"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040" href="#__codelineno-0-1040"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041" href="#__codelineno-0-1041"></a>
<a id="__codelineno-0-1042" name="__codelineno-0-1042" href="#__codelineno-0-1042"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043" href="#__codelineno-0-1043"></a>        <span class="k">return</span> <span class="n">odf</span><span class="p">,</span> <span class="n">odf_print</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044" href="#__codelineno-0-1044"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045" href="#__codelineno-0-1045"></a>        <span class="k">return</span> <span class="n">odf</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046" href="#__codelineno-0-1046"></a>
<a id="__codelineno-0-1047" name="__codelineno-0-1047" href="#__codelineno-0-1047"></a>
<a id="__codelineno-0-1048" name="__codelineno-0-1048" href="#__codelineno-0-1048"></a><span class="k">def</span> <span class="nf">IDness_detection</span><span class="p">(</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049" href="#__codelineno-0-1049"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050" href="#__codelineno-0-1050"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051" href="#__codelineno-0-1051"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052" href="#__codelineno-0-1052"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053" href="#__codelineno-0-1053"></a>    <span class="n">treatment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054" href="#__codelineno-0-1054"></a>    <span class="n">treatment_threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055" href="#__codelineno-0-1055"></a>    <span class="n">stats_unique</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056" href="#__codelineno-0-1056"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057" href="#__codelineno-0-1057"></a><span class="p">):</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058" href="#__codelineno-0-1058"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059" href="#__codelineno-0-1059"></a><span class="sd">    IDness of an attribute is defined as the ratio of number of unique values seen in an attribute by number of</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060" href="#__codelineno-0-1060"></a><span class="sd">    non-null rows. It varies between 0 to 100% where IDness of 100% means there are as many unique values as number</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061" href="#__codelineno-0-1061"></a><span class="sd">    of rows (primary key in the input dataset). IDness is computed only for discrete features. This function</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062" href="#__codelineno-0-1062"></a><span class="sd">    leverages the statistics from Measures of Cardinality function and flag the columns if IDness is above a certain</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063" href="#__codelineno-0-1063"></a><span class="sd">    threshold. Such columns can be deleted from the modelling analysis if directed for a treatment.</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064" href="#__codelineno-0-1064"></a>
<a id="__codelineno-0-1065" name="__codelineno-0-1065" href="#__codelineno-0-1065"></a><span class="sd">    This function returns two dataframes in tuple format – 1st dataframe is input dataset after removing high IDness</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066" href="#__codelineno-0-1066"></a><span class="sd">    columns (if treated else the original dataset) and  2nd dataframe is of schema – attribute, unique_values, IDness.</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067" href="#__codelineno-0-1067"></a>
<a id="__codelineno-0-1068" name="__codelineno-0-1068" href="#__codelineno-0-1068"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069" href="#__codelineno-0-1069"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070" href="#__codelineno-0-1070"></a><span class="sd">    spark</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071" href="#__codelineno-0-1071"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072" href="#__codelineno-0-1072"></a><span class="sd">    idf</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073" href="#__codelineno-0-1073"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074" href="#__codelineno-0-1074"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075" href="#__codelineno-0-1075"></a><span class="sd">        List of Discrete (Categorical + Integer) columns to analyse e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076" href="#__codelineno-0-1076"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077" href="#__codelineno-0-1077"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078" href="#__codelineno-0-1078"></a><span class="sd">        &quot;all&quot; can be passed to include all discrete columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079" href="#__codelineno-0-1079"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in drop_cols argument</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080" href="#__codelineno-0-1080"></a><span class="sd">        is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081" href="#__codelineno-0-1081"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082" href="#__codelineno-0-1082"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083" href="#__codelineno-0-1083"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084" href="#__codelineno-0-1084"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085" href="#__codelineno-0-1085"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086" href="#__codelineno-0-1086"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087" href="#__codelineno-0-1087"></a><span class="sd">    treatment</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088" href="#__codelineno-0-1088"></a><span class="sd">        Boolean argument – True or False. If True, columns with high IDness (defined by</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089" href="#__codelineno-0-1089"></a><span class="sd">        treatment_threshold argument) are removed from the input dataframe. (Default value = False)</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090" href="#__codelineno-0-1090"></a><span class="sd">    treatment_threshold</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091" href="#__codelineno-0-1091"></a><span class="sd">        Defines acceptable level of IDness (calculated as no. of unique values divided by no. of</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092" href="#__codelineno-0-1092"></a><span class="sd">        non-null values) for a column and takes value between 0 to 1. Default threshold</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093" href="#__codelineno-0-1093"></a><span class="sd">        of 0.8 can be interpreted as remove column if its unique values count is more than</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094" href="#__codelineno-0-1094"></a><span class="sd">        80% of total rows (after excluding null values).</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095" href="#__codelineno-0-1095"></a><span class="sd">    stats_unique</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096" href="#__codelineno-0-1096"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097" href="#__codelineno-0-1097"></a><span class="sd">        to read pre-saved statistics on unique value count i.e. if measures_of_cardinality or</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098" href="#__codelineno-0-1098"></a><span class="sd">        uniqueCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099" href="#__codelineno-0-1099"></a><span class="sd">    print_impact</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100" href="#__codelineno-0-1100"></a><span class="sd">        True, False</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101" href="#__codelineno-0-1101"></a><span class="sd">        This argument is to print out the statistics and the impact of treatment (if applicable).(Default value = False)</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102" href="#__codelineno-0-1102"></a>
<a id="__codelineno-0-1103" name="__codelineno-0-1103" href="#__codelineno-0-1103"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104" href="#__codelineno-0-1104"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105" href="#__codelineno-0-1105"></a><span class="sd">    odf : DataFrame</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106" href="#__codelineno-0-1106"></a><span class="sd">        Dataframe after column removal if treated, else original input dataframe.</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107" href="#__codelineno-0-1107"></a><span class="sd">    odf_print : DataFrame</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108" href="#__codelineno-0-1108"></a><span class="sd">        schema [attribute, unique_values, IDness, flagged/treated].</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109" href="#__codelineno-0-1109"></a><span class="sd">        unique_values is no. of distinct values in a column,</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110" href="#__codelineno-0-1110"></a><span class="sd">        IDness is unique_values divided by no. of non-null values.</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111" href="#__codelineno-0-1111"></a><span class="sd">        A column is flagged 1 if IDness is above the threshold, else 0.</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112" href="#__codelineno-0-1112"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113" href="#__codelineno-0-1113"></a>
<a id="__codelineno-0-1114" name="__codelineno-0-1114" href="#__codelineno-0-1114"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115" href="#__codelineno-0-1115"></a>        <span class="n">num_cols</span><span class="p">,</span> <span class="n">cat_cols</span><span class="p">,</span> <span class="n">other_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116" href="#__codelineno-0-1116"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span> <span class="o">+</span> <span class="n">cat_cols</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117" href="#__codelineno-0-1117"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118" href="#__codelineno-0-1118"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119" href="#__codelineno-0-1119"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120" href="#__codelineno-0-1120"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121" href="#__codelineno-0-1121"></a>
<a id="__codelineno-0-1122" name="__codelineno-0-1122" href="#__codelineno-0-1122"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123" href="#__codelineno-0-1123"></a>
<a id="__codelineno-0-1124" name="__codelineno-0-1124" href="#__codelineno-0-1124"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125" href="#__codelineno-0-1125"></a>        <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="s2">&quot;bigint&quot;</span><span class="p">,</span> <span class="s2">&quot;long&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126" href="#__codelineno-0-1126"></a>            <span class="n">list_of_cols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127" href="#__codelineno-0-1127"></a>
<a id="__codelineno-0-1128" name="__codelineno-0-1128" href="#__codelineno-0-1128"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129" href="#__codelineno-0-1129"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130" href="#__codelineno-0-1130"></a>
<a id="__codelineno-0-1131" name="__codelineno-0-1131" href="#__codelineno-0-1131"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132" href="#__codelineno-0-1132"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No IDness Check - No discrete column(s) to analyze&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133" href="#__codelineno-0-1133"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134" href="#__codelineno-0-1134"></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">StructType</span><span class="p">(</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135" href="#__codelineno-0-1135"></a>            <span class="p">[</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136" href="#__codelineno-0-1136"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137" href="#__codelineno-0-1137"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;unique_values&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138" href="#__codelineno-0-1138"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;IDness&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139" href="#__codelineno-0-1139"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;flagged&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140" href="#__codelineno-0-1140"></a>            <span class="p">]</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141" href="#__codelineno-0-1141"></a>        <span class="p">)</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142" href="#__codelineno-0-1142"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">emptyRDD</span><span class="p">()</span><span class="o">.</span><span class="n">toDF</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143" href="#__codelineno-0-1143"></a>        <span class="k">return</span> <span class="n">odf</span><span class="p">,</span> <span class="n">odf_print</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144" href="#__codelineno-0-1144"></a>    <span class="n">treatment_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">treatment_threshold</span><span class="p">)</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145" href="#__codelineno-0-1145"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">treatment_threshold</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">treatment_threshold</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146" href="#__codelineno-0-1146"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Treatment Threshold Value&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147" href="#__codelineno-0-1147"></a>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148" href="#__codelineno-0-1148"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149" href="#__codelineno-0-1149"></a>    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150" href="#__codelineno-0-1150"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151" href="#__codelineno-0-1151"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152" href="#__codelineno-0-1152"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Non-Boolean input for treatment&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153" href="#__codelineno-0-1153"></a>
<a id="__codelineno-0-1154" name="__codelineno-0-1154" href="#__codelineno-0-1154"></a>    <span class="k">if</span> <span class="n">stats_unique</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155" href="#__codelineno-0-1155"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">measures_of_cardinality</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156" href="#__codelineno-0-1156"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157" href="#__codelineno-0-1157"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_unique</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158" href="#__codelineno-0-1158"></a>            <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159" href="#__codelineno-0-1159"></a>        <span class="p">)</span>
<a id="__codelineno-0-1160" name="__codelineno-0-1160" href="#__codelineno-0-1160"></a>
<a id="__codelineno-0-1161" name="__codelineno-0-1161" href="#__codelineno-0-1161"></a>    <span class="n">odf_print</span> <span class="o">=</span> <span class="n">odf_print</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162" href="#__codelineno-0-1162"></a>        <span class="s2">&quot;flagged&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;IDness&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">treatment_threshold</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163" href="#__codelineno-0-1163"></a>    <span class="p">)</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164" href="#__codelineno-0-1164"></a>
<a id="__codelineno-0-1165" name="__codelineno-0-1165" href="#__codelineno-0-1165"></a>    <span class="k">if</span> <span class="n">treatment</span><span class="p">:</span>
<a id="__codelineno-0-1166" name="__codelineno-0-1166" href="#__codelineno-0-1166"></a>        <span class="n">remove_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167" href="#__codelineno-0-1167"></a>            <span class="n">odf_print</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;flagged&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168" href="#__codelineno-0-1168"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169" href="#__codelineno-0-1169"></a>            <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170" href="#__codelineno-0-1170"></a>            <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171" href="#__codelineno-0-1171"></a>        <span class="p">)</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172" href="#__codelineno-0-1172"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="n">remove_cols</span><span class="p">)</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173" href="#__codelineno-0-1173"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">odf_print</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;flagged&quot;</span><span class="p">,</span> <span class="s2">&quot;treated&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174" href="#__codelineno-0-1174"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175" href="#__codelineno-0-1175"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176" href="#__codelineno-0-1176"></a>
<a id="__codelineno-0-1177" name="__codelineno-0-1177" href="#__codelineno-0-1177"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178" href="#__codelineno-0-1178"></a>        <span class="n">odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179" href="#__codelineno-0-1179"></a>        <span class="k">if</span> <span class="n">treatment</span><span class="p">:</span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180" href="#__codelineno-0-1180"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Removed Columns: &quot;</span><span class="p">,</span> <span class="n">remove_cols</span><span class="p">)</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181" href="#__codelineno-0-1181"></a>
<a id="__codelineno-0-1182" name="__codelineno-0-1182" href="#__codelineno-0-1182"></a>    <span class="k">return</span> <span class="n">odf</span><span class="p">,</span> <span class="n">odf_print</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183" href="#__codelineno-0-1183"></a>
<a id="__codelineno-0-1184" name="__codelineno-0-1184" href="#__codelineno-0-1184"></a>
<a id="__codelineno-0-1185" name="__codelineno-0-1185" href="#__codelineno-0-1185"></a><span class="k">def</span> <span class="nf">biasedness_detection</span><span class="p">(</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186" href="#__codelineno-0-1186"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-1187" name="__codelineno-0-1187" href="#__codelineno-0-1187"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188" href="#__codelineno-0-1188"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189" href="#__codelineno-0-1189"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190" href="#__codelineno-0-1190"></a>    <span class="n">treatment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191" href="#__codelineno-0-1191"></a>    <span class="n">treatment_threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192" href="#__codelineno-0-1192"></a>    <span class="n">stats_mode</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193" href="#__codelineno-0-1193"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194" href="#__codelineno-0-1194"></a><span class="p">):</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195" href="#__codelineno-0-1195"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196" href="#__codelineno-0-1196"></a><span class="sd">    This function flags column if they are biased or skewed towards one specific value and leverages</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197" href="#__codelineno-0-1197"></a><span class="sd">    mode_pct computation from Measures of Central Tendency i.e. number of rows with mode value (most frequently seen</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198" href="#__codelineno-0-1198"></a><span class="sd">    value) divided by number of non-null values. It varies between 0 to 100% where biasedness of 100% means there is</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199" href="#__codelineno-0-1199"></a><span class="sd">    only a single value (other than null). The function flags a column if its biasedness is above a certain</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200" href="#__codelineno-0-1200"></a><span class="sd">    threshold. Such columns can be deleted from the modelling analysis, if required.</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201" href="#__codelineno-0-1201"></a>
<a id="__codelineno-0-1202" name="__codelineno-0-1202" href="#__codelineno-0-1202"></a><span class="sd">    This function returns two dataframes in tuple format – 1st dataframe is input dataset after removing high biased</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203" href="#__codelineno-0-1203"></a><span class="sd">    columns (the original dataset if no treatment) and  2nd dataframe is of schema – attribute, mode, mode_pct.</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204" href="#__codelineno-0-1204"></a>
<a id="__codelineno-0-1205" name="__codelineno-0-1205" href="#__codelineno-0-1205"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206" href="#__codelineno-0-1206"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207" href="#__codelineno-0-1207"></a><span class="sd">    spark</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208" href="#__codelineno-0-1208"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209" href="#__codelineno-0-1209"></a><span class="sd">    idf</span>
<a id="__codelineno-0-1210" name="__codelineno-0-1210" href="#__codelineno-0-1210"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-1211" name="__codelineno-0-1211" href="#__codelineno-0-1211"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212" href="#__codelineno-0-1212"></a><span class="sd">        List of Discrete (Categorical + Integer) columns to analyse e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213" href="#__codelineno-0-1213"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214" href="#__codelineno-0-1214"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-1215" name="__codelineno-0-1215" href="#__codelineno-0-1215"></a><span class="sd">        &quot;all&quot; can be passed to include all discrete columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216" href="#__codelineno-0-1216"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in drop_cols argument</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217" href="#__codelineno-0-1217"></a><span class="sd">        is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218" href="#__codelineno-0-1218"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219" href="#__codelineno-0-1219"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220" href="#__codelineno-0-1220"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-1221" name="__codelineno-0-1221" href="#__codelineno-0-1221"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222" href="#__codelineno-0-1222"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-0-1223" name="__codelineno-0-1223" href="#__codelineno-0-1223"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224" href="#__codelineno-0-1224"></a><span class="sd">    treatment</span>
<a id="__codelineno-0-1225" name="__codelineno-0-1225" href="#__codelineno-0-1225"></a><span class="sd">        Boolean argument – True or False. If True, columns with high biasedness (defined by</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226" href="#__codelineno-0-1226"></a><span class="sd">        treatment_threshold argument) are removed from the input dataframe. (Default value = False)</span>
<a id="__codelineno-0-1227" name="__codelineno-0-1227" href="#__codelineno-0-1227"></a><span class="sd">    treatment_threshold</span>
<a id="__codelineno-0-1228" name="__codelineno-0-1228" href="#__codelineno-0-1228"></a><span class="sd">        Defines acceptable level of biasedness (frequency of most-frequently seen value)for</span>
<a id="__codelineno-0-1229" name="__codelineno-0-1229" href="#__codelineno-0-1229"></a><span class="sd">        a column and takes value between 0 to 1. Default threshold of 0.8 can be interpreted as</span>
<a id="__codelineno-0-1230" name="__codelineno-0-1230" href="#__codelineno-0-1230"></a><span class="sd">        remove column if the number of rows with most-frequently seen value is more than 80%</span>
<a id="__codelineno-0-1231" name="__codelineno-0-1231" href="#__codelineno-0-1231"></a><span class="sd">        of total rows (after excluding null values).</span>
<a id="__codelineno-0-1232" name="__codelineno-0-1232" href="#__codelineno-0-1232"></a><span class="sd">    stats_mode</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233" href="#__codelineno-0-1233"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-0-1234" name="__codelineno-0-1234" href="#__codelineno-0-1234"></a><span class="sd">        to read pre-saved statistics on most frequently seen values i.e. if measures_of_centralTendency or</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235" href="#__codelineno-0-1235"></a><span class="sd">        mode_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236" href="#__codelineno-0-1236"></a><span class="sd">    print_impact</span>
<a id="__codelineno-0-1237" name="__codelineno-0-1237" href="#__codelineno-0-1237"></a><span class="sd">        True, False</span>
<a id="__codelineno-0-1238" name="__codelineno-0-1238" href="#__codelineno-0-1238"></a><span class="sd">        This argument is to print out the statistics and the impact of treatment (if applicable).(Default value = False)</span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239" href="#__codelineno-0-1239"></a>
<a id="__codelineno-0-1240" name="__codelineno-0-1240" href="#__codelineno-0-1240"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241" href="#__codelineno-0-1241"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242" href="#__codelineno-0-1242"></a><span class="sd">    odf : DataFrame</span>
<a id="__codelineno-0-1243" name="__codelineno-0-1243" href="#__codelineno-0-1243"></a><span class="sd">        Dataframe after column removal if treated, else original input dataframe.</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244" href="#__codelineno-0-1244"></a><span class="sd">    odf_print : DataFrame</span>
<a id="__codelineno-0-1245" name="__codelineno-0-1245" href="#__codelineno-0-1245"></a><span class="sd">        schema [attribute, mode, mode_rows, mode_pct, flagged/treated].</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246" href="#__codelineno-0-1246"></a><span class="sd">        mode is the most frequently seen value,</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247" href="#__codelineno-0-1247"></a><span class="sd">        mode_rows is number of rows with mode value, and</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248" href="#__codelineno-0-1248"></a><span class="sd">        mode_pct is number of rows with mode value divided by non-null values.</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249" href="#__codelineno-0-1249"></a><span class="sd">        A column is flagged 1 if mode_pct is above the threshold else 0.</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250" href="#__codelineno-0-1250"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1251" name="__codelineno-0-1251" href="#__codelineno-0-1251"></a>
<a id="__codelineno-0-1252" name="__codelineno-0-1252" href="#__codelineno-0-1252"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253" href="#__codelineno-0-1253"></a>        <span class="n">num_cols</span><span class="p">,</span> <span class="n">cat_cols</span><span class="p">,</span> <span class="n">other_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)</span>
<a id="__codelineno-0-1254" name="__codelineno-0-1254" href="#__codelineno-0-1254"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span> <span class="o">+</span> <span class="n">cat_cols</span>
<a id="__codelineno-0-1255" name="__codelineno-0-1255" href="#__codelineno-0-1255"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256" href="#__codelineno-0-1256"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-1257" name="__codelineno-0-1257" href="#__codelineno-0-1257"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-1258" name="__codelineno-0-1258" href="#__codelineno-0-1258"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259" href="#__codelineno-0-1259"></a>
<a id="__codelineno-0-1260" name="__codelineno-0-1260" href="#__codelineno-0-1260"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261" href="#__codelineno-0-1261"></a>
<a id="__codelineno-0-1262" name="__codelineno-0-1262" href="#__codelineno-0-1262"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
<a id="__codelineno-0-1263" name="__codelineno-0-1263" href="#__codelineno-0-1263"></a>        <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="s2">&quot;bigint&quot;</span><span class="p">,</span> <span class="s2">&quot;long&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1264" name="__codelineno-0-1264" href="#__codelineno-0-1264"></a>            <span class="n">list_of_cols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-1265" name="__codelineno-0-1265" href="#__codelineno-0-1265"></a>
<a id="__codelineno-0-1266" name="__codelineno-0-1266" href="#__codelineno-0-1266"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-1267" name="__codelineno-0-1267" href="#__codelineno-0-1267"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268" href="#__codelineno-0-1268"></a>
<a id="__codelineno-0-1269" name="__codelineno-0-1269" href="#__codelineno-0-1269"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1270" name="__codelineno-0-1270" href="#__codelineno-0-1270"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No biasedness Check - No discrete column(s) to analyze&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1271" name="__codelineno-0-1271" href="#__codelineno-0-1271"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-1272" name="__codelineno-0-1272" href="#__codelineno-0-1272"></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">StructType</span><span class="p">(</span>
<a id="__codelineno-0-1273" name="__codelineno-0-1273" href="#__codelineno-0-1273"></a>            <span class="p">[</span>
<a id="__codelineno-0-1274" name="__codelineno-0-1274" href="#__codelineno-0-1274"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-1275" name="__codelineno-0-1275" href="#__codelineno-0-1275"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276" href="#__codelineno-0-1276"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;mode_rows&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-1277" name="__codelineno-0-1277" href="#__codelineno-0-1277"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;mode_pct&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-1278" name="__codelineno-0-1278" href="#__codelineno-0-1278"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;flagged&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279" href="#__codelineno-0-1279"></a>            <span class="p">]</span>
<a id="__codelineno-0-1280" name="__codelineno-0-1280" href="#__codelineno-0-1280"></a>        <span class="p">)</span>
<a id="__codelineno-0-1281" name="__codelineno-0-1281" href="#__codelineno-0-1281"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">emptyRDD</span><span class="p">()</span><span class="o">.</span><span class="n">toDF</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282" href="#__codelineno-0-1282"></a>        <span class="k">return</span> <span class="n">odf</span><span class="p">,</span> <span class="n">odf_print</span>
<a id="__codelineno-0-1283" name="__codelineno-0-1283" href="#__codelineno-0-1283"></a>
<a id="__codelineno-0-1284" name="__codelineno-0-1284" href="#__codelineno-0-1284"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">treatment_threshold</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">treatment_threshold</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-1285" name="__codelineno-0-1285" href="#__codelineno-0-1285"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Treatment Threshold Value&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286" href="#__codelineno-0-1286"></a>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1287" name="__codelineno-0-1287" href="#__codelineno-0-1287"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1288" name="__codelineno-0-1288" href="#__codelineno-0-1288"></a>    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1289" name="__codelineno-0-1289" href="#__codelineno-0-1289"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1290" name="__codelineno-0-1290" href="#__codelineno-0-1290"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1291" name="__codelineno-0-1291" href="#__codelineno-0-1291"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Non-Boolean input for treatment&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292" href="#__codelineno-0-1292"></a>
<a id="__codelineno-0-1293" name="__codelineno-0-1293" href="#__codelineno-0-1293"></a>    <span class="k">if</span> <span class="n">stats_mode</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-0-1294" name="__codelineno-0-1294" href="#__codelineno-0-1294"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295" href="#__codelineno-0-1295"></a>            <span class="n">transpose_dataframe</span><span class="p">(</span><span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">),</span> <span class="s2">&quot;summary&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296" href="#__codelineno-0-1296"></a>            <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1297" name="__codelineno-0-1297" href="#__codelineno-0-1297"></a>            <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mode_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">),</span> <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;full_outer&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1298" name="__codelineno-0-1298" href="#__codelineno-0-1298"></a>            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-1299" name="__codelineno-0-1299" href="#__codelineno-0-1299"></a>                <span class="s2">&quot;mode_pct&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1300" name="__codelineno-0-1300" href="#__codelineno-0-1300"></a>                <span class="n">F</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;mode_rows&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">DoubleType</span><span class="p">()),</span> <span class="mi">4</span><span class="p">),</span>
<a id="__codelineno-0-1301" name="__codelineno-0-1301" href="#__codelineno-0-1301"></a>            <span class="p">)</span>
<a id="__codelineno-0-1302" name="__codelineno-0-1302" href="#__codelineno-0-1302"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="s2">&quot;mode_rows&quot;</span><span class="p">,</span> <span class="s2">&quot;mode_pct&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1303" name="__codelineno-0-1303" href="#__codelineno-0-1303"></a>        <span class="p">)</span>
<a id="__codelineno-0-1304" name="__codelineno-0-1304" href="#__codelineno-0-1304"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1305" name="__codelineno-0-1305" href="#__codelineno-0-1305"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1306" name="__codelineno-0-1306" href="#__codelineno-0-1306"></a>            <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_mode</span><span class="p">)</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307" href="#__codelineno-0-1307"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="s2">&quot;mode_rows&quot;</span><span class="p">,</span> <span class="s2">&quot;mode_pct&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1308" name="__codelineno-0-1308" href="#__codelineno-0-1308"></a>            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-0-1309" name="__codelineno-0-1309" href="#__codelineno-0-1309"></a>        <span class="p">)</span>
<a id="__codelineno-0-1310" name="__codelineno-0-1310" href="#__codelineno-0-1310"></a>
<a id="__codelineno-0-1311" name="__codelineno-0-1311" href="#__codelineno-0-1311"></a>    <span class="n">odf_print</span> <span class="o">=</span> <span class="n">odf_print</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-1312" name="__codelineno-0-1312" href="#__codelineno-0-1312"></a>        <span class="s2">&quot;flagged&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1313" name="__codelineno-0-1313" href="#__codelineno-0-1313"></a>        <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
<a id="__codelineno-0-1314" name="__codelineno-0-1314" href="#__codelineno-0-1314"></a>            <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;mode_pct&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">treatment_threshold</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;mode_pct&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">()),</span> <span class="mi">1</span>
<a id="__codelineno-0-1315" name="__codelineno-0-1315" href="#__codelineno-0-1315"></a>        <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-1316" name="__codelineno-0-1316" href="#__codelineno-0-1316"></a>    <span class="p">)</span>
<a id="__codelineno-0-1317" name="__codelineno-0-1317" href="#__codelineno-0-1317"></a>
<a id="__codelineno-0-1318" name="__codelineno-0-1318" href="#__codelineno-0-1318"></a>    <span class="k">if</span> <span class="n">treatment</span><span class="p">:</span>
<a id="__codelineno-0-1319" name="__codelineno-0-1319" href="#__codelineno-0-1319"></a>        <span class="n">remove_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1320" name="__codelineno-0-1320" href="#__codelineno-0-1320"></a>            <span class="n">odf_print</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-0-1321" name="__codelineno-0-1321" href="#__codelineno-0-1321"></a>                <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;mode_pct&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">treatment_threshold</span><span class="p">)</span>
<a id="__codelineno-0-1322" name="__codelineno-0-1322" href="#__codelineno-0-1322"></a>                <span class="o">|</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;mode_pct&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">())</span>
<a id="__codelineno-0-1323" name="__codelineno-0-1323" href="#__codelineno-0-1323"></a>            <span class="p">)</span>
<a id="__codelineno-0-1324" name="__codelineno-0-1324" href="#__codelineno-0-1324"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1325" name="__codelineno-0-1325" href="#__codelineno-0-1325"></a>            <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-1326" name="__codelineno-0-1326" href="#__codelineno-0-1326"></a>            <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-1327" name="__codelineno-0-1327" href="#__codelineno-0-1327"></a>        <span class="p">)</span>
<a id="__codelineno-0-1328" name="__codelineno-0-1328" href="#__codelineno-0-1328"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="n">remove_cols</span><span class="p">)</span>
<a id="__codelineno-0-1329" name="__codelineno-0-1329" href="#__codelineno-0-1329"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">odf_print</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;flagged&quot;</span><span class="p">,</span> <span class="s2">&quot;treated&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330" href="#__codelineno-0-1330"></a>
<a id="__codelineno-0-1331" name="__codelineno-0-1331" href="#__codelineno-0-1331"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1332" name="__codelineno-0-1332" href="#__codelineno-0-1332"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-1333" name="__codelineno-0-1333" href="#__codelineno-0-1333"></a>
<a id="__codelineno-0-1334" name="__codelineno-0-1334" href="#__codelineno-0-1334"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-1335" name="__codelineno-0-1335" href="#__codelineno-0-1335"></a>        <span class="n">odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-0-1336" name="__codelineno-0-1336" href="#__codelineno-0-1336"></a>        <span class="k">if</span> <span class="n">treatment</span><span class="p">:</span>
<a id="__codelineno-0-1337" name="__codelineno-0-1337" href="#__codelineno-0-1337"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Removed Columns: &quot;</span><span class="p">,</span> <span class="n">remove_cols</span><span class="p">)</span>
<a id="__codelineno-0-1338" name="__codelineno-0-1338" href="#__codelineno-0-1338"></a>
<a id="__codelineno-0-1339" name="__codelineno-0-1339" href="#__codelineno-0-1339"></a>    <span class="k">return</span> <span class="n">odf</span><span class="p">,</span> <span class="n">odf_print</span>
<a id="__codelineno-0-1340" name="__codelineno-0-1340" href="#__codelineno-0-1340"></a>
<a id="__codelineno-0-1341" name="__codelineno-0-1341" href="#__codelineno-0-1341"></a>
<a id="__codelineno-0-1342" name="__codelineno-0-1342" href="#__codelineno-0-1342"></a><span class="k">def</span> <span class="nf">invalidEntries_detection</span><span class="p">(</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343" href="#__codelineno-0-1343"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344" href="#__codelineno-0-1344"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-1345" name="__codelineno-0-1345" href="#__codelineno-0-1345"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346" href="#__codelineno-0-1346"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-1347" name="__codelineno-0-1347" href="#__codelineno-0-1347"></a>    <span class="n">detection_type</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348" href="#__codelineno-0-1348"></a>    <span class="n">invalid_entries</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-1349" name="__codelineno-0-1349" href="#__codelineno-0-1349"></a>    <span class="n">valid_entries</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-1350" name="__codelineno-0-1350" href="#__codelineno-0-1350"></a>    <span class="n">partial_match</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1351" name="__codelineno-0-1351" href="#__codelineno-0-1351"></a>    <span class="n">treatment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1352" name="__codelineno-0-1352" href="#__codelineno-0-1352"></a>    <span class="n">treatment_method</span><span class="o">=</span><span class="s2">&quot;null_replacement&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1353" name="__codelineno-0-1353" href="#__codelineno-0-1353"></a>    <span class="n">treatment_configs</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-0-1354" name="__codelineno-0-1354" href="#__codelineno-0-1354"></a>    <span class="n">stats_missing</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-0-1355" name="__codelineno-0-1355" href="#__codelineno-0-1355"></a>    <span class="n">stats_unique</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-0-1356" name="__codelineno-0-1356" href="#__codelineno-0-1356"></a>    <span class="n">stats_mode</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-0-1357" name="__codelineno-0-1357" href="#__codelineno-0-1357"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1358" name="__codelineno-0-1358" href="#__codelineno-0-1358"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1359" name="__codelineno-0-1359" href="#__codelineno-0-1359"></a><span class="p">):</span>
<a id="__codelineno-0-1360" name="__codelineno-0-1360" href="#__codelineno-0-1360"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1361" name="__codelineno-0-1361" href="#__codelineno-0-1361"></a><span class="sd">    This function checks for certain suspicious patterns in attributes’ values. Patterns that are considered for this quality check:</span>
<a id="__codelineno-0-1362" name="__codelineno-0-1362" href="#__codelineno-0-1362"></a>
<a id="__codelineno-0-1363" name="__codelineno-0-1363" href="#__codelineno-0-1363"></a><span class="sd">    - Missing Values: The function checks for all column values which directly or indirectly indicate the missing</span>
<a id="__codelineno-0-1364" name="__codelineno-0-1364" href="#__codelineno-0-1364"></a><span class="sd">    value in an attribute such as &#39;nan&#39;, &#39;null&#39;, &#39;na&#39;, &#39;inf&#39;, &#39;n/a&#39;, &#39;not defined&#39; etc. The function also check for special characters.</span>
<a id="__codelineno-0-1365" name="__codelineno-0-1365" href="#__codelineno-0-1365"></a>
<a id="__codelineno-0-1366" name="__codelineno-0-1366" href="#__codelineno-0-1366"></a><span class="sd">    - Repetitive Characters: Certain attributes’ values with repetitive characters may be default value or system</span>
<a id="__codelineno-0-1367" name="__codelineno-0-1367" href="#__codelineno-0-1367"></a><span class="sd">    error, rather than being a legit value etc xx, zzzzz, 99999 etc. Such values are flagged for the user to take an</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368" href="#__codelineno-0-1368"></a><span class="sd">    appropriate action. There may be certain false positive which are legit values.</span>
<a id="__codelineno-0-1369" name="__codelineno-0-1369" href="#__codelineno-0-1369"></a>
<a id="__codelineno-0-1370" name="__codelineno-0-1370" href="#__codelineno-0-1370"></a><span class="sd">    - Consecutive Characters: Similar to repetitive characters, consecutive characters (at least 3 characters long) such as abc, 1234 etc</span>
<a id="__codelineno-0-1371" name="__codelineno-0-1371" href="#__codelineno-0-1371"></a><span class="sd">      may not be legit values, and hence flagged. There may be certain false positive which are legit values.</span>
<a id="__codelineno-0-1372" name="__codelineno-0-1372" href="#__codelineno-0-1372"></a>
<a id="__codelineno-0-1373" name="__codelineno-0-1373" href="#__codelineno-0-1373"></a><span class="sd">    This function returns two dataframes in tuple format – 1st dataframe is input dataset after treating the invalid values</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374" href="#__codelineno-0-1374"></a><span class="sd">    (or the original dataset if no treatment) and  2nd dataframe is of schema – attribute,</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375" href="#__codelineno-0-1375"></a><span class="sd">    invalid_entries, invalid_count, invalid_pct. All potential invalid values (separated by delimiter pipe “|”) are</span>
<a id="__codelineno-0-1376" name="__codelineno-0-1376" href="#__codelineno-0-1376"></a><span class="sd">    shown under invalid_entries column. Total number of rows impacted by these entries for each attribute is shown</span>
<a id="__codelineno-0-1377" name="__codelineno-0-1377" href="#__codelineno-0-1377"></a><span class="sd">    under invalid_count. invalid_pct is invalid_count divided by number of rows.</span>
<a id="__codelineno-0-1378" name="__codelineno-0-1378" href="#__codelineno-0-1378"></a>
<a id="__codelineno-0-1379" name="__codelineno-0-1379" href="#__codelineno-0-1379"></a>
<a id="__codelineno-0-1380" name="__codelineno-0-1380" href="#__codelineno-0-1380"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381" href="#__codelineno-0-1381"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1382" name="__codelineno-0-1382" href="#__codelineno-0-1382"></a><span class="sd">    spark</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383" href="#__codelineno-0-1383"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-0-1384" name="__codelineno-0-1384" href="#__codelineno-0-1384"></a><span class="sd">    idf</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385" href="#__codelineno-0-1385"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386" href="#__codelineno-0-1386"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387" href="#__codelineno-0-1387"></a><span class="sd">        List of Discrete (Categorical + Integer) columns to analyse e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-1388" name="__codelineno-0-1388" href="#__codelineno-0-1388"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-1389" name="__codelineno-0-1389" href="#__codelineno-0-1389"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-1390" name="__codelineno-0-1390" href="#__codelineno-0-1390"></a><span class="sd">        &quot;all&quot; can be passed to include all discrete columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-0-1391" name="__codelineno-0-1391" href="#__codelineno-0-1391"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in drop_cols argument</span>
<a id="__codelineno-0-1392" name="__codelineno-0-1392" href="#__codelineno-0-1392"></a><span class="sd">        is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393" href="#__codelineno-0-1393"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-0-1394" name="__codelineno-0-1394" href="#__codelineno-0-1394"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395" href="#__codelineno-0-1395"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396" href="#__codelineno-0-1396"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-1397" name="__codelineno-0-1397" href="#__codelineno-0-1397"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-0-1398" name="__codelineno-0-1398" href="#__codelineno-0-1398"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-0-1399" name="__codelineno-0-1399" href="#__codelineno-0-1399"></a><span class="sd">    detection_type</span>
<a id="__codelineno-0-1400" name="__codelineno-0-1400" href="#__codelineno-0-1400"></a><span class="sd">        &quot;auto&quot;,&quot;manual&quot;,&quot;both&quot; (Default value = &quot;auto&quot;)</span>
<a id="__codelineno-0-1401" name="__codelineno-0-1401" href="#__codelineno-0-1401"></a><span class="sd">    invalid_entries</span>
<a id="__codelineno-0-1402" name="__codelineno-0-1402" href="#__codelineno-0-1402"></a><span class="sd">        List of values or regex patterns to be classified as invalid.</span>
<a id="__codelineno-0-1403" name="__codelineno-0-1403" href="#__codelineno-0-1403"></a><span class="sd">        Valid only for &quot;auto&quot; or &quot;both&quot; detection type. (Default value = [])</span>
<a id="__codelineno-0-1404" name="__codelineno-0-1404" href="#__codelineno-0-1404"></a><span class="sd">    valid_entries</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405" href="#__codelineno-0-1405"></a><span class="sd">        List of values or regex patterns such that a value will be classified as invalid if it</span>
<a id="__codelineno-0-1406" name="__codelineno-0-1406" href="#__codelineno-0-1406"></a><span class="sd">        does not match any value or regex pattern in it. Valid only for &quot;auto&quot; or &quot;both&quot; detection type. (Default value = [])</span>
<a id="__codelineno-0-1407" name="__codelineno-0-1407" href="#__codelineno-0-1407"></a><span class="sd">    partial_match</span>
<a id="__codelineno-0-1408" name="__codelineno-0-1408" href="#__codelineno-0-1408"></a><span class="sd">        Boolean argument – True or False. If True, values with substring same as invalid_entries is declared invalid. (Default value = False)</span>
<a id="__codelineno-0-1409" name="__codelineno-0-1409" href="#__codelineno-0-1409"></a><span class="sd">    treatment</span>
<a id="__codelineno-0-1410" name="__codelineno-0-1410" href="#__codelineno-0-1410"></a><span class="sd">        Boolean argument – True or False. If True, outliers are treated as per treatment_method argument. (Default value = False)</span>
<a id="__codelineno-0-1411" name="__codelineno-0-1411" href="#__codelineno-0-1411"></a><span class="sd">    treatment_method</span>
<a id="__codelineno-0-1412" name="__codelineno-0-1412" href="#__codelineno-0-1412"></a><span class="sd">        &quot;MMM&quot;, &quot;null_replacement&quot;, &quot;column_removal&quot; (more methods to be added soon).</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413" href="#__codelineno-0-1413"></a><span class="sd">        MMM (Mean Median Mode) replaces invalid value by the measure of central tendency (mode for</span>
<a id="__codelineno-0-1414" name="__codelineno-0-1414" href="#__codelineno-0-1414"></a><span class="sd">        categorical features and mean or median for numerical features).</span>
<a id="__codelineno-0-1415" name="__codelineno-0-1415" href="#__codelineno-0-1415"></a><span class="sd">        null_replacement removes all values with any invalid values as null.</span>
<a id="__codelineno-0-1416" name="__codelineno-0-1416" href="#__codelineno-0-1416"></a><span class="sd">        column_removal remove a column if % of rows with invalid value is above a threshold (defined</span>
<a id="__codelineno-0-1417" name="__codelineno-0-1417" href="#__codelineno-0-1417"></a><span class="sd">        by key &quot;treatment_threshold&quot; under treatment_configs argument). (Default value = &quot;null_replacement&quot;)</span>
<a id="__codelineno-0-1418" name="__codelineno-0-1418" href="#__codelineno-0-1418"></a><span class="sd">    treatment_configs</span>
<a id="__codelineno-0-1419" name="__codelineno-0-1419" href="#__codelineno-0-1419"></a><span class="sd">        Takes input in dictionary format.</span>
<a id="__codelineno-0-1420" name="__codelineno-0-1420" href="#__codelineno-0-1420"></a><span class="sd">        For column_removal treatment, key ‘treatment_threshold’ is provided with a value between 0 to 1.</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421" href="#__codelineno-0-1421"></a><span class="sd">        For value replacement, by MMM, arguments corresponding to imputation_MMM function (transformer module) are provided,</span>
<a id="__codelineno-0-1422" name="__codelineno-0-1422" href="#__codelineno-0-1422"></a><span class="sd">        where each key is an argument from imputation_MMM function.</span>
<a id="__codelineno-0-1423" name="__codelineno-0-1423" href="#__codelineno-0-1423"></a><span class="sd">        For null_replacement, this argument can be skipped. (Default value = {})</span>
<a id="__codelineno-0-1424" name="__codelineno-0-1424" href="#__codelineno-0-1424"></a><span class="sd">    stats_missing</span>
<a id="__codelineno-0-1425" name="__codelineno-0-1425" href="#__codelineno-0-1425"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-0-1426" name="__codelineno-0-1426" href="#__codelineno-0-1426"></a><span class="sd">        to read pre-saved statistics on missing count/pct i.e. if measures_of_counts or</span>
<a id="__codelineno-0-1427" name="__codelineno-0-1427" href="#__codelineno-0-1427"></a><span class="sd">        missingCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-0-1428" name="__codelineno-0-1428" href="#__codelineno-0-1428"></a><span class="sd">    stats_unique</span>
<a id="__codelineno-0-1429" name="__codelineno-0-1429" href="#__codelineno-0-1429"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-0-1430" name="__codelineno-0-1430" href="#__codelineno-0-1430"></a><span class="sd">        to read pre-saved statistics on unique value count i.e. if measures_of_cardinality or</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431" href="#__codelineno-0-1431"></a><span class="sd">        uniqueCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-0-1432" name="__codelineno-0-1432" href="#__codelineno-0-1432"></a><span class="sd">    stats_mode</span>
<a id="__codelineno-0-1433" name="__codelineno-0-1433" href="#__codelineno-0-1433"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-0-1434" name="__codelineno-0-1434" href="#__codelineno-0-1434"></a><span class="sd">        to read pre-saved statistics on most frequently seen values i.e. if measures_of_centralTendency or</span>
<a id="__codelineno-0-1435" name="__codelineno-0-1435" href="#__codelineno-0-1435"></a><span class="sd">        mode_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-0-1436" name="__codelineno-0-1436" href="#__codelineno-0-1436"></a><span class="sd">    output_mode</span>
<a id="__codelineno-0-1437" name="__codelineno-0-1437" href="#__codelineno-0-1437"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438" href="#__codelineno-0-1438"></a><span class="sd">        “replace” option replaces original columns with treated column. “append” option append treated</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439" href="#__codelineno-0-1439"></a><span class="sd">        column to the input dataset with a postfix &quot;_invalid&quot; e.g. column X is appended as X_invalid. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-0-1440" name="__codelineno-0-1440" href="#__codelineno-0-1440"></a><span class="sd">    print_impact</span>
<a id="__codelineno-0-1441" name="__codelineno-0-1441" href="#__codelineno-0-1441"></a><span class="sd">        True, False</span>
<a id="__codelineno-0-1442" name="__codelineno-0-1442" href="#__codelineno-0-1442"></a><span class="sd">        This argument is to print out the statistics.(Default value = False)</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443" href="#__codelineno-0-1443"></a>
<a id="__codelineno-0-1444" name="__codelineno-0-1444" href="#__codelineno-0-1444"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1445" name="__codelineno-0-1445" href="#__codelineno-0-1445"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1446" name="__codelineno-0-1446" href="#__codelineno-0-1446"></a><span class="sd">    odf : DataFrame</span>
<a id="__codelineno-0-1447" name="__codelineno-0-1447" href="#__codelineno-0-1447"></a><span class="sd">        Dataframe after treatment if applicable, else original input dataframe.</span>
<a id="__codelineno-0-1448" name="__codelineno-0-1448" href="#__codelineno-0-1448"></a><span class="sd">    odf_print : DataFrame</span>
<a id="__codelineno-0-1449" name="__codelineno-0-1449" href="#__codelineno-0-1449"></a><span class="sd">        schema [attribute, invalid_entries, invalid_count, invalid_pct].</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450" href="#__codelineno-0-1450"></a><span class="sd">        invalid_entries are all potential invalid values (separated by delimiter pipe “|”),</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451" href="#__codelineno-0-1451"></a><span class="sd">        invalid_count is no. of rows which are impacted by invalid entries, and</span>
<a id="__codelineno-0-1452" name="__codelineno-0-1452" href="#__codelineno-0-1452"></a><span class="sd">        invalid_pct is invalid_count divided by no of rows.</span>
<a id="__codelineno-0-1453" name="__codelineno-0-1453" href="#__codelineno-0-1453"></a>
<a id="__codelineno-0-1454" name="__codelineno-0-1454" href="#__codelineno-0-1454"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1455" name="__codelineno-0-1455" href="#__codelineno-0-1455"></a>
<a id="__codelineno-0-1456" name="__codelineno-0-1456" href="#__codelineno-0-1456"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1457" name="__codelineno-0-1457" href="#__codelineno-0-1457"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1458" name="__codelineno-0-1458" href="#__codelineno-0-1458"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459" href="#__codelineno-0-1459"></a>            <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="s2">&quot;bigint&quot;</span><span class="p">,</span> <span class="s2">&quot;long&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1460" name="__codelineno-0-1460" href="#__codelineno-0-1460"></a>                <span class="n">list_of_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-1461" name="__codelineno-0-1461" href="#__codelineno-0-1461"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-1462" name="__codelineno-0-1462" href="#__codelineno-0-1462"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-1463" name="__codelineno-0-1463" href="#__codelineno-0-1463"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464" href="#__codelineno-0-1464"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465" href="#__codelineno-0-1465"></a>
<a id="__codelineno-0-1466" name="__codelineno-0-1466" href="#__codelineno-0-1466"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-0-1467" name="__codelineno-0-1467" href="#__codelineno-0-1467"></a>
<a id="__codelineno-0-1468" name="__codelineno-0-1468" href="#__codelineno-0-1468"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-1469" name="__codelineno-0-1469" href="#__codelineno-0-1469"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1470" name="__codelineno-0-1470" href="#__codelineno-0-1470"></a>
<a id="__codelineno-0-1471" name="__codelineno-0-1471" href="#__codelineno-0-1471"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1472" name="__codelineno-0-1472" href="#__codelineno-0-1472"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No Invalid Entries Check - No discrete column(s) to analyze&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1473" name="__codelineno-0-1473" href="#__codelineno-0-1473"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-1474" name="__codelineno-0-1474" href="#__codelineno-0-1474"></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">StructType</span><span class="p">(</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475" href="#__codelineno-0-1475"></a>            <span class="p">[</span>
<a id="__codelineno-0-1476" name="__codelineno-0-1476" href="#__codelineno-0-1476"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-1477" name="__codelineno-0-1477" href="#__codelineno-0-1477"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;invalid_entries&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-1478" name="__codelineno-0-1478" href="#__codelineno-0-1478"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;invalid_count&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-1479" name="__codelineno-0-1479" href="#__codelineno-0-1479"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;invalid_pct&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-1480" name="__codelineno-0-1480" href="#__codelineno-0-1480"></a>            <span class="p">]</span>
<a id="__codelineno-0-1481" name="__codelineno-0-1481" href="#__codelineno-0-1481"></a>        <span class="p">)</span>
<a id="__codelineno-0-1482" name="__codelineno-0-1482" href="#__codelineno-0-1482"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">emptyRDD</span><span class="p">()</span><span class="o">.</span><span class="n">toDF</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
<a id="__codelineno-0-1483" name="__codelineno-0-1483" href="#__codelineno-0-1483"></a>        <span class="k">return</span> <span class="n">odf</span><span class="p">,</span> <span class="n">odf_print</span>
<a id="__codelineno-0-1484" name="__codelineno-0-1484" href="#__codelineno-0-1484"></a>
<a id="__codelineno-0-1485" name="__codelineno-0-1485" href="#__codelineno-0-1485"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1486" name="__codelineno-0-1486" href="#__codelineno-0-1486"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for output_mode&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1487" name="__codelineno-0-1487" href="#__codelineno-0-1487"></a>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1488" name="__codelineno-0-1488" href="#__codelineno-0-1488"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1489" name="__codelineno-0-1489" href="#__codelineno-0-1489"></a>    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1490" name="__codelineno-0-1490" href="#__codelineno-0-1490"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1491" name="__codelineno-0-1491" href="#__codelineno-0-1491"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1492" name="__codelineno-0-1492" href="#__codelineno-0-1492"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Non-Boolean input for treatment&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1493" name="__codelineno-0-1493" href="#__codelineno-0-1493"></a>
<a id="__codelineno-0-1494" name="__codelineno-0-1494" href="#__codelineno-0-1494"></a>    <span class="k">if</span> <span class="n">treatment_method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;MMM&quot;</span><span class="p">,</span> <span class="s2">&quot;null_replacement&quot;</span><span class="p">,</span> <span class="s2">&quot;column_removal&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1495" name="__codelineno-0-1495" href="#__codelineno-0-1495"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for method_type&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1496" name="__codelineno-0-1496" href="#__codelineno-0-1496"></a>
<a id="__codelineno-0-1497" name="__codelineno-0-1497" href="#__codelineno-0-1497"></a>    <span class="n">treatment_threshold</span> <span class="o">=</span> <span class="n">treatment_configs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;treatment_threshold&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-1498" name="__codelineno-0-1498" href="#__codelineno-0-1498"></a>    <span class="k">if</span> <span class="n">treatment_threshold</span><span class="p">:</span>
<a id="__codelineno-0-1499" name="__codelineno-0-1499" href="#__codelineno-0-1499"></a>        <span class="n">treatment_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">treatment_threshold</span><span class="p">)</span>
<a id="__codelineno-0-1500" name="__codelineno-0-1500" href="#__codelineno-0-1500"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1501" name="__codelineno-0-1501" href="#__codelineno-0-1501"></a>        <span class="k">if</span> <span class="n">treatment_method</span> <span class="o">==</span> <span class="s2">&quot;column_removal&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1502" name="__codelineno-0-1502" href="#__codelineno-0-1502"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for column removal threshold&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1503" name="__codelineno-0-1503" href="#__codelineno-0-1503"></a>
<a id="__codelineno-0-1504" name="__codelineno-0-1504" href="#__codelineno-0-1504"></a>    <span class="n">null_vocab</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1505" name="__codelineno-0-1505" href="#__codelineno-0-1505"></a>        <span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1506" name="__codelineno-0-1506" href="#__codelineno-0-1506"></a>        <span class="s2">&quot; &quot;</span><span class="p">,</span>
<a id="__codelineno-0-1507" name="__codelineno-0-1507" href="#__codelineno-0-1507"></a>        <span class="s2">&quot;nan&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1508" name="__codelineno-0-1508" href="#__codelineno-0-1508"></a>        <span class="s2">&quot;null&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1509" name="__codelineno-0-1509" href="#__codelineno-0-1509"></a>        <span class="s2">&quot;na&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1510" name="__codelineno-0-1510" href="#__codelineno-0-1510"></a>        <span class="s2">&quot;inf&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1511" name="__codelineno-0-1511" href="#__codelineno-0-1511"></a>        <span class="s2">&quot;n/a&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1512" name="__codelineno-0-1512" href="#__codelineno-0-1512"></a>        <span class="s2">&quot;not defined&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1513" name="__codelineno-0-1513" href="#__codelineno-0-1513"></a>        <span class="s2">&quot;none&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1514" name="__codelineno-0-1514" href="#__codelineno-0-1514"></a>        <span class="s2">&quot;undefined&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1515" name="__codelineno-0-1515" href="#__codelineno-0-1515"></a>        <span class="s2">&quot;blank&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1516" name="__codelineno-0-1516" href="#__codelineno-0-1516"></a>        <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1517" name="__codelineno-0-1517" href="#__codelineno-0-1517"></a>    <span class="p">]</span>
<a id="__codelineno-0-1518" name="__codelineno-0-1518" href="#__codelineno-0-1518"></a>    <span class="n">special_chars_vocab</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1519" name="__codelineno-0-1519" href="#__codelineno-0-1519"></a>        <span class="s2">&quot;&amp;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1520" name="__codelineno-0-1520" href="#__codelineno-0-1520"></a>        <span class="s2">&quot;$&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1521" name="__codelineno-0-1521" href="#__codelineno-0-1521"></a>        <span class="s2">&quot;;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522" href="#__codelineno-0-1522"></a>        <span class="s2">&quot;:&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523" href="#__codelineno-0-1523"></a>        <span class="s2">&quot;.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1524" name="__codelineno-0-1524" href="#__codelineno-0-1524"></a>        <span class="s2">&quot;,&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1525" name="__codelineno-0-1525" href="#__codelineno-0-1525"></a>        <span class="s2">&quot;*&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1526" name="__codelineno-0-1526" href="#__codelineno-0-1526"></a>        <span class="s2">&quot;#&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1527" name="__codelineno-0-1527" href="#__codelineno-0-1527"></a>        <span class="s2">&quot;@&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1528" name="__codelineno-0-1528" href="#__codelineno-0-1528"></a>        <span class="s2">&quot;_&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1529" name="__codelineno-0-1529" href="#__codelineno-0-1529"></a>        <span class="s2">&quot;?&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1530" name="__codelineno-0-1530" href="#__codelineno-0-1530"></a>        <span class="s2">&quot;%&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1531" name="__codelineno-0-1531" href="#__codelineno-0-1531"></a>        <span class="s2">&quot;!&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532" href="#__codelineno-0-1532"></a>        <span class="s2">&quot;^&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1533" name="__codelineno-0-1533" href="#__codelineno-0-1533"></a>        <span class="s2">&quot;(&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1534" name="__codelineno-0-1534" href="#__codelineno-0-1534"></a>        <span class="s2">&quot;)&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535" href="#__codelineno-0-1535"></a>        <span class="s2">&quot;-&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1536" name="__codelineno-0-1536" href="#__codelineno-0-1536"></a>        <span class="s2">&quot;/&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1537" name="__codelineno-0-1537" href="#__codelineno-0-1537"></a>        <span class="s2">&quot;&#39;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538" href="#__codelineno-0-1538"></a>    <span class="p">]</span>
<a id="__codelineno-0-1539" name="__codelineno-0-1539" href="#__codelineno-0-1539"></a>
<a id="__codelineno-0-1540" name="__codelineno-0-1540" href="#__codelineno-0-1540"></a>    <span class="k">def</span> <span class="nf">detect</span><span class="p">(</span><span class="o">*</span><span class="n">v</span><span class="p">):</span>
<a id="__codelineno-0-1541" name="__codelineno-0-1541" href="#__codelineno-0-1541"></a>        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1542" name="__codelineno-0-1542" href="#__codelineno-0-1542"></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543" href="#__codelineno-0-1543"></a>            <span class="k">if</span> <span class="n">e</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1544" name="__codelineno-0-1544" href="#__codelineno-0-1544"></a>                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545" href="#__codelineno-0-1545"></a>                <span class="k">continue</span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546" href="#__codelineno-0-1546"></a>            <span class="k">if</span> <span class="n">detection_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;both&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547" href="#__codelineno-0-1547"></a>                <span class="n">e</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-0-1548" name="__codelineno-0-1548" href="#__codelineno-0-1548"></a>                <span class="c1"># Null &amp; Special Chars Search</span>
<a id="__codelineno-0-1549" name="__codelineno-0-1549" href="#__codelineno-0-1549"></a>                <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="p">(</span><span class="n">null_vocab</span> <span class="o">+</span> <span class="n">special_chars_vocab</span><span class="p">):</span>
<a id="__codelineno-0-1550" name="__codelineno-0-1550" href="#__codelineno-0-1550"></a>                    <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1551" name="__codelineno-0-1551" href="#__codelineno-0-1551"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-1552" name="__codelineno-0-1552" href="#__codelineno-0-1552"></a>                <span class="c1"># Consecutive Identical Chars Search</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553" href="#__codelineno-0-1553"></a>                <span class="n">regex</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">b([a-zA-Z0-9])</span><span class="se">\\</span><span class="s2">1</span><span class="se">\\</span><span class="s2">1+</span><span class="se">\\</span><span class="s2">b&quot;</span>
<a id="__codelineno-0-1554" name="__codelineno-0-1554" href="#__codelineno-0-1554"></a>                <span class="n">p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
<a id="__codelineno-0-1555" name="__codelineno-0-1555" href="#__codelineno-0-1555"></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<a id="__codelineno-0-1556" name="__codelineno-0-1556" href="#__codelineno-0-1556"></a>                    <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557" href="#__codelineno-0-1557"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558" href="#__codelineno-0-1558"></a>                <span class="c1"># Ordered Chars Search</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559" href="#__codelineno-0-1559"></a>                <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-1560" name="__codelineno-0-1560" href="#__codelineno-0-1560"></a>                <span class="n">check</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1561" name="__codelineno-0-1561" href="#__codelineno-0-1561"></a>                <span class="k">if</span> <span class="n">l</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-1562" name="__codelineno-0-1562" href="#__codelineno-0-1562"></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>
<a id="__codelineno-0-1563" name="__codelineno-0-1563" href="#__codelineno-0-1563"></a>                        <span class="k">if</span> <span class="nb">ord</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="nb">ord</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1564" name="__codelineno-0-1564" href="#__codelineno-0-1564"></a>                            <span class="n">check</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1565" name="__codelineno-0-1565" href="#__codelineno-0-1565"></a>                            <span class="k">break</span>
<a id="__codelineno-0-1566" name="__codelineno-0-1566" href="#__codelineno-0-1566"></a>                    <span class="k">if</span> <span class="n">check</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1567" name="__codelineno-0-1567" href="#__codelineno-0-1567"></a>                        <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1568" name="__codelineno-0-1568" href="#__codelineno-0-1568"></a>                        <span class="k">continue</span>
<a id="__codelineno-0-1569" name="__codelineno-0-1569" href="#__codelineno-0-1569"></a>
<a id="__codelineno-0-1570" name="__codelineno-0-1570" href="#__codelineno-0-1570"></a>            <span class="n">check</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1571" name="__codelineno-0-1571" href="#__codelineno-0-1571"></a>            <span class="k">if</span> <span class="n">detection_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;manual&quot;</span><span class="p">,</span> <span class="s2">&quot;both&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1572" name="__codelineno-0-1572" href="#__codelineno-0-1572"></a>                <span class="n">e</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-0-1573" name="__codelineno-0-1573" href="#__codelineno-0-1573"></a>                <span class="k">for</span> <span class="n">regex</span> <span class="ow">in</span> <span class="n">invalid_entries</span><span class="p">:</span>
<a id="__codelineno-0-1574" name="__codelineno-0-1574" href="#__codelineno-0-1574"></a>                    <span class="n">p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
<a id="__codelineno-0-1575" name="__codelineno-0-1575" href="#__codelineno-0-1575"></a>                    <span class="k">if</span> <span class="n">partial_match</span><span class="p">:</span>
<a id="__codelineno-0-1576" name="__codelineno-0-1576" href="#__codelineno-0-1576"></a>                        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<a id="__codelineno-0-1577" name="__codelineno-0-1577" href="#__codelineno-0-1577"></a>                            <span class="n">check</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1578" name="__codelineno-0-1578" href="#__codelineno-0-1578"></a>                            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1579" name="__codelineno-0-1579" href="#__codelineno-0-1579"></a>                            <span class="k">break</span>
<a id="__codelineno-0-1580" name="__codelineno-0-1580" href="#__codelineno-0-1580"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1581" name="__codelineno-0-1581" href="#__codelineno-0-1581"></a>                        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
<a id="__codelineno-0-1582" name="__codelineno-0-1582" href="#__codelineno-0-1582"></a>                            <span class="n">check</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1583" name="__codelineno-0-1583" href="#__codelineno-0-1583"></a>                            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1584" name="__codelineno-0-1584" href="#__codelineno-0-1584"></a>                            <span class="k">break</span>
<a id="__codelineno-0-1585" name="__codelineno-0-1585" href="#__codelineno-0-1585"></a>
<a id="__codelineno-0-1586" name="__codelineno-0-1586" href="#__codelineno-0-1586"></a>                <span class="n">match_valid_entries</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1587" name="__codelineno-0-1587" href="#__codelineno-0-1587"></a>                <span class="k">for</span> <span class="n">regex</span> <span class="ow">in</span> <span class="n">valid_entries</span><span class="p">:</span>
<a id="__codelineno-0-1588" name="__codelineno-0-1588" href="#__codelineno-0-1588"></a>                    <span class="n">p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
<a id="__codelineno-0-1589" name="__codelineno-0-1589" href="#__codelineno-0-1589"></a>                    <span class="k">if</span> <span class="n">partial_match</span><span class="p">:</span>
<a id="__codelineno-0-1590" name="__codelineno-0-1590" href="#__codelineno-0-1590"></a>                        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<a id="__codelineno-0-1591" name="__codelineno-0-1591" href="#__codelineno-0-1591"></a>                            <span class="n">match_valid_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1592" name="__codelineno-0-1592" href="#__codelineno-0-1592"></a>                        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1593" name="__codelineno-0-1593" href="#__codelineno-0-1593"></a>                            <span class="n">match_valid_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1594" name="__codelineno-0-1594" href="#__codelineno-0-1594"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1595" name="__codelineno-0-1595" href="#__codelineno-0-1595"></a>                        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
<a id="__codelineno-0-1596" name="__codelineno-0-1596" href="#__codelineno-0-1596"></a>                            <span class="n">match_valid_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1597" name="__codelineno-0-1597" href="#__codelineno-0-1597"></a>                        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1598" name="__codelineno-0-1598" href="#__codelineno-0-1598"></a>                            <span class="n">match_valid_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1599" name="__codelineno-0-1599" href="#__codelineno-0-1599"></a>
<a id="__codelineno-0-1600" name="__codelineno-0-1600" href="#__codelineno-0-1600"></a>                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">match_valid_entries</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">match_valid_entries</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-1601" name="__codelineno-0-1601" href="#__codelineno-0-1601"></a>                    <span class="n">check</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-1602" name="__codelineno-0-1602" href="#__codelineno-0-1602"></a>                    <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1603" name="__codelineno-0-1603" href="#__codelineno-0-1603"></a>
<a id="__codelineno-0-1604" name="__codelineno-0-1604" href="#__codelineno-0-1604"></a>            <span class="k">if</span> <span class="n">check</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1605" name="__codelineno-0-1605" href="#__codelineno-0-1605"></a>                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1606" name="__codelineno-0-1606" href="#__codelineno-0-1606"></a>
<a id="__codelineno-0-1607" name="__codelineno-0-1607" href="#__codelineno-0-1607"></a>        <span class="k">return</span> <span class="n">output</span>
<a id="__codelineno-0-1608" name="__codelineno-0-1608" href="#__codelineno-0-1608"></a>
<a id="__codelineno-0-1609" name="__codelineno-0-1609" href="#__codelineno-0-1609"></a>    <span class="n">f_detect</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">udf</span><span class="p">(</span><span class="n">detect</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">ArrayType</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">LongType</span><span class="p">()))</span>
<a id="__codelineno-0-1610" name="__codelineno-0-1610" href="#__codelineno-0-1610"></a>
<a id="__codelineno-0-1611" name="__codelineno-0-1611" href="#__codelineno-0-1611"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;invalid&quot;</span><span class="p">,</span> <span class="n">f_detect</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-0-1612" name="__codelineno-0-1612" href="#__codelineno-0-1612"></a>
<a id="__codelineno-0-1613" name="__codelineno-0-1613" href="#__codelineno-0-1613"></a>    <span class="n">odf</span><span class="o">.</span><span class="n">persist</span><span class="p">()</span>
<a id="__codelineno-0-1614" name="__codelineno-0-1614" href="#__codelineno-0-1614"></a>    <span class="n">output_print</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1615" name="__codelineno-0-1615" href="#__codelineno-0-1615"></a>
<a id="__codelineno-0-1616" name="__codelineno-0-1616" href="#__codelineno-0-1616"></a>    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-1617" name="__codelineno-0-1617" href="#__codelineno-0-1617"></a>        <span class="n">tmp</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_invalid&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;invalid&quot;</span><span class="p">)[</span><span class="n">index</span><span class="p">])</span>
<a id="__codelineno-0-1618" name="__codelineno-0-1618" href="#__codelineno-0-1618"></a>        <span class="n">invalid</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1619" name="__codelineno-0-1619" href="#__codelineno-0-1619"></a>            <span class="n">tmp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_invalid&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1620" name="__codelineno-0-1620" href="#__codelineno-0-1620"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1621" name="__codelineno-0-1621" href="#__codelineno-0-1621"></a>            <span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
<a id="__codelineno-0-1622" name="__codelineno-0-1622" href="#__codelineno-0-1622"></a>            <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-1623" name="__codelineno-0-1623" href="#__codelineno-0-1623"></a>            <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-1624" name="__codelineno-0-1624" href="#__codelineno-0-1624"></a>        <span class="p">)</span>
<a id="__codelineno-0-1625" name="__codelineno-0-1625" href="#__codelineno-0-1625"></a>        <span class="n">invalid</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">invalid</span><span class="p">]</span>
<a id="__codelineno-0-1626" name="__codelineno-0-1626" href="#__codelineno-0-1626"></a>        <span class="n">invalid_count</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_invalid&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-0-1627" name="__codelineno-0-1627" href="#__codelineno-0-1627"></a>        <span class="n">output_print</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1628" name="__codelineno-0-1628" href="#__codelineno-0-1628"></a>            <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invalid</span><span class="p">),</span> <span class="n">invalid_count</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">invalid_count</span> <span class="o">/</span> <span class="n">idf</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">4</span><span class="p">)]</span>
<a id="__codelineno-0-1629" name="__codelineno-0-1629" href="#__codelineno-0-1629"></a>        <span class="p">)</span>
<a id="__codelineno-0-1630" name="__codelineno-0-1630" href="#__codelineno-0-1630"></a>
<a id="__codelineno-0-1631" name="__codelineno-0-1631" href="#__codelineno-0-1631"></a>    <span class="n">odf_print</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
<a id="__codelineno-0-1632" name="__codelineno-0-1632" href="#__codelineno-0-1632"></a>        <span class="n">output_print</span><span class="p">,</span>
<a id="__codelineno-0-1633" name="__codelineno-0-1633" href="#__codelineno-0-1633"></a>        <span class="n">schema</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;invalid_entries&quot;</span><span class="p">,</span> <span class="s2">&quot;invalid_count&quot;</span><span class="p">,</span> <span class="s2">&quot;invalid_pct&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1634" name="__codelineno-0-1634" href="#__codelineno-0-1634"></a>    <span class="p">)</span>
<a id="__codelineno-0-1635" name="__codelineno-0-1635" href="#__codelineno-0-1635"></a>
<a id="__codelineno-0-1636" name="__codelineno-0-1636" href="#__codelineno-0-1636"></a>    <span class="k">if</span> <span class="n">treatment</span><span class="p">:</span>
<a id="__codelineno-0-1637" name="__codelineno-0-1637" href="#__codelineno-0-1637"></a>        <span class="k">if</span> <span class="n">treatment_threshold</span><span class="p">:</span>
<a id="__codelineno-0-1638" name="__codelineno-0-1638" href="#__codelineno-0-1638"></a>            <span class="n">threshold_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1639" name="__codelineno-0-1639" href="#__codelineno-0-1639"></a>                <span class="n">odf_print</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-0-1640" name="__codelineno-0-1640" href="#__codelineno-0-1640"></a>                <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;invalid_pct&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">treatment_threshold</span><span class="p">)</span>
<a id="__codelineno-0-1641" name="__codelineno-0-1641" href="#__codelineno-0-1641"></a>                <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1642" name="__codelineno-0-1642" href="#__codelineno-0-1642"></a>                <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-1643" name="__codelineno-0-1643" href="#__codelineno-0-1643"></a>                <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-1644" name="__codelineno-0-1644" href="#__codelineno-0-1644"></a>            <span class="p">)</span>
<a id="__codelineno-0-1645" name="__codelineno-0-1645" href="#__codelineno-0-1645"></a>        <span class="k">if</span> <span class="n">treatment_method</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;null_replacement&quot;</span><span class="p">,</span> <span class="s2">&quot;MMM&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1646" name="__codelineno-0-1646" href="#__codelineno-0-1646"></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-1647" name="__codelineno-0-1647" href="#__codelineno-0-1647"></a>                <span class="k">if</span> <span class="n">treatment_threshold</span><span class="p">:</span>
<a id="__codelineno-0-1648" name="__codelineno-0-1648" href="#__codelineno-0-1648"></a>                    <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">threshold_cols</span><span class="p">:</span>
<a id="__codelineno-0-1649" name="__codelineno-0-1649" href="#__codelineno-0-1649"></a>                        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_invalid&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1650" name="__codelineno-0-1650" href="#__codelineno-0-1650"></a>                        <span class="k">continue</span>
<a id="__codelineno-0-1651" name="__codelineno-0-1651" href="#__codelineno-0-1651"></a>                <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-1652" name="__codelineno-0-1652" href="#__codelineno-0-1652"></a>                    <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_invalid&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1653" name="__codelineno-0-1653" href="#__codelineno-0-1653"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;invalid&quot;</span><span class="p">)[</span><span class="n">index</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span>
<a id="__codelineno-0-1654" name="__codelineno-0-1654" href="#__codelineno-0-1654"></a>                <span class="p">)</span>
<a id="__codelineno-0-1655" name="__codelineno-0-1655" href="#__codelineno-0-1655"></a>                <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1656" name="__codelineno-0-1656" href="#__codelineno-0-1656"></a>                    <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_invalid&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1657" name="__codelineno-0-1657" href="#__codelineno-0-1657"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1658" name="__codelineno-0-1658" href="#__codelineno-0-1658"></a>                    <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-1659" name="__codelineno-0-1659" href="#__codelineno-0-1659"></a>                        <span class="n">odf_print</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1660" name="__codelineno-0-1660" href="#__codelineno-0-1660"></a>                        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;invalid_pct&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1661" name="__codelineno-0-1661" href="#__codelineno-0-1661"></a>                        <span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1662" name="__codelineno-0-1662" href="#__codelineno-0-1662"></a>                        <span class="o">==</span> <span class="mf">0.0</span>
<a id="__codelineno-0-1663" name="__codelineno-0-1663" href="#__codelineno-0-1663"></a>                    <span class="p">):</span>
<a id="__codelineno-0-1664" name="__codelineno-0-1664" href="#__codelineno-0-1664"></a>                        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_invalid&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1665" name="__codelineno-0-1665" href="#__codelineno-0-1665"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;invalid&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1666" name="__codelineno-0-1666" href="#__codelineno-0-1666"></a>
<a id="__codelineno-0-1667" name="__codelineno-0-1667" href="#__codelineno-0-1667"></a>        <span class="k">if</span> <span class="n">treatment_method</span> <span class="o">==</span> <span class="s2">&quot;column_removal&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1668" name="__codelineno-0-1668" href="#__codelineno-0-1668"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="n">threshold_cols</span><span class="p">)</span>
<a id="__codelineno-0-1669" name="__codelineno-0-1669" href="#__codelineno-0-1669"></a>            <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-1670" name="__codelineno-0-1670" href="#__codelineno-0-1670"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Removed Columns: &quot;</span><span class="p">,</span> <span class="n">threshold_cols</span><span class="p">)</span>
<a id="__codelineno-0-1671" name="__codelineno-0-1671" href="#__codelineno-0-1671"></a>
<a id="__codelineno-0-1672" name="__codelineno-0-1672" href="#__codelineno-0-1672"></a>        <span class="k">if</span> <span class="n">treatment_method</span> <span class="o">==</span> <span class="s2">&quot;MMM&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1673" name="__codelineno-0-1673" href="#__codelineno-0-1673"></a>            <span class="k">if</span> <span class="n">stats_unique</span> <span class="o">==</span> <span class="p">{}</span> <span class="ow">or</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;append&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1674" name="__codelineno-0-1674" href="#__codelineno-0-1674"></a>                <span class="n">remove_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1675" name="__codelineno-0-1675" href="#__codelineno-0-1675"></a>                    <span class="n">uniqueCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">odf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-0-1676" name="__codelineno-0-1676" href="#__codelineno-0-1676"></a>                    <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;unique_values&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1677" name="__codelineno-0-1677" href="#__codelineno-0-1677"></a>                    <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1678" name="__codelineno-0-1678" href="#__codelineno-0-1678"></a>                    <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-1679" name="__codelineno-0-1679" href="#__codelineno-0-1679"></a>                    <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-1680" name="__codelineno-0-1680" href="#__codelineno-0-1680"></a>                <span class="p">)</span>
<a id="__codelineno-0-1681" name="__codelineno-0-1681" href="#__codelineno-0-1681"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1682" name="__codelineno-0-1682" href="#__codelineno-0-1682"></a>                <span class="n">remove_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1683" name="__codelineno-0-1683" href="#__codelineno-0-1683"></a>                    <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_unique</span><span class="p">)</span>
<a id="__codelineno-0-1684" name="__codelineno-0-1684" href="#__codelineno-0-1684"></a>                    <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;unique_values&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1685" name="__codelineno-0-1685" href="#__codelineno-0-1685"></a>                    <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1686" name="__codelineno-0-1686" href="#__codelineno-0-1686"></a>                    <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-1687" name="__codelineno-0-1687" href="#__codelineno-0-1687"></a>                    <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-1688" name="__codelineno-0-1688" href="#__codelineno-0-1688"></a>                <span class="p">)</span>
<a id="__codelineno-0-1689" name="__codelineno-0-1689" href="#__codelineno-0-1689"></a>
<a id="__codelineno-0-1690" name="__codelineno-0-1690" href="#__codelineno-0-1690"></a>            <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">remove_cols</span><span class="p">]</span>
<a id="__codelineno-0-1691" name="__codelineno-0-1691" href="#__codelineno-0-1691"></a>            <span class="k">if</span> <span class="n">treatment_threshold</span><span class="p">:</span>
<a id="__codelineno-0-1692" name="__codelineno-0-1692" href="#__codelineno-0-1692"></a>                <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">threshold_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">remove_cols</span><span class="p">]</span>
<a id="__codelineno-0-1693" name="__codelineno-0-1693" href="#__codelineno-0-1693"></a>            <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;append&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1694" name="__codelineno-0-1694" href="#__codelineno-0-1694"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1695" name="__codelineno-0-1695" href="#__codelineno-0-1695"></a>                    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="o">+</span> <span class="s2">&quot;_invalid&quot;</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">]</span>
<a id="__codelineno-0-1696" name="__codelineno-0-1696" href="#__codelineno-0-1696"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">imputation_MMM</span><span class="p">(</span>
<a id="__codelineno-0-1697" name="__codelineno-0-1697" href="#__codelineno-0-1697"></a>                <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-1698" name="__codelineno-0-1698" href="#__codelineno-0-1698"></a>                <span class="n">odf</span><span class="p">,</span>
<a id="__codelineno-0-1699" name="__codelineno-0-1699" href="#__codelineno-0-1699"></a>                <span class="n">list_of_cols</span><span class="p">,</span>
<a id="__codelineno-0-1700" name="__codelineno-0-1700" href="#__codelineno-0-1700"></a>                <span class="o">**</span><span class="n">treatment_configs</span><span class="p">,</span>
<a id="__codelineno-0-1701" name="__codelineno-0-1701" href="#__codelineno-0-1701"></a>                <span class="n">stats_missing</span><span class="o">=</span><span class="n">stats_missing</span><span class="p">,</span>
<a id="__codelineno-0-1702" name="__codelineno-0-1702" href="#__codelineno-0-1702"></a>                <span class="n">stats_mode</span><span class="o">=</span><span class="n">stats_mode</span><span class="p">,</span>
<a id="__codelineno-0-1703" name="__codelineno-0-1703" href="#__codelineno-0-1703"></a>                <span class="n">print_impact</span><span class="o">=</span><span class="n">print_impact</span>
<a id="__codelineno-0-1704" name="__codelineno-0-1704" href="#__codelineno-0-1704"></a>            <span class="p">)</span>
<a id="__codelineno-0-1705" name="__codelineno-0-1705" href="#__codelineno-0-1705"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1706" name="__codelineno-0-1706" href="#__codelineno-0-1706"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-1707" name="__codelineno-0-1707" href="#__codelineno-0-1707"></a>
<a id="__codelineno-0-1708" name="__codelineno-0-1708" href="#__codelineno-0-1708"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-1709" name="__codelineno-0-1709" href="#__codelineno-0-1709"></a>        <span class="n">odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-0-1710" name="__codelineno-0-1710" href="#__codelineno-0-1710"></a>
<a id="__codelineno-0-1711" name="__codelineno-0-1711" href="#__codelineno-0-1711"></a>    <span class="k">return</span> <span class="n">odf</span><span class="p">,</span> <span class="n">odf_print</span>
</code></pre></div>
</pre>
</details>
<h2 id="functions">Functions</h2>
<dl>
<dt id="anovos.data_analyzer.quality_checker.IDness_detection"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">IDness_detection</span></span>(<span class="n">spark, idf, list_of_cols='all', drop_cols=[], treatment=False, treatment_threshold=0.8, stats_unique={}, print_impact=False)</span>
</code></dt>
<dd>
<div class="desc"><p>IDness of an attribute is defined as the ratio of number of unique values seen in an attribute by number of
non-null rows. It varies between 0 to 100% where IDness of 100% means there are as many unique values as number
of rows (primary key in the input dataset). IDness is computed only for discrete features. This function
leverages the statistics from Measures of Cardinality function and flag the columns if IDness is above a certain
threshold. Such columns can be deleted from the modelling analysis if directed for a treatment.</p>
<p>This function returns two dataframes in tuple format – 1st dataframe is input dataset after removing high IDness
columns (if treated else the original dataset) and
2nd dataframe is of schema – attribute, unique_values, IDness.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>spark</code></strong></dt>
<dd>Spark Session</dd>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe</dd>
<dt><strong><code>list_of_cols</code></strong></dt>
<dd>List of Discrete (Categorical + Integer) columns to analyse e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
"all" can be passed to include all discrete columns for analysis. This is super useful instead of specifying all column names manually.
Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in drop_cols argument
is not considered for analysis even if it is mentioned in list_of_cols. (Default value = "all")</dd>
<dt><strong><code>drop_cols</code></strong></dt>
<dd>List of columns to be dropped e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except
a few handful of them. (Default value = [])</dd>
<dt><strong><code>treatment</code></strong></dt>
<dd>Boolean argument – True or False. If True, columns with high IDness (defined by
treatment_threshold argument) are removed from the input dataframe. (Default value = False)</dd>
<dt><strong><code>treatment_threshold</code></strong></dt>
<dd>Defines acceptable level of IDness (calculated as no. of unique values divided by no. of
non-null values) for a column and takes value between 0 to 1. Default threshold
of 0.8 can be interpreted as remove column if its unique values count is more than
80% of total rows (after excluding null values).</dd>
<dt><strong><code>stats_unique</code></strong></dt>
<dd>Takes arguments for read_dataset (data_ingest module) function in a dictionary format
to read pre-saved statistics on unique value count i.e. if measures_of_cardinality or
uniqueCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</dd>
<dt><strong><code>print_impact</code></strong></dt>
<dd>True, False
This argument is to print out the statistics and the impact of treatment (if applicable).(Default value = False)</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>odf</code></strong> :&ensp;<code>DataFrame</code></dt>
<dd>Dataframe after column removal if treated, else original input dataframe.</dd>
<dt><strong><code>odf_print</code></strong> :&ensp;<code>DataFrame</code></dt>
<dd>schema [attribute, unique_values, IDness, flagged/treated].
unique_values is no. of distinct values in a column,
IDness is unique_values divided by no. of non-null values.
A column is flagged 1 if IDness is above the threshold, else 0.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">def</span> <span class="nf">IDness_detection</span><span class="p">(</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    <span class="n">treatment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    <span class="n">treatment_threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    <span class="n">stats_unique</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="p">):</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="sd">    IDness of an attribute is defined as the ratio of number of unique values seen in an attribute by number of</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="sd">    non-null rows. It varies between 0 to 100% where IDness of 100% means there are as many unique values as number</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="sd">    of rows (primary key in the input dataset). IDness is computed only for discrete features. This function</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="sd">    leverages the statistics from Measures of Cardinality function and flag the columns if IDness is above a certain</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="sd">    threshold. Such columns can be deleted from the modelling analysis if directed for a treatment.</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="sd">    This function returns two dataframes in tuple format – 1st dataframe is input dataset after removing high IDness</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="sd">    columns (if treated else the original dataset) and  2nd dataframe is of schema – attribute, unique_values, IDness.</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="sd">    Parameters</span>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="sd">    ----------</span>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="sd">    spark</span>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="sd">    idf</span>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="sd">        List of Discrete (Categorical + Integer) columns to analyse e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="sd">        &quot;all&quot; can be passed to include all discrete columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in drop_cols argument</span>
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a><span class="sd">        is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a><span class="sd">    treatment</span>
<a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a><span class="sd">        Boolean argument – True or False. If True, columns with high IDness (defined by</span>
<a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a><span class="sd">        treatment_threshold argument) are removed from the input dataframe. (Default value = False)</span>
<a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a><span class="sd">    treatment_threshold</span>
<a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a><span class="sd">        Defines acceptable level of IDness (calculated as no. of unique values divided by no. of</span>
<a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a><span class="sd">        non-null values) for a column and takes value between 0 to 1. Default threshold</span>
<a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a><span class="sd">        of 0.8 can be interpreted as remove column if its unique values count is more than</span>
<a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a><span class="sd">        80% of total rows (after excluding null values).</span>
<a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a><span class="sd">    stats_unique</span>
<a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a><span class="sd">        to read pre-saved statistics on unique value count i.e. if measures_of_cardinality or</span>
<a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a><span class="sd">        uniqueCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a><span class="sd">    print_impact</span>
<a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a><span class="sd">        True, False</span>
<a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a><span class="sd">        This argument is to print out the statistics and the impact of treatment (if applicable).(Default value = False)</span>
<a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a>
<a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a><span class="sd">    Returns</span>
<a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a><span class="sd">    -------</span>
<a id="__codelineno-1-58" name="__codelineno-1-58" href="#__codelineno-1-58"></a><span class="sd">    odf : DataFrame</span>
<a id="__codelineno-1-59" name="__codelineno-1-59" href="#__codelineno-1-59"></a><span class="sd">        Dataframe after column removal if treated, else original input dataframe.</span>
<a id="__codelineno-1-60" name="__codelineno-1-60" href="#__codelineno-1-60"></a><span class="sd">    odf_print : DataFrame</span>
<a id="__codelineno-1-61" name="__codelineno-1-61" href="#__codelineno-1-61"></a><span class="sd">        schema [attribute, unique_values, IDness, flagged/treated].</span>
<a id="__codelineno-1-62" name="__codelineno-1-62" href="#__codelineno-1-62"></a><span class="sd">        unique_values is no. of distinct values in a column,</span>
<a id="__codelineno-1-63" name="__codelineno-1-63" href="#__codelineno-1-63"></a><span class="sd">        IDness is unique_values divided by no. of non-null values.</span>
<a id="__codelineno-1-64" name="__codelineno-1-64" href="#__codelineno-1-64"></a><span class="sd">        A column is flagged 1 if IDness is above the threshold, else 0.</span>
<a id="__codelineno-1-65" name="__codelineno-1-65" href="#__codelineno-1-65"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-1-66" name="__codelineno-1-66" href="#__codelineno-1-66"></a>
<a id="__codelineno-1-67" name="__codelineno-1-67" href="#__codelineno-1-67"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-1-68" name="__codelineno-1-68" href="#__codelineno-1-68"></a>        <span class="n">num_cols</span><span class="p">,</span> <span class="n">cat_cols</span><span class="p">,</span> <span class="n">other_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)</span>
<a id="__codelineno-1-69" name="__codelineno-1-69" href="#__codelineno-1-69"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span> <span class="o">+</span> <span class="n">cat_cols</span>
<a id="__codelineno-1-70" name="__codelineno-1-70" href="#__codelineno-1-70"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-1-71" name="__codelineno-1-71" href="#__codelineno-1-71"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-1-72" name="__codelineno-1-72" href="#__codelineno-1-72"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-1-73" name="__codelineno-1-73" href="#__codelineno-1-73"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-1-74" name="__codelineno-1-74" href="#__codelineno-1-74"></a>
<a id="__codelineno-1-75" name="__codelineno-1-75" href="#__codelineno-1-75"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-1-76" name="__codelineno-1-76" href="#__codelineno-1-76"></a>
<a id="__codelineno-1-77" name="__codelineno-1-77" href="#__codelineno-1-77"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
<a id="__codelineno-1-78" name="__codelineno-1-78" href="#__codelineno-1-78"></a>        <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="s2">&quot;bigint&quot;</span><span class="p">,</span> <span class="s2">&quot;long&quot;</span><span class="p">):</span>
<a id="__codelineno-1-79" name="__codelineno-1-79" href="#__codelineno-1-79"></a>            <span class="n">list_of_cols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-1-80" name="__codelineno-1-80" href="#__codelineno-1-80"></a>
<a id="__codelineno-1-81" name="__codelineno-1-81" href="#__codelineno-1-81"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-1-82" name="__codelineno-1-82" href="#__codelineno-1-82"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-1-83" name="__codelineno-1-83" href="#__codelineno-1-83"></a>
<a id="__codelineno-1-84" name="__codelineno-1-84" href="#__codelineno-1-84"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-1-85" name="__codelineno-1-85" href="#__codelineno-1-85"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No IDness Check - No discrete column(s) to analyze&quot;</span><span class="p">)</span>
<a id="__codelineno-1-86" name="__codelineno-1-86" href="#__codelineno-1-86"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-1-87" name="__codelineno-1-87" href="#__codelineno-1-87"></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">StructType</span><span class="p">(</span>
<a id="__codelineno-1-88" name="__codelineno-1-88" href="#__codelineno-1-88"></a>            <span class="p">[</span>
<a id="__codelineno-1-89" name="__codelineno-1-89" href="#__codelineno-1-89"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-1-90" name="__codelineno-1-90" href="#__codelineno-1-90"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;unique_values&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-1-91" name="__codelineno-1-91" href="#__codelineno-1-91"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;IDness&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-1-92" name="__codelineno-1-92" href="#__codelineno-1-92"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;flagged&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-1-93" name="__codelineno-1-93" href="#__codelineno-1-93"></a>            <span class="p">]</span>
<a id="__codelineno-1-94" name="__codelineno-1-94" href="#__codelineno-1-94"></a>        <span class="p">)</span>
<a id="__codelineno-1-95" name="__codelineno-1-95" href="#__codelineno-1-95"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">emptyRDD</span><span class="p">()</span><span class="o">.</span><span class="n">toDF</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
<a id="__codelineno-1-96" name="__codelineno-1-96" href="#__codelineno-1-96"></a>        <span class="k">return</span> <span class="n">odf</span><span class="p">,</span> <span class="n">odf_print</span>
<a id="__codelineno-1-97" name="__codelineno-1-97" href="#__codelineno-1-97"></a>    <span class="n">treatment_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">treatment_threshold</span><span class="p">)</span>
<a id="__codelineno-1-98" name="__codelineno-1-98" href="#__codelineno-1-98"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">treatment_threshold</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">treatment_threshold</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-1-99" name="__codelineno-1-99" href="#__codelineno-1-99"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Treatment Threshold Value&quot;</span><span class="p">)</span>
<a id="__codelineno-1-100" name="__codelineno-1-100" href="#__codelineno-1-100"></a>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
<a id="__codelineno-1-101" name="__codelineno-1-101" href="#__codelineno-1-101"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-1-102" name="__codelineno-1-102" href="#__codelineno-1-102"></a>    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
<a id="__codelineno-1-103" name="__codelineno-1-103" href="#__codelineno-1-103"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-1-104" name="__codelineno-1-104" href="#__codelineno-1-104"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-1-105" name="__codelineno-1-105" href="#__codelineno-1-105"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Non-Boolean input for treatment&quot;</span><span class="p">)</span>
<a id="__codelineno-1-106" name="__codelineno-1-106" href="#__codelineno-1-106"></a>
<a id="__codelineno-1-107" name="__codelineno-1-107" href="#__codelineno-1-107"></a>    <span class="k">if</span> <span class="n">stats_unique</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-1-108" name="__codelineno-1-108" href="#__codelineno-1-108"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">measures_of_cardinality</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-1-109" name="__codelineno-1-109" href="#__codelineno-1-109"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-1-110" name="__codelineno-1-110" href="#__codelineno-1-110"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_unique</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-1-111" name="__codelineno-1-111" href="#__codelineno-1-111"></a>            <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-1-112" name="__codelineno-1-112" href="#__codelineno-1-112"></a>        <span class="p">)</span>
<a id="__codelineno-1-113" name="__codelineno-1-113" href="#__codelineno-1-113"></a>
<a id="__codelineno-1-114" name="__codelineno-1-114" href="#__codelineno-1-114"></a>    <span class="n">odf_print</span> <span class="o">=</span> <span class="n">odf_print</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-1-115" name="__codelineno-1-115" href="#__codelineno-1-115"></a>        <span class="s2">&quot;flagged&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;IDness&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">treatment_threshold</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-1-116" name="__codelineno-1-116" href="#__codelineno-1-116"></a>    <span class="p">)</span>
<a id="__codelineno-1-117" name="__codelineno-1-117" href="#__codelineno-1-117"></a>
<a id="__codelineno-1-118" name="__codelineno-1-118" href="#__codelineno-1-118"></a>    <span class="k">if</span> <span class="n">treatment</span><span class="p">:</span>
<a id="__codelineno-1-119" name="__codelineno-1-119" href="#__codelineno-1-119"></a>        <span class="n">remove_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-1-120" name="__codelineno-1-120" href="#__codelineno-1-120"></a>            <span class="n">odf_print</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;flagged&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-121" name="__codelineno-1-121" href="#__codelineno-1-121"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-1-122" name="__codelineno-1-122" href="#__codelineno-1-122"></a>            <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-1-123" name="__codelineno-1-123" href="#__codelineno-1-123"></a>            <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-1-124" name="__codelineno-1-124" href="#__codelineno-1-124"></a>        <span class="p">)</span>
<a id="__codelineno-1-125" name="__codelineno-1-125" href="#__codelineno-1-125"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="n">remove_cols</span><span class="p">)</span>
<a id="__codelineno-1-126" name="__codelineno-1-126" href="#__codelineno-1-126"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">odf_print</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;flagged&quot;</span><span class="p">,</span> <span class="s2">&quot;treated&quot;</span><span class="p">)</span>
<a id="__codelineno-1-127" name="__codelineno-1-127" href="#__codelineno-1-127"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-1-128" name="__codelineno-1-128" href="#__codelineno-1-128"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-1-129" name="__codelineno-1-129" href="#__codelineno-1-129"></a>
<a id="__codelineno-1-130" name="__codelineno-1-130" href="#__codelineno-1-130"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-1-131" name="__codelineno-1-131" href="#__codelineno-1-131"></a>        <span class="n">odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-1-132" name="__codelineno-1-132" href="#__codelineno-1-132"></a>        <span class="k">if</span> <span class="n">treatment</span><span class="p">:</span>
<a id="__codelineno-1-133" name="__codelineno-1-133" href="#__codelineno-1-133"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Removed Columns: &quot;</span><span class="p">,</span> <span class="n">remove_cols</span><span class="p">)</span>
<a id="__codelineno-1-134" name="__codelineno-1-134" href="#__codelineno-1-134"></a>
<a id="__codelineno-1-135" name="__codelineno-1-135" href="#__codelineno-1-135"></a>    <span class="k">return</span> <span class="n">odf</span><span class="p">,</span> <span class="n">odf_print</span>
</code></pre></div>
</pre>
</details>
</dd>
<dt id="anovos.data_analyzer.quality_checker.biasedness_detection"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">biasedness_detection</span></span>(<span class="n">spark, idf, list_of_cols='all', drop_cols=[], treatment=False, treatment_threshold=0.8, stats_mode={}, print_impact=False)</span>
</code></dt>
<dd>
<div class="desc"><p>This function flags column if they are biased or skewed towards one specific value and leverages
mode_pct computation from Measures of Central Tendency i.e. number of rows with mode value (most frequently seen
value) divided by number of non-null values. It varies between 0 to 100% where biasedness of 100% means there is
only a single value (other than null). The function flags a column if its biasedness is above a certain
threshold. Such columns can be deleted from the modelling analysis, if required.</p>
<p>This function returns two dataframes in tuple format – 1st dataframe is input dataset after removing high biased
columns (the original dataset if no treatment) and
2nd dataframe is of schema – attribute, mode, mode_pct.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>spark</code></strong></dt>
<dd>Spark Session</dd>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe</dd>
<dt><strong><code>list_of_cols</code></strong></dt>
<dd>List of Discrete (Categorical + Integer) columns to analyse e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
"all" can be passed to include all discrete columns for analysis. This is super useful instead of specifying all column names manually.
Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in drop_cols argument
is not considered for analysis even if it is mentioned in list_of_cols. (Default value = "all")</dd>
<dt><strong><code>drop_cols</code></strong></dt>
<dd>List of columns to be dropped e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except
a few handful of them. (Default value = [])</dd>
<dt><strong><code>treatment</code></strong></dt>
<dd>Boolean argument – True or False. If True, columns with high biasedness (defined by
treatment_threshold argument) are removed from the input dataframe. (Default value = False)</dd>
<dt><strong><code>treatment_threshold</code></strong></dt>
<dd>Defines acceptable level of biasedness (frequency of most-frequently seen value)for
a column and takes value between 0 to 1. Default threshold of 0.8 can be interpreted as
remove column if the number of rows with most-frequently seen value is more than 80%
of total rows (after excluding null values).</dd>
<dt><strong><code>stats_mode</code></strong></dt>
<dd>Takes arguments for read_dataset (data_ingest module) function in a dictionary format
to read pre-saved statistics on most frequently seen values i.e. if measures_of_centralTendency or
mode_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</dd>
<dt><strong><code>print_impact</code></strong></dt>
<dd>True, False
This argument is to print out the statistics and the impact of treatment (if applicable).(Default value = False)</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>odf</code></strong> :&ensp;<code>DataFrame</code></dt>
<dd>Dataframe after column removal if treated, else original input dataframe.</dd>
<dt><strong><code>odf_print</code></strong> :&ensp;<code>DataFrame</code></dt>
<dd>schema [attribute, mode, mode_rows, mode_pct, flagged/treated].
mode is the most frequently seen value,
mode_rows is number of rows with mode value, and
mode_pct is number of rows with mode value divided by non-null values.
A column is flagged 1 if mode_pct is above the threshold else 0.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">def</span> <span class="nf">biasedness_detection</span><span class="p">(</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="n">treatment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>    <span class="n">treatment_threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    <span class="n">stats_mode</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="p">):</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="sd">    This function flags column if they are biased or skewed towards one specific value and leverages</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="sd">    mode_pct computation from Measures of Central Tendency i.e. number of rows with mode value (most frequently seen</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="sd">    value) divided by number of non-null values. It varies between 0 to 100% where biasedness of 100% means there is</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="sd">    only a single value (other than null). The function flags a column if its biasedness is above a certain</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="sd">    threshold. Such columns can be deleted from the modelling analysis, if required.</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="sd">    This function returns two dataframes in tuple format – 1st dataframe is input dataset after removing high biased</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="sd">    columns (the original dataset if no treatment) and  2nd dataframe is of schema – attribute, mode, mode_pct.</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="sd">    Parameters</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="sd">    ----------</span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="sd">    spark</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="sd">    idf</span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a><span class="sd">        List of Discrete (Categorical + Integer) columns to analyse e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a><span class="sd">        &quot;all&quot; can be passed to include all discrete columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in drop_cols argument</span>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a><span class="sd">        is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a><span class="sd">    treatment</span>
<a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a><span class="sd">        Boolean argument – True or False. If True, columns with high biasedness (defined by</span>
<a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a><span class="sd">        treatment_threshold argument) are removed from the input dataframe. (Default value = False)</span>
<a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a><span class="sd">    treatment_threshold</span>
<a id="__codelineno-2-44" name="__codelineno-2-44" href="#__codelineno-2-44"></a><span class="sd">        Defines acceptable level of biasedness (frequency of most-frequently seen value)for</span>
<a id="__codelineno-2-45" name="__codelineno-2-45" href="#__codelineno-2-45"></a><span class="sd">        a column and takes value between 0 to 1. Default threshold of 0.8 can be interpreted as</span>
<a id="__codelineno-2-46" name="__codelineno-2-46" href="#__codelineno-2-46"></a><span class="sd">        remove column if the number of rows with most-frequently seen value is more than 80%</span>
<a id="__codelineno-2-47" name="__codelineno-2-47" href="#__codelineno-2-47"></a><span class="sd">        of total rows (after excluding null values).</span>
<a id="__codelineno-2-48" name="__codelineno-2-48" href="#__codelineno-2-48"></a><span class="sd">    stats_mode</span>
<a id="__codelineno-2-49" name="__codelineno-2-49" href="#__codelineno-2-49"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-2-50" name="__codelineno-2-50" href="#__codelineno-2-50"></a><span class="sd">        to read pre-saved statistics on most frequently seen values i.e. if measures_of_centralTendency or</span>
<a id="__codelineno-2-51" name="__codelineno-2-51" href="#__codelineno-2-51"></a><span class="sd">        mode_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-2-52" name="__codelineno-2-52" href="#__codelineno-2-52"></a><span class="sd">    print_impact</span>
<a id="__codelineno-2-53" name="__codelineno-2-53" href="#__codelineno-2-53"></a><span class="sd">        True, False</span>
<a id="__codelineno-2-54" name="__codelineno-2-54" href="#__codelineno-2-54"></a><span class="sd">        This argument is to print out the statistics and the impact of treatment (if applicable).(Default value = False)</span>
<a id="__codelineno-2-55" name="__codelineno-2-55" href="#__codelineno-2-55"></a>
<a id="__codelineno-2-56" name="__codelineno-2-56" href="#__codelineno-2-56"></a><span class="sd">    Returns</span>
<a id="__codelineno-2-57" name="__codelineno-2-57" href="#__codelineno-2-57"></a><span class="sd">    -------</span>
<a id="__codelineno-2-58" name="__codelineno-2-58" href="#__codelineno-2-58"></a><span class="sd">    odf : DataFrame</span>
<a id="__codelineno-2-59" name="__codelineno-2-59" href="#__codelineno-2-59"></a><span class="sd">        Dataframe after column removal if treated, else original input dataframe.</span>
<a id="__codelineno-2-60" name="__codelineno-2-60" href="#__codelineno-2-60"></a><span class="sd">    odf_print : DataFrame</span>
<a id="__codelineno-2-61" name="__codelineno-2-61" href="#__codelineno-2-61"></a><span class="sd">        schema [attribute, mode, mode_rows, mode_pct, flagged/treated].</span>
<a id="__codelineno-2-62" name="__codelineno-2-62" href="#__codelineno-2-62"></a><span class="sd">        mode is the most frequently seen value,</span>
<a id="__codelineno-2-63" name="__codelineno-2-63" href="#__codelineno-2-63"></a><span class="sd">        mode_rows is number of rows with mode value, and</span>
<a id="__codelineno-2-64" name="__codelineno-2-64" href="#__codelineno-2-64"></a><span class="sd">        mode_pct is number of rows with mode value divided by non-null values.</span>
<a id="__codelineno-2-65" name="__codelineno-2-65" href="#__codelineno-2-65"></a><span class="sd">        A column is flagged 1 if mode_pct is above the threshold else 0.</span>
<a id="__codelineno-2-66" name="__codelineno-2-66" href="#__codelineno-2-66"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-2-67" name="__codelineno-2-67" href="#__codelineno-2-67"></a>
<a id="__codelineno-2-68" name="__codelineno-2-68" href="#__codelineno-2-68"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-2-69" name="__codelineno-2-69" href="#__codelineno-2-69"></a>        <span class="n">num_cols</span><span class="p">,</span> <span class="n">cat_cols</span><span class="p">,</span> <span class="n">other_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)</span>
<a id="__codelineno-2-70" name="__codelineno-2-70" href="#__codelineno-2-70"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span> <span class="o">+</span> <span class="n">cat_cols</span>
<a id="__codelineno-2-71" name="__codelineno-2-71" href="#__codelineno-2-71"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-2-72" name="__codelineno-2-72" href="#__codelineno-2-72"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-2-73" name="__codelineno-2-73" href="#__codelineno-2-73"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-2-74" name="__codelineno-2-74" href="#__codelineno-2-74"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-2-75" name="__codelineno-2-75" href="#__codelineno-2-75"></a>
<a id="__codelineno-2-76" name="__codelineno-2-76" href="#__codelineno-2-76"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-2-77" name="__codelineno-2-77" href="#__codelineno-2-77"></a>
<a id="__codelineno-2-78" name="__codelineno-2-78" href="#__codelineno-2-78"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
<a id="__codelineno-2-79" name="__codelineno-2-79" href="#__codelineno-2-79"></a>        <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="s2">&quot;bigint&quot;</span><span class="p">,</span> <span class="s2">&quot;long&quot;</span><span class="p">):</span>
<a id="__codelineno-2-80" name="__codelineno-2-80" href="#__codelineno-2-80"></a>            <span class="n">list_of_cols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-2-81" name="__codelineno-2-81" href="#__codelineno-2-81"></a>
<a id="__codelineno-2-82" name="__codelineno-2-82" href="#__codelineno-2-82"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-2-83" name="__codelineno-2-83" href="#__codelineno-2-83"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-2-84" name="__codelineno-2-84" href="#__codelineno-2-84"></a>
<a id="__codelineno-2-85" name="__codelineno-2-85" href="#__codelineno-2-85"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-2-86" name="__codelineno-2-86" href="#__codelineno-2-86"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No biasedness Check - No discrete column(s) to analyze&quot;</span><span class="p">)</span>
<a id="__codelineno-2-87" name="__codelineno-2-87" href="#__codelineno-2-87"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-2-88" name="__codelineno-2-88" href="#__codelineno-2-88"></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">StructType</span><span class="p">(</span>
<a id="__codelineno-2-89" name="__codelineno-2-89" href="#__codelineno-2-89"></a>            <span class="p">[</span>
<a id="__codelineno-2-90" name="__codelineno-2-90" href="#__codelineno-2-90"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-2-91" name="__codelineno-2-91" href="#__codelineno-2-91"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-2-92" name="__codelineno-2-92" href="#__codelineno-2-92"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;mode_rows&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-2-93" name="__codelineno-2-93" href="#__codelineno-2-93"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;mode_pct&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-2-94" name="__codelineno-2-94" href="#__codelineno-2-94"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;flagged&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-2-95" name="__codelineno-2-95" href="#__codelineno-2-95"></a>            <span class="p">]</span>
<a id="__codelineno-2-96" name="__codelineno-2-96" href="#__codelineno-2-96"></a>        <span class="p">)</span>
<a id="__codelineno-2-97" name="__codelineno-2-97" href="#__codelineno-2-97"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">emptyRDD</span><span class="p">()</span><span class="o">.</span><span class="n">toDF</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
<a id="__codelineno-2-98" name="__codelineno-2-98" href="#__codelineno-2-98"></a>        <span class="k">return</span> <span class="n">odf</span><span class="p">,</span> <span class="n">odf_print</span>
<a id="__codelineno-2-99" name="__codelineno-2-99" href="#__codelineno-2-99"></a>
<a id="__codelineno-2-100" name="__codelineno-2-100" href="#__codelineno-2-100"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">treatment_threshold</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">treatment_threshold</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-2-101" name="__codelineno-2-101" href="#__codelineno-2-101"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Treatment Threshold Value&quot;</span><span class="p">)</span>
<a id="__codelineno-2-102" name="__codelineno-2-102" href="#__codelineno-2-102"></a>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
<a id="__codelineno-2-103" name="__codelineno-2-103" href="#__codelineno-2-103"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-2-104" name="__codelineno-2-104" href="#__codelineno-2-104"></a>    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
<a id="__codelineno-2-105" name="__codelineno-2-105" href="#__codelineno-2-105"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-2-106" name="__codelineno-2-106" href="#__codelineno-2-106"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-2-107" name="__codelineno-2-107" href="#__codelineno-2-107"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Non-Boolean input for treatment&quot;</span><span class="p">)</span>
<a id="__codelineno-2-108" name="__codelineno-2-108" href="#__codelineno-2-108"></a>
<a id="__codelineno-2-109" name="__codelineno-2-109" href="#__codelineno-2-109"></a>    <span class="k">if</span> <span class="n">stats_mode</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-2-110" name="__codelineno-2-110" href="#__codelineno-2-110"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-2-111" name="__codelineno-2-111" href="#__codelineno-2-111"></a>            <span class="n">transpose_dataframe</span><span class="p">(</span><span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">),</span> <span class="s2">&quot;summary&quot;</span><span class="p">)</span>
<a id="__codelineno-2-112" name="__codelineno-2-112" href="#__codelineno-2-112"></a>            <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-2-113" name="__codelineno-2-113" href="#__codelineno-2-113"></a>            <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mode_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">),</span> <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;full_outer&quot;</span><span class="p">)</span>
<a id="__codelineno-2-114" name="__codelineno-2-114" href="#__codelineno-2-114"></a>            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-2-115" name="__codelineno-2-115" href="#__codelineno-2-115"></a>                <span class="s2">&quot;mode_pct&quot;</span><span class="p">,</span>
<a id="__codelineno-2-116" name="__codelineno-2-116" href="#__codelineno-2-116"></a>                <span class="n">F</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;mode_rows&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">DoubleType</span><span class="p">()),</span> <span class="mi">4</span><span class="p">),</span>
<a id="__codelineno-2-117" name="__codelineno-2-117" href="#__codelineno-2-117"></a>            <span class="p">)</span>
<a id="__codelineno-2-118" name="__codelineno-2-118" href="#__codelineno-2-118"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="s2">&quot;mode_rows&quot;</span><span class="p">,</span> <span class="s2">&quot;mode_pct&quot;</span><span class="p">)</span>
<a id="__codelineno-2-119" name="__codelineno-2-119" href="#__codelineno-2-119"></a>        <span class="p">)</span>
<a id="__codelineno-2-120" name="__codelineno-2-120" href="#__codelineno-2-120"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-2-121" name="__codelineno-2-121" href="#__codelineno-2-121"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-2-122" name="__codelineno-2-122" href="#__codelineno-2-122"></a>            <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_mode</span><span class="p">)</span>
<a id="__codelineno-2-123" name="__codelineno-2-123" href="#__codelineno-2-123"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="s2">&quot;mode_rows&quot;</span><span class="p">,</span> <span class="s2">&quot;mode_pct&quot;</span><span class="p">)</span>
<a id="__codelineno-2-124" name="__codelineno-2-124" href="#__codelineno-2-124"></a>            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-2-125" name="__codelineno-2-125" href="#__codelineno-2-125"></a>        <span class="p">)</span>
<a id="__codelineno-2-126" name="__codelineno-2-126" href="#__codelineno-2-126"></a>
<a id="__codelineno-2-127" name="__codelineno-2-127" href="#__codelineno-2-127"></a>    <span class="n">odf_print</span> <span class="o">=</span> <span class="n">odf_print</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-2-128" name="__codelineno-2-128" href="#__codelineno-2-128"></a>        <span class="s2">&quot;flagged&quot;</span><span class="p">,</span>
<a id="__codelineno-2-129" name="__codelineno-2-129" href="#__codelineno-2-129"></a>        <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
<a id="__codelineno-2-130" name="__codelineno-2-130" href="#__codelineno-2-130"></a>            <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;mode_pct&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">treatment_threshold</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;mode_pct&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">()),</span> <span class="mi">1</span>
<a id="__codelineno-2-131" name="__codelineno-2-131" href="#__codelineno-2-131"></a>        <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-2-132" name="__codelineno-2-132" href="#__codelineno-2-132"></a>    <span class="p">)</span>
<a id="__codelineno-2-133" name="__codelineno-2-133" href="#__codelineno-2-133"></a>
<a id="__codelineno-2-134" name="__codelineno-2-134" href="#__codelineno-2-134"></a>    <span class="k">if</span> <span class="n">treatment</span><span class="p">:</span>
<a id="__codelineno-2-135" name="__codelineno-2-135" href="#__codelineno-2-135"></a>        <span class="n">remove_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-2-136" name="__codelineno-2-136" href="#__codelineno-2-136"></a>            <span class="n">odf_print</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-2-137" name="__codelineno-2-137" href="#__codelineno-2-137"></a>                <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;mode_pct&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">treatment_threshold</span><span class="p">)</span>
<a id="__codelineno-2-138" name="__codelineno-2-138" href="#__codelineno-2-138"></a>                <span class="o">|</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;mode_pct&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">())</span>
<a id="__codelineno-2-139" name="__codelineno-2-139" href="#__codelineno-2-139"></a>            <span class="p">)</span>
<a id="__codelineno-2-140" name="__codelineno-2-140" href="#__codelineno-2-140"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-2-141" name="__codelineno-2-141" href="#__codelineno-2-141"></a>            <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-2-142" name="__codelineno-2-142" href="#__codelineno-2-142"></a>            <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-2-143" name="__codelineno-2-143" href="#__codelineno-2-143"></a>        <span class="p">)</span>
<a id="__codelineno-2-144" name="__codelineno-2-144" href="#__codelineno-2-144"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="n">remove_cols</span><span class="p">)</span>
<a id="__codelineno-2-145" name="__codelineno-2-145" href="#__codelineno-2-145"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">odf_print</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;flagged&quot;</span><span class="p">,</span> <span class="s2">&quot;treated&quot;</span><span class="p">)</span>
<a id="__codelineno-2-146" name="__codelineno-2-146" href="#__codelineno-2-146"></a>
<a id="__codelineno-2-147" name="__codelineno-2-147" href="#__codelineno-2-147"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-2-148" name="__codelineno-2-148" href="#__codelineno-2-148"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-2-149" name="__codelineno-2-149" href="#__codelineno-2-149"></a>
<a id="__codelineno-2-150" name="__codelineno-2-150" href="#__codelineno-2-150"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-2-151" name="__codelineno-2-151" href="#__codelineno-2-151"></a>        <span class="n">odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-2-152" name="__codelineno-2-152" href="#__codelineno-2-152"></a>        <span class="k">if</span> <span class="n">treatment</span><span class="p">:</span>
<a id="__codelineno-2-153" name="__codelineno-2-153" href="#__codelineno-2-153"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Removed Columns: &quot;</span><span class="p">,</span> <span class="n">remove_cols</span><span class="p">)</span>
<a id="__codelineno-2-154" name="__codelineno-2-154" href="#__codelineno-2-154"></a>
<a id="__codelineno-2-155" name="__codelineno-2-155" href="#__codelineno-2-155"></a>    <span class="k">return</span> <span class="n">odf</span><span class="p">,</span> <span class="n">odf_print</span>
</code></pre></div>
</pre>
</details>
</dd>
<dt id="anovos.data_analyzer.quality_checker.duplicate_detection"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">duplicate_detection</span></span>(<span class="n">spark, idf, list_of_cols='all', drop_cols=[], treatment=True, print_impact=False)</span>
</code></dt>
<dd>
<div class="desc"><p>As the name implies, this function detects duplication in the input dataset. This means, for a pair of
duplicate rows, the values in each column coincide. Duplication check is confined to the list of columns passed
in the arguments. As part of treatment, duplicated rows are removed. This function returns two dataframes in
tuple format; the 1st dataframe is the input dataset after deduplication (if treated else the original dataset).
The 2nd dataframe is of schema – metric, value and contains the total number of rows, number of unique rows,
number of duplicate rows and percentage of duplicate rows in total.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>spark</code></strong></dt>
<dd>Spark Session</dd>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe</dd>
<dt><strong><code>list_of_cols</code></strong></dt>
<dd>List of columns to analyse e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
"all" can be passed to include all columns for analysis. This is super useful instead of specifying all column names manually.
Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in drop_cols argument
is not considered for analysis even if it is mentioned in list_of_cols. (Default value = "all")</dd>
<dt><strong><code>drop_cols</code></strong></dt>
<dd>List of columns to be dropped e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except
a few handful of them. (Default value = [])</dd>
<dt><strong><code>treatment</code></strong></dt>
<dd>Boolean argument – True or False. If True, duplicate rows are removed from the input dataframe. (Default value = True)</dd>
<dt><strong><code>print_impact</code></strong></dt>
<dd>True, False
This argument is to print out the statistics.(Default value = False)</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>if print_impact is True:</code></dt>
<dd>odf : DataFrame
de-duplicated dataframe if treated, else original input dataframe.
odf_print : DataFrame
schema [metric, value] and contains metrics - number of rows, number of unique rows,
number of duplicate rows and percentage of duplicate rows in total.</dd>
<dt><code>if print_impact is False:</code></dt>
<dd>odf : DataFrame
de-duplicated dataframe if treated, else original input dataframe.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">def</span> <span class="nf">duplicate_detection</span><span class="p">(</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    <span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span> <span class="n">treatment</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="p">):</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="sd">    As the name implies, this function detects duplication in the input dataset. This means, for a pair of</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="sd">    duplicate rows, the values in each column coincide. Duplication check is confined to the list of columns passed</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="sd">    in the arguments. As part of treatment, duplicated rows are removed. This function returns two dataframes in</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="sd">    tuple format; the 1st dataframe is the input dataset after deduplication (if treated else the original dataset).</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="sd">    The 2nd dataframe is of schema – metric, value and contains the total number of rows, number of unique rows,</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="sd">    number of duplicate rows and percentage of duplicate rows in total.</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="sd">    Parameters</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="sd">    ----------</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="sd">    spark</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="sd">    idf</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="sd">        List of columns to analyse e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a><span class="sd">        &quot;all&quot; can be passed to include all columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in drop_cols argument</span>
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a><span class="sd">        is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a><span class="sd">    treatment</span>
<a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a><span class="sd">        Boolean argument – True or False. If True, duplicate rows are removed from the input dataframe. (Default value = True)</span>
<a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a><span class="sd">    print_impact</span>
<a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a><span class="sd">        True, False</span>
<a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a><span class="sd">        This argument is to print out the statistics.(Default value = False)</span>
<a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a>
<a id="__codelineno-3-38" name="__codelineno-3-38" href="#__codelineno-3-38"></a><span class="sd">    Returns</span>
<a id="__codelineno-3-39" name="__codelineno-3-39" href="#__codelineno-3-39"></a><span class="sd">    -------</span>
<a id="__codelineno-3-40" name="__codelineno-3-40" href="#__codelineno-3-40"></a><span class="sd">    if print_impact is True:</span>
<a id="__codelineno-3-41" name="__codelineno-3-41" href="#__codelineno-3-41"></a><span class="sd">        odf : DataFrame</span>
<a id="__codelineno-3-42" name="__codelineno-3-42" href="#__codelineno-3-42"></a><span class="sd">            de-duplicated dataframe if treated, else original input dataframe.</span>
<a id="__codelineno-3-43" name="__codelineno-3-43" href="#__codelineno-3-43"></a><span class="sd">        odf_print : DataFrame</span>
<a id="__codelineno-3-44" name="__codelineno-3-44" href="#__codelineno-3-44"></a><span class="sd">            schema [metric, value] and contains metrics - number of rows, number of unique rows,</span>
<a id="__codelineno-3-45" name="__codelineno-3-45" href="#__codelineno-3-45"></a><span class="sd">            number of duplicate rows and percentage of duplicate rows in total.</span>
<a id="__codelineno-3-46" name="__codelineno-3-46" href="#__codelineno-3-46"></a><span class="sd">    if print_impact is False:</span>
<a id="__codelineno-3-47" name="__codelineno-3-47" href="#__codelineno-3-47"></a><span class="sd">        odf : DataFrame</span>
<a id="__codelineno-3-48" name="__codelineno-3-48" href="#__codelineno-3-48"></a><span class="sd">            de-duplicated dataframe if treated, else original input dataframe.</span>
<a id="__codelineno-3-49" name="__codelineno-3-49" href="#__codelineno-3-49"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-3-50" name="__codelineno-3-50" href="#__codelineno-3-50"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">treatment</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-3-51" name="__codelineno-3-51" href="#__codelineno-3-51"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-3-52" name="__codelineno-3-52" href="#__codelineno-3-52"></a>            <span class="s2">&quot;The original idf will be the only output. Set print_impact=True to perform detection without treatment&quot;</span>
<a id="__codelineno-3-53" name="__codelineno-3-53" href="#__codelineno-3-53"></a>        <span class="p">)</span>
<a id="__codelineno-3-54" name="__codelineno-3-54" href="#__codelineno-3-54"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-3-55" name="__codelineno-3-55" href="#__codelineno-3-55"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-3-56" name="__codelineno-3-56" href="#__codelineno-3-56"></a>        <span class="n">num_cols</span><span class="p">,</span> <span class="n">cat_cols</span><span class="p">,</span> <span class="n">other_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)</span>
<a id="__codelineno-3-57" name="__codelineno-3-57" href="#__codelineno-3-57"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span> <span class="o">+</span> <span class="n">cat_cols</span>
<a id="__codelineno-3-58" name="__codelineno-3-58" href="#__codelineno-3-58"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-3-59" name="__codelineno-3-59" href="#__codelineno-3-59"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-3-60" name="__codelineno-3-60" href="#__codelineno-3-60"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-3-61" name="__codelineno-3-61" href="#__codelineno-3-61"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-3-62" name="__codelineno-3-62" href="#__codelineno-3-62"></a>
<a id="__codelineno-3-63" name="__codelineno-3-63" href="#__codelineno-3-63"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-3-64" name="__codelineno-3-64" href="#__codelineno-3-64"></a>
<a id="__codelineno-3-65" name="__codelineno-3-65" href="#__codelineno-3-65"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-3-66" name="__codelineno-3-66" href="#__codelineno-3-66"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-3-67" name="__codelineno-3-67" href="#__codelineno-3-67"></a>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
<a id="__codelineno-3-68" name="__codelineno-3-68" href="#__codelineno-3-68"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-3-69" name="__codelineno-3-69" href="#__codelineno-3-69"></a>    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
<a id="__codelineno-3-70" name="__codelineno-3-70" href="#__codelineno-3-70"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-3-71" name="__codelineno-3-71" href="#__codelineno-3-71"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-3-72" name="__codelineno-3-72" href="#__codelineno-3-72"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Non-Boolean input for treatment&quot;</span><span class="p">)</span>
<a id="__codelineno-3-73" name="__codelineno-3-73" href="#__codelineno-3-73"></a>
<a id="__codelineno-3-74" name="__codelineno-3-74" href="#__codelineno-3-74"></a>    <span class="n">odf_tmp</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">)</span>
<a id="__codelineno-3-75" name="__codelineno-3-75" href="#__codelineno-3-75"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">odf_tmp</span> <span class="k">if</span> <span class="n">treatment</span> <span class="k">else</span> <span class="n">idf</span>
<a id="__codelineno-3-76" name="__codelineno-3-76" href="#__codelineno-3-76"></a>
<a id="__codelineno-3-77" name="__codelineno-3-77" href="#__codelineno-3-77"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-3-78" name="__codelineno-3-78" href="#__codelineno-3-78"></a>        <span class="n">idf_count</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-3-79" name="__codelineno-3-79" href="#__codelineno-3-79"></a>        <span class="n">odf_tmp_count</span> <span class="o">=</span> <span class="n">odf_tmp</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-3-80" name="__codelineno-3-80" href="#__codelineno-3-80"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
<a id="__codelineno-3-81" name="__codelineno-3-81" href="#__codelineno-3-81"></a>            <span class="p">[</span>
<a id="__codelineno-3-82" name="__codelineno-3-82" href="#__codelineno-3-82"></a>                <span class="p">[</span><span class="s2">&quot;rows_count&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">idf_count</span><span class="p">)],</span>
<a id="__codelineno-3-83" name="__codelineno-3-83" href="#__codelineno-3-83"></a>                <span class="p">[</span><span class="s2">&quot;unique_rows_count&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">odf_tmp_count</span><span class="p">)],</span>
<a id="__codelineno-3-84" name="__codelineno-3-84" href="#__codelineno-3-84"></a>                <span class="p">[</span><span class="s2">&quot;duplicate_rows&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">idf_count</span> <span class="o">-</span> <span class="n">odf_tmp_count</span><span class="p">)],</span>
<a id="__codelineno-3-85" name="__codelineno-3-85" href="#__codelineno-3-85"></a>                <span class="p">[</span><span class="s2">&quot;duplicate_pct&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">((</span><span class="n">idf_count</span> <span class="o">-</span> <span class="n">odf_tmp_count</span><span class="p">)</span> <span class="o">/</span> <span class="n">idf_count</span><span class="p">,</span> <span class="mi">4</span><span class="p">)],</span>
<a id="__codelineno-3-86" name="__codelineno-3-86" href="#__codelineno-3-86"></a>            <span class="p">],</span>
<a id="__codelineno-3-87" name="__codelineno-3-87" href="#__codelineno-3-87"></a>            <span class="n">schema</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;metric&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">],</span>
<a id="__codelineno-3-88" name="__codelineno-3-88" href="#__codelineno-3-88"></a>        <span class="p">)</span>
<a id="__codelineno-3-89" name="__codelineno-3-89" href="#__codelineno-3-89"></a>
<a id="__codelineno-3-90" name="__codelineno-3-90" href="#__codelineno-3-90"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No. of Rows: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idf_count</span><span class="p">))</span>
<a id="__codelineno-3-91" name="__codelineno-3-91" href="#__codelineno-3-91"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No. of UNIQUE Rows: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">odf_tmp_count</span><span class="p">))</span>
<a id="__codelineno-3-92" name="__codelineno-3-92" href="#__codelineno-3-92"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No. of Duplicate Rows: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idf_count</span> <span class="o">-</span> <span class="n">odf_tmp_count</span><span class="p">))</span>
<a id="__codelineno-3-93" name="__codelineno-3-93" href="#__codelineno-3-93"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-3-94" name="__codelineno-3-94" href="#__codelineno-3-94"></a>            <span class="s2">&quot;Percentage of Duplicate Rows: &quot;</span>
<a id="__codelineno-3-95" name="__codelineno-3-95" href="#__codelineno-3-95"></a>            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">idf_count</span> <span class="o">-</span> <span class="n">odf_tmp_count</span><span class="p">)</span> <span class="o">/</span> <span class="n">idf_count</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<a id="__codelineno-3-96" name="__codelineno-3-96" href="#__codelineno-3-96"></a>        <span class="p">)</span>
<a id="__codelineno-3-97" name="__codelineno-3-97" href="#__codelineno-3-97"></a>
<a id="__codelineno-3-98" name="__codelineno-3-98" href="#__codelineno-3-98"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-3-99" name="__codelineno-3-99" href="#__codelineno-3-99"></a>        <span class="k">return</span> <span class="n">odf</span><span class="p">,</span> <span class="n">odf_print</span>
<a id="__codelineno-3-100" name="__codelineno-3-100" href="#__codelineno-3-100"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-3-101" name="__codelineno-3-101" href="#__codelineno-3-101"></a>        <span class="k">return</span> <span class="n">odf</span>
</code></pre></div>
</pre>
</details>
</dd>
<dt id="anovos.data_analyzer.quality_checker.invalidEntries_detection"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">invalidEntries_detection</span></span>(<span class="n">spark, idf, list_of_cols='all', drop_cols=[], detection_type='auto', invalid_entries=[], valid_entries=[], partial_match=False, treatment=False, treatment_method='null_replacement', treatment_configs={}, stats_missing={}, stats_unique={}, stats_mode={}, output_mode='replace', print_impact=False)</span>
</code></dt>
<dd>
<div class="desc"><p>This function checks for certain suspicious patterns in attributes’ values. Patterns that are considered for this quality check:</p>
<ul>
<li>
<p>Missing Values: The function checks for all column values which directly or indirectly indicate the missing
value in an attribute such as 'nan', 'null', 'na', 'inf', 'n/a', 'not defined' etc. The function also check for special characters.</p>
</li>
<li>
<p>Repetitive Characters: Certain attributes’ values with repetitive characters may be default value or system
error, rather than being a legit value etc xx, zzzzz, 99999 etc. Such values are flagged for the user to take an
appropriate action. There may be certain false positive which are legit values.</p>
</li>
<li>
<p>Consecutive Characters: Similar to repetitive characters, consecutive characters (at least 3 characters long) such as abc, 1234 etc
may not be legit values, and hence flagged. There may be certain false positive which are legit values.</p>
</li>
</ul>
<p>This function returns two dataframes in tuple format – 1st dataframe is input dataset after treating the invalid values
(or the original dataset if no treatment) and
2nd dataframe is of schema – attribute,
invalid_entries, invalid_count, invalid_pct. All potential invalid values (separated by delimiter pipe “|”) are
shown under invalid_entries column. Total number of rows impacted by these entries for each attribute is shown
under invalid_count. invalid_pct is invalid_count divided by number of rows.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>spark</code></strong></dt>
<dd>Spark Session</dd>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe</dd>
<dt><strong><code>list_of_cols</code></strong></dt>
<dd>List of Discrete (Categorical + Integer) columns to analyse e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
"all" can be passed to include all discrete columns for analysis. This is super useful instead of specifying all column names manually.
Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in drop_cols argument
is not considered for analysis even if it is mentioned in list_of_cols. (Default value = "all")</dd>
<dt><strong><code>drop_cols</code></strong></dt>
<dd>List of columns to be dropped e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except
a few handful of them. (Default value = [])</dd>
<dt><strong><code>detection_type</code></strong></dt>
<dd>"auto","manual","both" (Default value = "auto")</dd>
<dt><strong><code>invalid_entries</code></strong></dt>
<dd>List of values or regex patterns to be classified as invalid.
Valid only for "auto" or "both" detection type. (Default value = [])</dd>
<dt><strong><code>valid_entries</code></strong></dt>
<dd>List of values or regex patterns such that a value will be classified as invalid if it
does not match any value or regex pattern in it. Valid only for "auto" or "both" detection type. (Default value = [])</dd>
<dt><strong><code>partial_match</code></strong></dt>
<dd>Boolean argument – True or False. If True, values with substring same as invalid_entries is declared invalid. (Default value = False)</dd>
<dt><strong><code>treatment</code></strong></dt>
<dd>Boolean argument – True or False. If True, outliers are treated as per treatment_method argument. (Default value = False)</dd>
<dt><strong><code>treatment_method</code></strong></dt>
<dd>"MMM", "null_replacement", "column_removal" (more methods to be added soon).
MMM (Mean Median Mode) replaces invalid value by the measure of central tendency (mode for
categorical features and mean or median for numerical features).
null_replacement removes all values with any invalid values as null.
column_removal remove a column if % of rows with invalid value is above a threshold (defined
by key "treatment_threshold" under treatment_configs argument). (Default value = "null_replacement")</dd>
<dt><strong><code>treatment_configs</code></strong></dt>
<dd>Takes input in dictionary format.
For column_removal treatment, key ‘treatment_threshold’ is provided with a value between 0 to 1.
For value replacement, by MMM, arguments corresponding to imputation_MMM function (transformer module) are provided,
where each key is an argument from imputation_MMM function.
For null_replacement, this argument can be skipped. (Default value = {})</dd>
<dt><strong><code>stats_missing</code></strong></dt>
<dd>Takes arguments for read_dataset (data_ingest module) function in a dictionary format
to read pre-saved statistics on missing count/pct i.e. if measures_of_counts or
missingCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</dd>
<dt><strong><code>stats_unique</code></strong></dt>
<dd>Takes arguments for read_dataset (data_ingest module) function in a dictionary format
to read pre-saved statistics on unique value count i.e. if measures_of_cardinality or
uniqueCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</dd>
<dt><strong><code>stats_mode</code></strong></dt>
<dd>Takes arguments for read_dataset (data_ingest module) function in a dictionary format
to read pre-saved statistics on most frequently seen values i.e. if measures_of_centralTendency or
mode_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</dd>
<dt><strong><code>output_mode</code></strong></dt>
<dd>"replace", "append".
“replace” option replaces original columns with treated column. “append” option append treated
column to the input dataset with a postfix "_invalid" e.g. column X is appended as X_invalid. (Default value = "replace")</dd>
<dt><strong><code>print_impact</code></strong></dt>
<dd>True, False
This argument is to print out the statistics.(Default value = False)</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>odf</code></strong> :&ensp;<code>DataFrame</code></dt>
<dd>Dataframe after treatment if applicable, else original input dataframe.</dd>
<dt><strong><code>odf_print</code></strong> :&ensp;<code>DataFrame</code></dt>
<dd>schema [attribute, invalid_entries, invalid_count, invalid_pct].
invalid_entries are all potential invalid values (separated by delimiter pipe “|”),
invalid_count is no. of rows which are impacted by invalid entries, and
invalid_pct is invalid_count divided by no of rows.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">def</span> <span class="nf">invalidEntries_detection</span><span class="p">(</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>    <span class="n">detection_type</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>    <span class="n">invalid_entries</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>    <span class="n">valid_entries</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>    <span class="n">partial_match</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>    <span class="n">treatment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>    <span class="n">treatment_method</span><span class="o">=</span><span class="s2">&quot;null_replacement&quot;</span><span class="p">,</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>    <span class="n">treatment_configs</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>    <span class="n">stats_missing</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>    <span class="n">stats_unique</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>    <span class="n">stats_mode</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="p">):</span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="sd">    This function checks for certain suspicious patterns in attributes’ values. Patterns that are considered for this quality check:</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="sd">    - Missing Values: The function checks for all column values which directly or indirectly indicate the missing</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="sd">    value in an attribute such as &#39;nan&#39;, &#39;null&#39;, &#39;na&#39;, &#39;inf&#39;, &#39;n/a&#39;, &#39;not defined&#39; etc. The function also check for special characters.</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="sd">    - Repetitive Characters: Certain attributes’ values with repetitive characters may be default value or system</span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="sd">    error, rather than being a legit value etc xx, zzzzz, 99999 etc. Such values are flagged for the user to take an</span>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="sd">    appropriate action. There may be certain false positive which are legit values.</span>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="sd">    - Consecutive Characters: Similar to repetitive characters, consecutive characters (at least 3 characters long) such as abc, 1234 etc</span>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="sd">      may not be legit values, and hence flagged. There may be certain false positive which are legit values.</span>
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="sd">    This function returns two dataframes in tuple format – 1st dataframe is input dataset after treating the invalid values</span>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="sd">    (or the original dataset if no treatment) and  2nd dataframe is of schema – attribute,</span>
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="sd">    invalid_entries, invalid_count, invalid_pct. All potential invalid values (separated by delimiter pipe “|”) are</span>
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="sd">    shown under invalid_entries column. Total number of rows impacted by these entries for each attribute is shown</span>
<a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a><span class="sd">    under invalid_count. invalid_pct is invalid_count divided by number of rows.</span>
<a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a>
<a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a>
<a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a><span class="sd">    Parameters</span>
<a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a><span class="sd">    ----------</span>
<a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a><span class="sd">    spark</span>
<a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a><span class="sd">    idf</span>
<a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a><span class="sd">        List of Discrete (Categorical + Integer) columns to analyse e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a><span class="sd">        &quot;all&quot; can be passed to include all discrete columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in drop_cols argument</span>
<a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a><span class="sd">        is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-4-54" name="__codelineno-4-54" href="#__codelineno-4-54"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-4-55" name="__codelineno-4-55" href="#__codelineno-4-55"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-4-56" name="__codelineno-4-56" href="#__codelineno-4-56"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-4-57" name="__codelineno-4-57" href="#__codelineno-4-57"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-4-58" name="__codelineno-4-58" href="#__codelineno-4-58"></a><span class="sd">    detection_type</span>
<a id="__codelineno-4-59" name="__codelineno-4-59" href="#__codelineno-4-59"></a><span class="sd">        &quot;auto&quot;,&quot;manual&quot;,&quot;both&quot; (Default value = &quot;auto&quot;)</span>
<a id="__codelineno-4-60" name="__codelineno-4-60" href="#__codelineno-4-60"></a><span class="sd">    invalid_entries</span>
<a id="__codelineno-4-61" name="__codelineno-4-61" href="#__codelineno-4-61"></a><span class="sd">        List of values or regex patterns to be classified as invalid.</span>
<a id="__codelineno-4-62" name="__codelineno-4-62" href="#__codelineno-4-62"></a><span class="sd">        Valid only for &quot;auto&quot; or &quot;both&quot; detection type. (Default value = [])</span>
<a id="__codelineno-4-63" name="__codelineno-4-63" href="#__codelineno-4-63"></a><span class="sd">    valid_entries</span>
<a id="__codelineno-4-64" name="__codelineno-4-64" href="#__codelineno-4-64"></a><span class="sd">        List of values or regex patterns such that a value will be classified as invalid if it</span>
<a id="__codelineno-4-65" name="__codelineno-4-65" href="#__codelineno-4-65"></a><span class="sd">        does not match any value or regex pattern in it. Valid only for &quot;auto&quot; or &quot;both&quot; detection type. (Default value = [])</span>
<a id="__codelineno-4-66" name="__codelineno-4-66" href="#__codelineno-4-66"></a><span class="sd">    partial_match</span>
<a id="__codelineno-4-67" name="__codelineno-4-67" href="#__codelineno-4-67"></a><span class="sd">        Boolean argument – True or False. If True, values with substring same as invalid_entries is declared invalid. (Default value = False)</span>
<a id="__codelineno-4-68" name="__codelineno-4-68" href="#__codelineno-4-68"></a><span class="sd">    treatment</span>
<a id="__codelineno-4-69" name="__codelineno-4-69" href="#__codelineno-4-69"></a><span class="sd">        Boolean argument – True or False. If True, outliers are treated as per treatment_method argument. (Default value = False)</span>
<a id="__codelineno-4-70" name="__codelineno-4-70" href="#__codelineno-4-70"></a><span class="sd">    treatment_method</span>
<a id="__codelineno-4-71" name="__codelineno-4-71" href="#__codelineno-4-71"></a><span class="sd">        &quot;MMM&quot;, &quot;null_replacement&quot;, &quot;column_removal&quot; (more methods to be added soon).</span>
<a id="__codelineno-4-72" name="__codelineno-4-72" href="#__codelineno-4-72"></a><span class="sd">        MMM (Mean Median Mode) replaces invalid value by the measure of central tendency (mode for</span>
<a id="__codelineno-4-73" name="__codelineno-4-73" href="#__codelineno-4-73"></a><span class="sd">        categorical features and mean or median for numerical features).</span>
<a id="__codelineno-4-74" name="__codelineno-4-74" href="#__codelineno-4-74"></a><span class="sd">        null_replacement removes all values with any invalid values as null.</span>
<a id="__codelineno-4-75" name="__codelineno-4-75" href="#__codelineno-4-75"></a><span class="sd">        column_removal remove a column if % of rows with invalid value is above a threshold (defined</span>
<a id="__codelineno-4-76" name="__codelineno-4-76" href="#__codelineno-4-76"></a><span class="sd">        by key &quot;treatment_threshold&quot; under treatment_configs argument). (Default value = &quot;null_replacement&quot;)</span>
<a id="__codelineno-4-77" name="__codelineno-4-77" href="#__codelineno-4-77"></a><span class="sd">    treatment_configs</span>
<a id="__codelineno-4-78" name="__codelineno-4-78" href="#__codelineno-4-78"></a><span class="sd">        Takes input in dictionary format.</span>
<a id="__codelineno-4-79" name="__codelineno-4-79" href="#__codelineno-4-79"></a><span class="sd">        For column_removal treatment, key ‘treatment_threshold’ is provided with a value between 0 to 1.</span>
<a id="__codelineno-4-80" name="__codelineno-4-80" href="#__codelineno-4-80"></a><span class="sd">        For value replacement, by MMM, arguments corresponding to imputation_MMM function (transformer module) are provided,</span>
<a id="__codelineno-4-81" name="__codelineno-4-81" href="#__codelineno-4-81"></a><span class="sd">        where each key is an argument from imputation_MMM function.</span>
<a id="__codelineno-4-82" name="__codelineno-4-82" href="#__codelineno-4-82"></a><span class="sd">        For null_replacement, this argument can be skipped. (Default value = {})</span>
<a id="__codelineno-4-83" name="__codelineno-4-83" href="#__codelineno-4-83"></a><span class="sd">    stats_missing</span>
<a id="__codelineno-4-84" name="__codelineno-4-84" href="#__codelineno-4-84"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-4-85" name="__codelineno-4-85" href="#__codelineno-4-85"></a><span class="sd">        to read pre-saved statistics on missing count/pct i.e. if measures_of_counts or</span>
<a id="__codelineno-4-86" name="__codelineno-4-86" href="#__codelineno-4-86"></a><span class="sd">        missingCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-4-87" name="__codelineno-4-87" href="#__codelineno-4-87"></a><span class="sd">    stats_unique</span>
<a id="__codelineno-4-88" name="__codelineno-4-88" href="#__codelineno-4-88"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-4-89" name="__codelineno-4-89" href="#__codelineno-4-89"></a><span class="sd">        to read pre-saved statistics on unique value count i.e. if measures_of_cardinality or</span>
<a id="__codelineno-4-90" name="__codelineno-4-90" href="#__codelineno-4-90"></a><span class="sd">        uniqueCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-4-91" name="__codelineno-4-91" href="#__codelineno-4-91"></a><span class="sd">    stats_mode</span>
<a id="__codelineno-4-92" name="__codelineno-4-92" href="#__codelineno-4-92"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-4-93" name="__codelineno-4-93" href="#__codelineno-4-93"></a><span class="sd">        to read pre-saved statistics on most frequently seen values i.e. if measures_of_centralTendency or</span>
<a id="__codelineno-4-94" name="__codelineno-4-94" href="#__codelineno-4-94"></a><span class="sd">        mode_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-4-95" name="__codelineno-4-95" href="#__codelineno-4-95"></a><span class="sd">    output_mode</span>
<a id="__codelineno-4-96" name="__codelineno-4-96" href="#__codelineno-4-96"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-4-97" name="__codelineno-4-97" href="#__codelineno-4-97"></a><span class="sd">        “replace” option replaces original columns with treated column. “append” option append treated</span>
<a id="__codelineno-4-98" name="__codelineno-4-98" href="#__codelineno-4-98"></a><span class="sd">        column to the input dataset with a postfix &quot;_invalid&quot; e.g. column X is appended as X_invalid. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-4-99" name="__codelineno-4-99" href="#__codelineno-4-99"></a><span class="sd">    print_impact</span>
<a id="__codelineno-4-100" name="__codelineno-4-100" href="#__codelineno-4-100"></a><span class="sd">        True, False</span>
<a id="__codelineno-4-101" name="__codelineno-4-101" href="#__codelineno-4-101"></a><span class="sd">        This argument is to print out the statistics.(Default value = False)</span>
<a id="__codelineno-4-102" name="__codelineno-4-102" href="#__codelineno-4-102"></a>
<a id="__codelineno-4-103" name="__codelineno-4-103" href="#__codelineno-4-103"></a><span class="sd">    Returns</span>
<a id="__codelineno-4-104" name="__codelineno-4-104" href="#__codelineno-4-104"></a><span class="sd">    -------</span>
<a id="__codelineno-4-105" name="__codelineno-4-105" href="#__codelineno-4-105"></a><span class="sd">    odf : DataFrame</span>
<a id="__codelineno-4-106" name="__codelineno-4-106" href="#__codelineno-4-106"></a><span class="sd">        Dataframe after treatment if applicable, else original input dataframe.</span>
<a id="__codelineno-4-107" name="__codelineno-4-107" href="#__codelineno-4-107"></a><span class="sd">    odf_print : DataFrame</span>
<a id="__codelineno-4-108" name="__codelineno-4-108" href="#__codelineno-4-108"></a><span class="sd">        schema [attribute, invalid_entries, invalid_count, invalid_pct].</span>
<a id="__codelineno-4-109" name="__codelineno-4-109" href="#__codelineno-4-109"></a><span class="sd">        invalid_entries are all potential invalid values (separated by delimiter pipe “|”),</span>
<a id="__codelineno-4-110" name="__codelineno-4-110" href="#__codelineno-4-110"></a><span class="sd">        invalid_count is no. of rows which are impacted by invalid entries, and</span>
<a id="__codelineno-4-111" name="__codelineno-4-111" href="#__codelineno-4-111"></a><span class="sd">        invalid_pct is invalid_count divided by no of rows.</span>
<a id="__codelineno-4-112" name="__codelineno-4-112" href="#__codelineno-4-112"></a>
<a id="__codelineno-4-113" name="__codelineno-4-113" href="#__codelineno-4-113"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-4-114" name="__codelineno-4-114" href="#__codelineno-4-114"></a>
<a id="__codelineno-4-115" name="__codelineno-4-115" href="#__codelineno-4-115"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-4-116" name="__codelineno-4-116" href="#__codelineno-4-116"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-4-117" name="__codelineno-4-117" href="#__codelineno-4-117"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
<a id="__codelineno-4-118" name="__codelineno-4-118" href="#__codelineno-4-118"></a>            <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="s2">&quot;bigint&quot;</span><span class="p">,</span> <span class="s2">&quot;long&quot;</span><span class="p">):</span>
<a id="__codelineno-4-119" name="__codelineno-4-119" href="#__codelineno-4-119"></a>                <span class="n">list_of_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-4-120" name="__codelineno-4-120" href="#__codelineno-4-120"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-4-121" name="__codelineno-4-121" href="#__codelineno-4-121"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-4-122" name="__codelineno-4-122" href="#__codelineno-4-122"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-4-123" name="__codelineno-4-123" href="#__codelineno-4-123"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-4-124" name="__codelineno-4-124" href="#__codelineno-4-124"></a>
<a id="__codelineno-4-125" name="__codelineno-4-125" href="#__codelineno-4-125"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-4-126" name="__codelineno-4-126" href="#__codelineno-4-126"></a>
<a id="__codelineno-4-127" name="__codelineno-4-127" href="#__codelineno-4-127"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-4-128" name="__codelineno-4-128" href="#__codelineno-4-128"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-4-129" name="__codelineno-4-129" href="#__codelineno-4-129"></a>
<a id="__codelineno-4-130" name="__codelineno-4-130" href="#__codelineno-4-130"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-4-131" name="__codelineno-4-131" href="#__codelineno-4-131"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No Invalid Entries Check - No discrete column(s) to analyze&quot;</span><span class="p">)</span>
<a id="__codelineno-4-132" name="__codelineno-4-132" href="#__codelineno-4-132"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-4-133" name="__codelineno-4-133" href="#__codelineno-4-133"></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">StructType</span><span class="p">(</span>
<a id="__codelineno-4-134" name="__codelineno-4-134" href="#__codelineno-4-134"></a>            <span class="p">[</span>
<a id="__codelineno-4-135" name="__codelineno-4-135" href="#__codelineno-4-135"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-4-136" name="__codelineno-4-136" href="#__codelineno-4-136"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;invalid_entries&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-4-137" name="__codelineno-4-137" href="#__codelineno-4-137"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;invalid_count&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-4-138" name="__codelineno-4-138" href="#__codelineno-4-138"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;invalid_pct&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-4-139" name="__codelineno-4-139" href="#__codelineno-4-139"></a>            <span class="p">]</span>
<a id="__codelineno-4-140" name="__codelineno-4-140" href="#__codelineno-4-140"></a>        <span class="p">)</span>
<a id="__codelineno-4-141" name="__codelineno-4-141" href="#__codelineno-4-141"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">emptyRDD</span><span class="p">()</span><span class="o">.</span><span class="n">toDF</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
<a id="__codelineno-4-142" name="__codelineno-4-142" href="#__codelineno-4-142"></a>        <span class="k">return</span> <span class="n">odf</span><span class="p">,</span> <span class="n">odf_print</span>
<a id="__codelineno-4-143" name="__codelineno-4-143" href="#__codelineno-4-143"></a>
<a id="__codelineno-4-144" name="__codelineno-4-144" href="#__codelineno-4-144"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">):</span>
<a id="__codelineno-4-145" name="__codelineno-4-145" href="#__codelineno-4-145"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for output_mode&quot;</span><span class="p">)</span>
<a id="__codelineno-4-146" name="__codelineno-4-146" href="#__codelineno-4-146"></a>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
<a id="__codelineno-4-147" name="__codelineno-4-147" href="#__codelineno-4-147"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-4-148" name="__codelineno-4-148" href="#__codelineno-4-148"></a>    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
<a id="__codelineno-4-149" name="__codelineno-4-149" href="#__codelineno-4-149"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-4-150" name="__codelineno-4-150" href="#__codelineno-4-150"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-4-151" name="__codelineno-4-151" href="#__codelineno-4-151"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Non-Boolean input for treatment&quot;</span><span class="p">)</span>
<a id="__codelineno-4-152" name="__codelineno-4-152" href="#__codelineno-4-152"></a>
<a id="__codelineno-4-153" name="__codelineno-4-153" href="#__codelineno-4-153"></a>    <span class="k">if</span> <span class="n">treatment_method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;MMM&quot;</span><span class="p">,</span> <span class="s2">&quot;null_replacement&quot;</span><span class="p">,</span> <span class="s2">&quot;column_removal&quot;</span><span class="p">):</span>
<a id="__codelineno-4-154" name="__codelineno-4-154" href="#__codelineno-4-154"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for method_type&quot;</span><span class="p">)</span>
<a id="__codelineno-4-155" name="__codelineno-4-155" href="#__codelineno-4-155"></a>
<a id="__codelineno-4-156" name="__codelineno-4-156" href="#__codelineno-4-156"></a>    <span class="n">treatment_threshold</span> <span class="o">=</span> <span class="n">treatment_configs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;treatment_threshold&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-4-157" name="__codelineno-4-157" href="#__codelineno-4-157"></a>    <span class="k">if</span> <span class="n">treatment_threshold</span><span class="p">:</span>
<a id="__codelineno-4-158" name="__codelineno-4-158" href="#__codelineno-4-158"></a>        <span class="n">treatment_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">treatment_threshold</span><span class="p">)</span>
<a id="__codelineno-4-159" name="__codelineno-4-159" href="#__codelineno-4-159"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-4-160" name="__codelineno-4-160" href="#__codelineno-4-160"></a>        <span class="k">if</span> <span class="n">treatment_method</span> <span class="o">==</span> <span class="s2">&quot;column_removal&quot;</span><span class="p">:</span>
<a id="__codelineno-4-161" name="__codelineno-4-161" href="#__codelineno-4-161"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for column removal threshold&quot;</span><span class="p">)</span>
<a id="__codelineno-4-162" name="__codelineno-4-162" href="#__codelineno-4-162"></a>
<a id="__codelineno-4-163" name="__codelineno-4-163" href="#__codelineno-4-163"></a>    <span class="n">null_vocab</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-4-164" name="__codelineno-4-164" href="#__codelineno-4-164"></a>        <span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-4-165" name="__codelineno-4-165" href="#__codelineno-4-165"></a>        <span class="s2">&quot; &quot;</span><span class="p">,</span>
<a id="__codelineno-4-166" name="__codelineno-4-166" href="#__codelineno-4-166"></a>        <span class="s2">&quot;nan&quot;</span><span class="p">,</span>
<a id="__codelineno-4-167" name="__codelineno-4-167" href="#__codelineno-4-167"></a>        <span class="s2">&quot;null&quot;</span><span class="p">,</span>
<a id="__codelineno-4-168" name="__codelineno-4-168" href="#__codelineno-4-168"></a>        <span class="s2">&quot;na&quot;</span><span class="p">,</span>
<a id="__codelineno-4-169" name="__codelineno-4-169" href="#__codelineno-4-169"></a>        <span class="s2">&quot;inf&quot;</span><span class="p">,</span>
<a id="__codelineno-4-170" name="__codelineno-4-170" href="#__codelineno-4-170"></a>        <span class="s2">&quot;n/a&quot;</span><span class="p">,</span>
<a id="__codelineno-4-171" name="__codelineno-4-171" href="#__codelineno-4-171"></a>        <span class="s2">&quot;not defined&quot;</span><span class="p">,</span>
<a id="__codelineno-4-172" name="__codelineno-4-172" href="#__codelineno-4-172"></a>        <span class="s2">&quot;none&quot;</span><span class="p">,</span>
<a id="__codelineno-4-173" name="__codelineno-4-173" href="#__codelineno-4-173"></a>        <span class="s2">&quot;undefined&quot;</span><span class="p">,</span>
<a id="__codelineno-4-174" name="__codelineno-4-174" href="#__codelineno-4-174"></a>        <span class="s2">&quot;blank&quot;</span><span class="p">,</span>
<a id="__codelineno-4-175" name="__codelineno-4-175" href="#__codelineno-4-175"></a>        <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
<a id="__codelineno-4-176" name="__codelineno-4-176" href="#__codelineno-4-176"></a>    <span class="p">]</span>
<a id="__codelineno-4-177" name="__codelineno-4-177" href="#__codelineno-4-177"></a>    <span class="n">special_chars_vocab</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-4-178" name="__codelineno-4-178" href="#__codelineno-4-178"></a>        <span class="s2">&quot;&amp;&quot;</span><span class="p">,</span>
<a id="__codelineno-4-179" name="__codelineno-4-179" href="#__codelineno-4-179"></a>        <span class="s2">&quot;$&quot;</span><span class="p">,</span>
<a id="__codelineno-4-180" name="__codelineno-4-180" href="#__codelineno-4-180"></a>        <span class="s2">&quot;;&quot;</span><span class="p">,</span>
<a id="__codelineno-4-181" name="__codelineno-4-181" href="#__codelineno-4-181"></a>        <span class="s2">&quot;:&quot;</span><span class="p">,</span>
<a id="__codelineno-4-182" name="__codelineno-4-182" href="#__codelineno-4-182"></a>        <span class="s2">&quot;.&quot;</span><span class="p">,</span>
<a id="__codelineno-4-183" name="__codelineno-4-183" href="#__codelineno-4-183"></a>        <span class="s2">&quot;,&quot;</span><span class="p">,</span>
<a id="__codelineno-4-184" name="__codelineno-4-184" href="#__codelineno-4-184"></a>        <span class="s2">&quot;*&quot;</span><span class="p">,</span>
<a id="__codelineno-4-185" name="__codelineno-4-185" href="#__codelineno-4-185"></a>        <span class="s2">&quot;#&quot;</span><span class="p">,</span>
<a id="__codelineno-4-186" name="__codelineno-4-186" href="#__codelineno-4-186"></a>        <span class="s2">&quot;@&quot;</span><span class="p">,</span>
<a id="__codelineno-4-187" name="__codelineno-4-187" href="#__codelineno-4-187"></a>        <span class="s2">&quot;_&quot;</span><span class="p">,</span>
<a id="__codelineno-4-188" name="__codelineno-4-188" href="#__codelineno-4-188"></a>        <span class="s2">&quot;?&quot;</span><span class="p">,</span>
<a id="__codelineno-4-189" name="__codelineno-4-189" href="#__codelineno-4-189"></a>        <span class="s2">&quot;%&quot;</span><span class="p">,</span>
<a id="__codelineno-4-190" name="__codelineno-4-190" href="#__codelineno-4-190"></a>        <span class="s2">&quot;!&quot;</span><span class="p">,</span>
<a id="__codelineno-4-191" name="__codelineno-4-191" href="#__codelineno-4-191"></a>        <span class="s2">&quot;^&quot;</span><span class="p">,</span>
<a id="__codelineno-4-192" name="__codelineno-4-192" href="#__codelineno-4-192"></a>        <span class="s2">&quot;(&quot;</span><span class="p">,</span>
<a id="__codelineno-4-193" name="__codelineno-4-193" href="#__codelineno-4-193"></a>        <span class="s2">&quot;)&quot;</span><span class="p">,</span>
<a id="__codelineno-4-194" name="__codelineno-4-194" href="#__codelineno-4-194"></a>        <span class="s2">&quot;-&quot;</span><span class="p">,</span>
<a id="__codelineno-4-195" name="__codelineno-4-195" href="#__codelineno-4-195"></a>        <span class="s2">&quot;/&quot;</span><span class="p">,</span>
<a id="__codelineno-4-196" name="__codelineno-4-196" href="#__codelineno-4-196"></a>        <span class="s2">&quot;&#39;&quot;</span><span class="p">,</span>
<a id="__codelineno-4-197" name="__codelineno-4-197" href="#__codelineno-4-197"></a>    <span class="p">]</span>
<a id="__codelineno-4-198" name="__codelineno-4-198" href="#__codelineno-4-198"></a>
<a id="__codelineno-4-199" name="__codelineno-4-199" href="#__codelineno-4-199"></a>    <span class="k">def</span> <span class="nf">detect</span><span class="p">(</span><span class="o">*</span><span class="n">v</span><span class="p">):</span>
<a id="__codelineno-4-200" name="__codelineno-4-200" href="#__codelineno-4-200"></a>        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-4-201" name="__codelineno-4-201" href="#__codelineno-4-201"></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
<a id="__codelineno-4-202" name="__codelineno-4-202" href="#__codelineno-4-202"></a>            <span class="k">if</span> <span class="n">e</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-4-203" name="__codelineno-4-203" href="#__codelineno-4-203"></a>                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-4-204" name="__codelineno-4-204" href="#__codelineno-4-204"></a>                <span class="k">continue</span>
<a id="__codelineno-4-205" name="__codelineno-4-205" href="#__codelineno-4-205"></a>            <span class="k">if</span> <span class="n">detection_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;both&quot;</span><span class="p">):</span>
<a id="__codelineno-4-206" name="__codelineno-4-206" href="#__codelineno-4-206"></a>                <span class="n">e</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-4-207" name="__codelineno-4-207" href="#__codelineno-4-207"></a>                <span class="c1"># Null &amp; Special Chars Search</span>
<a id="__codelineno-4-208" name="__codelineno-4-208" href="#__codelineno-4-208"></a>                <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="p">(</span><span class="n">null_vocab</span> <span class="o">+</span> <span class="n">special_chars_vocab</span><span class="p">):</span>
<a id="__codelineno-4-209" name="__codelineno-4-209" href="#__codelineno-4-209"></a>                    <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-4-210" name="__codelineno-4-210" href="#__codelineno-4-210"></a>                    <span class="k">continue</span>
<a id="__codelineno-4-211" name="__codelineno-4-211" href="#__codelineno-4-211"></a>                <span class="c1"># Consecutive Identical Chars Search</span>
<a id="__codelineno-4-212" name="__codelineno-4-212" href="#__codelineno-4-212"></a>                <span class="n">regex</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">b([a-zA-Z0-9])</span><span class="se">\\</span><span class="s2">1</span><span class="se">\\</span><span class="s2">1+</span><span class="se">\\</span><span class="s2">b&quot;</span>
<a id="__codelineno-4-213" name="__codelineno-4-213" href="#__codelineno-4-213"></a>                <span class="n">p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
<a id="__codelineno-4-214" name="__codelineno-4-214" href="#__codelineno-4-214"></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<a id="__codelineno-4-215" name="__codelineno-4-215" href="#__codelineno-4-215"></a>                    <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-4-216" name="__codelineno-4-216" href="#__codelineno-4-216"></a>                    <span class="k">continue</span>
<a id="__codelineno-4-217" name="__codelineno-4-217" href="#__codelineno-4-217"></a>                <span class="c1"># Ordered Chars Search</span>
<a id="__codelineno-4-218" name="__codelineno-4-218" href="#__codelineno-4-218"></a>                <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-4-219" name="__codelineno-4-219" href="#__codelineno-4-219"></a>                <span class="n">check</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-4-220" name="__codelineno-4-220" href="#__codelineno-4-220"></a>                <span class="k">if</span> <span class="n">l</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-4-221" name="__codelineno-4-221" href="#__codelineno-4-221"></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>
<a id="__codelineno-4-222" name="__codelineno-4-222" href="#__codelineno-4-222"></a>                        <span class="k">if</span> <span class="nb">ord</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="nb">ord</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-4-223" name="__codelineno-4-223" href="#__codelineno-4-223"></a>                            <span class="n">check</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-4-224" name="__codelineno-4-224" href="#__codelineno-4-224"></a>                            <span class="k">break</span>
<a id="__codelineno-4-225" name="__codelineno-4-225" href="#__codelineno-4-225"></a>                    <span class="k">if</span> <span class="n">check</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-4-226" name="__codelineno-4-226" href="#__codelineno-4-226"></a>                        <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-4-227" name="__codelineno-4-227" href="#__codelineno-4-227"></a>                        <span class="k">continue</span>
<a id="__codelineno-4-228" name="__codelineno-4-228" href="#__codelineno-4-228"></a>
<a id="__codelineno-4-229" name="__codelineno-4-229" href="#__codelineno-4-229"></a>            <span class="n">check</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-4-230" name="__codelineno-4-230" href="#__codelineno-4-230"></a>            <span class="k">if</span> <span class="n">detection_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;manual&quot;</span><span class="p">,</span> <span class="s2">&quot;both&quot;</span><span class="p">):</span>
<a id="__codelineno-4-231" name="__codelineno-4-231" href="#__codelineno-4-231"></a>                <span class="n">e</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-4-232" name="__codelineno-4-232" href="#__codelineno-4-232"></a>                <span class="k">for</span> <span class="n">regex</span> <span class="ow">in</span> <span class="n">invalid_entries</span><span class="p">:</span>
<a id="__codelineno-4-233" name="__codelineno-4-233" href="#__codelineno-4-233"></a>                    <span class="n">p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
<a id="__codelineno-4-234" name="__codelineno-4-234" href="#__codelineno-4-234"></a>                    <span class="k">if</span> <span class="n">partial_match</span><span class="p">:</span>
<a id="__codelineno-4-235" name="__codelineno-4-235" href="#__codelineno-4-235"></a>                        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<a id="__codelineno-4-236" name="__codelineno-4-236" href="#__codelineno-4-236"></a>                            <span class="n">check</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-4-237" name="__codelineno-4-237" href="#__codelineno-4-237"></a>                            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-4-238" name="__codelineno-4-238" href="#__codelineno-4-238"></a>                            <span class="k">break</span>
<a id="__codelineno-4-239" name="__codelineno-4-239" href="#__codelineno-4-239"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-4-240" name="__codelineno-4-240" href="#__codelineno-4-240"></a>                        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
<a id="__codelineno-4-241" name="__codelineno-4-241" href="#__codelineno-4-241"></a>                            <span class="n">check</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-4-242" name="__codelineno-4-242" href="#__codelineno-4-242"></a>                            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-4-243" name="__codelineno-4-243" href="#__codelineno-4-243"></a>                            <span class="k">break</span>
<a id="__codelineno-4-244" name="__codelineno-4-244" href="#__codelineno-4-244"></a>
<a id="__codelineno-4-245" name="__codelineno-4-245" href="#__codelineno-4-245"></a>                <span class="n">match_valid_entries</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-4-246" name="__codelineno-4-246" href="#__codelineno-4-246"></a>                <span class="k">for</span> <span class="n">regex</span> <span class="ow">in</span> <span class="n">valid_entries</span><span class="p">:</span>
<a id="__codelineno-4-247" name="__codelineno-4-247" href="#__codelineno-4-247"></a>                    <span class="n">p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
<a id="__codelineno-4-248" name="__codelineno-4-248" href="#__codelineno-4-248"></a>                    <span class="k">if</span> <span class="n">partial_match</span><span class="p">:</span>
<a id="__codelineno-4-249" name="__codelineno-4-249" href="#__codelineno-4-249"></a>                        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<a id="__codelineno-4-250" name="__codelineno-4-250" href="#__codelineno-4-250"></a>                            <span class="n">match_valid_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-4-251" name="__codelineno-4-251" href="#__codelineno-4-251"></a>                        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-4-252" name="__codelineno-4-252" href="#__codelineno-4-252"></a>                            <span class="n">match_valid_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-4-253" name="__codelineno-4-253" href="#__codelineno-4-253"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-4-254" name="__codelineno-4-254" href="#__codelineno-4-254"></a>                        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
<a id="__codelineno-4-255" name="__codelineno-4-255" href="#__codelineno-4-255"></a>                            <span class="n">match_valid_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-4-256" name="__codelineno-4-256" href="#__codelineno-4-256"></a>                        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-4-257" name="__codelineno-4-257" href="#__codelineno-4-257"></a>                            <span class="n">match_valid_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-4-258" name="__codelineno-4-258" href="#__codelineno-4-258"></a>
<a id="__codelineno-4-259" name="__codelineno-4-259" href="#__codelineno-4-259"></a>                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">match_valid_entries</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">match_valid_entries</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-4-260" name="__codelineno-4-260" href="#__codelineno-4-260"></a>                    <span class="n">check</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-4-261" name="__codelineno-4-261" href="#__codelineno-4-261"></a>                    <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-4-262" name="__codelineno-4-262" href="#__codelineno-4-262"></a>
<a id="__codelineno-4-263" name="__codelineno-4-263" href="#__codelineno-4-263"></a>            <span class="k">if</span> <span class="n">check</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-4-264" name="__codelineno-4-264" href="#__codelineno-4-264"></a>                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-4-265" name="__codelineno-4-265" href="#__codelineno-4-265"></a>
<a id="__codelineno-4-266" name="__codelineno-4-266" href="#__codelineno-4-266"></a>        <span class="k">return</span> <span class="n">output</span>
<a id="__codelineno-4-267" name="__codelineno-4-267" href="#__codelineno-4-267"></a>
<a id="__codelineno-4-268" name="__codelineno-4-268" href="#__codelineno-4-268"></a>    <span class="n">f_detect</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">udf</span><span class="p">(</span><span class="n">detect</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">ArrayType</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">LongType</span><span class="p">()))</span>
<a id="__codelineno-4-269" name="__codelineno-4-269" href="#__codelineno-4-269"></a>
<a id="__codelineno-4-270" name="__codelineno-4-270" href="#__codelineno-4-270"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;invalid&quot;</span><span class="p">,</span> <span class="n">f_detect</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-4-271" name="__codelineno-4-271" href="#__codelineno-4-271"></a>
<a id="__codelineno-4-272" name="__codelineno-4-272" href="#__codelineno-4-272"></a>    <span class="n">odf</span><span class="o">.</span><span class="n">persist</span><span class="p">()</span>
<a id="__codelineno-4-273" name="__codelineno-4-273" href="#__codelineno-4-273"></a>    <span class="n">output_print</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-4-274" name="__codelineno-4-274" href="#__codelineno-4-274"></a>
<a id="__codelineno-4-275" name="__codelineno-4-275" href="#__codelineno-4-275"></a>    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-4-276" name="__codelineno-4-276" href="#__codelineno-4-276"></a>        <span class="n">tmp</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_invalid&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;invalid&quot;</span><span class="p">)[</span><span class="n">index</span><span class="p">])</span>
<a id="__codelineno-4-277" name="__codelineno-4-277" href="#__codelineno-4-277"></a>        <span class="n">invalid</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-4-278" name="__codelineno-4-278" href="#__codelineno-4-278"></a>            <span class="n">tmp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_invalid&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-4-279" name="__codelineno-4-279" href="#__codelineno-4-279"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-4-280" name="__codelineno-4-280" href="#__codelineno-4-280"></a>            <span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
<a id="__codelineno-4-281" name="__codelineno-4-281" href="#__codelineno-4-281"></a>            <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-4-282" name="__codelineno-4-282" href="#__codelineno-4-282"></a>            <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-4-283" name="__codelineno-4-283" href="#__codelineno-4-283"></a>        <span class="p">)</span>
<a id="__codelineno-4-284" name="__codelineno-4-284" href="#__codelineno-4-284"></a>        <span class="n">invalid</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">invalid</span><span class="p">]</span>
<a id="__codelineno-4-285" name="__codelineno-4-285" href="#__codelineno-4-285"></a>        <span class="n">invalid_count</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_invalid&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-4-286" name="__codelineno-4-286" href="#__codelineno-4-286"></a>        <span class="n">output_print</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-4-287" name="__codelineno-4-287" href="#__codelineno-4-287"></a>            <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invalid</span><span class="p">),</span> <span class="n">invalid_count</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">invalid_count</span> <span class="o">/</span> <span class="n">idf</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">4</span><span class="p">)]</span>
<a id="__codelineno-4-288" name="__codelineno-4-288" href="#__codelineno-4-288"></a>        <span class="p">)</span>
<a id="__codelineno-4-289" name="__codelineno-4-289" href="#__codelineno-4-289"></a>
<a id="__codelineno-4-290" name="__codelineno-4-290" href="#__codelineno-4-290"></a>    <span class="n">odf_print</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
<a id="__codelineno-4-291" name="__codelineno-4-291" href="#__codelineno-4-291"></a>        <span class="n">output_print</span><span class="p">,</span>
<a id="__codelineno-4-292" name="__codelineno-4-292" href="#__codelineno-4-292"></a>        <span class="n">schema</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;invalid_entries&quot;</span><span class="p">,</span> <span class="s2">&quot;invalid_count&quot;</span><span class="p">,</span> <span class="s2">&quot;invalid_pct&quot;</span><span class="p">],</span>
<a id="__codelineno-4-293" name="__codelineno-4-293" href="#__codelineno-4-293"></a>    <span class="p">)</span>
<a id="__codelineno-4-294" name="__codelineno-4-294" href="#__codelineno-4-294"></a>
<a id="__codelineno-4-295" name="__codelineno-4-295" href="#__codelineno-4-295"></a>    <span class="k">if</span> <span class="n">treatment</span><span class="p">:</span>
<a id="__codelineno-4-296" name="__codelineno-4-296" href="#__codelineno-4-296"></a>        <span class="k">if</span> <span class="n">treatment_threshold</span><span class="p">:</span>
<a id="__codelineno-4-297" name="__codelineno-4-297" href="#__codelineno-4-297"></a>            <span class="n">threshold_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-4-298" name="__codelineno-4-298" href="#__codelineno-4-298"></a>                <span class="n">odf_print</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-4-299" name="__codelineno-4-299" href="#__codelineno-4-299"></a>                <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;invalid_pct&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">treatment_threshold</span><span class="p">)</span>
<a id="__codelineno-4-300" name="__codelineno-4-300" href="#__codelineno-4-300"></a>                <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-4-301" name="__codelineno-4-301" href="#__codelineno-4-301"></a>                <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-4-302" name="__codelineno-4-302" href="#__codelineno-4-302"></a>                <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-4-303" name="__codelineno-4-303" href="#__codelineno-4-303"></a>            <span class="p">)</span>
<a id="__codelineno-4-304" name="__codelineno-4-304" href="#__codelineno-4-304"></a>        <span class="k">if</span> <span class="n">treatment_method</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;null_replacement&quot;</span><span class="p">,</span> <span class="s2">&quot;MMM&quot;</span><span class="p">):</span>
<a id="__codelineno-4-305" name="__codelineno-4-305" href="#__codelineno-4-305"></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-4-306" name="__codelineno-4-306" href="#__codelineno-4-306"></a>                <span class="k">if</span> <span class="n">treatment_threshold</span><span class="p">:</span>
<a id="__codelineno-4-307" name="__codelineno-4-307" href="#__codelineno-4-307"></a>                    <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">threshold_cols</span><span class="p">:</span>
<a id="__codelineno-4-308" name="__codelineno-4-308" href="#__codelineno-4-308"></a>                        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_invalid&quot;</span><span class="p">)</span>
<a id="__codelineno-4-309" name="__codelineno-4-309" href="#__codelineno-4-309"></a>                        <span class="k">continue</span>
<a id="__codelineno-4-310" name="__codelineno-4-310" href="#__codelineno-4-310"></a>                <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-4-311" name="__codelineno-4-311" href="#__codelineno-4-311"></a>                    <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_invalid&quot;</span><span class="p">,</span>
<a id="__codelineno-4-312" name="__codelineno-4-312" href="#__codelineno-4-312"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;invalid&quot;</span><span class="p">)[</span><span class="n">index</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span>
<a id="__codelineno-4-313" name="__codelineno-4-313" href="#__codelineno-4-313"></a>                <span class="p">)</span>
<a id="__codelineno-4-314" name="__codelineno-4-314" href="#__codelineno-4-314"></a>                <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-4-315" name="__codelineno-4-315" href="#__codelineno-4-315"></a>                    <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_invalid&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-4-316" name="__codelineno-4-316" href="#__codelineno-4-316"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-4-317" name="__codelineno-4-317" href="#__codelineno-4-317"></a>                    <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-4-318" name="__codelineno-4-318" href="#__codelineno-4-318"></a>                        <span class="n">odf_print</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-4-319" name="__codelineno-4-319" href="#__codelineno-4-319"></a>                        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;invalid_pct&quot;</span><span class="p">)</span>
<a id="__codelineno-4-320" name="__codelineno-4-320" href="#__codelineno-4-320"></a>                        <span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-4-321" name="__codelineno-4-321" href="#__codelineno-4-321"></a>                        <span class="o">==</span> <span class="mf">0.0</span>
<a id="__codelineno-4-322" name="__codelineno-4-322" href="#__codelineno-4-322"></a>                    <span class="p">):</span>
<a id="__codelineno-4-323" name="__codelineno-4-323" href="#__codelineno-4-323"></a>                        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_invalid&quot;</span><span class="p">)</span>
<a id="__codelineno-4-324" name="__codelineno-4-324" href="#__codelineno-4-324"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;invalid&quot;</span><span class="p">)</span>
<a id="__codelineno-4-325" name="__codelineno-4-325" href="#__codelineno-4-325"></a>
<a id="__codelineno-4-326" name="__codelineno-4-326" href="#__codelineno-4-326"></a>        <span class="k">if</span> <span class="n">treatment_method</span> <span class="o">==</span> <span class="s2">&quot;column_removal&quot;</span><span class="p">:</span>
<a id="__codelineno-4-327" name="__codelineno-4-327" href="#__codelineno-4-327"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="n">threshold_cols</span><span class="p">)</span>
<a id="__codelineno-4-328" name="__codelineno-4-328" href="#__codelineno-4-328"></a>            <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-4-329" name="__codelineno-4-329" href="#__codelineno-4-329"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Removed Columns: &quot;</span><span class="p">,</span> <span class="n">threshold_cols</span><span class="p">)</span>
<a id="__codelineno-4-330" name="__codelineno-4-330" href="#__codelineno-4-330"></a>
<a id="__codelineno-4-331" name="__codelineno-4-331" href="#__codelineno-4-331"></a>        <span class="k">if</span> <span class="n">treatment_method</span> <span class="o">==</span> <span class="s2">&quot;MMM&quot;</span><span class="p">:</span>
<a id="__codelineno-4-332" name="__codelineno-4-332" href="#__codelineno-4-332"></a>            <span class="k">if</span> <span class="n">stats_unique</span> <span class="o">==</span> <span class="p">{}</span> <span class="ow">or</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;append&quot;</span><span class="p">:</span>
<a id="__codelineno-4-333" name="__codelineno-4-333" href="#__codelineno-4-333"></a>                <span class="n">remove_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-4-334" name="__codelineno-4-334" href="#__codelineno-4-334"></a>                    <span class="n">uniqueCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">odf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-4-335" name="__codelineno-4-335" href="#__codelineno-4-335"></a>                    <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;unique_values&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-4-336" name="__codelineno-4-336" href="#__codelineno-4-336"></a>                    <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-4-337" name="__codelineno-4-337" href="#__codelineno-4-337"></a>                    <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-4-338" name="__codelineno-4-338" href="#__codelineno-4-338"></a>                    <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-4-339" name="__codelineno-4-339" href="#__codelineno-4-339"></a>                <span class="p">)</span>
<a id="__codelineno-4-340" name="__codelineno-4-340" href="#__codelineno-4-340"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-4-341" name="__codelineno-4-341" href="#__codelineno-4-341"></a>                <span class="n">remove_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-4-342" name="__codelineno-4-342" href="#__codelineno-4-342"></a>                    <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_unique</span><span class="p">)</span>
<a id="__codelineno-4-343" name="__codelineno-4-343" href="#__codelineno-4-343"></a>                    <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;unique_values&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-4-344" name="__codelineno-4-344" href="#__codelineno-4-344"></a>                    <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-4-345" name="__codelineno-4-345" href="#__codelineno-4-345"></a>                    <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-4-346" name="__codelineno-4-346" href="#__codelineno-4-346"></a>                    <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-4-347" name="__codelineno-4-347" href="#__codelineno-4-347"></a>                <span class="p">)</span>
<a id="__codelineno-4-348" name="__codelineno-4-348" href="#__codelineno-4-348"></a>
<a id="__codelineno-4-349" name="__codelineno-4-349" href="#__codelineno-4-349"></a>            <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">remove_cols</span><span class="p">]</span>
<a id="__codelineno-4-350" name="__codelineno-4-350" href="#__codelineno-4-350"></a>            <span class="k">if</span> <span class="n">treatment_threshold</span><span class="p">:</span>
<a id="__codelineno-4-351" name="__codelineno-4-351" href="#__codelineno-4-351"></a>                <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">threshold_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">remove_cols</span><span class="p">]</span>
<a id="__codelineno-4-352" name="__codelineno-4-352" href="#__codelineno-4-352"></a>            <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;append&quot;</span><span class="p">:</span>
<a id="__codelineno-4-353" name="__codelineno-4-353" href="#__codelineno-4-353"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-4-354" name="__codelineno-4-354" href="#__codelineno-4-354"></a>                    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="o">+</span> <span class="s2">&quot;_invalid&quot;</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">]</span>
<a id="__codelineno-4-355" name="__codelineno-4-355" href="#__codelineno-4-355"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">imputation_MMM</span><span class="p">(</span>
<a id="__codelineno-4-356" name="__codelineno-4-356" href="#__codelineno-4-356"></a>                <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-4-357" name="__codelineno-4-357" href="#__codelineno-4-357"></a>                <span class="n">odf</span><span class="p">,</span>
<a id="__codelineno-4-358" name="__codelineno-4-358" href="#__codelineno-4-358"></a>                <span class="n">list_of_cols</span><span class="p">,</span>
<a id="__codelineno-4-359" name="__codelineno-4-359" href="#__codelineno-4-359"></a>                <span class="o">**</span><span class="n">treatment_configs</span><span class="p">,</span>
<a id="__codelineno-4-360" name="__codelineno-4-360" href="#__codelineno-4-360"></a>                <span class="n">stats_missing</span><span class="o">=</span><span class="n">stats_missing</span><span class="p">,</span>
<a id="__codelineno-4-361" name="__codelineno-4-361" href="#__codelineno-4-361"></a>                <span class="n">stats_mode</span><span class="o">=</span><span class="n">stats_mode</span><span class="p">,</span>
<a id="__codelineno-4-362" name="__codelineno-4-362" href="#__codelineno-4-362"></a>                <span class="n">print_impact</span><span class="o">=</span><span class="n">print_impact</span>
<a id="__codelineno-4-363" name="__codelineno-4-363" href="#__codelineno-4-363"></a>            <span class="p">)</span>
<a id="__codelineno-4-364" name="__codelineno-4-364" href="#__codelineno-4-364"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-4-365" name="__codelineno-4-365" href="#__codelineno-4-365"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-4-366" name="__codelineno-4-366" href="#__codelineno-4-366"></a>
<a id="__codelineno-4-367" name="__codelineno-4-367" href="#__codelineno-4-367"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-4-368" name="__codelineno-4-368" href="#__codelineno-4-368"></a>        <span class="n">odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-4-369" name="__codelineno-4-369" href="#__codelineno-4-369"></a>
<a id="__codelineno-4-370" name="__codelineno-4-370" href="#__codelineno-4-370"></a>    <span class="k">return</span> <span class="n">odf</span><span class="p">,</span> <span class="n">odf_print</span>
</code></pre></div>
</pre>
</details>
</dd>
<dt id="anovos.data_analyzer.quality_checker.nullColumns_detection"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">nullColumns_detection</span></span>(<span class="n">spark, idf, list_of_cols='missing', drop_cols=[], treatment=False, treatment_method='row_removal', treatment_configs={}, stats_missing={}, stats_unique={}, stats_mode={}, print_impact=False)</span>
</code></dt>
<dd>
<div class="desc"><p>This function inspects the column quality and computes the number of rows that are missing for a column. This
function also leverages statistics computed as part of the State Generator module. Statistics are not computed
twice if already available.</p>
<p>As part of treatments, it currently supports the following methods – Mean Median Mode (MMM), row_removal,
column_removal, KNN, regression, Matrix Factorization (MF), auto imputation (auto).
- MMM replaces null value with the measure of central tendency (mode for categorical features and mean/median for numerical features).
- row_removal removes all rows with any missing value (output of this treatment is same as nullRows_detection with treatment_threshold of 0).
- column_removal remove a column if %rows with a missing value is above treatment_threshold.
- KNN/regression create an imputation model for every to-be-imputed column based on the rest of columns in the list_of_cols columns.
KNN leverages sklearn.impute.KNNImputer and regression sklearn.impute.IterativeImputer. Since sklearn algorithms are not
scalable, we create imputation model on sample dataset and apply that model on the whole dataset in distributed manner using
pyspark pandas udf.
- Matrix Factorization leverages pyspark.ml.recommendation.ALS algorithm.
- auto imputation compares all imputation methods and select the best imputation method based on the least RMSE.</p>
<p>This function returns two dataframes in tuple format – 1st dataframe is input dataset after imputation (if
treated else the original dataset) and
2nd dataframe is of schema – attribute, missing_count, missing_pct.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>spark</code></strong></dt>
<dd>Spark Session</dd>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe</dd>
<dt><strong><code>list_of_cols</code></strong></dt>
<dd>List of columns to inspect e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
"all" can be passed to include all (non-array) columns for analysis. This is super useful instead of specifying all column names manually.
"missing" (default) can be passed to include only those columns with missing values.
One of the usecases where "all" may be preferable over "missing" is when the user wants to save
the imputation model for the future use e.g. a column may not have missing value in the training
dataset but missing values may possibly appear in the prediction dataset.
Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in
drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols.</dd>
<dt><strong><code>drop_cols</code></strong></dt>
<dd>List of columns to be dropped e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except
a few handful of them. (Default value = [])</dd>
<dt><strong><code>treatment</code></strong></dt>
<dd>Boolean argument – True or False. If True, missing values are treated as per treatment_method argument. (Default value = False)</dd>
<dt><strong><code>treatment_method</code></strong></dt>
<dd>"MMM", "row_removal", "column_removal", "KNN", "regression", "MF", "auto".
(Default value = "row_removal")</dd>
<dt><strong><code>treatment_configs</code></strong></dt>
<dd>Takes input in dictionary format.
For column_removal treatment, key ‘treatment_threshold’ is provided with a value between 0 to 1 (remove column
if % of rows with missing value is above this threshold)
For row_removal, this argument can be skipped.
For MMM, arguments corresponding to imputation_MMM function (transformer module) are provided,
where each key is an argument from imputation_MMM function.
For KNN, arguments corresponding to imputation_sklearn function (transformer module) are provided,
where each key is an argument from imputation_sklearn function. method_type should be "KNN"
For regression, arguments corresponding to imputation_sklearn function (transformer module) are provided,
where each key is an argument from imputation_sklearn function. method_type should be "regression"
For MF, arguments corresponding to imputation_matrixFactorization function (transformer module) are provided,
where each key is an argument from imputation_matrixFactorization function.
For auto, arguments corresponding to auto_imputation function (transformer module) are provided,
where each key is an argument from auto_imputation function. (Default value = {})</dd>
<dt><strong><code>stats_missing</code></strong></dt>
<dd>Takes arguments for read_dataset (data_ingest module) function in a dictionary format
to read pre-saved statistics on missing count/pct i.e. if measures_of_counts or
missingCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</dd>
<dt><strong><code>stats_unique</code></strong></dt>
<dd>Takes arguments for read_dataset (data_ingest module) function in a dictionary format
to read pre-saved statistics on unique value count i.e. if measures_of_cardinality or
uniqueCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</dd>
<dt><strong><code>stats_mode</code></strong></dt>
<dd>Takes arguments for read_dataset (data_ingest module) function in a dictionary format
to read pre-saved statistics on most frequently seen values i.e. if measures_of_centralTendency or
mode_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</dd>
<dt><strong><code>print_impact</code></strong></dt>
<dd>True, False
This argument is to print out the statistics or the impact of imputation (if applicable).(Default value = False)</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>odf</code></strong> :&ensp;<code>DataFrame</code></dt>
<dd>Imputed dataframe if treated, else original input dataframe.</dd>
<dt><strong><code>odf_print</code></strong> :&ensp;<code>DataFrame</code></dt>
<dd>schema [attribute, missing_count, missing_pct].
missing_count is number of rows with null values for an attribute, and
missing_pct is missing_count divided by number of rows.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">def</span> <span class="nf">nullColumns_detection</span><span class="p">(</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">,</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>    <span class="n">treatment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>    <span class="n">treatment_method</span><span class="o">=</span><span class="s2">&quot;row_removal&quot;</span><span class="p">,</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    <span class="n">treatment_configs</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>    <span class="n">stats_missing</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>    <span class="n">stats_unique</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>    <span class="n">stats_mode</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="p">):</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="sd">    This function inspects the column quality and computes the number of rows that are missing for a column. This</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="sd">    function also leverages statistics computed as part of the State Generator module. Statistics are not computed</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="sd">    twice if already available.</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="sd">    As part of treatments, it currently supports the following methods – Mean Median Mode (MMM), row_removal,</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="sd">    column_removal, KNN, regression, Matrix Factorization (MF), auto imputation (auto).</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="sd">    - MMM replaces null value with the measure of central tendency (mode for categorical features and mean/median for numerical features).</span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="sd">    - row_removal removes all rows with any missing value (output of this treatment is same as nullRows_detection with treatment_threshold of 0).</span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="sd">    - column_removal remove a column if %rows with a missing value is above treatment_threshold.</span>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="sd">    - KNN/regression create an imputation model for every to-be-imputed column based on the rest of columns in the list_of_cols columns.</span>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="sd">      KNN leverages sklearn.impute.KNNImputer and regression sklearn.impute.IterativeImputer. Since sklearn algorithms are not</span>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a><span class="sd">      scalable, we create imputation model on sample dataset and apply that model on the whole dataset in distributed manner using</span>
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a><span class="sd">      pyspark pandas udf.</span>
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a><span class="sd">    - Matrix Factorization leverages pyspark.ml.recommendation.ALS algorithm.</span>
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a><span class="sd">    - auto imputation compares all imputation methods and select the best imputation method based on the least RMSE.</span>
<a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a>
<a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a><span class="sd">    This function returns two dataframes in tuple format – 1st dataframe is input dataset after imputation (if</span>
<a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a><span class="sd">    treated else the original dataset) and  2nd dataframe is of schema – attribute, missing_count, missing_pct.</span>
<a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a>
<a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a>
<a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a><span class="sd">    Parameters</span>
<a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a><span class="sd">    ----------</span>
<a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a><span class="sd">    spark</span>
<a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a><span class="sd">    idf</span>
<a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-5-41" name="__codelineno-5-41" href="#__codelineno-5-41"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-5-42" name="__codelineno-5-42" href="#__codelineno-5-42"></a><span class="sd">        List of columns to inspect e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-5-43" name="__codelineno-5-43" href="#__codelineno-5-43"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-5-44" name="__codelineno-5-44" href="#__codelineno-5-44"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-5-45" name="__codelineno-5-45" href="#__codelineno-5-45"></a><span class="sd">        &quot;all&quot; can be passed to include all (non-array) columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-5-46" name="__codelineno-5-46" href="#__codelineno-5-46"></a><span class="sd">        &quot;missing&quot; (default) can be passed to include only those columns with missing values.</span>
<a id="__codelineno-5-47" name="__codelineno-5-47" href="#__codelineno-5-47"></a><span class="sd">        One of the usecases where &quot;all&quot; may be preferable over &quot;missing&quot; is when the user wants to save</span>
<a id="__codelineno-5-48" name="__codelineno-5-48" href="#__codelineno-5-48"></a><span class="sd">        the imputation model for the future use e.g. a column may not have missing value in the training</span>
<a id="__codelineno-5-49" name="__codelineno-5-49" href="#__codelineno-5-49"></a><span class="sd">        dataset but missing values may possibly appear in the prediction dataset.</span>
<a id="__codelineno-5-50" name="__codelineno-5-50" href="#__codelineno-5-50"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-5-51" name="__codelineno-5-51" href="#__codelineno-5-51"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols.</span>
<a id="__codelineno-5-52" name="__codelineno-5-52" href="#__codelineno-5-52"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-5-53" name="__codelineno-5-53" href="#__codelineno-5-53"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-5-54" name="__codelineno-5-54" href="#__codelineno-5-54"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-5-55" name="__codelineno-5-55" href="#__codelineno-5-55"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-5-56" name="__codelineno-5-56" href="#__codelineno-5-56"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-5-57" name="__codelineno-5-57" href="#__codelineno-5-57"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-5-58" name="__codelineno-5-58" href="#__codelineno-5-58"></a><span class="sd">    treatment</span>
<a id="__codelineno-5-59" name="__codelineno-5-59" href="#__codelineno-5-59"></a><span class="sd">        Boolean argument – True or False. If True, missing values are treated as per treatment_method argument. (Default value = False)</span>
<a id="__codelineno-5-60" name="__codelineno-5-60" href="#__codelineno-5-60"></a><span class="sd">    treatment_method</span>
<a id="__codelineno-5-61" name="__codelineno-5-61" href="#__codelineno-5-61"></a><span class="sd">        &quot;MMM&quot;, &quot;row_removal&quot;, &quot;column_removal&quot;, &quot;KNN&quot;, &quot;regression&quot;, &quot;MF&quot;, &quot;auto&quot;.</span>
<a id="__codelineno-5-62" name="__codelineno-5-62" href="#__codelineno-5-62"></a><span class="sd">        (Default value = &quot;row_removal&quot;)</span>
<a id="__codelineno-5-63" name="__codelineno-5-63" href="#__codelineno-5-63"></a><span class="sd">    treatment_configs</span>
<a id="__codelineno-5-64" name="__codelineno-5-64" href="#__codelineno-5-64"></a><span class="sd">        Takes input in dictionary format.</span>
<a id="__codelineno-5-65" name="__codelineno-5-65" href="#__codelineno-5-65"></a><span class="sd">        For column_removal treatment, key ‘treatment_threshold’ is provided with a value between 0 to 1 (remove column</span>
<a id="__codelineno-5-66" name="__codelineno-5-66" href="#__codelineno-5-66"></a><span class="sd">        if % of rows with missing value is above this threshold)</span>
<a id="__codelineno-5-67" name="__codelineno-5-67" href="#__codelineno-5-67"></a><span class="sd">        For row_removal, this argument can be skipped.</span>
<a id="__codelineno-5-68" name="__codelineno-5-68" href="#__codelineno-5-68"></a><span class="sd">        For MMM, arguments corresponding to imputation_MMM function (transformer module) are provided,</span>
<a id="__codelineno-5-69" name="__codelineno-5-69" href="#__codelineno-5-69"></a><span class="sd">        where each key is an argument from imputation_MMM function.</span>
<a id="__codelineno-5-70" name="__codelineno-5-70" href="#__codelineno-5-70"></a><span class="sd">        For KNN, arguments corresponding to imputation_sklearn function (transformer module) are provided,</span>
<a id="__codelineno-5-71" name="__codelineno-5-71" href="#__codelineno-5-71"></a><span class="sd">        where each key is an argument from imputation_sklearn function. method_type should be &quot;KNN&quot;</span>
<a id="__codelineno-5-72" name="__codelineno-5-72" href="#__codelineno-5-72"></a><span class="sd">        For regression, arguments corresponding to imputation_sklearn function (transformer module) are provided,</span>
<a id="__codelineno-5-73" name="__codelineno-5-73" href="#__codelineno-5-73"></a><span class="sd">        where each key is an argument from imputation_sklearn function. method_type should be &quot;regression&quot;</span>
<a id="__codelineno-5-74" name="__codelineno-5-74" href="#__codelineno-5-74"></a><span class="sd">        For MF, arguments corresponding to imputation_matrixFactorization function (transformer module) are provided,</span>
<a id="__codelineno-5-75" name="__codelineno-5-75" href="#__codelineno-5-75"></a><span class="sd">        where each key is an argument from imputation_matrixFactorization function.</span>
<a id="__codelineno-5-76" name="__codelineno-5-76" href="#__codelineno-5-76"></a><span class="sd">        For auto, arguments corresponding to auto_imputation function (transformer module) are provided,</span>
<a id="__codelineno-5-77" name="__codelineno-5-77" href="#__codelineno-5-77"></a><span class="sd">        where each key is an argument from auto_imputation function. (Default value = {})</span>
<a id="__codelineno-5-78" name="__codelineno-5-78" href="#__codelineno-5-78"></a><span class="sd">    stats_missing</span>
<a id="__codelineno-5-79" name="__codelineno-5-79" href="#__codelineno-5-79"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-5-80" name="__codelineno-5-80" href="#__codelineno-5-80"></a><span class="sd">        to read pre-saved statistics on missing count/pct i.e. if measures_of_counts or</span>
<a id="__codelineno-5-81" name="__codelineno-5-81" href="#__codelineno-5-81"></a><span class="sd">        missingCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-5-82" name="__codelineno-5-82" href="#__codelineno-5-82"></a><span class="sd">    stats_unique</span>
<a id="__codelineno-5-83" name="__codelineno-5-83" href="#__codelineno-5-83"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-5-84" name="__codelineno-5-84" href="#__codelineno-5-84"></a><span class="sd">        to read pre-saved statistics on unique value count i.e. if measures_of_cardinality or</span>
<a id="__codelineno-5-85" name="__codelineno-5-85" href="#__codelineno-5-85"></a><span class="sd">        uniqueCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-5-86" name="__codelineno-5-86" href="#__codelineno-5-86"></a><span class="sd">    stats_mode</span>
<a id="__codelineno-5-87" name="__codelineno-5-87" href="#__codelineno-5-87"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-5-88" name="__codelineno-5-88" href="#__codelineno-5-88"></a><span class="sd">        to read pre-saved statistics on most frequently seen values i.e. if measures_of_centralTendency or</span>
<a id="__codelineno-5-89" name="__codelineno-5-89" href="#__codelineno-5-89"></a><span class="sd">        mode_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-5-90" name="__codelineno-5-90" href="#__codelineno-5-90"></a><span class="sd">    print_impact</span>
<a id="__codelineno-5-91" name="__codelineno-5-91" href="#__codelineno-5-91"></a><span class="sd">        True, False</span>
<a id="__codelineno-5-92" name="__codelineno-5-92" href="#__codelineno-5-92"></a><span class="sd">        This argument is to print out the statistics or the impact of imputation (if applicable).(Default value = False)</span>
<a id="__codelineno-5-93" name="__codelineno-5-93" href="#__codelineno-5-93"></a>
<a id="__codelineno-5-94" name="__codelineno-5-94" href="#__codelineno-5-94"></a><span class="sd">    Returns</span>
<a id="__codelineno-5-95" name="__codelineno-5-95" href="#__codelineno-5-95"></a><span class="sd">    -------</span>
<a id="__codelineno-5-96" name="__codelineno-5-96" href="#__codelineno-5-96"></a><span class="sd">    odf : DataFrame</span>
<a id="__codelineno-5-97" name="__codelineno-5-97" href="#__codelineno-5-97"></a><span class="sd">        Imputed dataframe if treated, else original input dataframe.</span>
<a id="__codelineno-5-98" name="__codelineno-5-98" href="#__codelineno-5-98"></a><span class="sd">    odf_print : DataFrame</span>
<a id="__codelineno-5-99" name="__codelineno-5-99" href="#__codelineno-5-99"></a><span class="sd">        schema [attribute, missing_count, missing_pct].</span>
<a id="__codelineno-5-100" name="__codelineno-5-100" href="#__codelineno-5-100"></a><span class="sd">        missing_count is number of rows with null values for an attribute, and</span>
<a id="__codelineno-5-101" name="__codelineno-5-101" href="#__codelineno-5-101"></a><span class="sd">        missing_pct is missing_count divided by number of rows.</span>
<a id="__codelineno-5-102" name="__codelineno-5-102" href="#__codelineno-5-102"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-5-103" name="__codelineno-5-103" href="#__codelineno-5-103"></a>    <span class="k">if</span> <span class="n">stats_missing</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-5-104" name="__codelineno-5-104" href="#__codelineno-5-104"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">)</span>
<a id="__codelineno-5-105" name="__codelineno-5-105" href="#__codelineno-5-105"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-5-106" name="__codelineno-5-106" href="#__codelineno-5-106"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_missing</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-5-107" name="__codelineno-5-107" href="#__codelineno-5-107"></a>            <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_count&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_pct&quot;</span>
<a id="__codelineno-5-108" name="__codelineno-5-108" href="#__codelineno-5-108"></a>        <span class="p">)</span>
<a id="__codelineno-5-109" name="__codelineno-5-109" href="#__codelineno-5-109"></a>
<a id="__codelineno-5-110" name="__codelineno-5-110" href="#__codelineno-5-110"></a>    <span class="n">missing_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-5-111" name="__codelineno-5-111" href="#__codelineno-5-111"></a>        <span class="n">odf_print</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-5-112" name="__codelineno-5-112" href="#__codelineno-5-112"></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-5-113" name="__codelineno-5-113" href="#__codelineno-5-113"></a>        <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-5-114" name="__codelineno-5-114" href="#__codelineno-5-114"></a>        <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-5-115" name="__codelineno-5-115" href="#__codelineno-5-115"></a>    <span class="p">)</span>
<a id="__codelineno-5-116" name="__codelineno-5-116" href="#__codelineno-5-116"></a>
<a id="__codelineno-5-117" name="__codelineno-5-117" href="#__codelineno-5-117"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-5-118" name="__codelineno-5-118" href="#__codelineno-5-118"></a>        <span class="n">num_cols</span><span class="p">,</span> <span class="n">cat_cols</span><span class="p">,</span> <span class="n">other_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)</span>
<a id="__codelineno-5-119" name="__codelineno-5-119" href="#__codelineno-5-119"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span> <span class="o">+</span> <span class="n">cat_cols</span>
<a id="__codelineno-5-120" name="__codelineno-5-120" href="#__codelineno-5-120"></a>
<a id="__codelineno-5-121" name="__codelineno-5-121" href="#__codelineno-5-121"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;missing&quot;</span><span class="p">:</span>
<a id="__codelineno-5-122" name="__codelineno-5-122" href="#__codelineno-5-122"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">missing_cols</span>
<a id="__codelineno-5-123" name="__codelineno-5-123" href="#__codelineno-5-123"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-5-124" name="__codelineno-5-124" href="#__codelineno-5-124"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-5-125" name="__codelineno-5-125" href="#__codelineno-5-125"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-5-126" name="__codelineno-5-126" href="#__codelineno-5-126"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-5-127" name="__codelineno-5-127" href="#__codelineno-5-127"></a>
<a id="__codelineno-5-128" name="__codelineno-5-128" href="#__codelineno-5-128"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-5-129" name="__codelineno-5-129" href="#__codelineno-5-129"></a>
<a id="__codelineno-5-130" name="__codelineno-5-130" href="#__codelineno-5-130"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-5-131" name="__codelineno-5-131" href="#__codelineno-5-131"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No Null Detection - No column(s) to analyze&quot;</span><span class="p">)</span>
<a id="__codelineno-5-132" name="__codelineno-5-132" href="#__codelineno-5-132"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-5-133" name="__codelineno-5-133" href="#__codelineno-5-133"></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">StructType</span><span class="p">(</span>
<a id="__codelineno-5-134" name="__codelineno-5-134" href="#__codelineno-5-134"></a>            <span class="p">[</span>
<a id="__codelineno-5-135" name="__codelineno-5-135" href="#__codelineno-5-135"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-5-136" name="__codelineno-5-136" href="#__codelineno-5-136"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-5-137" name="__codelineno-5-137" href="#__codelineno-5-137"></a>                <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-5-138" name="__codelineno-5-138" href="#__codelineno-5-138"></a>            <span class="p">]</span>
<a id="__codelineno-5-139" name="__codelineno-5-139" href="#__codelineno-5-139"></a>        <span class="p">)</span>
<a id="__codelineno-5-140" name="__codelineno-5-140" href="#__codelineno-5-140"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">emptyRDD</span><span class="p">()</span><span class="o">.</span><span class="n">toDF</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
<a id="__codelineno-5-141" name="__codelineno-5-141" href="#__codelineno-5-141"></a>        <span class="k">return</span> <span class="n">odf</span><span class="p">,</span> <span class="n">odf_print</span>
<a id="__codelineno-5-142" name="__codelineno-5-142" href="#__codelineno-5-142"></a>
<a id="__codelineno-5-143" name="__codelineno-5-143" href="#__codelineno-5-143"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-5-144" name="__codelineno-5-144" href="#__codelineno-5-144"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-5-145" name="__codelineno-5-145" href="#__codelineno-5-145"></a>
<a id="__codelineno-5-146" name="__codelineno-5-146" href="#__codelineno-5-146"></a>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
<a id="__codelineno-5-147" name="__codelineno-5-147" href="#__codelineno-5-147"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-5-148" name="__codelineno-5-148" href="#__codelineno-5-148"></a>    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
<a id="__codelineno-5-149" name="__codelineno-5-149" href="#__codelineno-5-149"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-5-150" name="__codelineno-5-150" href="#__codelineno-5-150"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-5-151" name="__codelineno-5-151" href="#__codelineno-5-151"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Non-Boolean input for treatment&quot;</span><span class="p">)</span>
<a id="__codelineno-5-152" name="__codelineno-5-152" href="#__codelineno-5-152"></a>    <span class="k">if</span> <span class="n">treatment_method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
<a id="__codelineno-5-153" name="__codelineno-5-153" href="#__codelineno-5-153"></a>        <span class="s2">&quot;MMM&quot;</span><span class="p">,</span>
<a id="__codelineno-5-154" name="__codelineno-5-154" href="#__codelineno-5-154"></a>        <span class="s2">&quot;row_removal&quot;</span><span class="p">,</span>
<a id="__codelineno-5-155" name="__codelineno-5-155" href="#__codelineno-5-155"></a>        <span class="s2">&quot;column_removal&quot;</span><span class="p">,</span>
<a id="__codelineno-5-156" name="__codelineno-5-156" href="#__codelineno-5-156"></a>        <span class="s2">&quot;KNN&quot;</span><span class="p">,</span>
<a id="__codelineno-5-157" name="__codelineno-5-157" href="#__codelineno-5-157"></a>        <span class="s2">&quot;regression&quot;</span><span class="p">,</span>
<a id="__codelineno-5-158" name="__codelineno-5-158" href="#__codelineno-5-158"></a>        <span class="s2">&quot;MF&quot;</span><span class="p">,</span>
<a id="__codelineno-5-159" name="__codelineno-5-159" href="#__codelineno-5-159"></a>        <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
<a id="__codelineno-5-160" name="__codelineno-5-160" href="#__codelineno-5-160"></a>    <span class="p">):</span>
<a id="__codelineno-5-161" name="__codelineno-5-161" href="#__codelineno-5-161"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for method_type&quot;</span><span class="p">)</span>
<a id="__codelineno-5-162" name="__codelineno-5-162" href="#__codelineno-5-162"></a>
<a id="__codelineno-5-163" name="__codelineno-5-163" href="#__codelineno-5-163"></a>    <span class="n">treatment_threshold</span> <span class="o">=</span> <span class="n">treatment_configs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;treatment_threshold&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-5-164" name="__codelineno-5-164" href="#__codelineno-5-164"></a>    <span class="k">if</span> <span class="n">treatment_threshold</span><span class="p">:</span>
<a id="__codelineno-5-165" name="__codelineno-5-165" href="#__codelineno-5-165"></a>        <span class="n">treatment_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">treatment_threshold</span><span class="p">)</span>
<a id="__codelineno-5-166" name="__codelineno-5-166" href="#__codelineno-5-166"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-5-167" name="__codelineno-5-167" href="#__codelineno-5-167"></a>        <span class="k">if</span> <span class="n">treatment_method</span> <span class="o">==</span> <span class="s2">&quot;column_removal&quot;</span><span class="p">:</span>
<a id="__codelineno-5-168" name="__codelineno-5-168" href="#__codelineno-5-168"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for column removal threshold&quot;</span><span class="p">)</span>
<a id="__codelineno-5-169" name="__codelineno-5-169" href="#__codelineno-5-169"></a>
<a id="__codelineno-5-170" name="__codelineno-5-170" href="#__codelineno-5-170"></a>    <span class="n">odf_print</span> <span class="o">=</span> <span class="n">odf_print</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-5-171" name="__codelineno-5-171" href="#__codelineno-5-171"></a>
<a id="__codelineno-5-172" name="__codelineno-5-172" href="#__codelineno-5-172"></a>    <span class="k">if</span> <span class="n">treatment</span><span class="p">:</span>
<a id="__codelineno-5-173" name="__codelineno-5-173" href="#__codelineno-5-173"></a>        <span class="k">if</span> <span class="n">treatment_threshold</span><span class="p">:</span>
<a id="__codelineno-5-174" name="__codelineno-5-174" href="#__codelineno-5-174"></a>            <span class="n">threshold_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-5-175" name="__codelineno-5-175" href="#__codelineno-5-175"></a>                <span class="n">odf_print</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-5-176" name="__codelineno-5-176" href="#__codelineno-5-176"></a>                <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">treatment_threshold</span><span class="p">)</span>
<a id="__codelineno-5-177" name="__codelineno-5-177" href="#__codelineno-5-177"></a>                <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-5-178" name="__codelineno-5-178" href="#__codelineno-5-178"></a>                <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-5-179" name="__codelineno-5-179" href="#__codelineno-5-179"></a>                <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-5-180" name="__codelineno-5-180" href="#__codelineno-5-180"></a>            <span class="p">)</span>
<a id="__codelineno-5-181" name="__codelineno-5-181" href="#__codelineno-5-181"></a>
<a id="__codelineno-5-182" name="__codelineno-5-182" href="#__codelineno-5-182"></a>        <span class="k">if</span> <span class="n">treatment_method</span> <span class="o">==</span> <span class="s2">&quot;column_removal&quot;</span><span class="p">:</span>
<a id="__codelineno-5-183" name="__codelineno-5-183" href="#__codelineno-5-183"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="n">threshold_cols</span><span class="p">)</span>
<a id="__codelineno-5-184" name="__codelineno-5-184" href="#__codelineno-5-184"></a>            <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-5-185" name="__codelineno-5-185" href="#__codelineno-5-185"></a>                <span class="n">odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-5-186" name="__codelineno-5-186" href="#__codelineno-5-186"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Removed Columns: &quot;</span><span class="p">,</span> <span class="n">threshold_cols</span><span class="p">)</span>
<a id="__codelineno-5-187" name="__codelineno-5-187" href="#__codelineno-5-187"></a>
<a id="__codelineno-5-188" name="__codelineno-5-188" href="#__codelineno-5-188"></a>        <span class="k">if</span> <span class="n">treatment_method</span> <span class="o">==</span> <span class="s2">&quot;row_removal&quot;</span><span class="p">:</span>
<a id="__codelineno-5-189" name="__codelineno-5-189" href="#__codelineno-5-189"></a>            <span class="n">remove_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-5-190" name="__codelineno-5-190" href="#__codelineno-5-190"></a>                <span class="n">odf_print</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-5-191" name="__codelineno-5-191" href="#__codelineno-5-191"></a>                <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-5-192" name="__codelineno-5-192" href="#__codelineno-5-192"></a>                <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-5-193" name="__codelineno-5-193" href="#__codelineno-5-193"></a>                <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-5-194" name="__codelineno-5-194" href="#__codelineno-5-194"></a>                <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-5-195" name="__codelineno-5-195" href="#__codelineno-5-195"></a>            <span class="p">)</span>
<a id="__codelineno-5-196" name="__codelineno-5-196" href="#__codelineno-5-196"></a>            <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">remove_cols</span><span class="p">]</span>
<a id="__codelineno-5-197" name="__codelineno-5-197" href="#__codelineno-5-197"></a>            <span class="k">if</span> <span class="n">treatment_threshold</span><span class="p">:</span>
<a id="__codelineno-5-198" name="__codelineno-5-198" href="#__codelineno-5-198"></a>                <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">threshold_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">remove_cols</span><span class="p">]</span>
<a id="__codelineno-5-199" name="__codelineno-5-199" href="#__codelineno-5-199"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-5-200" name="__codelineno-5-200" href="#__codelineno-5-200"></a>
<a id="__codelineno-5-201" name="__codelineno-5-201" href="#__codelineno-5-201"></a>            <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-5-202" name="__codelineno-5-202" href="#__codelineno-5-202"></a>                <span class="n">odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-5-203" name="__codelineno-5-203" href="#__codelineno-5-203"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before Count: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idf</span><span class="o">.</span><span class="n">count</span><span class="p">()))</span>
<a id="__codelineno-5-204" name="__codelineno-5-204" href="#__codelineno-5-204"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After Count: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">odf</span><span class="o">.</span><span class="n">count</span><span class="p">()))</span>
<a id="__codelineno-5-205" name="__codelineno-5-205" href="#__codelineno-5-205"></a>
<a id="__codelineno-5-206" name="__codelineno-5-206" href="#__codelineno-5-206"></a>        <span class="k">if</span> <span class="n">treatment_method</span> <span class="o">==</span> <span class="s2">&quot;MMM&quot;</span><span class="p">:</span>
<a id="__codelineno-5-207" name="__codelineno-5-207" href="#__codelineno-5-207"></a>            <span class="k">if</span> <span class="n">stats_unique</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-5-208" name="__codelineno-5-208" href="#__codelineno-5-208"></a>                <span class="n">remove_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-5-209" name="__codelineno-5-209" href="#__codelineno-5-209"></a>                    <span class="n">uniqueCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-5-210" name="__codelineno-5-210" href="#__codelineno-5-210"></a>                    <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;unique_values&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-5-211" name="__codelineno-5-211" href="#__codelineno-5-211"></a>                    <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-5-212" name="__codelineno-5-212" href="#__codelineno-5-212"></a>                    <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-5-213" name="__codelineno-5-213" href="#__codelineno-5-213"></a>                    <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-5-214" name="__codelineno-5-214" href="#__codelineno-5-214"></a>                <span class="p">)</span>
<a id="__codelineno-5-215" name="__codelineno-5-215" href="#__codelineno-5-215"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-5-216" name="__codelineno-5-216" href="#__codelineno-5-216"></a>                <span class="n">remove_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-5-217" name="__codelineno-5-217" href="#__codelineno-5-217"></a>                    <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_unique</span><span class="p">)</span>
<a id="__codelineno-5-218" name="__codelineno-5-218" href="#__codelineno-5-218"></a>                    <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;unique_values&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-5-219" name="__codelineno-5-219" href="#__codelineno-5-219"></a>                    <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-5-220" name="__codelineno-5-220" href="#__codelineno-5-220"></a>                    <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-5-221" name="__codelineno-5-221" href="#__codelineno-5-221"></a>                    <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-5-222" name="__codelineno-5-222" href="#__codelineno-5-222"></a>                <span class="p">)</span>
<a id="__codelineno-5-223" name="__codelineno-5-223" href="#__codelineno-5-223"></a>            <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">remove_cols</span><span class="p">]</span>
<a id="__codelineno-5-224" name="__codelineno-5-224" href="#__codelineno-5-224"></a>            <span class="k">if</span> <span class="n">treatment_threshold</span><span class="p">:</span>
<a id="__codelineno-5-225" name="__codelineno-5-225" href="#__codelineno-5-225"></a>                <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">threshold_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">remove_cols</span><span class="p">]</span>
<a id="__codelineno-5-226" name="__codelineno-5-226" href="#__codelineno-5-226"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">imputation_MMM</span><span class="p">(</span>
<a id="__codelineno-5-227" name="__codelineno-5-227" href="#__codelineno-5-227"></a>                <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-5-228" name="__codelineno-5-228" href="#__codelineno-5-228"></a>                <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-5-229" name="__codelineno-5-229" href="#__codelineno-5-229"></a>                <span class="n">list_of_cols</span><span class="p">,</span>
<a id="__codelineno-5-230" name="__codelineno-5-230" href="#__codelineno-5-230"></a>                <span class="o">**</span><span class="n">treatment_configs</span><span class="p">,</span>
<a id="__codelineno-5-231" name="__codelineno-5-231" href="#__codelineno-5-231"></a>                <span class="n">stats_missing</span><span class="o">=</span><span class="n">stats_missing</span><span class="p">,</span>
<a id="__codelineno-5-232" name="__codelineno-5-232" href="#__codelineno-5-232"></a>                <span class="n">stats_mode</span><span class="o">=</span><span class="n">stats_mode</span><span class="p">,</span>
<a id="__codelineno-5-233" name="__codelineno-5-233" href="#__codelineno-5-233"></a>                <span class="n">print_impact</span><span class="o">=</span><span class="n">print_impact</span>
<a id="__codelineno-5-234" name="__codelineno-5-234" href="#__codelineno-5-234"></a>            <span class="p">)</span>
<a id="__codelineno-5-235" name="__codelineno-5-235" href="#__codelineno-5-235"></a>
<a id="__codelineno-5-236" name="__codelineno-5-236" href="#__codelineno-5-236"></a>        <span class="k">if</span> <span class="n">treatment_method</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;KNN&quot;</span><span class="p">,</span> <span class="s2">&quot;regression&quot;</span><span class="p">,</span> <span class="s2">&quot;MF&quot;</span><span class="p">,</span> <span class="s2">&quot;auto&quot;</span><span class="p">):</span>
<a id="__codelineno-5-237" name="__codelineno-5-237" href="#__codelineno-5-237"></a>
<a id="__codelineno-5-238" name="__codelineno-5-238" href="#__codelineno-5-238"></a>            <span class="k">if</span> <span class="n">treatment_threshold</span><span class="p">:</span>
<a id="__codelineno-5-239" name="__codelineno-5-239" href="#__codelineno-5-239"></a>                <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">threshold_cols</span>
<a id="__codelineno-5-240" name="__codelineno-5-240" href="#__codelineno-5-240"></a>            <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">num_cols</span><span class="p">]</span>
<a id="__codelineno-5-241" name="__codelineno-5-241" href="#__codelineno-5-241"></a>            <span class="n">func_mapping</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-5-242" name="__codelineno-5-242" href="#__codelineno-5-242"></a>                <span class="s2">&quot;KNN&quot;</span><span class="p">:</span> <span class="n">imputation_sklearn</span><span class="p">,</span>
<a id="__codelineno-5-243" name="__codelineno-5-243" href="#__codelineno-5-243"></a>                <span class="s2">&quot;regression&quot;</span><span class="p">:</span> <span class="n">imputation_sklearn</span><span class="p">,</span>
<a id="__codelineno-5-244" name="__codelineno-5-244" href="#__codelineno-5-244"></a>                <span class="s2">&quot;MF&quot;</span><span class="p">:</span> <span class="n">imputation_matrixFactorization</span><span class="p">,</span>
<a id="__codelineno-5-245" name="__codelineno-5-245" href="#__codelineno-5-245"></a>                <span class="s2">&quot;auto&quot;</span><span class="p">:</span> <span class="n">auto_imputation</span><span class="p">,</span>
<a id="__codelineno-5-246" name="__codelineno-5-246" href="#__codelineno-5-246"></a>            <span class="p">}</span>
<a id="__codelineno-5-247" name="__codelineno-5-247" href="#__codelineno-5-247"></a>            <span class="n">func</span> <span class="o">=</span> <span class="n">func_mapping</span><span class="p">[</span><span class="n">treatment_method</span><span class="p">]</span>
<a id="__codelineno-5-248" name="__codelineno-5-248" href="#__codelineno-5-248"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span>
<a id="__codelineno-5-249" name="__codelineno-5-249" href="#__codelineno-5-249"></a>                <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-5-250" name="__codelineno-5-250" href="#__codelineno-5-250"></a>                <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-5-251" name="__codelineno-5-251" href="#__codelineno-5-251"></a>                <span class="n">list_of_cols</span><span class="p">,</span>
<a id="__codelineno-5-252" name="__codelineno-5-252" href="#__codelineno-5-252"></a>                <span class="o">**</span><span class="n">treatment_configs</span><span class="p">,</span>
<a id="__codelineno-5-253" name="__codelineno-5-253" href="#__codelineno-5-253"></a>                <span class="n">stats_missing</span><span class="o">=</span><span class="n">stats_missing</span><span class="p">,</span>
<a id="__codelineno-5-254" name="__codelineno-5-254" href="#__codelineno-5-254"></a>                <span class="n">print_impact</span><span class="o">=</span><span class="n">print_impact</span>
<a id="__codelineno-5-255" name="__codelineno-5-255" href="#__codelineno-5-255"></a>            <span class="p">)</span>
<a id="__codelineno-5-256" name="__codelineno-5-256" href="#__codelineno-5-256"></a>
<a id="__codelineno-5-257" name="__codelineno-5-257" href="#__codelineno-5-257"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-5-258" name="__codelineno-5-258" href="#__codelineno-5-258"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-5-259" name="__codelineno-5-259" href="#__codelineno-5-259"></a>        <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-5-260" name="__codelineno-5-260" href="#__codelineno-5-260"></a>            <span class="n">odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-5-261" name="__codelineno-5-261" href="#__codelineno-5-261"></a>
<a id="__codelineno-5-262" name="__codelineno-5-262" href="#__codelineno-5-262"></a>    <span class="k">return</span> <span class="n">odf</span><span class="p">,</span> <span class="n">odf_print</span>
</code></pre></div>
</pre>
</details>
</dd>
<dt id="anovos.data_analyzer.quality_checker.nullRows_detection"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">nullRows_detection</span></span>(<span class="n">spark, idf, list_of_cols='all', drop_cols=[], treatment=False, treatment_threshold=0.8, print_impact=False)</span>
</code></dt>
<dd>
<div class="desc"><p>This function inspects the row quality and computes the number of columns that are missing for a row. This
metric is further aggregated to check how many columns are missing for how many rows (or % rows). Intuition
is if too many columns are missing for a row, removing it from the modeling may give better results than relying
on its imputed values. Therefore as part of the treatment, rows with missing columns above the specified
threshold are removed. This function returns two dataframes in tuple format; the 1st dataframe is the input
dataset after filtering rows with a high number of missing columns (if treated else the original dataframe).
The 2nd dataframe is of schema – null_cols_count, row_count, row_pct, flagged/treated.</p>
<table>
<thead>
<tr>
<th>null_cols_count</th>
<th>row_count</th>
<th>row_pct</th>
<th>flagged</th>
</tr>
</thead>
<tbody>
<tr>
<td>5</td>
<td>11</td>
<td>3.0E-4</td>
<td>0</td>
</tr>
<tr>
<td>7</td>
<td>1306</td>
<td>0.0401</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>Interpretation: 1306 rows (4.01% of total rows) have 7 missing columns and flagged for are removal because
null_cols_count is above the threshold. If treatment is True, then flagged column is renamed as treated to
show rows which has been removed.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>spark</code></strong></dt>
<dd>Spark Session</dd>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe</dd>
<dt><strong><code>list_of_cols</code></strong></dt>
<dd>List of columns to analyse e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
"all" can be passed to include all columns for analysis. This is super useful instead of specifying all column names manually.
Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in drop_cols argument
is not considered for analysis even if it is mentioned in list_of_cols. (Default value = "all")</dd>
<dt><strong><code>drop_cols</code></strong></dt>
<dd>List of columns to be dropped e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except
a few handful of them. (Default value = [])</dd>
<dt><strong><code>treatment</code></strong></dt>
<dd>Boolean argument – True or False. If True, rows with high no. of null columns (defined by
treatment_threshold argument) are removed from the input dataframe. (Default value = False)</dd>
<dt><strong><code>treatment_threshold</code></strong></dt>
<dd>Defines % of columns allowed to be Null per row and takes value between 0 to 1.
If % of null columns is above the threshold for a row, it is removed from the dataframe.
There is no row removal if the threshold is 1.0. And if the threshold is 0, all rows with
null value are removed. (Default value = 0.8)</dd>
<dt><strong><code>print_impact</code></strong></dt>
<dd>True, False
This argument is to print out the statistics.(Default value = False)</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>odf</code></strong> :&ensp;<code>DataFrame</code></dt>
<dd>Dataframe after row removal if treated, else original input dataframe.</dd>
<dt><strong><code>odf_print</code></strong> :&ensp;<code>DataFrame</code></dt>
<dd>schema [null_cols_count, row_count, row_pct, flagged/treated].
null_cols_count is defined as no. of missing columns in a row.
row_count is no. of rows with null_cols_count missing columns.
row_pct is row_count divided by number of rows.
flagged/treated is 1 if null_cols_count is more than (threshold
X Number of Columns), else 0.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">def</span> <span class="nf">nullRows_detection</span><span class="p">(</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    <span class="n">treatment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>    <span class="n">treatment_threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="p">):</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="sd">    This function inspects the row quality and computes the number of columns that are missing for a row. This</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="sd">    metric is further aggregated to check how many columns are missing for how many rows (or % rows). Intuition</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="sd">    is if too many columns are missing for a row, removing it from the modeling may give better results than relying</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="sd">    on its imputed values. Therefore as part of the treatment, rows with missing columns above the specified</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="sd">    threshold are removed. This function returns two dataframes in tuple format; the 1st dataframe is the input</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="sd">    dataset after filtering rows with a high number of missing columns (if treated else the original dataframe).</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="sd">    The 2nd dataframe is of schema – null_cols_count, row_count, row_pct, flagged/treated.</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="sd">    | null_cols_count | row_count | row_pct | flagged |</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="sd">    |-----------------|-----------|---------|---------|</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="sd">    | 5               | 11        | 3.0E-4  | 0       |</span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="sd">    | 7               | 1306      | 0.0401  | 1       |</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="sd">    Interpretation: 1306 rows (4.01% of total rows) have 7 missing columns and flagged for are removal because</span>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="sd">    null_cols_count is above the threshold. If treatment is True, then flagged column is renamed as treated to</span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="sd">    show rows which has been removed.</span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="sd">    Parameters</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a><span class="sd">    ----------</span>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="sd">    spark</span>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a><span class="sd">    idf</span>
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a><span class="sd">        List of columns to analyse e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a><span class="sd">        &quot;all&quot; can be passed to include all columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in drop_cols argument</span>
<a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a><span class="sd">        is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a><span class="sd">    treatment</span>
<a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a><span class="sd">        Boolean argument – True or False. If True, rows with high no. of null columns (defined by</span>
<a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a><span class="sd">        treatment_threshold argument) are removed from the input dataframe. (Default value = False)</span>
<a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a><span class="sd">    treatment_threshold</span>
<a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a><span class="sd">        Defines % of columns allowed to be Null per row and takes value between 0 to 1.</span>
<a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a><span class="sd">        If % of null columns is above the threshold for a row, it is removed from the dataframe.</span>
<a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a><span class="sd">        There is no row removal if the threshold is 1.0. And if the threshold is 0, all rows with</span>
<a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a><span class="sd">        null value are removed. (Default value = 0.8)</span>
<a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a><span class="sd">    print_impact</span>
<a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a><span class="sd">        True, False</span>
<a id="__codelineno-6-58" name="__codelineno-6-58" href="#__codelineno-6-58"></a><span class="sd">        This argument is to print out the statistics.(Default value = False)</span>
<a id="__codelineno-6-59" name="__codelineno-6-59" href="#__codelineno-6-59"></a>
<a id="__codelineno-6-60" name="__codelineno-6-60" href="#__codelineno-6-60"></a><span class="sd">    Returns</span>
<a id="__codelineno-6-61" name="__codelineno-6-61" href="#__codelineno-6-61"></a><span class="sd">    -------</span>
<a id="__codelineno-6-62" name="__codelineno-6-62" href="#__codelineno-6-62"></a><span class="sd">    odf : DataFrame</span>
<a id="__codelineno-6-63" name="__codelineno-6-63" href="#__codelineno-6-63"></a><span class="sd">        Dataframe after row removal if treated, else original input dataframe.</span>
<a id="__codelineno-6-64" name="__codelineno-6-64" href="#__codelineno-6-64"></a><span class="sd">    odf_print : DataFrame</span>
<a id="__codelineno-6-65" name="__codelineno-6-65" href="#__codelineno-6-65"></a><span class="sd">        schema [null_cols_count, row_count, row_pct, flagged/treated].</span>
<a id="__codelineno-6-66" name="__codelineno-6-66" href="#__codelineno-6-66"></a><span class="sd">        null_cols_count is defined as no. of missing columns in a row.</span>
<a id="__codelineno-6-67" name="__codelineno-6-67" href="#__codelineno-6-67"></a><span class="sd">        row_count is no. of rows with null_cols_count missing columns.</span>
<a id="__codelineno-6-68" name="__codelineno-6-68" href="#__codelineno-6-68"></a><span class="sd">        row_pct is row_count divided by number of rows.</span>
<a id="__codelineno-6-69" name="__codelineno-6-69" href="#__codelineno-6-69"></a><span class="sd">        flagged/treated is 1 if null_cols_count is more than (threshold  X Number of Columns), else 0.</span>
<a id="__codelineno-6-70" name="__codelineno-6-70" href="#__codelineno-6-70"></a>
<a id="__codelineno-6-71" name="__codelineno-6-71" href="#__codelineno-6-71"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-6-72" name="__codelineno-6-72" href="#__codelineno-6-72"></a>
<a id="__codelineno-6-73" name="__codelineno-6-73" href="#__codelineno-6-73"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-6-74" name="__codelineno-6-74" href="#__codelineno-6-74"></a>        <span class="n">num_cols</span><span class="p">,</span> <span class="n">cat_cols</span><span class="p">,</span> <span class="n">other_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)</span>
<a id="__codelineno-6-75" name="__codelineno-6-75" href="#__codelineno-6-75"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span> <span class="o">+</span> <span class="n">cat_cols</span>
<a id="__codelineno-6-76" name="__codelineno-6-76" href="#__codelineno-6-76"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-6-77" name="__codelineno-6-77" href="#__codelineno-6-77"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-6-78" name="__codelineno-6-78" href="#__codelineno-6-78"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-6-79" name="__codelineno-6-79" href="#__codelineno-6-79"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-6-80" name="__codelineno-6-80" href="#__codelineno-6-80"></a>
<a id="__codelineno-6-81" name="__codelineno-6-81" href="#__codelineno-6-81"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-6-82" name="__codelineno-6-82" href="#__codelineno-6-82"></a>
<a id="__codelineno-6-83" name="__codelineno-6-83" href="#__codelineno-6-83"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-6-84" name="__codelineno-6-84" href="#__codelineno-6-84"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-6-85" name="__codelineno-6-85" href="#__codelineno-6-85"></a>
<a id="__codelineno-6-86" name="__codelineno-6-86" href="#__codelineno-6-86"></a>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
<a id="__codelineno-6-87" name="__codelineno-6-87" href="#__codelineno-6-87"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-6-88" name="__codelineno-6-88" href="#__codelineno-6-88"></a>    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
<a id="__codelineno-6-89" name="__codelineno-6-89" href="#__codelineno-6-89"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-6-90" name="__codelineno-6-90" href="#__codelineno-6-90"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-6-91" name="__codelineno-6-91" href="#__codelineno-6-91"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Non-Boolean input for treatment&quot;</span><span class="p">)</span>
<a id="__codelineno-6-92" name="__codelineno-6-92" href="#__codelineno-6-92"></a>
<a id="__codelineno-6-93" name="__codelineno-6-93" href="#__codelineno-6-93"></a>    <span class="n">treatment_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">treatment_threshold</span><span class="p">)</span>
<a id="__codelineno-6-94" name="__codelineno-6-94" href="#__codelineno-6-94"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">treatment_threshold</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">treatment_threshold</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-6-95" name="__codelineno-6-95" href="#__codelineno-6-95"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Treatment Threshold Value&quot;</span><span class="p">)</span>
<a id="__codelineno-6-96" name="__codelineno-6-96" href="#__codelineno-6-96"></a>
<a id="__codelineno-6-97" name="__codelineno-6-97" href="#__codelineno-6-97"></a>    <span class="k">def</span> <span class="nf">null_count</span><span class="p">(</span><span class="o">*</span><span class="n">cols</span><span class="p">):</span>
<a id="__codelineno-6-98" name="__codelineno-6-98" href="#__codelineno-6-98"></a>        <span class="k">return</span> <span class="n">cols</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-6-99" name="__codelineno-6-99" href="#__codelineno-6-99"></a>
<a id="__codelineno-6-100" name="__codelineno-6-100" href="#__codelineno-6-100"></a>    <span class="n">f_null_count</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">udf</span><span class="p">(</span><span class="n">null_count</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">LongType</span><span class="p">())</span>
<a id="__codelineno-6-101" name="__codelineno-6-101" href="#__codelineno-6-101"></a>
<a id="__codelineno-6-102" name="__codelineno-6-102" href="#__codelineno-6-102"></a>    <span class="n">odf_tmp</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;null_cols_count&quot;</span><span class="p">,</span> <span class="n">f_null_count</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_cols</span><span class="p">))</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-6-103" name="__codelineno-6-103" href="#__codelineno-6-103"></a>        <span class="s2">&quot;flagged&quot;</span><span class="p">,</span>
<a id="__codelineno-6-104" name="__codelineno-6-104" href="#__codelineno-6-104"></a>        <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
<a id="__codelineno-6-105" name="__codelineno-6-105" href="#__codelineno-6-105"></a>            <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;null_cols_count&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">*</span> <span class="n">treatment_threshold</span><span class="p">),</span> <span class="mi">1</span>
<a id="__codelineno-6-106" name="__codelineno-6-106" href="#__codelineno-6-106"></a>        <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-6-107" name="__codelineno-6-107" href="#__codelineno-6-107"></a>    <span class="p">)</span>
<a id="__codelineno-6-108" name="__codelineno-6-108" href="#__codelineno-6-108"></a>
<a id="__codelineno-6-109" name="__codelineno-6-109" href="#__codelineno-6-109"></a>    <span class="k">if</span> <span class="n">treatment_threshold</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-6-110" name="__codelineno-6-110" href="#__codelineno-6-110"></a>        <span class="n">odf_tmp</span> <span class="o">=</span> <span class="n">odf_tmp</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-6-111" name="__codelineno-6-111" href="#__codelineno-6-111"></a>            <span class="s2">&quot;flagged&quot;</span><span class="p">,</span>
<a id="__codelineno-6-112" name="__codelineno-6-112" href="#__codelineno-6-112"></a>            <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;null_cols_count&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-6-113" name="__codelineno-6-113" href="#__codelineno-6-113"></a>        <span class="p">)</span>
<a id="__codelineno-6-114" name="__codelineno-6-114" href="#__codelineno-6-114"></a>
<a id="__codelineno-6-115" name="__codelineno-6-115" href="#__codelineno-6-115"></a>    <span class="n">odf_print</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-6-116" name="__codelineno-6-116" href="#__codelineno-6-116"></a>        <span class="n">odf_tmp</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;null_cols_count&quot;</span><span class="p">,</span> <span class="s2">&quot;flagged&quot;</span><span class="p">)</span>
<a id="__codelineno-6-117" name="__codelineno-6-117" href="#__codelineno-6-117"></a>        <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;row_count&quot;</span><span class="p">))</span>
<a id="__codelineno-6-118" name="__codelineno-6-118" href="#__codelineno-6-118"></a>        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;row_pct&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;row_count&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">idf</span><span class="o">.</span><span class="n">count</span><span class="p">()),</span> <span class="mi">4</span><span class="p">))</span>
<a id="__codelineno-6-119" name="__codelineno-6-119" href="#__codelineno-6-119"></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;null_cols_count&quot;</span><span class="p">,</span> <span class="s2">&quot;row_count&quot;</span><span class="p">,</span> <span class="s2">&quot;row_pct&quot;</span><span class="p">,</span> <span class="s2">&quot;flagged&quot;</span><span class="p">)</span>
<a id="__codelineno-6-120" name="__codelineno-6-120" href="#__codelineno-6-120"></a>        <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;null_cols_count&quot;</span><span class="p">)</span>
<a id="__codelineno-6-121" name="__codelineno-6-121" href="#__codelineno-6-121"></a>    <span class="p">)</span>
<a id="__codelineno-6-122" name="__codelineno-6-122" href="#__codelineno-6-122"></a>
<a id="__codelineno-6-123" name="__codelineno-6-123" href="#__codelineno-6-123"></a>    <span class="k">if</span> <span class="n">treatment</span><span class="p">:</span>
<a id="__codelineno-6-124" name="__codelineno-6-124" href="#__codelineno-6-124"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf_tmp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;flagged&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="s2">&quot;null_cols_count&quot;</span><span class="p">,</span> <span class="s2">&quot;flagged&quot;</span><span class="p">])</span>
<a id="__codelineno-6-125" name="__codelineno-6-125" href="#__codelineno-6-125"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">odf_print</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;flagged&quot;</span><span class="p">,</span> <span class="s2">&quot;treated&quot;</span><span class="p">)</span>
<a id="__codelineno-6-126" name="__codelineno-6-126" href="#__codelineno-6-126"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-6-127" name="__codelineno-6-127" href="#__codelineno-6-127"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-6-128" name="__codelineno-6-128" href="#__codelineno-6-128"></a>
<a id="__codelineno-6-129" name="__codelineno-6-129" href="#__codelineno-6-129"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-6-130" name="__codelineno-6-130" href="#__codelineno-6-130"></a>        <span class="n">odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">odf</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
<a id="__codelineno-6-131" name="__codelineno-6-131" href="#__codelineno-6-131"></a>
<a id="__codelineno-6-132" name="__codelineno-6-132" href="#__codelineno-6-132"></a>    <span class="k">return</span> <span class="n">odf</span><span class="p">,</span> <span class="n">odf_print</span>
</code></pre></div>
</pre>
</details>
</dd>
<dt id="anovos.data_analyzer.quality_checker.outlier_detection"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">outlier_detection</span></span>(<span class="n">spark, idf, list_of_cols='all', drop_cols=[], detection_side='upper', detection_configs={'pctile_lower': 0.05, 'pctile_upper': 0.95, 'stdev_lower': 3.0, 'stdev_upper': 3.0, 'IQR_lower': 1.5, 'IQR_upper': 1.5, 'min_validation': 2}, treatment=True, treatment_method='value_replacement', pre_existing_model=False, model_path='NA', sample_size=1000000, output_mode='replace', print_impact=False)</span>
</code></dt>
<dd>
<div class="desc"><p>In Machine Learning, outlier detection identifies values that deviate drastically from the rest of the
attribute values. An outlier may be caused simply by chance, measurement error, or inherent heavy-tailed
distribution. This function identifies extreme values in both directions (or any direction provided by the user
via detection_side argument). By default, outlier is identified by 3 different methodologies and tagged an outlier
only if it is validated by at least 2 methods. Users can customize the methodologies they would like to apply and
the minimum number of methodologies to be validated under detection_configs argument.</p>
<ul>
<li>
<p>Percentile Method: In this methodology, a value higher than a certain (default 95th) percentile value is considered
as an outlier. Similarly, a value lower than a certain (default 5th) percentile value is considered as an outlier.</p>
</li>
<li>
<p>Standard Deviation Method: In this methodology, if a value is a certain number of standard deviations (default 3)
away from the mean, it is identified as an outlier.</p>
</li>
<li>
<p>Interquartile Range (IQR) Method: if a value is a certain number of IQRs (default 1.5) below Q1 or above Q3,
it is identified as an outlier. Q1 is in first quantile/25th percentile, Q3 is in third quantile/75th percentile,
and IQR is the difference between third quantile &amp; first quantile.</p>
</li>
</ul>
<p>As part of treatments available, outlier values can be replaced by null so that it can be imputed by a reliable
imputation methodology (null_replacement). It can also be replaced by maximum or minimum permissible by above
methodologies (value_replacement). Lastly, rows can be removed if it is identified with any outlier (row_removal).</p>
<p>This function returns two dataframes in tuple format – 1st dataframe is input dataset after treating outlier (the
original dataset if no treatment) and
2nd dataframe is of schema – attribute, lower_outliers, upper_outliers. If
outliers are checked only for upper end, then lower_outliers column will be shown all zero. Similarly if checked
only for lower end, then upper_outliers will be zero for all attributes.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>spark</code></strong></dt>
<dd>Spark Session</dd>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe</dd>
<dt><strong><code>list_of_cols</code></strong></dt>
<dd>List of numerical columns to analyse e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
"all" can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.
Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in drop_cols argument
is not considered for analysis even if it is mentioned in list_of_cols. (Default value = "all")</dd>
<dt><strong><code>drop_cols</code></strong></dt>
<dd>List of columns to be dropped e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except
a few handful of them. (Default value = [])</dd>
<dt><strong><code>detection_side</code></strong></dt>
<dd>"upper", "lower", "both".
"lower" detects outliers in the lower spectrum of the column range, whereas "upper" detects in the upper spectrum.
"both" detects in both upper and lower end of the spectrum. (Default value = "upper")</dd>
<dt><strong><code>detection_configs</code></strong></dt>
<dd>Takes input in dictionary format with keys representing upper &amp; lower parameter for
three outlier detection methodologies.
a) Percentile Method: lower and upper percentile threshold can be set via "pctile_lower" &amp; "pctile_upper" (default 0.05 &amp; 0.95)
Any value above "pctile_upper" is considered as an outlier. Similarly, a value lower than "pctile_lower" is considered as an outlier.
b) Standard Deviation Method: In this methodology, if a value which is below (mean - "stdev_lower" * standard deviation) or above
(mean + "stdev_upper" * standard deviation), then it is identified as an outlier (default 3.0 &amp; 3.0).
c) Interquartile Range (IQR) Method: A value which is below (Q1 – "IQR_lower" * IQR) or above (Q3 + "IQR_lower" * IQR)
is identified as outliers, where Q1 is first quartile/25th percentile, Q3 is third quartile/75th percentile and IQR is difference between
third quartile &amp; first quartile (default 1.5 &amp; 1.5).
If an attribute value is less (more) than its derived lower (upper) bound value, it is considered as outlier by a methodology.
A attribute value is considered as outlier if it is declared as outlier by at least 'min_validation' methodologies (default 2).
If 'min_validation' is not specified, the total number of methodologies will be used. In addition, it cannot be larger than the
total number of methodologies applied.
If detection_side is "upper", then "pctile_lower", "stdev_lower" and "IQR_lower" will be ignored and vice versa.
Examples (detection_side = "lower")
- If detection_configs={"pctile_lower": 0.05, "stdev_lower": 3.0, "min_validation": 1}, Percentile and Standard Deviation
methods will be applied and a value is considered as outlier if at least 1 methodology categorizes it as an outlier.
- If detection_configs={"pctile_lower": 0.05, "stdev_lower": 3.0}, since "min_validation" is not specified, 2 will be used
because there are 2 methodologies specified. A value is considered as outlier if at both 2 methodologies categorize it as an outlier.</dd>
<dt><strong><code>treatment</code></strong></dt>
<dd>Boolean argument - True or False. If True, outliers are treated as per treatment_method argument.
If treatment is False, print_impact should be True to perform detection without treatment. (Default value = True)</dd>
<dt><strong><code>treatment_method</code></strong></dt>
<dd>"null_replacement", "row_removal", "value_replacement".
In "null_replacement", outlier values are replaced by null so that it can be imputed by a
reliable imputation methodology. In "value_replacement", outlier values are replaced by
maximum or minimum permissible value by above methodologies. Lastly in "row_removal", rows
are removed if it is found with any outlier. (Default value = "value_replacement")</dd>
<dt><strong><code>pre_existing_model</code></strong></dt>
<dd>Boolean argument – True or False. True if the model with upper/lower permissible values
for each attribute exists already to be used, False otherwise. (Default value = False)</dd>
<dt><strong><code>model_path</code></strong></dt>
<dd>If pre_existing_model is True, this argument is path for the pre-saved model.
If pre_existing_model is False, this field can be used for saving the model.
Default "NA" means there is neither pre-existing model nor there is a need to save one.</dd>
<dt><strong><code>sample_size</code></strong></dt>
<dd>The maximum number of rows used to calculate the thresholds of outlier detection. Relevant computation includes
percentiles, means, standard deviations and quantiles calculation. The computed thresholds will be applied over
all rows in the original idf to detect outliers. If the number of rows of idf is smaller than sample_size,
the original idf will be used. (Default value = 1000000)</dd>
<dt><strong><code>output_mode</code></strong></dt>
<dd>"replace", "append".
“replace” option replaces original columns with treated column. “append” option append treated
column to the input dataset with a postfix "_outliered" e.g. column X is appended as X_outliered. (Default value = "replace")</dd>
<dt><strong><code>print_impact</code></strong></dt>
<dd>True, False
This argument is to calculate and print out the impact of treatment (if applicable).
If treatment is False, print_impact should be True to perform detection without treatment. (Default value = False).</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>if print_impact is True:</code></dt>
<dd>odf : DataFrame
Dataframe with outliers treated if treatment is True, else original input dataframe.
odf_print : DataFrame
schema [attribute, lower_outliers, upper_outliers, excluded_due_to_skewness].
lower_outliers is no. of outliers found in the lower spectrum of the attribute range,
upper_outliers is outlier count in the upper spectrum, and
excluded_due_to_skewness is 0 or 1 indicating whether an attribute is excluded from detection due to skewness.</dd>
<dt><code>if print_impact is False:</code></dt>
<dd>odf : DataFrame
Dataframe with outliers treated if treatment is True, else original input dataframe.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">def</span> <span class="nf">outlier_detection</span><span class="p">(</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    <span class="n">detection_side</span><span class="o">=</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    <span class="n">detection_configs</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>        <span class="s2">&quot;pctile_lower&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>        <span class="s2">&quot;pctile_upper&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>        <span class="s2">&quot;stdev_lower&quot;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>        <span class="s2">&quot;stdev_upper&quot;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>        <span class="s2">&quot;IQR_lower&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>        <span class="s2">&quot;IQR_upper&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>        <span class="s2">&quot;min_validation&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>    <span class="p">},</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>    <span class="n">treatment</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>    <span class="n">treatment_method</span><span class="o">=</span><span class="s2">&quot;value_replacement&quot;</span><span class="p">,</span>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>    <span class="n">pre_existing_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>    <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>    <span class="n">sample_size</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span>
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a><span class="p">):</span>
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a><span class="sd">    In Machine Learning, outlier detection identifies values that deviate drastically from the rest of the</span>
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a><span class="sd">    attribute values. An outlier may be caused simply by chance, measurement error, or inherent heavy-tailed</span>
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a><span class="sd">    distribution. This function identifies extreme values in both directions (or any direction provided by the user</span>
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a><span class="sd">    via detection_side argument). By default, outlier is identified by 3 different methodologies and tagged an outlier</span>
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a><span class="sd">    only if it is validated by at least 2 methods. Users can customize the methodologies they would like to apply and</span>
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a><span class="sd">    the minimum number of methodologies to be validated under detection_configs argument.</span>
<a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a>
<a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a><span class="sd">    - Percentile Method: In this methodology, a value higher than a certain (default 95th) percentile value is considered</span>
<a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a><span class="sd">      as an outlier. Similarly, a value lower than a certain (default 5th) percentile value is considered as an outlier.</span>
<a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a>
<a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a><span class="sd">    - Standard Deviation Method: In this methodology, if a value is a certain number of standard deviations (default 3)</span>
<a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a><span class="sd">      away from the mean, it is identified as an outlier.</span>
<a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a>
<a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a><span class="sd">    - Interquartile Range (IQR) Method: if a value is a certain number of IQRs (default 1.5) below Q1 or above Q3,</span>
<a id="__codelineno-7-39" name="__codelineno-7-39" href="#__codelineno-7-39"></a><span class="sd">    it is identified as an outlier. Q1 is in first quantile/25th percentile, Q3 is in third quantile/75th percentile,</span>
<a id="__codelineno-7-40" name="__codelineno-7-40" href="#__codelineno-7-40"></a><span class="sd">    and IQR is the difference between third quantile &amp; first quantile.</span>
<a id="__codelineno-7-41" name="__codelineno-7-41" href="#__codelineno-7-41"></a>
<a id="__codelineno-7-42" name="__codelineno-7-42" href="#__codelineno-7-42"></a><span class="sd">    As part of treatments available, outlier values can be replaced by null so that it can be imputed by a reliable</span>
<a id="__codelineno-7-43" name="__codelineno-7-43" href="#__codelineno-7-43"></a><span class="sd">    imputation methodology (null_replacement). It can also be replaced by maximum or minimum permissible by above</span>
<a id="__codelineno-7-44" name="__codelineno-7-44" href="#__codelineno-7-44"></a><span class="sd">    methodologies (value_replacement). Lastly, rows can be removed if it is identified with any outlier (row_removal).</span>
<a id="__codelineno-7-45" name="__codelineno-7-45" href="#__codelineno-7-45"></a>
<a id="__codelineno-7-46" name="__codelineno-7-46" href="#__codelineno-7-46"></a><span class="sd">    This function returns two dataframes in tuple format – 1st dataframe is input dataset after treating outlier (the</span>
<a id="__codelineno-7-47" name="__codelineno-7-47" href="#__codelineno-7-47"></a><span class="sd">    original dataset if no treatment) and  2nd dataframe is of schema – attribute, lower_outliers, upper_outliers. If</span>
<a id="__codelineno-7-48" name="__codelineno-7-48" href="#__codelineno-7-48"></a><span class="sd">    outliers are checked only for upper end, then lower_outliers column will be shown all zero. Similarly if checked</span>
<a id="__codelineno-7-49" name="__codelineno-7-49" href="#__codelineno-7-49"></a><span class="sd">    only for lower end, then upper_outliers will be zero for all attributes.</span>
<a id="__codelineno-7-50" name="__codelineno-7-50" href="#__codelineno-7-50"></a>
<a id="__codelineno-7-51" name="__codelineno-7-51" href="#__codelineno-7-51"></a><span class="sd">    Parameters</span>
<a id="__codelineno-7-52" name="__codelineno-7-52" href="#__codelineno-7-52"></a><span class="sd">    ----------</span>
<a id="__codelineno-7-53" name="__codelineno-7-53" href="#__codelineno-7-53"></a><span class="sd">    spark</span>
<a id="__codelineno-7-54" name="__codelineno-7-54" href="#__codelineno-7-54"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-7-55" name="__codelineno-7-55" href="#__codelineno-7-55"></a><span class="sd">    idf</span>
<a id="__codelineno-7-56" name="__codelineno-7-56" href="#__codelineno-7-56"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-7-57" name="__codelineno-7-57" href="#__codelineno-7-57"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-7-58" name="__codelineno-7-58" href="#__codelineno-7-58"></a><span class="sd">        List of numerical columns to analyse e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-7-59" name="__codelineno-7-59" href="#__codelineno-7-59"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-7-60" name="__codelineno-7-60" href="#__codelineno-7-60"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-7-61" name="__codelineno-7-61" href="#__codelineno-7-61"></a><span class="sd">        &quot;all&quot; can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-7-62" name="__codelineno-7-62" href="#__codelineno-7-62"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in drop_cols argument</span>
<a id="__codelineno-7-63" name="__codelineno-7-63" href="#__codelineno-7-63"></a><span class="sd">        is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-7-64" name="__codelineno-7-64" href="#__codelineno-7-64"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-7-65" name="__codelineno-7-65" href="#__codelineno-7-65"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-7-66" name="__codelineno-7-66" href="#__codelineno-7-66"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-7-67" name="__codelineno-7-67" href="#__codelineno-7-67"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-7-68" name="__codelineno-7-68" href="#__codelineno-7-68"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-7-69" name="__codelineno-7-69" href="#__codelineno-7-69"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-7-70" name="__codelineno-7-70" href="#__codelineno-7-70"></a><span class="sd">    detection_side</span>
<a id="__codelineno-7-71" name="__codelineno-7-71" href="#__codelineno-7-71"></a><span class="sd">        &quot;upper&quot;, &quot;lower&quot;, &quot;both&quot;.</span>
<a id="__codelineno-7-72" name="__codelineno-7-72" href="#__codelineno-7-72"></a><span class="sd">        &quot;lower&quot; detects outliers in the lower spectrum of the column range, whereas &quot;upper&quot; detects in the upper spectrum.</span>
<a id="__codelineno-7-73" name="__codelineno-7-73" href="#__codelineno-7-73"></a><span class="sd">        &quot;both&quot; detects in both upper and lower end of the spectrum. (Default value = &quot;upper&quot;)</span>
<a id="__codelineno-7-74" name="__codelineno-7-74" href="#__codelineno-7-74"></a><span class="sd">    detection_configs</span>
<a id="__codelineno-7-75" name="__codelineno-7-75" href="#__codelineno-7-75"></a><span class="sd">        Takes input in dictionary format with keys representing upper &amp; lower parameter for</span>
<a id="__codelineno-7-76" name="__codelineno-7-76" href="#__codelineno-7-76"></a><span class="sd">        three outlier detection methodologies.</span>
<a id="__codelineno-7-77" name="__codelineno-7-77" href="#__codelineno-7-77"></a><span class="sd">        a) Percentile Method: lower and upper percentile threshold can be set via &quot;pctile_lower&quot; &amp; &quot;pctile_upper&quot; (default 0.05 &amp; 0.95)</span>
<a id="__codelineno-7-78" name="__codelineno-7-78" href="#__codelineno-7-78"></a><span class="sd">        Any value above &quot;pctile_upper&quot; is considered as an outlier. Similarly, a value lower than &quot;pctile_lower&quot; is considered as an outlier.</span>
<a id="__codelineno-7-79" name="__codelineno-7-79" href="#__codelineno-7-79"></a><span class="sd">        b) Standard Deviation Method: In this methodology, if a value which is below (mean - &quot;stdev_lower&quot; * standard deviation) or above</span>
<a id="__codelineno-7-80" name="__codelineno-7-80" href="#__codelineno-7-80"></a><span class="sd">        (mean + &quot;stdev_upper&quot; * standard deviation), then it is identified as an outlier (default 3.0 &amp; 3.0).</span>
<a id="__codelineno-7-81" name="__codelineno-7-81" href="#__codelineno-7-81"></a><span class="sd">        c) Interquartile Range (IQR) Method: A value which is below (Q1 – &quot;IQR_lower&quot; * IQR) or above (Q3 + &quot;IQR_lower&quot; * IQR)</span>
<a id="__codelineno-7-82" name="__codelineno-7-82" href="#__codelineno-7-82"></a><span class="sd">        is identified as outliers, where Q1 is first quartile/25th percentile, Q3 is third quartile/75th percentile and IQR is difference between</span>
<a id="__codelineno-7-83" name="__codelineno-7-83" href="#__codelineno-7-83"></a><span class="sd">        third quartile &amp; first quartile (default 1.5 &amp; 1.5).</span>
<a id="__codelineno-7-84" name="__codelineno-7-84" href="#__codelineno-7-84"></a><span class="sd">        If an attribute value is less (more) than its derived lower (upper) bound value, it is considered as outlier by a methodology.</span>
<a id="__codelineno-7-85" name="__codelineno-7-85" href="#__codelineno-7-85"></a><span class="sd">        A attribute value is considered as outlier if it is declared as outlier by at least &#39;min_validation&#39; methodologies (default 2).</span>
<a id="__codelineno-7-86" name="__codelineno-7-86" href="#__codelineno-7-86"></a><span class="sd">        If &#39;min_validation&#39; is not specified, the total number of methodologies will be used. In addition, it cannot be larger than the</span>
<a id="__codelineno-7-87" name="__codelineno-7-87" href="#__codelineno-7-87"></a><span class="sd">        total number of methodologies applied.</span>
<a id="__codelineno-7-88" name="__codelineno-7-88" href="#__codelineno-7-88"></a><span class="sd">        If detection_side is &quot;upper&quot;, then &quot;pctile_lower&quot;, &quot;stdev_lower&quot; and &quot;IQR_lower&quot; will be ignored and vice versa.</span>
<a id="__codelineno-7-89" name="__codelineno-7-89" href="#__codelineno-7-89"></a><span class="sd">        Examples (detection_side = &quot;lower&quot;)</span>
<a id="__codelineno-7-90" name="__codelineno-7-90" href="#__codelineno-7-90"></a><span class="sd">        - If detection_configs={&quot;pctile_lower&quot;: 0.05, &quot;stdev_lower&quot;: 3.0, &quot;min_validation&quot;: 1}, Percentile and Standard Deviation</span>
<a id="__codelineno-7-91" name="__codelineno-7-91" href="#__codelineno-7-91"></a><span class="sd">        methods will be applied and a value is considered as outlier if at least 1 methodology categorizes it as an outlier.</span>
<a id="__codelineno-7-92" name="__codelineno-7-92" href="#__codelineno-7-92"></a><span class="sd">        - If detection_configs={&quot;pctile_lower&quot;: 0.05, &quot;stdev_lower&quot;: 3.0}, since &quot;min_validation&quot; is not specified, 2 will be used</span>
<a id="__codelineno-7-93" name="__codelineno-7-93" href="#__codelineno-7-93"></a><span class="sd">        because there are 2 methodologies specified. A value is considered as outlier if at both 2 methodologies categorize it as an outlier.</span>
<a id="__codelineno-7-94" name="__codelineno-7-94" href="#__codelineno-7-94"></a><span class="sd">    treatment</span>
<a id="__codelineno-7-95" name="__codelineno-7-95" href="#__codelineno-7-95"></a><span class="sd">        Boolean argument - True or False. If True, outliers are treated as per treatment_method argument.</span>
<a id="__codelineno-7-96" name="__codelineno-7-96" href="#__codelineno-7-96"></a><span class="sd">        If treatment is False, print_impact should be True to perform detection without treatment. (Default value = True)</span>
<a id="__codelineno-7-97" name="__codelineno-7-97" href="#__codelineno-7-97"></a><span class="sd">    treatment_method</span>
<a id="__codelineno-7-98" name="__codelineno-7-98" href="#__codelineno-7-98"></a><span class="sd">        &quot;null_replacement&quot;, &quot;row_removal&quot;, &quot;value_replacement&quot;.</span>
<a id="__codelineno-7-99" name="__codelineno-7-99" href="#__codelineno-7-99"></a><span class="sd">        In &quot;null_replacement&quot;, outlier values are replaced by null so that it can be imputed by a</span>
<a id="__codelineno-7-100" name="__codelineno-7-100" href="#__codelineno-7-100"></a><span class="sd">        reliable imputation methodology. In &quot;value_replacement&quot;, outlier values are replaced by</span>
<a id="__codelineno-7-101" name="__codelineno-7-101" href="#__codelineno-7-101"></a><span class="sd">        maximum or minimum permissible value by above methodologies. Lastly in &quot;row_removal&quot;, rows</span>
<a id="__codelineno-7-102" name="__codelineno-7-102" href="#__codelineno-7-102"></a><span class="sd">        are removed if it is found with any outlier. (Default value = &quot;value_replacement&quot;)</span>
<a id="__codelineno-7-103" name="__codelineno-7-103" href="#__codelineno-7-103"></a><span class="sd">    pre_existing_model</span>
<a id="__codelineno-7-104" name="__codelineno-7-104" href="#__codelineno-7-104"></a><span class="sd">        Boolean argument – True or False. True if the model with upper/lower permissible values</span>
<a id="__codelineno-7-105" name="__codelineno-7-105" href="#__codelineno-7-105"></a><span class="sd">        for each attribute exists already to be used, False otherwise. (Default value = False)</span>
<a id="__codelineno-7-106" name="__codelineno-7-106" href="#__codelineno-7-106"></a><span class="sd">    model_path</span>
<a id="__codelineno-7-107" name="__codelineno-7-107" href="#__codelineno-7-107"></a><span class="sd">        If pre_existing_model is True, this argument is path for the pre-saved model.</span>
<a id="__codelineno-7-108" name="__codelineno-7-108" href="#__codelineno-7-108"></a><span class="sd">        If pre_existing_model is False, this field can be used for saving the model.</span>
<a id="__codelineno-7-109" name="__codelineno-7-109" href="#__codelineno-7-109"></a><span class="sd">        Default &quot;NA&quot; means there is neither pre-existing model nor there is a need to save one.</span>
<a id="__codelineno-7-110" name="__codelineno-7-110" href="#__codelineno-7-110"></a><span class="sd">    sample_size</span>
<a id="__codelineno-7-111" name="__codelineno-7-111" href="#__codelineno-7-111"></a><span class="sd">        The maximum number of rows used to calculate the thresholds of outlier detection. Relevant computation includes</span>
<a id="__codelineno-7-112" name="__codelineno-7-112" href="#__codelineno-7-112"></a><span class="sd">        percentiles, means, standard deviations and quantiles calculation. The computed thresholds will be applied over</span>
<a id="__codelineno-7-113" name="__codelineno-7-113" href="#__codelineno-7-113"></a><span class="sd">        all rows in the original idf to detect outliers. If the number of rows of idf is smaller than sample_size,</span>
<a id="__codelineno-7-114" name="__codelineno-7-114" href="#__codelineno-7-114"></a><span class="sd">        the original idf will be used. (Default value = 1000000)</span>
<a id="__codelineno-7-115" name="__codelineno-7-115" href="#__codelineno-7-115"></a><span class="sd">    output_mode</span>
<a id="__codelineno-7-116" name="__codelineno-7-116" href="#__codelineno-7-116"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-7-117" name="__codelineno-7-117" href="#__codelineno-7-117"></a><span class="sd">        “replace” option replaces original columns with treated column. “append” option append treated</span>
<a id="__codelineno-7-118" name="__codelineno-7-118" href="#__codelineno-7-118"></a><span class="sd">        column to the input dataset with a postfix &quot;_outliered&quot; e.g. column X is appended as X_outliered. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-7-119" name="__codelineno-7-119" href="#__codelineno-7-119"></a><span class="sd">    print_impact</span>
<a id="__codelineno-7-120" name="__codelineno-7-120" href="#__codelineno-7-120"></a><span class="sd">        True, False</span>
<a id="__codelineno-7-121" name="__codelineno-7-121" href="#__codelineno-7-121"></a><span class="sd">        This argument is to calculate and print out the impact of treatment (if applicable).</span>
<a id="__codelineno-7-122" name="__codelineno-7-122" href="#__codelineno-7-122"></a><span class="sd">        If treatment is False, print_impact should be True to perform detection without treatment. (Default value = False).</span>
<a id="__codelineno-7-123" name="__codelineno-7-123" href="#__codelineno-7-123"></a>
<a id="__codelineno-7-124" name="__codelineno-7-124" href="#__codelineno-7-124"></a><span class="sd">    Returns</span>
<a id="__codelineno-7-125" name="__codelineno-7-125" href="#__codelineno-7-125"></a><span class="sd">    -------</span>
<a id="__codelineno-7-126" name="__codelineno-7-126" href="#__codelineno-7-126"></a><span class="sd">    if print_impact is True:</span>
<a id="__codelineno-7-127" name="__codelineno-7-127" href="#__codelineno-7-127"></a><span class="sd">        odf : DataFrame</span>
<a id="__codelineno-7-128" name="__codelineno-7-128" href="#__codelineno-7-128"></a><span class="sd">            Dataframe with outliers treated if treatment is True, else original input dataframe.</span>
<a id="__codelineno-7-129" name="__codelineno-7-129" href="#__codelineno-7-129"></a><span class="sd">        odf_print : DataFrame</span>
<a id="__codelineno-7-130" name="__codelineno-7-130" href="#__codelineno-7-130"></a><span class="sd">            schema [attribute, lower_outliers, upper_outliers, excluded_due_to_skewness].</span>
<a id="__codelineno-7-131" name="__codelineno-7-131" href="#__codelineno-7-131"></a><span class="sd">            lower_outliers is no. of outliers found in the lower spectrum of the attribute range,</span>
<a id="__codelineno-7-132" name="__codelineno-7-132" href="#__codelineno-7-132"></a><span class="sd">            upper_outliers is outlier count in the upper spectrum, and</span>
<a id="__codelineno-7-133" name="__codelineno-7-133" href="#__codelineno-7-133"></a><span class="sd">            excluded_due_to_skewness is 0 or 1 indicating whether an attribute is excluded from detection due to skewness.</span>
<a id="__codelineno-7-134" name="__codelineno-7-134" href="#__codelineno-7-134"></a><span class="sd">    if print_impact is False:</span>
<a id="__codelineno-7-135" name="__codelineno-7-135" href="#__codelineno-7-135"></a><span class="sd">        odf : DataFrame</span>
<a id="__codelineno-7-136" name="__codelineno-7-136" href="#__codelineno-7-136"></a><span class="sd">            Dataframe with outliers treated if treatment is True, else original input dataframe.</span>
<a id="__codelineno-7-137" name="__codelineno-7-137" href="#__codelineno-7-137"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-7-138" name="__codelineno-7-138" href="#__codelineno-7-138"></a>    <span class="n">column_order</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">columns</span>
<a id="__codelineno-7-139" name="__codelineno-7-139" href="#__codelineno-7-139"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-7-140" name="__codelineno-7-140" href="#__codelineno-7-140"></a>
<a id="__codelineno-7-141" name="__codelineno-7-141" href="#__codelineno-7-141"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">treatment</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-7-142" name="__codelineno-7-142" href="#__codelineno-7-142"></a>        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pre_existing_model</span> <span class="ow">and</span> <span class="n">model_path</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span><span class="p">)</span> <span class="o">|</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-7-143" name="__codelineno-7-143" href="#__codelineno-7-143"></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-7-144" name="__codelineno-7-144" href="#__codelineno-7-144"></a>                <span class="s2">&quot;The original idf will be the only output. Set print_impact=True to perform detection without treatment&quot;</span>
<a id="__codelineno-7-145" name="__codelineno-7-145" href="#__codelineno-7-145"></a>            <span class="p">)</span>
<a id="__codelineno-7-146" name="__codelineno-7-146" href="#__codelineno-7-146"></a>            <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-7-147" name="__codelineno-7-147" href="#__codelineno-7-147"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-7-148" name="__codelineno-7-148" href="#__codelineno-7-148"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-7-149" name="__codelineno-7-149" href="#__codelineno-7-149"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-7-150" name="__codelineno-7-150" href="#__codelineno-7-150"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-7-151" name="__codelineno-7-151" href="#__codelineno-7-151"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-7-152" name="__codelineno-7-152" href="#__codelineno-7-152"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-7-153" name="__codelineno-7-153" href="#__codelineno-7-153"></a>
<a id="__codelineno-7-154" name="__codelineno-7-154" href="#__codelineno-7-154"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-7-155" name="__codelineno-7-155" href="#__codelineno-7-155"></a>
<a id="__codelineno-7-156" name="__codelineno-7-156" href="#__codelineno-7-156"></a>    <span class="n">schema</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">StructType</span><span class="p">(</span>
<a id="__codelineno-7-157" name="__codelineno-7-157" href="#__codelineno-7-157"></a>        <span class="p">[</span>
<a id="__codelineno-7-158" name="__codelineno-7-158" href="#__codelineno-7-158"></a>            <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-7-159" name="__codelineno-7-159" href="#__codelineno-7-159"></a>            <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;lower_outliers&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-7-160" name="__codelineno-7-160" href="#__codelineno-7-160"></a>            <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;upper_outliers&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-7-161" name="__codelineno-7-161" href="#__codelineno-7-161"></a>        <span class="p">]</span>
<a id="__codelineno-7-162" name="__codelineno-7-162" href="#__codelineno-7-162"></a>    <span class="p">)</span>
<a id="__codelineno-7-163" name="__codelineno-7-163" href="#__codelineno-7-163"></a>    <span class="n">empty_odf_print</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">emptyRDD</span><span class="p">()</span><span class="o">.</span><span class="n">toDF</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
<a id="__codelineno-7-164" name="__codelineno-7-164" href="#__codelineno-7-164"></a>
<a id="__codelineno-7-165" name="__codelineno-7-165" href="#__codelineno-7-165"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-7-166" name="__codelineno-7-166" href="#__codelineno-7-166"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No Outlier Check - No numerical column to analyze&quot;</span><span class="p">)</span>
<a id="__codelineno-7-167" name="__codelineno-7-167" href="#__codelineno-7-167"></a>        <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-7-168" name="__codelineno-7-168" href="#__codelineno-7-168"></a>            <span class="n">empty_odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-7-169" name="__codelineno-7-169" href="#__codelineno-7-169"></a>            <span class="k">return</span> <span class="n">idf</span><span class="p">,</span> <span class="n">empty_odf_print</span>
<a id="__codelineno-7-170" name="__codelineno-7-170" href="#__codelineno-7-170"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-171" name="__codelineno-7-171" href="#__codelineno-7-171"></a>            <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-7-172" name="__codelineno-7-172" href="#__codelineno-7-172"></a>
<a id="__codelineno-7-173" name="__codelineno-7-173" href="#__codelineno-7-173"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-7-174" name="__codelineno-7-174" href="#__codelineno-7-174"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-7-175" name="__codelineno-7-175" href="#__codelineno-7-175"></a>    <span class="k">if</span> <span class="n">detection_side</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span> <span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="s2">&quot;both&quot;</span><span class="p">):</span>
<a id="__codelineno-7-176" name="__codelineno-7-176" href="#__codelineno-7-176"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for detection_side&quot;</span><span class="p">)</span>
<a id="__codelineno-7-177" name="__codelineno-7-177" href="#__codelineno-7-177"></a>    <span class="k">if</span> <span class="n">treatment_method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;null_replacement&quot;</span><span class="p">,</span> <span class="s2">&quot;row_removal&quot;</span><span class="p">,</span> <span class="s2">&quot;value_replacement&quot;</span><span class="p">):</span>
<a id="__codelineno-7-178" name="__codelineno-7-178" href="#__codelineno-7-178"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for treatment_method&quot;</span><span class="p">)</span>
<a id="__codelineno-7-179" name="__codelineno-7-179" href="#__codelineno-7-179"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">):</span>
<a id="__codelineno-7-180" name="__codelineno-7-180" href="#__codelineno-7-180"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for output_mode&quot;</span><span class="p">)</span>
<a id="__codelineno-7-181" name="__codelineno-7-181" href="#__codelineno-7-181"></a>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
<a id="__codelineno-7-182" name="__codelineno-7-182" href="#__codelineno-7-182"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-7-183" name="__codelineno-7-183" href="#__codelineno-7-183"></a>    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
<a id="__codelineno-7-184" name="__codelineno-7-184" href="#__codelineno-7-184"></a>        <span class="n">treatment</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-7-185" name="__codelineno-7-185" href="#__codelineno-7-185"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-186" name="__codelineno-7-186" href="#__codelineno-7-186"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Non-Boolean input for treatment&quot;</span><span class="p">)</span>
<a id="__codelineno-7-187" name="__codelineno-7-187" href="#__codelineno-7-187"></a>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_existing_model</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
<a id="__codelineno-7-188" name="__codelineno-7-188" href="#__codelineno-7-188"></a>        <span class="n">pre_existing_model</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-7-189" name="__codelineno-7-189" href="#__codelineno-7-189"></a>    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_existing_model</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
<a id="__codelineno-7-190" name="__codelineno-7-190" href="#__codelineno-7-190"></a>        <span class="n">pre_existing_model</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-7-191" name="__codelineno-7-191" href="#__codelineno-7-191"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-192" name="__codelineno-7-192" href="#__codelineno-7-192"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Non-Boolean input for pre_existing_model&quot;</span><span class="p">)</span>
<a id="__codelineno-7-193" name="__codelineno-7-193" href="#__codelineno-7-193"></a>    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;pctile_lower&quot;</span><span class="p">,</span> <span class="s2">&quot;pctile_upper&quot;</span><span class="p">]:</span>
<a id="__codelineno-7-194" name="__codelineno-7-194" href="#__codelineno-7-194"></a>        <span class="k">if</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">detection_configs</span><span class="p">:</span>
<a id="__codelineno-7-195" name="__codelineno-7-195" href="#__codelineno-7-195"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">detection_configs</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">detection_configs</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-7-196" name="__codelineno-7-196" href="#__codelineno-7-196"></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for &quot;</span> <span class="o">+</span> <span class="n">arg</span><span class="p">)</span>
<a id="__codelineno-7-197" name="__codelineno-7-197" href="#__codelineno-7-197"></a>
<a id="__codelineno-7-198" name="__codelineno-7-198" href="#__codelineno-7-198"></a>    <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-7-199" name="__codelineno-7-199" href="#__codelineno-7-199"></a>        <span class="n">df_model</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/outlier_numcols&quot;</span><span class="p">)</span>
<a id="__codelineno-7-200" name="__codelineno-7-200" href="#__codelineno-7-200"></a>        <span class="n">model_dict_list</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-7-201" name="__codelineno-7-201" href="#__codelineno-7-201"></a>            <span class="n">df_model</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-7-202" name="__codelineno-7-202" href="#__codelineno-7-202"></a>            <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="p">{</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
<a id="__codelineno-7-203" name="__codelineno-7-203" href="#__codelineno-7-203"></a>            <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-7-204" name="__codelineno-7-204" href="#__codelineno-7-204"></a>        <span class="p">)</span>
<a id="__codelineno-7-205" name="__codelineno-7-205" href="#__codelineno-7-205"></a>        <span class="n">model_dict</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-7-206" name="__codelineno-7-206" href="#__codelineno-7-206"></a>        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">model_dict_list</span><span class="p">:</span>
<a id="__codelineno-7-207" name="__codelineno-7-207" href="#__codelineno-7-207"></a>            <span class="n">model_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-7-208" name="__codelineno-7-208" href="#__codelineno-7-208"></a>
<a id="__codelineno-7-209" name="__codelineno-7-209" href="#__codelineno-7-209"></a>        <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-7-210" name="__codelineno-7-210" href="#__codelineno-7-210"></a>        <span class="n">present_cols</span><span class="p">,</span> <span class="n">skewed_cols</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<a id="__codelineno-7-211" name="__codelineno-7-211" href="#__codelineno-7-211"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-7-212" name="__codelineno-7-212" href="#__codelineno-7-212"></a>            <span class="n">param</span> <span class="o">=</span> <span class="n">model_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-7-213" name="__codelineno-7-213" href="#__codelineno-7-213"></a>            <span class="k">if</span> <span class="n">param</span><span class="p">:</span>
<a id="__codelineno-7-214" name="__codelineno-7-214" href="#__codelineno-7-214"></a>                <span class="k">if</span> <span class="s2">&quot;skewed_attribute&quot;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
<a id="__codelineno-7-215" name="__codelineno-7-215" href="#__codelineno-7-215"></a>                    <span class="n">skewed_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-7-216" name="__codelineno-7-216" href="#__codelineno-7-216"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-217" name="__codelineno-7-217" href="#__codelineno-7-217"></a>                    <span class="n">param</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span> <span class="k">else</span> <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">param</span><span class="p">]</span>
<a id="__codelineno-7-218" name="__codelineno-7-218" href="#__codelineno-7-218"></a>                    <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
<a id="__codelineno-7-219" name="__codelineno-7-219" href="#__codelineno-7-219"></a>                    <span class="n">present_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-7-220" name="__codelineno-7-220" href="#__codelineno-7-220"></a>
<a id="__codelineno-7-221" name="__codelineno-7-221" href="#__codelineno-7-221"></a>        <span class="n">diff_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">present_cols</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">skewed_cols</span><span class="p">))</span>
<a id="__codelineno-7-222" name="__codelineno-7-222" href="#__codelineno-7-222"></a>        <span class="k">if</span> <span class="n">diff_cols</span><span class="p">:</span>
<a id="__codelineno-7-223" name="__codelineno-7-223" href="#__codelineno-7-223"></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Columns not found in model_path: &quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">diff_cols</span><span class="p">))</span>
<a id="__codelineno-7-224" name="__codelineno-7-224" href="#__codelineno-7-224"></a>        <span class="k">if</span> <span class="n">skewed_cols</span><span class="p">:</span>
<a id="__codelineno-7-225" name="__codelineno-7-225" href="#__codelineno-7-225"></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-7-226" name="__codelineno-7-226" href="#__codelineno-7-226"></a>                <span class="s2">&quot;Columns excluded from outlier detection due to highly skewed distribution: &quot;</span>
<a id="__codelineno-7-227" name="__codelineno-7-227" href="#__codelineno-7-227"></a>                <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">skewed_cols</span><span class="p">)</span>
<a id="__codelineno-7-228" name="__codelineno-7-228" href="#__codelineno-7-228"></a>            <span class="p">)</span>
<a id="__codelineno-7-229" name="__codelineno-7-229" href="#__codelineno-7-229"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">present_cols</span>
<a id="__codelineno-7-230" name="__codelineno-7-230" href="#__codelineno-7-230"></a>
<a id="__codelineno-7-231" name="__codelineno-7-231" href="#__codelineno-7-231"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-7-232" name="__codelineno-7-232" href="#__codelineno-7-232"></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No Outlier Check - No numerical column to analyze&quot;</span><span class="p">)</span>
<a id="__codelineno-7-233" name="__codelineno-7-233" href="#__codelineno-7-233"></a>            <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-7-234" name="__codelineno-7-234" href="#__codelineno-7-234"></a>                <span class="n">empty_odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-7-235" name="__codelineno-7-235" href="#__codelineno-7-235"></a>                <span class="k">return</span> <span class="n">idf</span><span class="p">,</span> <span class="n">empty_odf_print</span>
<a id="__codelineno-7-236" name="__codelineno-7-236" href="#__codelineno-7-236"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-237" name="__codelineno-7-237" href="#__codelineno-7-237"></a>                <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-7-238" name="__codelineno-7-238" href="#__codelineno-7-238"></a>
<a id="__codelineno-7-239" name="__codelineno-7-239" href="#__codelineno-7-239"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-240" name="__codelineno-7-240" href="#__codelineno-7-240"></a>        <span class="n">check_dict</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-7-241" name="__codelineno-7-241" href="#__codelineno-7-241"></a>            <span class="s2">&quot;pctile&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lower&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;upper&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
<a id="__codelineno-7-242" name="__codelineno-7-242" href="#__codelineno-7-242"></a>            <span class="s2">&quot;stdev&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lower&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;upper&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
<a id="__codelineno-7-243" name="__codelineno-7-243" href="#__codelineno-7-243"></a>            <span class="s2">&quot;IQR&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lower&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;upper&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
<a id="__codelineno-7-244" name="__codelineno-7-244" href="#__codelineno-7-244"></a>        <span class="p">}</span>
<a id="__codelineno-7-245" name="__codelineno-7-245" href="#__codelineno-7-245"></a>        <span class="n">side_mapping</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-7-246" name="__codelineno-7-246" href="#__codelineno-7-246"></a>            <span class="s2">&quot;lower&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;lower&quot;</span><span class="p">],</span>
<a id="__codelineno-7-247" name="__codelineno-7-247" href="#__codelineno-7-247"></a>            <span class="s2">&quot;upper&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;upper&quot;</span><span class="p">],</span>
<a id="__codelineno-7-248" name="__codelineno-7-248" href="#__codelineno-7-248"></a>            <span class="s2">&quot;both&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="s2">&quot;upper&quot;</span><span class="p">],</span>
<a id="__codelineno-7-249" name="__codelineno-7-249" href="#__codelineno-7-249"></a>        <span class="p">}</span>
<a id="__codelineno-7-250" name="__codelineno-7-250" href="#__codelineno-7-250"></a>
<a id="__codelineno-7-251" name="__codelineno-7-251" href="#__codelineno-7-251"></a>        <span class="k">for</span> <span class="n">methodology</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;pctile&quot;</span><span class="p">,</span> <span class="s2">&quot;stdev&quot;</span><span class="p">,</span> <span class="s2">&quot;IQR&quot;</span><span class="p">]:</span>
<a id="__codelineno-7-252" name="__codelineno-7-252" href="#__codelineno-7-252"></a>            <span class="k">for</span> <span class="n">side</span> <span class="ow">in</span> <span class="n">side_mapping</span><span class="p">[</span><span class="n">detection_side</span><span class="p">]:</span>
<a id="__codelineno-7-253" name="__codelineno-7-253" href="#__codelineno-7-253"></a>                <span class="k">if</span> <span class="n">methodology</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">side</span> <span class="ow">in</span> <span class="n">detection_configs</span><span class="p">:</span>
<a id="__codelineno-7-254" name="__codelineno-7-254" href="#__codelineno-7-254"></a>                    <span class="n">check_dict</span><span class="p">[</span><span class="n">methodology</span><span class="p">][</span><span class="n">side</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-7-255" name="__codelineno-7-255" href="#__codelineno-7-255"></a>
<a id="__codelineno-7-256" name="__codelineno-7-256" href="#__codelineno-7-256"></a>        <span class="n">methodologies</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-7-257" name="__codelineno-7-257" href="#__codelineno-7-257"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">check_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
<a id="__codelineno-7-258" name="__codelineno-7-258" href="#__codelineno-7-258"></a>            <span class="n">val_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<a id="__codelineno-7-259" name="__codelineno-7-259" href="#__codelineno-7-259"></a>            <span class="k">if</span> <span class="n">detection_side</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span><span class="p">:</span>
<a id="__codelineno-7-260" name="__codelineno-7-260" href="#__codelineno-7-260"></a>                <span class="k">if</span> <span class="n">val_list</span> <span class="ow">in</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
<a id="__codelineno-7-261" name="__codelineno-7-261" href="#__codelineno-7-261"></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<a id="__codelineno-7-262" name="__codelineno-7-262" href="#__codelineno-7-262"></a>                        <span class="s2">&quot;Invalid input for detection_configs. If detection_side is &#39;both&#39;, the methodologies used on both sides should be the same&quot;</span>
<a id="__codelineno-7-263" name="__codelineno-7-263" href="#__codelineno-7-263"></a>                    <span class="p">)</span>
<a id="__codelineno-7-264" name="__codelineno-7-264" href="#__codelineno-7-264"></a>                <span class="k">if</span> <span class="n">val_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-7-265" name="__codelineno-7-265" href="#__codelineno-7-265"></a>                    <span class="n">methodologies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<a id="__codelineno-7-266" name="__codelineno-7-266" href="#__codelineno-7-266"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-267" name="__codelineno-7-267" href="#__codelineno-7-267"></a>                <span class="k">if</span> <span class="n">val</span><span class="p">[</span><span class="n">detection_side</span><span class="p">]:</span>
<a id="__codelineno-7-268" name="__codelineno-7-268" href="#__codelineno-7-268"></a>                    <span class="n">methodologies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<a id="__codelineno-7-269" name="__codelineno-7-269" href="#__codelineno-7-269"></a>        <span class="n">num_methodologies</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">methodologies</span><span class="p">)</span>
<a id="__codelineno-7-270" name="__codelineno-7-270" href="#__codelineno-7-270"></a>
<a id="__codelineno-7-271" name="__codelineno-7-271" href="#__codelineno-7-271"></a>        <span class="k">if</span> <span class="s2">&quot;min_validation&quot;</span> <span class="ow">in</span> <span class="n">detection_configs</span><span class="p">:</span>
<a id="__codelineno-7-272" name="__codelineno-7-272" href="#__codelineno-7-272"></a>            <span class="k">if</span> <span class="n">detection_configs</span><span class="p">[</span><span class="s2">&quot;min_validation&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">num_methodologies</span><span class="p">:</span>
<a id="__codelineno-7-273" name="__codelineno-7-273" href="#__codelineno-7-273"></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<a id="__codelineno-7-274" name="__codelineno-7-274" href="#__codelineno-7-274"></a>                    <span class="s2">&quot;Invalid input for min_validation of detection_configs. It cannot be larger than the total number of methodologies on any side that detection will be applied over.&quot;</span>
<a id="__codelineno-7-275" name="__codelineno-7-275" href="#__codelineno-7-275"></a>                <span class="p">)</span>
<a id="__codelineno-7-276" name="__codelineno-7-276" href="#__codelineno-7-276"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-277" name="__codelineno-7-277" href="#__codelineno-7-277"></a>            <span class="c1"># if min_validation is not present, num of specified methodologies will be used</span>
<a id="__codelineno-7-278" name="__codelineno-7-278" href="#__codelineno-7-278"></a>            <span class="n">detection_configs</span><span class="p">[</span><span class="s2">&quot;min_validation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_methodologies</span>
<a id="__codelineno-7-279" name="__codelineno-7-279" href="#__codelineno-7-279"></a>
<a id="__codelineno-7-280" name="__codelineno-7-280" href="#__codelineno-7-280"></a>        <span class="n">empty_params</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-7-281" name="__codelineno-7-281" href="#__codelineno-7-281"></a>
<a id="__codelineno-7-282" name="__codelineno-7-282" href="#__codelineno-7-282"></a>        <span class="n">idf_count</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-7-283" name="__codelineno-7-283" href="#__codelineno-7-283"></a>        <span class="k">if</span> <span class="n">idf_count</span> <span class="o">&gt;</span> <span class="n">sample_size</span><span class="p">:</span>
<a id="__codelineno-7-284" name="__codelineno-7-284" href="#__codelineno-7-284"></a>            <span class="n">idf_sample</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">sample_size</span> <span class="o">/</span> <span class="n">idf_count</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-7-285" name="__codelineno-7-285" href="#__codelineno-7-285"></a>                <span class="n">list_of_cols</span>
<a id="__codelineno-7-286" name="__codelineno-7-286" href="#__codelineno-7-286"></a>            <span class="p">)</span>
<a id="__codelineno-7-287" name="__codelineno-7-287" href="#__codelineno-7-287"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-288" name="__codelineno-7-288" href="#__codelineno-7-288"></a>            <span class="n">idf_sample</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-7-289" name="__codelineno-7-289" href="#__codelineno-7-289"></a>
<a id="__codelineno-7-290" name="__codelineno-7-290" href="#__codelineno-7-290"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-7-291" name="__codelineno-7-291" href="#__codelineno-7-291"></a>            <span class="k">if</span> <span class="n">get_dtype</span><span class="p">(</span><span class="n">idf_sample</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;decimal&quot;</span><span class="p">):</span>
<a id="__codelineno-7-292" name="__codelineno-7-292" href="#__codelineno-7-292"></a>                <span class="n">idf_sample</span> <span class="o">=</span> <span class="n">idf_sample</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">DoubleType</span><span class="p">()))</span>
<a id="__codelineno-7-293" name="__codelineno-7-293" href="#__codelineno-7-293"></a>
<a id="__codelineno-7-294" name="__codelineno-7-294" href="#__codelineno-7-294"></a>        <span class="n">pctiles</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-7-295" name="__codelineno-7-295" href="#__codelineno-7-295"></a>            <span class="n">detection_configs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pctile_lower&quot;</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
<a id="__codelineno-7-296" name="__codelineno-7-296" href="#__codelineno-7-296"></a>            <span class="n">detection_configs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pctile_upper&quot;</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">),</span>
<a id="__codelineno-7-297" name="__codelineno-7-297" href="#__codelineno-7-297"></a>        <span class="p">]</span>
<a id="__codelineno-7-298" name="__codelineno-7-298" href="#__codelineno-7-298"></a>        <span class="n">pctile_params</span> <span class="o">=</span> <span class="n">idf_sample</span><span class="o">.</span><span class="n">approxQuantile</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="n">pctiles</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-7-299" name="__codelineno-7-299" href="#__codelineno-7-299"></a>        <span class="n">skewed_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-7-300" name="__codelineno-7-300" href="#__codelineno-7-300"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="n">pctile_params</span><span class="p">):</span>
<a id="__codelineno-7-301" name="__codelineno-7-301" href="#__codelineno-7-301"></a>            <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-7-302" name="__codelineno-7-302" href="#__codelineno-7-302"></a>                <span class="n">skewed_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-7-303" name="__codelineno-7-303" href="#__codelineno-7-303"></a>
<a id="__codelineno-7-304" name="__codelineno-7-304" href="#__codelineno-7-304"></a>        <span class="k">if</span> <span class="n">skewed_cols</span><span class="p">:</span>
<a id="__codelineno-7-305" name="__codelineno-7-305" href="#__codelineno-7-305"></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-7-306" name="__codelineno-7-306" href="#__codelineno-7-306"></a>                <span class="s2">&quot;Columns excluded from outlier detection due to highly skewed distribution: &quot;</span>
<a id="__codelineno-7-307" name="__codelineno-7-307" href="#__codelineno-7-307"></a>                <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">skewed_cols</span><span class="p">)</span>
<a id="__codelineno-7-308" name="__codelineno-7-308" href="#__codelineno-7-308"></a>            <span class="p">)</span>
<a id="__codelineno-7-309" name="__codelineno-7-309" href="#__codelineno-7-309"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">skewed_cols</span><span class="p">:</span>
<a id="__codelineno-7-310" name="__codelineno-7-310" href="#__codelineno-7-310"></a>                <span class="n">idx</span> <span class="o">=</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-7-311" name="__codelineno-7-311" href="#__codelineno-7-311"></a>                <span class="n">list_of_cols</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
<a id="__codelineno-7-312" name="__codelineno-7-312" href="#__codelineno-7-312"></a>                <span class="n">pctile_params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
<a id="__codelineno-7-313" name="__codelineno-7-313" href="#__codelineno-7-313"></a>
<a id="__codelineno-7-314" name="__codelineno-7-314" href="#__codelineno-7-314"></a>        <span class="k">if</span> <span class="s2">&quot;pctile&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">methodologies</span><span class="p">:</span>
<a id="__codelineno-7-315" name="__codelineno-7-315" href="#__codelineno-7-315"></a>            <span class="n">pctile_params</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">empty_params</span><span class="p">)</span>
<a id="__codelineno-7-316" name="__codelineno-7-316" href="#__codelineno-7-316"></a>
<a id="__codelineno-7-317" name="__codelineno-7-317" href="#__codelineno-7-317"></a>        <span class="k">if</span> <span class="s2">&quot;stdev&quot;</span> <span class="ow">in</span> <span class="n">methodologies</span><span class="p">:</span>
<a id="__codelineno-7-318" name="__codelineno-7-318" href="#__codelineno-7-318"></a>            <span class="n">exprs</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="n">F</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">stddev</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">]</span>
<a id="__codelineno-7-319" name="__codelineno-7-319" href="#__codelineno-7-319"></a>            <span class="n">stats</span> <span class="o">=</span> <span class="n">idf_sample</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">exprs</span><span class="p">)</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-7-320" name="__codelineno-7-320" href="#__codelineno-7-320"></a>
<a id="__codelineno-7-321" name="__codelineno-7-321" href="#__codelineno-7-321"></a>            <span class="n">mean</span><span class="p">,</span> <span class="n">stdev</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)],</span> <span class="n">stats</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="p">:]</span>
<a id="__codelineno-7-322" name="__codelineno-7-322" href="#__codelineno-7-322"></a>            <span class="n">stdev_lower</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span> <span class="o">-</span> <span class="n">detection_configs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-7-323" name="__codelineno-7-323" href="#__codelineno-7-323"></a>                <span class="s2">&quot;stdev_lower&quot;</span><span class="p">,</span> <span class="mf">0.0</span>
<a id="__codelineno-7-324" name="__codelineno-7-324" href="#__codelineno-7-324"></a>            <span class="p">)</span> <span class="o">*</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">stdev</span><span class="p">)</span>
<a id="__codelineno-7-325" name="__codelineno-7-325" href="#__codelineno-7-325"></a>            <span class="n">stdev_upper</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span> <span class="o">+</span> <span class="n">detection_configs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-7-326" name="__codelineno-7-326" href="#__codelineno-7-326"></a>                <span class="s2">&quot;stdev_upper&quot;</span><span class="p">,</span> <span class="mf">0.0</span>
<a id="__codelineno-7-327" name="__codelineno-7-327" href="#__codelineno-7-327"></a>            <span class="p">)</span> <span class="o">*</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">stdev</span><span class="p">)</span>
<a id="__codelineno-7-328" name="__codelineno-7-328" href="#__codelineno-7-328"></a>            <span class="n">stdev_params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">stdev_lower</span><span class="p">,</span> <span class="n">stdev_upper</span><span class="p">))</span>
<a id="__codelineno-7-329" name="__codelineno-7-329" href="#__codelineno-7-329"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-330" name="__codelineno-7-330" href="#__codelineno-7-330"></a>            <span class="n">stdev_params</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">empty_params</span><span class="p">)</span>
<a id="__codelineno-7-331" name="__codelineno-7-331" href="#__codelineno-7-331"></a>
<a id="__codelineno-7-332" name="__codelineno-7-332" href="#__codelineno-7-332"></a>        <span class="k">if</span> <span class="s2">&quot;IQR&quot;</span> <span class="ow">in</span> <span class="n">methodologies</span><span class="p">:</span>
<a id="__codelineno-7-333" name="__codelineno-7-333" href="#__codelineno-7-333"></a>            <span class="n">quantiles</span> <span class="o">=</span> <span class="n">idf_sample</span><span class="o">.</span><span class="n">approxQuantile</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">],</span> <span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-7-334" name="__codelineno-7-334" href="#__codelineno-7-334"></a>            <span class="n">IQR_params</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-7-335" name="__codelineno-7-335" href="#__codelineno-7-335"></a>                <span class="p">[</span>
<a id="__codelineno-7-336" name="__codelineno-7-336" href="#__codelineno-7-336"></a>                    <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">detection_configs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;IQR_lower&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-7-337" name="__codelineno-7-337" href="#__codelineno-7-337"></a>                    <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">detection_configs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;IQR_upper&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-7-338" name="__codelineno-7-338" href="#__codelineno-7-338"></a>                <span class="p">]</span>
<a id="__codelineno-7-339" name="__codelineno-7-339" href="#__codelineno-7-339"></a>                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">quantiles</span>
<a id="__codelineno-7-340" name="__codelineno-7-340" href="#__codelineno-7-340"></a>            <span class="p">]</span>
<a id="__codelineno-7-341" name="__codelineno-7-341" href="#__codelineno-7-341"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-342" name="__codelineno-7-342" href="#__codelineno-7-342"></a>            <span class="n">IQR_params</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">empty_params</span><span class="p">)</span>
<a id="__codelineno-7-343" name="__codelineno-7-343" href="#__codelineno-7-343"></a>
<a id="__codelineno-7-344" name="__codelineno-7-344" href="#__codelineno-7-344"></a>        <span class="n">n</span> <span class="o">=</span> <span class="n">detection_configs</span><span class="p">[</span><span class="s2">&quot;min_validation&quot;</span><span class="p">]</span>
<a id="__codelineno-7-345" name="__codelineno-7-345" href="#__codelineno-7-345"></a>        <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-7-346" name="__codelineno-7-346" href="#__codelineno-7-346"></a>        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">pctile_params</span><span class="p">,</span> <span class="n">stdev_params</span><span class="p">,</span> <span class="n">IQR_params</span><span class="p">)):</span>
<a id="__codelineno-7-347" name="__codelineno-7-347" href="#__codelineno-7-347"></a>            <span class="n">lower</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
<a id="__codelineno-7-348" name="__codelineno-7-348" href="#__codelineno-7-348"></a>                <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-7-349" name="__codelineno-7-349" href="#__codelineno-7-349"></a>            <span class="p">)[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-7-350" name="__codelineno-7-350" href="#__codelineno-7-350"></a>            <span class="n">upper</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-7-351" name="__codelineno-7-351" href="#__codelineno-7-351"></a>            <span class="k">if</span> <span class="n">detection_side</span> <span class="o">==</span> <span class="s2">&quot;lower&quot;</span><span class="p">:</span>
<a id="__codelineno-7-352" name="__codelineno-7-352" href="#__codelineno-7-352"></a>                <span class="n">param</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-7-353" name="__codelineno-7-353" href="#__codelineno-7-353"></a>            <span class="k">elif</span> <span class="n">detection_side</span> <span class="o">==</span> <span class="s2">&quot;upper&quot;</span><span class="p">:</span>
<a id="__codelineno-7-354" name="__codelineno-7-354" href="#__codelineno-7-354"></a>                <span class="n">param</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">upper</span><span class="p">]</span>
<a id="__codelineno-7-355" name="__codelineno-7-355" href="#__codelineno-7-355"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-356" name="__codelineno-7-356" href="#__codelineno-7-356"></a>                <span class="n">param</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">]</span>
<a id="__codelineno-7-357" name="__codelineno-7-357" href="#__codelineno-7-357"></a>            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
<a id="__codelineno-7-358" name="__codelineno-7-358" href="#__codelineno-7-358"></a>
<a id="__codelineno-7-359" name="__codelineno-7-359" href="#__codelineno-7-359"></a>        <span class="c1"># Saving model File if required</span>
<a id="__codelineno-7-360" name="__codelineno-7-360" href="#__codelineno-7-360"></a>        <span class="k">if</span> <span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span>
<a id="__codelineno-7-361" name="__codelineno-7-361" href="#__codelineno-7-361"></a>            <span class="k">if</span> <span class="n">detection_side</span> <span class="o">==</span> <span class="s2">&quot;lower&quot;</span><span class="p">:</span>
<a id="__codelineno-7-362" name="__codelineno-7-362" href="#__codelineno-7-362"></a>                <span class="n">skewed_param</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;skewed_attribute&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-7-363" name="__codelineno-7-363" href="#__codelineno-7-363"></a>            <span class="k">elif</span> <span class="n">detection_side</span> <span class="o">==</span> <span class="s2">&quot;upper&quot;</span><span class="p">:</span>
<a id="__codelineno-7-364" name="__codelineno-7-364" href="#__codelineno-7-364"></a>                <span class="n">skewed_param</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;skewed_attribute&quot;</span><span class="p">]</span>
<a id="__codelineno-7-365" name="__codelineno-7-365" href="#__codelineno-7-365"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-366" name="__codelineno-7-366" href="#__codelineno-7-366"></a>                <span class="n">skewed_param</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;skewed_attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;skewed_attribute&quot;</span><span class="p">]</span>
<a id="__codelineno-7-367" name="__codelineno-7-367" href="#__codelineno-7-367"></a>
<a id="__codelineno-7-368" name="__codelineno-7-368" href="#__codelineno-7-368"></a>            <span class="n">schema</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">StructType</span><span class="p">(</span>
<a id="__codelineno-7-369" name="__codelineno-7-369" href="#__codelineno-7-369"></a>                <span class="p">[</span>
<a id="__codelineno-7-370" name="__codelineno-7-370" href="#__codelineno-7-370"></a>                    <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-7-371" name="__codelineno-7-371" href="#__codelineno-7-371"></a>                    <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;parameters&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">ArrayType</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">()),</span> <span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-7-372" name="__codelineno-7-372" href="#__codelineno-7-372"></a>                <span class="p">]</span>
<a id="__codelineno-7-373" name="__codelineno-7-373" href="#__codelineno-7-373"></a>            <span class="p">)</span>
<a id="__codelineno-7-374" name="__codelineno-7-374" href="#__codelineno-7-374"></a>            <span class="n">df_model</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
<a id="__codelineno-7-375" name="__codelineno-7-375" href="#__codelineno-7-375"></a>                <span class="nb">zip</span><span class="p">(</span>
<a id="__codelineno-7-376" name="__codelineno-7-376" href="#__codelineno-7-376"></a>                    <span class="n">list_of_cols</span> <span class="o">+</span> <span class="n">skewed_cols</span><span class="p">,</span>
<a id="__codelineno-7-377" name="__codelineno-7-377" href="#__codelineno-7-377"></a>                    <span class="n">params</span> <span class="o">+</span> <span class="p">[</span><span class="n">skewed_param</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">skewed_cols</span><span class="p">),</span>
<a id="__codelineno-7-378" name="__codelineno-7-378" href="#__codelineno-7-378"></a>                <span class="p">),</span>
<a id="__codelineno-7-379" name="__codelineno-7-379" href="#__codelineno-7-379"></a>                <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
<a id="__codelineno-7-380" name="__codelineno-7-380" href="#__codelineno-7-380"></a>            <span class="p">)</span>
<a id="__codelineno-7-381" name="__codelineno-7-381" href="#__codelineno-7-381"></a>            <span class="n">df_model</span><span class="o">.</span><span class="n">coalesce</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span>
<a id="__codelineno-7-382" name="__codelineno-7-382" href="#__codelineno-7-382"></a>                <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/outlier_numcols&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span>
<a id="__codelineno-7-383" name="__codelineno-7-383" href="#__codelineno-7-383"></a>            <span class="p">)</span>
<a id="__codelineno-7-384" name="__codelineno-7-384" href="#__codelineno-7-384"></a>
<a id="__codelineno-7-385" name="__codelineno-7-385" href="#__codelineno-7-385"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">treatment</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-7-386" name="__codelineno-7-386" href="#__codelineno-7-386"></a>                <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-7-387" name="__codelineno-7-387" href="#__codelineno-7-387"></a>
<a id="__codelineno-7-388" name="__codelineno-7-388" href="#__codelineno-7-388"></a>    <span class="k">def</span> <span class="nf">composite_outlier_pandas</span><span class="p">(</span><span class="n">col_param</span><span class="p">):</span>
<a id="__codelineno-7-389" name="__codelineno-7-389" href="#__codelineno-7-389"></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
<a id="__codelineno-7-390" name="__codelineno-7-390" href="#__codelineno-7-390"></a>            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;raise&quot;</span><span class="p">)</span>
<a id="__codelineno-7-391" name="__codelineno-7-391" href="#__codelineno-7-391"></a>            <span class="k">if</span> <span class="n">detection_side</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="s2">&quot;both&quot;</span><span class="p">):</span>
<a id="__codelineno-7-392" name="__codelineno-7-392" href="#__codelineno-7-392"></a>                <span class="n">lower_v</span> <span class="o">=</span> <span class="p">((</span><span class="n">v</span> <span class="o">-</span> <span class="n">col_param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-7-393" name="__codelineno-7-393" href="#__codelineno-7-393"></a>            <span class="k">if</span> <span class="n">detection_side</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span> <span class="s2">&quot;both&quot;</span><span class="p">):</span>
<a id="__codelineno-7-394" name="__codelineno-7-394" href="#__codelineno-7-394"></a>                <span class="n">upper_v</span> <span class="o">=</span> <span class="p">((</span><span class="n">v</span> <span class="o">-</span> <span class="n">col_param</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-7-395" name="__codelineno-7-395" href="#__codelineno-7-395"></a>
<a id="__codelineno-7-396" name="__codelineno-7-396" href="#__codelineno-7-396"></a>            <span class="k">if</span> <span class="n">detection_side</span> <span class="o">==</span> <span class="s2">&quot;upper&quot;</span><span class="p">:</span>
<a id="__codelineno-7-397" name="__codelineno-7-397" href="#__codelineno-7-397"></a>                <span class="k">return</span> <span class="n">upper_v</span>
<a id="__codelineno-7-398" name="__codelineno-7-398" href="#__codelineno-7-398"></a>            <span class="k">elif</span> <span class="n">detection_side</span> <span class="o">==</span> <span class="s2">&quot;lower&quot;</span><span class="p">:</span>
<a id="__codelineno-7-399" name="__codelineno-7-399" href="#__codelineno-7-399"></a>                <span class="k">return</span> <span class="n">lower_v</span>
<a id="__codelineno-7-400" name="__codelineno-7-400" href="#__codelineno-7-400"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-401" name="__codelineno-7-401" href="#__codelineno-7-401"></a>                <span class="k">return</span> <span class="n">lower_v</span> <span class="o">+</span> <span class="n">upper_v</span>
<a id="__codelineno-7-402" name="__codelineno-7-402" href="#__codelineno-7-402"></a>
<a id="__codelineno-7-403" name="__codelineno-7-403" href="#__codelineno-7-403"></a>        <span class="k">return</span> <span class="n">inner</span>
<a id="__codelineno-7-404" name="__codelineno-7-404" href="#__codelineno-7-404"></a>
<a id="__codelineno-7-405" name="__codelineno-7-405" href="#__codelineno-7-405"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-7-406" name="__codelineno-7-406" href="#__codelineno-7-406"></a>
<a id="__codelineno-7-407" name="__codelineno-7-407" href="#__codelineno-7-407"></a>    <span class="n">list_odf</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-7-408" name="__codelineno-7-408" href="#__codelineno-7-408"></a>    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-7-409" name="__codelineno-7-409" href="#__codelineno-7-409"></a>        <span class="n">f_composite_outlier</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">pandas_udf</span><span class="p">(</span>
<a id="__codelineno-7-410" name="__codelineno-7-410" href="#__codelineno-7-410"></a>            <span class="n">composite_outlier_pandas</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">index</span><span class="p">]),</span> <span class="n">returnType</span><span class="o">=</span><span class="n">T</span><span class="o">.</span><span class="n">IntegerType</span><span class="p">()</span>
<a id="__codelineno-7-411" name="__codelineno-7-411" href="#__codelineno-7-411"></a>        <span class="p">)</span>
<a id="__codelineno-7-412" name="__codelineno-7-412" href="#__codelineno-7-412"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_outliered&quot;</span><span class="p">,</span> <span class="n">f_composite_outlier</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a id="__codelineno-7-413" name="__codelineno-7-413" href="#__codelineno-7-413"></a>
<a id="__codelineno-7-414" name="__codelineno-7-414" href="#__codelineno-7-414"></a>        <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-7-415" name="__codelineno-7-415" href="#__codelineno-7-415"></a>            <span class="n">odf_agg_col</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-7-416" name="__codelineno-7-416" href="#__codelineno-7-416"></a>                <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_outliered&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">()</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_outliered&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-7-417" name="__codelineno-7-417" href="#__codelineno-7-417"></a>            <span class="p">)</span>
<a id="__codelineno-7-418" name="__codelineno-7-418" href="#__codelineno-7-418"></a>            <span class="n">odf_print_col</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-7-419" name="__codelineno-7-419" href="#__codelineno-7-419"></a>                <span class="n">odf_agg_col</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-7-420" name="__codelineno-7-420" href="#__codelineno-7-420"></a>                    <span class="s2">&quot;lower_outliers&quot;</span><span class="p">,</span>
<a id="__codelineno-7-421" name="__codelineno-7-421" href="#__codelineno-7-421"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;-1&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;-1&quot;</span> <span class="ow">in</span> <span class="n">odf_agg_col</span><span class="o">.</span><span class="n">columns</span> <span class="k">else</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-7-422" name="__codelineno-7-422" href="#__codelineno-7-422"></a>                <span class="p">)</span>
<a id="__codelineno-7-423" name="__codelineno-7-423" href="#__codelineno-7-423"></a>                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-7-424" name="__codelineno-7-424" href="#__codelineno-7-424"></a>                    <span class="s2">&quot;upper_outliers&quot;</span><span class="p">,</span>
<a id="__codelineno-7-425" name="__codelineno-7-425" href="#__codelineno-7-425"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;1&quot;</span> <span class="ow">in</span> <span class="n">odf_agg_col</span><span class="o">.</span><span class="n">columns</span> <span class="k">else</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-7-426" name="__codelineno-7-426" href="#__codelineno-7-426"></a>                <span class="p">)</span>
<a id="__codelineno-7-427" name="__codelineno-7-427" href="#__codelineno-7-427"></a>                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;excluded_due_to_skewness&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-7-428" name="__codelineno-7-428" href="#__codelineno-7-428"></a>                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
<a id="__codelineno-7-429" name="__codelineno-7-429" href="#__codelineno-7-429"></a>                <span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-7-430" name="__codelineno-7-430" href="#__codelineno-7-430"></a>                    <span class="s2">&quot;attribute&quot;</span><span class="p">,</span>
<a id="__codelineno-7-431" name="__codelineno-7-431" href="#__codelineno-7-431"></a>                    <span class="s2">&quot;lower_outliers&quot;</span><span class="p">,</span>
<a id="__codelineno-7-432" name="__codelineno-7-432" href="#__codelineno-7-432"></a>                    <span class="s2">&quot;upper_outliers&quot;</span><span class="p">,</span>
<a id="__codelineno-7-433" name="__codelineno-7-433" href="#__codelineno-7-433"></a>                    <span class="s2">&quot;excluded_due_to_skewness&quot;</span><span class="p">,</span>
<a id="__codelineno-7-434" name="__codelineno-7-434" href="#__codelineno-7-434"></a>                <span class="p">)</span>
<a id="__codelineno-7-435" name="__codelineno-7-435" href="#__codelineno-7-435"></a>                <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-7-436" name="__codelineno-7-436" href="#__codelineno-7-436"></a>            <span class="p">)</span>
<a id="__codelineno-7-437" name="__codelineno-7-437" href="#__codelineno-7-437"></a>            <span class="n">list_odf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">odf_print_col</span><span class="p">)</span>
<a id="__codelineno-7-438" name="__codelineno-7-438" href="#__codelineno-7-438"></a>
<a id="__codelineno-7-439" name="__codelineno-7-439" href="#__codelineno-7-439"></a>        <span class="k">if</span> <span class="n">treatment</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">treatment_method</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;value_replacement&quot;</span><span class="p">,</span> <span class="s2">&quot;null_replacement&quot;</span><span class="p">)):</span>
<a id="__codelineno-7-440" name="__codelineno-7-440" href="#__codelineno-7-440"></a>            <span class="n">replace_vals</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-7-441" name="__codelineno-7-441" href="#__codelineno-7-441"></a>                <span class="s2">&quot;value_replacement&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span>
<a id="__codelineno-7-442" name="__codelineno-7-442" href="#__codelineno-7-442"></a>                <span class="s2">&quot;null_replacement&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-7-443" name="__codelineno-7-443" href="#__codelineno-7-443"></a>            <span class="p">}</span>
<a id="__codelineno-7-444" name="__codelineno-7-444" href="#__codelineno-7-444"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-7-445" name="__codelineno-7-445" href="#__codelineno-7-445"></a>                <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_outliered&quot;</span><span class="p">,</span>
<a id="__codelineno-7-446" name="__codelineno-7-446" href="#__codelineno-7-446"></a>                <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
<a id="__codelineno-7-447" name="__codelineno-7-447" href="#__codelineno-7-447"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_outliered&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">replace_vals</span><span class="p">[</span><span class="n">treatment_method</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-7-448" name="__codelineno-7-448" href="#__codelineno-7-448"></a>                <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
<a id="__codelineno-7-449" name="__codelineno-7-449" href="#__codelineno-7-449"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
<a id="__codelineno-7-450" name="__codelineno-7-450" href="#__codelineno-7-450"></a>                        <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_outliered&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-7-451" name="__codelineno-7-451" href="#__codelineno-7-451"></a>                        <span class="n">replace_vals</span><span class="p">[</span><span class="n">treatment_method</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-7-452" name="__codelineno-7-452" href="#__codelineno-7-452"></a>                    <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a id="__codelineno-7-453" name="__codelineno-7-453" href="#__codelineno-7-453"></a>                <span class="p">),</span>
<a id="__codelineno-7-454" name="__codelineno-7-454" href="#__codelineno-7-454"></a>            <span class="p">)</span>
<a id="__codelineno-7-455" name="__codelineno-7-455" href="#__codelineno-7-455"></a>            <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-7-456" name="__codelineno-7-456" href="#__codelineno-7-456"></a>                <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_outliered&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-7-457" name="__codelineno-7-457" href="#__codelineno-7-457"></a>
<a id="__codelineno-7-458" name="__codelineno-7-458" href="#__codelineno-7-458"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-7-459" name="__codelineno-7-459" href="#__codelineno-7-459"></a>
<a id="__codelineno-7-460" name="__codelineno-7-460" href="#__codelineno-7-460"></a>        <span class="k">def</span> <span class="nf">unionAll</span><span class="p">(</span><span class="n">dfs</span><span class="p">):</span>
<a id="__codelineno-7-461" name="__codelineno-7-461" href="#__codelineno-7-461"></a>            <span class="n">first</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">dfs</span>
<a id="__codelineno-7-462" name="__codelineno-7-462" href="#__codelineno-7-462"></a>            <span class="k">return</span> <span class="n">first</span><span class="o">.</span><span class="n">sql_ctx</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
<a id="__codelineno-7-463" name="__codelineno-7-463" href="#__codelineno-7-463"></a>                <span class="n">first</span><span class="o">.</span><span class="n">sql_ctx</span><span class="o">.</span><span class="n">_sc</span><span class="o">.</span><span class="n">union</span><span class="p">([</span><span class="n">df</span><span class="o">.</span><span class="n">rdd</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dfs</span><span class="p">]),</span> <span class="n">first</span><span class="o">.</span><span class="n">schema</span>
<a id="__codelineno-7-464" name="__codelineno-7-464" href="#__codelineno-7-464"></a>            <span class="p">)</span>
<a id="__codelineno-7-465" name="__codelineno-7-465" href="#__codelineno-7-465"></a>
<a id="__codelineno-7-466" name="__codelineno-7-466" href="#__codelineno-7-466"></a>        <span class="n">odf_print</span> <span class="o">=</span> <span class="n">unionAll</span><span class="p">(</span><span class="n">list_odf</span><span class="p">)</span>
<a id="__codelineno-7-467" name="__codelineno-7-467" href="#__codelineno-7-467"></a>
<a id="__codelineno-7-468" name="__codelineno-7-468" href="#__codelineno-7-468"></a>        <span class="k">if</span> <span class="n">skewed_cols</span><span class="p">:</span>
<a id="__codelineno-7-469" name="__codelineno-7-469" href="#__codelineno-7-469"></a>            <span class="n">skewed_cols_print</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">skewed_cols</span><span class="p">]</span>
<a id="__codelineno-7-470" name="__codelineno-7-470" href="#__codelineno-7-470"></a>            <span class="n">skewed_cols_odf_print</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
<a id="__codelineno-7-471" name="__codelineno-7-471" href="#__codelineno-7-471"></a>                <span class="n">skewed_cols_print</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">odf_print</span><span class="o">.</span><span class="n">columns</span>
<a id="__codelineno-7-472" name="__codelineno-7-472" href="#__codelineno-7-472"></a>            <span class="p">)</span>
<a id="__codelineno-7-473" name="__codelineno-7-473" href="#__codelineno-7-473"></a>            <span class="n">odf_print</span> <span class="o">=</span> <span class="n">unionAll</span><span class="p">([</span><span class="n">odf_print</span><span class="p">,</span> <span class="n">skewed_cols_odf_print</span><span class="p">])</span>
<a id="__codelineno-7-474" name="__codelineno-7-474" href="#__codelineno-7-474"></a>
<a id="__codelineno-7-475" name="__codelineno-7-475" href="#__codelineno-7-475"></a>        <span class="n">odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">skewed_cols</span><span class="p">),</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-7-476" name="__codelineno-7-476" href="#__codelineno-7-476"></a>
<a id="__codelineno-7-477" name="__codelineno-7-477" href="#__codelineno-7-477"></a>    <span class="k">if</span> <span class="n">treatment</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">treatment_method</span> <span class="o">==</span> <span class="s2">&quot;row_removal&quot;</span><span class="p">):</span>
<a id="__codelineno-7-478" name="__codelineno-7-478" href="#__codelineno-7-478"></a>        <span class="n">conditions</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-7-479" name="__codelineno-7-479" href="#__codelineno-7-479"></a>            <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_outliered&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_outliered&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">())</span>
<a id="__codelineno-7-480" name="__codelineno-7-480" href="#__codelineno-7-480"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span>
<a id="__codelineno-7-481" name="__codelineno-7-481" href="#__codelineno-7-481"></a>        <span class="p">]</span>
<a id="__codelineno-7-482" name="__codelineno-7-482" href="#__codelineno-7-482"></a>        <span class="n">conditions_combined</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">&amp;</span> <span class="n">b</span><span class="p">,</span> <span class="n">conditions</span><span class="p">)</span>
<a id="__codelineno-7-483" name="__codelineno-7-483" href="#__codelineno-7-483"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">conditions_combined</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
<a id="__codelineno-7-484" name="__codelineno-7-484" href="#__codelineno-7-484"></a>            <span class="o">*</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_outliered&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">]</span>
<a id="__codelineno-7-485" name="__codelineno-7-485" href="#__codelineno-7-485"></a>        <span class="p">)</span>
<a id="__codelineno-7-486" name="__codelineno-7-486" href="#__codelineno-7-486"></a>
<a id="__codelineno-7-487" name="__codelineno-7-487" href="#__codelineno-7-487"></a>    <span class="k">if</span> <span class="n">treatment</span><span class="p">:</span>
<a id="__codelineno-7-488" name="__codelineno-7-488" href="#__codelineno-7-488"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-7-489" name="__codelineno-7-489" href="#__codelineno-7-489"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">column_order</span><span class="p">)</span>
<a id="__codelineno-7-490" name="__codelineno-7-490" href="#__codelineno-7-490"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-491" name="__codelineno-7-491" href="#__codelineno-7-491"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-7-492" name="__codelineno-7-492" href="#__codelineno-7-492"></a>
<a id="__codelineno-7-493" name="__codelineno-7-493" href="#__codelineno-7-493"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-7-494" name="__codelineno-7-494" href="#__codelineno-7-494"></a>        <span class="k">return</span> <span class="n">odf</span><span class="p">,</span> <span class="n">odf_print</span>
<a id="__codelineno-7-495" name="__codelineno-7-495" href="#__codelineno-7-495"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-496" name="__codelineno-7-496" href="#__codelineno-7-496"></a>        <span class="k">return</span> <span class="n">odf</span>
</code></pre></div>
</pre>
</details>
</dd>
</dl>


  




                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="geospatial_analyzer.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: &lt;code&gt;geospatial_analyzer&lt;/code&gt;" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              <code>geospatial_analyzer</code>
            </div>
          </div>
        </a>
      
      
        
        <a href="stats_generator.html" class="md-footer__link md-footer__link--next" aria-label="Next: &lt;code&gt;stats_generator&lt;/code&gt;" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              <code>stats_generator</code>
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/anovos" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://join.slack.com/t/featureengineers/shared_invite/zt-17pkc3f5d-33SUtV8Wx48CpiIRNuQ7JA" target="_blank" rel="noopener" title="join.slack.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://twitter.com/anovos" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
    
  </body>
</html>