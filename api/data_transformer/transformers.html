
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Stable Features yield Resilient Models. Documentation for the Feature Engineering Library Anovos.">
      
      
        <meta name="author" content="Anovos Developers, Mobilewalla">
      
      
        <link rel="canonical" href="https://docs.anovos.ai/api/data_transformer/transformers.html">
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>transformers - Anovos Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script id="__analytics">function __md_analytics(){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-52258647-20","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");ga("send","event","feedback","click",t,e),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){ga("send","pageview",e.pathname)})});var e=document.createElement("script");e.async=!0,e.src="https://www.google-analytics.com/analytics.js",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
<!-- Extra styles for API docs, cf. https://github.com/pdoc3/pdoc/blob/master/pdoc/templates/html.mako -->
<link rel="preload stylesheet" as="style"
      href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css"
      integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style"
      href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css"
      integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/${hljs_style}.min.css" crossorigin>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"
        integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>

<!-- Extra style sheets (can't be set in mkdocs.yml due to content hash) -->
<link
        rel="stylesheet"
        href="../../assets/stylesheets/main.css"
/>

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#transformers" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
<a href="https://join.slack.com/t/featureengineers/shared_invite/zt-17pkc3f5d-33SUtV8Wx48CpiIRNuQ7JA" style="color: white;">
      <span class="twemoji fa-slack">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg>
    </span>
    Join us in the <strong>#anovos</strong> channel on the <em>Feature Engineers Community Slack!</em>
</a>

          </div>
          
        </aside>
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="Anovos Documentation" class="md-header__button md-logo" aria-label="Anovos Documentation" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Anovos Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              <code>transformers</code>
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
            </label>
          
        
          
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a
  href="https://github.com/anovos/anovos"
  title="Go to repository"
  class="md-source"
  data-md-component="source"
>
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    anovos/anovos
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="Anovos Documentation" class="md-nav__button md-logo" aria-label="Anovos Documentation" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    Anovos Documentation
  </label>
  
    <div class="md-nav__source">
      <a
  href="https://github.com/anovos/anovos"
  title="Go to repository"
  class="md-source"
  data-md-component="source"
>
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    anovos/anovos
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../about.html" class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started.html" class="md-nav__link">
        Getting Started 🚀
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Using Anovos
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Using Anovos" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Using Anovos
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" type="checkbox" id="__nav_4_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_1">
          Setting up
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Setting up" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Setting up
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/setting-up/locally.html" class="md-nav__link">
        Locally
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/setting-up/on_aws.html" class="md-nav__link">
        On AWS EMR
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/setting-up/on_azure_databricks.html" class="md-nav__link">
        On Azure Databricks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/setting-up/on_aks.html" class="md-nav__link">
        On Azure Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/setting-up/on_google_colab.html" class="md-nav__link">
        On Google Colab
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/setting-up/spark_cluster.html" class="md-nav__link">
        On a Spark cluster
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/workflow.html" class="md-nav__link">
        Workflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/config_file.html" class="md-nav__link">
        Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_4" type="checkbox" id="__nav_4_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_4">
          Data Reports
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Data Reports" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          Data Reports
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/data-reports/overview.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/data-reports/intermediate_report.html" class="md-nav__link">
        Intermediate Report
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/data-reports/final_report.html" class="md-nav__link">
        Final Report
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/data-reports/html_report.html" class="md-nav__link">
        HTML Report
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/feature_mapper.html" class="md-nav__link">
        Feature Mapper
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/mlflow.html" class="md-nav__link">
        MLflow Integration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/feature_store.html" class="md-nav__link">
        Feature Store Integration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/scaling.html" class="md-nav__link">
        Scaling Up
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/limitations.html" class="md-nav__link">
        Limitations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../using-anovos/roadmap.html" class="md-nav__link">
        Roadmap
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Community
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Community" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Community
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../community/contributing.html" class="md-nav__link">
        Contributing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../community/communication.html" class="md-nav__link">
        Communication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../community/code-of-conduct.html" class="md-nav__link">
        Code of Conduct
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          API Docs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API Docs" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          API Docs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../_index.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../workflow.html" class="md-nav__link">
        <code>workflow</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_3" type="checkbox" id="__nav_6_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_3">
          data_analyzer
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="data_analyzer" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          data_analyzer
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_analyzer/_index.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_analyzer/association_eval_varclus.html" class="md-nav__link">
        <code>association_eval_varclus</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_analyzer/association_evaluator.html" class="md-nav__link">
        <code>association_evaluator</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_analyzer/geospatial_analyzer.html" class="md-nav__link">
        <code>geospatial_analyzer</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_analyzer/quality_checker.html" class="md-nav__link">
        <code>quality_checker</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_analyzer/stats_generator.html" class="md-nav__link">
        <code>stats_generator</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_analyzer/ts_analyzer.html" class="md-nav__link">
        <code>ts_analyzer</code>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_4" type="checkbox" id="__nav_6_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_4">
          data_ingest
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="data_ingest" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_4">
          <span class="md-nav__icon md-icon"></span>
          data_ingest
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_ingest/_index.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_ingest/data_ingest.html" class="md-nav__link">
        <code>data_ingest</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_ingest/data_sampling.html" class="md-nav__link">
        <code>data_sampling</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_ingest/geo_auto_detection.html" class="md-nav__link">
        <code>geo_auto_detection</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_ingest/ts_auto_detection.html" class="md-nav__link">
        <code>ts_auto_detection</code>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_5" type="checkbox" id="__nav_6_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_5">
          data_report
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="data_report" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_5">
          <span class="md-nav__icon md-icon"></span>
          data_report
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_report/_index.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_report/basic_report_generation.html" class="md-nav__link">
        <code>basic_report_generation</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_report/report_generation.html" class="md-nav__link">
        <code>report_generation</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_report/report_preprocessing.html" class="md-nav__link">
        <code>report_preprocessing</code>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_6" type="checkbox" id="__nav_6_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6_6">
          data_transformer
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="data_transformer" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_6">
          <span class="md-nav__icon md-icon"></span>
          data_transformer
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="_index.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="datetime.html" class="md-nav__link">
        <code>datetime</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="geo_utils.html" class="md-nav__link">
        <code>geo_utils</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="geospatial.html" class="md-nav__link">
        <code>geospatial</code>
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          <code>transformers</code>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="transformers.html" class="md-nav__link md-nav__link--active">
        <code>transformers</code>
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_7" type="checkbox" id="__nav_6_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_7">
          drift_stability
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="drift_stability" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_7">
          <span class="md-nav__icon md-icon"></span>
          drift_stability
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../drift_stability/_index.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../drift_stability/drift_detector.html" class="md-nav__link">
        <code>drift_detector</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../drift_stability/stability.html" class="md-nav__link">
        <code>stability</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../drift_stability/validations.html" class="md-nav__link">
        <code>validations</code>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_8" type="checkbox" id="__nav_6_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_8">
          feature_recommender
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="feature_recommender" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_8">
          <span class="md-nav__icon md-icon"></span>
          feature_recommender
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../feature_recommender/_index.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../feature_recommender/featrec_init.html" class="md-nav__link">
        <code>featrec_init</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../feature_recommender/feature_explorer.html" class="md-nav__link">
        <code>feature_explorer</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../feature_recommender/feature_mapper.html" class="md-nav__link">
        <code>feature_mapper</code>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_9" type="checkbox" id="__nav_6_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_9">
          feature_store
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="feature_store" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_9">
          <span class="md-nav__icon md-icon"></span>
          feature_store
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../feature_store/_index.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../feature_store/feast_exporter.html" class="md-nav__link">
        <code>feast_exporter</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../feature_store/feature_retrieval.html" class="md-nav__link">
        <code>feature_retrieval</code>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_10" type="checkbox" id="__nav_6_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_10">
          shared
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="shared" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_10">
          <span class="md-nav__icon md-icon"></span>
          shared
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../shared/_index.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../shared/spark.html" class="md-nav__link">
        <code>spark</code>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../shared/utils.html" class="md-nav__link">
        <code>utils</code>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../license.html" class="md-nav__link">
        License
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/anovos/anovos-docs/edit/main/docs/api/data_transformer/transformers.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="transformers"><code>transformers</code></h1>
<p>The data transformer module supports selected pre-processing &amp; transformation functions, such as binning, encoding,
scaling, imputation, to name a few, which are required for statistics generation and quality checks. Functions
supported through this module are listed below:</p>
<ul>
<li>attribute_binning</li>
<li>monotonic_binning</li>
<li>cat_to_num_transformer</li>
<li>cat_to_num_unsupervised</li>
<li>cat_to_num_supervised</li>
<li>z_standardization</li>
<li>IQR_standardization</li>
<li>normalization</li>
<li>imputation_MMM</li>
<li>imputation_sklearn</li>
<li>imputation_matrixFactorization</li>
<li>auto_imputation</li>
<li>autoencoder_latentFeatures</li>
<li>PCA_latentFeatures</li>
<li>feature_transformation</li>
<li>boxcox_transformation</li>
<li>outlier_categories</li>
<li>expression_parser</li>
</ul>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># coding=utf-8</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="sd">The data transformer module supports selected pre-processing &amp; transformation functions, such as binning, encoding,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="sd">scaling, imputation, to name a few, which are required for statistics generation and quality checks. Functions</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="sd">supported through this module are listed below:</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="sd">- attribute_binning</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="sd">- monotonic_binning</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="sd">- cat_to_num_transformer</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="sd">- cat_to_num_unsupervised</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="sd">- cat_to_num_supervised</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="sd">- z_standardization</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="sd">- IQR_standardization</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="sd">- normalization</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="sd">- imputation_MMM</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="sd">- imputation_sklearn</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="sd">- imputation_matrixFactorization</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="sd">- auto_imputation</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="sd">- autoencoder_latentFeatures</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="sd">- PCA_latentFeatures</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="sd">- feature_transformation</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="sd">- boxcox_transformation</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="sd">- outlier_categories</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="sd">- expression_parser</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="kn">import</span> <span class="nn">copy</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="kn">import</span> <span class="nn">os</span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="kn">import</span> <span class="nn">pickle</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="kn">import</span> <span class="nn">random</span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="kn">import</span> <span class="nn">platform</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a><span class="kn">import</span> <span class="nn">subprocess</span>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="kn">import</span> <span class="nn">tempfile</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="kn">import</span> <span class="nn">warnings</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a><span class="kn">import</span> <span class="nn">pyspark</span>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a><span class="kn">from</span> <span class="nn">packaging</span> <span class="kn">import</span> <span class="n">version</span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a><span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">pyspark</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;3.0.0&quot;</span><span class="p">):</span>
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>    <span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">OneHotEncoderEstimator</span> <span class="k">as</span> <span class="n">OneHotEncoder</span>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>    <span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a><span class="kn">from</span> <span class="nn">pyspark.ml.evaluation</span> <span class="kn">import</span> <span class="n">RegressionEvaluator</span>
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a>    <span class="n">PCA</span><span class="p">,</span>
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a>    <span class="n">Imputer</span><span class="p">,</span>
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>    <span class="n">ImputerModel</span><span class="p">,</span>
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a>    <span class="n">IndexToString</span><span class="p">,</span>
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a>    <span class="n">MinMaxScaler</span><span class="p">,</span>
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a>    <span class="n">MinMaxScalerModel</span><span class="p">,</span>
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a>    <span class="n">PCAModel</span><span class="p">,</span>
<a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a>    <span class="n">StringIndexer</span><span class="p">,</span>
<a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a>    <span class="n">StringIndexerModel</span><span class="p">,</span>
<a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a>    <span class="n">VectorAssembler</span><span class="p">,</span>
<a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a><span class="p">)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a><span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">DenseVector</span>
<a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a><span class="kn">from</span> <span class="nn">pyspark.ml.recommendation</span> <span class="kn">import</span> <span class="n">ALS</span>
<a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a><span class="kn">from</span> <span class="nn">pyspark.mllib.stat</span> <span class="kn">import</span> <span class="n">Statistics</span>
<a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">functions</span> <span class="k">as</span> <span class="n">F</span>
<a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">types</span> <span class="k">as</span> <span class="n">T</span>
<a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a><span class="kn">from</span> <span class="nn">pyspark.sql.window</span> <span class="kn">import</span> <span class="n">Window</span>
<a id="__codelineno-0-67" name="__codelineno-0-67" href="#__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68" href="#__codelineno-0-68"></a><span class="kn">from</span> <span class="nn">anovos.data_analyzer.stats_generator</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-0-69" name="__codelineno-0-69" href="#__codelineno-0-69"></a>    <span class="n">missingCount_computation</span><span class="p">,</span>
<a id="__codelineno-0-70" name="__codelineno-0-70" href="#__codelineno-0-70"></a>    <span class="n">uniqueCount_computation</span><span class="p">,</span>
<a id="__codelineno-0-71" name="__codelineno-0-71" href="#__codelineno-0-71"></a><span class="p">)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72" href="#__codelineno-0-72"></a><span class="kn">from</span> <span class="nn">anovos.data_ingest.data_ingest</span> <span class="kn">import</span> <span class="n">read_dataset</span><span class="p">,</span> <span class="n">recast_column</span>
<a id="__codelineno-0-73" name="__codelineno-0-73" href="#__codelineno-0-73"></a><span class="kn">from</span> <span class="nn">anovos.data_ingest.data_sampling</span> <span class="kn">import</span> <span class="n">data_sample</span>
<a id="__codelineno-0-74" name="__codelineno-0-74" href="#__codelineno-0-74"></a><span class="kn">from</span> <span class="nn">anovos.shared.utils</span> <span class="kn">import</span> <span class="n">ends_with</span><span class="p">,</span> <span class="n">attributeType_segregation</span><span class="p">,</span> <span class="n">get_dtype</span>
<a id="__codelineno-0-75" name="__codelineno-0-75" href="#__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76" href="#__codelineno-0-76"></a><span class="c1"># enable_iterative_imputer is prequisite for importing IterativeImputer</span>
<a id="__codelineno-0-77" name="__codelineno-0-77" href="#__codelineno-0-77"></a><span class="c1"># check the following issue for more details https://github.com/scikit-learn/scikit-learn/issues/16833</span>
<a id="__codelineno-0-78" name="__codelineno-0-78" href="#__codelineno-0-78"></a><span class="kn">from</span> <span class="nn">sklearn.experimental</span> <span class="kn">import</span> <span class="n">enable_iterative_imputer</span>  <span class="c1"># noqa</span>
<a id="__codelineno-0-79" name="__codelineno-0-79" href="#__codelineno-0-79"></a><span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">KNNImputer</span><span class="p">,</span> <span class="n">IterativeImputer</span>
<a id="__codelineno-0-80" name="__codelineno-0-80" href="#__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81" href="#__codelineno-0-81"></a><span class="k">if</span> <span class="s2">&quot;arm64&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">platform</span><span class="o">.</span><span class="n">version</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
<a id="__codelineno-0-82" name="__codelineno-0-82" href="#__codelineno-0-82"></a>    <span class="kn">import</span> <span class="nn">tensorflow</span>
<a id="__codelineno-0-83" name="__codelineno-0-83" href="#__codelineno-0-83"></a>    <span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">load_model</span><span class="p">,</span> <span class="n">Model</span>
<a id="__codelineno-0-84" name="__codelineno-0-84" href="#__codelineno-0-84"></a>    <span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">BatchNormalization</span><span class="p">,</span> <span class="n">LeakyReLU</span>
<a id="__codelineno-0-85" name="__codelineno-0-85" href="#__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86" href="#__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87" href="#__codelineno-0-87"></a><span class="k">def</span> <span class="nf">attribute_binning</span><span class="p">(</span>
<a id="__codelineno-0-88" name="__codelineno-0-88" href="#__codelineno-0-88"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-89" name="__codelineno-0-89" href="#__codelineno-0-89"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-90" name="__codelineno-0-90" href="#__codelineno-0-90"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-0-91" name="__codelineno-0-91" href="#__codelineno-0-91"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-92" name="__codelineno-0-92" href="#__codelineno-0-92"></a>    <span class="n">method_type</span><span class="o">=</span><span class="s2">&quot;equal_range&quot;</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93" href="#__codelineno-0-93"></a>    <span class="n">bin_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-0-94" name="__codelineno-0-94" href="#__codelineno-0-94"></a>    <span class="n">bin_dtype</span><span class="o">=</span><span class="s2">&quot;numerical&quot;</span><span class="p">,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95" href="#__codelineno-0-95"></a>    <span class="n">pre_existing_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-96" name="__codelineno-0-96" href="#__codelineno-0-96"></a>    <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-0-97" name="__codelineno-0-97" href="#__codelineno-0-97"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-0-98" name="__codelineno-0-98" href="#__codelineno-0-98"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-99" name="__codelineno-0-99" href="#__codelineno-0-99"></a><span class="p">):</span>
<a id="__codelineno-0-100" name="__codelineno-0-100" href="#__codelineno-0-100"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-101" name="__codelineno-0-101" href="#__codelineno-0-101"></a><span class="sd">    Attribute binning (or discretization) is a method of numerical attribute into discrete (integer or categorical</span>
<a id="__codelineno-0-102" name="__codelineno-0-102" href="#__codelineno-0-102"></a><span class="sd">    values) using pre-defined number of bins. This data pre-processing technique is used to reduce the effects of</span>
<a id="__codelineno-0-103" name="__codelineno-0-103" href="#__codelineno-0-103"></a><span class="sd">    minor observation errors. Also, Binning introduces non-linearity and tends to improve the performance of the</span>
<a id="__codelineno-0-104" name="__codelineno-0-104" href="#__codelineno-0-104"></a><span class="sd">    model. In this function, we are focussing on unsupervised way of binning i.e. without taking the target</span>
<a id="__codelineno-0-105" name="__codelineno-0-105" href="#__codelineno-0-105"></a><span class="sd">    variable into account - Equal Range Binning, Equal Frequency Binning. In Equal Range method, each bin is of equal</span>
<a id="__codelineno-0-106" name="__codelineno-0-106" href="#__codelineno-0-106"></a><span class="sd">    size/width and computed as:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107" href="#__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108" href="#__codelineno-0-108"></a><span class="sd">    w = max- min / no. of bins</span>
<a id="__codelineno-0-109" name="__codelineno-0-109" href="#__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110" href="#__codelineno-0-110"></a><span class="sd">    *bins cutoff=[min, min+w,min+2w…..,max-w,max]*</span>
<a id="__codelineno-0-111" name="__codelineno-0-111" href="#__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112" href="#__codelineno-0-112"></a><span class="sd">    whereas in Equal Frequency binning method, bins are created in such a way that each bin has equal no. of rows,</span>
<a id="__codelineno-0-113" name="__codelineno-0-113" href="#__codelineno-0-113"></a><span class="sd">    though the width of bins may vary from each other.</span>
<a id="__codelineno-0-114" name="__codelineno-0-114" href="#__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115" href="#__codelineno-0-115"></a><span class="sd">    w = 1 / no. of bins</span>
<a id="__codelineno-0-116" name="__codelineno-0-116" href="#__codelineno-0-116"></a>
<a id="__codelineno-0-117" name="__codelineno-0-117" href="#__codelineno-0-117"></a><span class="sd">    *bins cutoff=[min, wthpctile, 2wthpctile….,max ]*</span>
<a id="__codelineno-0-118" name="__codelineno-0-118" href="#__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119" href="#__codelineno-0-119"></a>
<a id="__codelineno-0-120" name="__codelineno-0-120" href="#__codelineno-0-120"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-121" name="__codelineno-0-121" href="#__codelineno-0-121"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-122" name="__codelineno-0-122" href="#__codelineno-0-122"></a><span class="sd">    spark</span>
<a id="__codelineno-0-123" name="__codelineno-0-123" href="#__codelineno-0-123"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-0-124" name="__codelineno-0-124" href="#__codelineno-0-124"></a><span class="sd">    idf</span>
<a id="__codelineno-0-125" name="__codelineno-0-125" href="#__codelineno-0-125"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-126" name="__codelineno-0-126" href="#__codelineno-0-126"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-0-127" name="__codelineno-0-127" href="#__codelineno-0-127"></a><span class="sd">        List of numerical columns to transform e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-128" name="__codelineno-0-128" href="#__codelineno-0-128"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-129" name="__codelineno-0-129" href="#__codelineno-0-129"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-130" name="__codelineno-0-130" href="#__codelineno-0-130"></a><span class="sd">        &quot;all&quot; can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-0-131" name="__codelineno-0-131" href="#__codelineno-0-131"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-0-132" name="__codelineno-0-132" href="#__codelineno-0-132"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-0-133" name="__codelineno-0-133" href="#__codelineno-0-133"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-0-134" name="__codelineno-0-134" href="#__codelineno-0-134"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-135" name="__codelineno-0-135" href="#__codelineno-0-135"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-136" name="__codelineno-0-136" href="#__codelineno-0-136"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-137" name="__codelineno-0-137" href="#__codelineno-0-137"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-0-138" name="__codelineno-0-138" href="#__codelineno-0-138"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-0-139" name="__codelineno-0-139" href="#__codelineno-0-139"></a><span class="sd">    method_type</span>
<a id="__codelineno-0-140" name="__codelineno-0-140" href="#__codelineno-0-140"></a><span class="sd">        &quot;equal_frequency&quot;, &quot;equal_range&quot;.</span>
<a id="__codelineno-0-141" name="__codelineno-0-141" href="#__codelineno-0-141"></a><span class="sd">        In &quot;equal_range&quot; method, each bin is of equal size/width and in &quot;equal_frequency&quot;, each bin has</span>
<a id="__codelineno-0-142" name="__codelineno-0-142" href="#__codelineno-0-142"></a><span class="sd">        equal no. of rows, though the width of bins may vary. (Default value = &quot;equal_range&quot;)</span>
<a id="__codelineno-0-143" name="__codelineno-0-143" href="#__codelineno-0-143"></a><span class="sd">    bin_size</span>
<a id="__codelineno-0-144" name="__codelineno-0-144" href="#__codelineno-0-144"></a><span class="sd">        Number of bins. (Default value = 10)</span>
<a id="__codelineno-0-145" name="__codelineno-0-145" href="#__codelineno-0-145"></a><span class="sd">    bin_dtype</span>
<a id="__codelineno-0-146" name="__codelineno-0-146" href="#__codelineno-0-146"></a><span class="sd">        &quot;numerical&quot;, &quot;categorical&quot;.</span>
<a id="__codelineno-0-147" name="__codelineno-0-147" href="#__codelineno-0-147"></a><span class="sd">        With &quot;numerical&quot; option, original value is replaced with an Integer (1,2,…) and</span>
<a id="__codelineno-0-148" name="__codelineno-0-148" href="#__codelineno-0-148"></a><span class="sd">        with &quot;categorical&quot; option, original replaced with a string describing min and max value allowed</span>
<a id="__codelineno-0-149" name="__codelineno-0-149" href="#__codelineno-0-149"></a><span class="sd">        in the bin (&quot;minval-maxval&quot;). (Default value = &quot;numerical&quot;)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150" href="#__codelineno-0-150"></a><span class="sd">    pre_existing_model</span>
<a id="__codelineno-0-151" name="__codelineno-0-151" href="#__codelineno-0-151"></a><span class="sd">        Boolean argument – True or False. True if binning model exists already, False Otherwise. (Default value = False)</span>
<a id="__codelineno-0-152" name="__codelineno-0-152" href="#__codelineno-0-152"></a><span class="sd">    model_path</span>
<a id="__codelineno-0-153" name="__codelineno-0-153" href="#__codelineno-0-153"></a><span class="sd">        If pre_existing_model is True, this argument is path for referring the pre-saved model.</span>
<a id="__codelineno-0-154" name="__codelineno-0-154" href="#__codelineno-0-154"></a><span class="sd">        If pre_existing_model is False, this argument can be used for saving the model.</span>
<a id="__codelineno-0-155" name="__codelineno-0-155" href="#__codelineno-0-155"></a><span class="sd">        Default &quot;NA&quot; means there is neither pre-existing model nor there is a need to save one.</span>
<a id="__codelineno-0-156" name="__codelineno-0-156" href="#__codelineno-0-156"></a><span class="sd">    output_mode</span>
<a id="__codelineno-0-157" name="__codelineno-0-157" href="#__codelineno-0-157"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-0-158" name="__codelineno-0-158" href="#__codelineno-0-158"></a><span class="sd">        “replace” option replaces original columns with transformed column. “append” option append transformed</span>
<a id="__codelineno-0-159" name="__codelineno-0-159" href="#__codelineno-0-159"></a><span class="sd">        column to the input dataset with a postfix &quot;_binned&quot; e.g. column X is appended as X_binned. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-0-160" name="__codelineno-0-160" href="#__codelineno-0-160"></a><span class="sd">    print_impact</span>
<a id="__codelineno-0-161" name="__codelineno-0-161" href="#__codelineno-0-161"></a><span class="sd">        True, False (Default value = False)</span>
<a id="__codelineno-0-162" name="__codelineno-0-162" href="#__codelineno-0-162"></a><span class="sd">        This argument is to print the number of categories generated for each attribute (may or may be not same as bin_size)</span>
<a id="__codelineno-0-163" name="__codelineno-0-163" href="#__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164" href="#__codelineno-0-164"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-165" name="__codelineno-0-165" href="#__codelineno-0-165"></a><span class="sd">    -------</span>
<a id="__codelineno-0-166" name="__codelineno-0-166" href="#__codelineno-0-166"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-0-167" name="__codelineno-0-167" href="#__codelineno-0-167"></a><span class="sd">        Binned Dataframe</span>
<a id="__codelineno-0-168" name="__codelineno-0-168" href="#__codelineno-0-168"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-169" name="__codelineno-0-169" href="#__codelineno-0-169"></a>
<a id="__codelineno-0-170" name="__codelineno-0-170" href="#__codelineno-0-170"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-171" name="__codelineno-0-171" href="#__codelineno-0-171"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172" href="#__codelineno-0-172"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-0-173" name="__codelineno-0-173" href="#__codelineno-0-173"></a>
<a id="__codelineno-0-174" name="__codelineno-0-174" href="#__codelineno-0-174"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-175" name="__codelineno-0-175" href="#__codelineno-0-175"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-176" name="__codelineno-0-176" href="#__codelineno-0-176"></a>
<a id="__codelineno-0-177" name="__codelineno-0-177" href="#__codelineno-0-177"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-178" name="__codelineno-0-178" href="#__codelineno-0-178"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-179" name="__codelineno-0-179" href="#__codelineno-0-179"></a>
<a id="__codelineno-0-180" name="__codelineno-0-180" href="#__codelineno-0-180"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-0-181" name="__codelineno-0-181" href="#__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182" href="#__codelineno-0-182"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-183" name="__codelineno-0-183" href="#__codelineno-0-183"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-184" name="__codelineno-0-184" href="#__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185" href="#__codelineno-0-185"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-186" name="__codelineno-0-186" href="#__codelineno-0-186"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No Binning Performed - No numerical column(s) to transform&quot;</span><span class="p">)</span>
<a id="__codelineno-0-187" name="__codelineno-0-187" href="#__codelineno-0-187"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-0-188" name="__codelineno-0-188" href="#__codelineno-0-188"></a>
<a id="__codelineno-0-189" name="__codelineno-0-189" href="#__codelineno-0-189"></a>    <span class="k">if</span> <span class="n">method_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;equal_frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;equal_range&quot;</span><span class="p">):</span>
<a id="__codelineno-0-190" name="__codelineno-0-190" href="#__codelineno-0-190"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for method_type&quot;</span><span class="p">)</span>
<a id="__codelineno-0-191" name="__codelineno-0-191" href="#__codelineno-0-191"></a>
<a id="__codelineno-0-192" name="__codelineno-0-192" href="#__codelineno-0-192"></a>    <span class="k">if</span> <span class="n">bin_size</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-193" name="__codelineno-0-193" href="#__codelineno-0-193"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for bin_size&quot;</span><span class="p">)</span>
<a id="__codelineno-0-194" name="__codelineno-0-194" href="#__codelineno-0-194"></a>
<a id="__codelineno-0-195" name="__codelineno-0-195" href="#__codelineno-0-195"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">):</span>
<a id="__codelineno-0-196" name="__codelineno-0-196" href="#__codelineno-0-196"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for output_mode&quot;</span><span class="p">)</span>
<a id="__codelineno-0-197" name="__codelineno-0-197" href="#__codelineno-0-197"></a>
<a id="__codelineno-0-198" name="__codelineno-0-198" href="#__codelineno-0-198"></a>    <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-0-199" name="__codelineno-0-199" href="#__codelineno-0-199"></a>        <span class="n">df_model</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/attribute_binning&quot;</span><span class="p">)</span>
<a id="__codelineno-0-200" name="__codelineno-0-200" href="#__codelineno-0-200"></a>        <span class="n">bin_cutoffs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-201" name="__codelineno-0-201" href="#__codelineno-0-201"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202" href="#__codelineno-0-202"></a>            <span class="n">mapped_value</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-203" name="__codelineno-0-203" href="#__codelineno-0-203"></a>                <span class="n">df_model</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-204" name="__codelineno-0-204" href="#__codelineno-0-204"></a>                <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;parameters&quot;</span><span class="p">)</span>
<a id="__codelineno-0-205" name="__codelineno-0-205" href="#__codelineno-0-205"></a>                <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-206" name="__codelineno-0-206" href="#__codelineno-0-206"></a>                <span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-207" name="__codelineno-0-207" href="#__codelineno-0-207"></a>            <span class="p">)</span>
<a id="__codelineno-0-208" name="__codelineno-0-208" href="#__codelineno-0-208"></a>            <span class="n">bin_cutoffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapped_value</span><span class="p">)</span>
<a id="__codelineno-0-209" name="__codelineno-0-209" href="#__codelineno-0-209"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-210" name="__codelineno-0-210" href="#__codelineno-0-210"></a>        <span class="k">if</span> <span class="n">method_type</span> <span class="o">==</span> <span class="s2">&quot;equal_frequency&quot;</span><span class="p">:</span>
<a id="__codelineno-0-211" name="__codelineno-0-211" href="#__codelineno-0-211"></a>            <span class="n">pctile_width</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">bin_size</span>
<a id="__codelineno-0-212" name="__codelineno-0-212" href="#__codelineno-0-212"></a>            <span class="n">pctile_cutoff</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-213" name="__codelineno-0-213" href="#__codelineno-0-213"></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bin_size</span><span class="p">):</span>
<a id="__codelineno-0-214" name="__codelineno-0-214" href="#__codelineno-0-214"></a>                <span class="n">pctile_cutoff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="n">pctile_width</span><span class="p">)</span>
<a id="__codelineno-0-215" name="__codelineno-0-215" href="#__codelineno-0-215"></a>            <span class="n">bin_cutoffs</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">approxQuantile</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="n">pctile_cutoff</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-0-216" name="__codelineno-0-216" href="#__codelineno-0-216"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-217" name="__codelineno-0-217" href="#__codelineno-0-217"></a>            <span class="n">funs</span> <span class="o">=</span> <span class="p">[</span><span class="n">F</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">min</span><span class="p">]</span>
<a id="__codelineno-0-218" name="__codelineno-0-218" href="#__codelineno-0-218"></a>            <span class="n">exprs</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">funs</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">]</span>
<a id="__codelineno-0-219" name="__codelineno-0-219" href="#__codelineno-0-219"></a>            <span class="n">list_result</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">groupby</span><span class="p">()</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="o">*</span><span class="n">exprs</span><span class="p">)</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-220" name="__codelineno-0-220" href="#__codelineno-0-220"></a>            <span class="n">bin_cutoffs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-221" name="__codelineno-0-221" href="#__codelineno-0-221"></a>            <span class="n">drop_col_process</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-222" name="__codelineno-0-222" href="#__codelineno-0-222"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_result</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)):</span>
<a id="__codelineno-0-223" name="__codelineno-0-223" href="#__codelineno-0-223"></a>                <span class="n">bin_cutoff</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-224" name="__codelineno-0-224" href="#__codelineno-0-224"></a>                <span class="n">max_val</span> <span class="o">=</span> <span class="n">list_result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-225" name="__codelineno-0-225" href="#__codelineno-0-225"></a>                <span class="n">min_val</span> <span class="o">=</span> <span class="n">list_result</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_result</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
<a id="__codelineno-0-226" name="__codelineno-0-226" href="#__codelineno-0-226"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">max_val</span> <span class="ow">and</span> <span class="n">max_val</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-227" name="__codelineno-0-227" href="#__codelineno-0-227"></a>                    <span class="n">drop_col_process</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-0-228" name="__codelineno-0-228" href="#__codelineno-0-228"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-229" name="__codelineno-0-229" href="#__codelineno-0-229"></a>                <span class="n">bin_width</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_val</span> <span class="o">-</span> <span class="n">min_val</span><span class="p">)</span> <span class="o">/</span> <span class="n">bin_size</span>
<a id="__codelineno-0-230" name="__codelineno-0-230" href="#__codelineno-0-230"></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bin_size</span><span class="p">):</span>
<a id="__codelineno-0-231" name="__codelineno-0-231" href="#__codelineno-0-231"></a>                    <span class="n">bin_cutoff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">min_val</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="n">bin_width</span><span class="p">)</span>
<a id="__codelineno-0-232" name="__codelineno-0-232" href="#__codelineno-0-232"></a>                <span class="n">bin_cutoffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bin_cutoff</span><span class="p">)</span>
<a id="__codelineno-0-233" name="__codelineno-0-233" href="#__codelineno-0-233"></a>            <span class="k">if</span> <span class="n">drop_col_process</span><span class="p">:</span>
<a id="__codelineno-0-234" name="__codelineno-0-234" href="#__codelineno-0-234"></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-235" name="__codelineno-0-235" href="#__codelineno-0-235"></a>                    <span class="s2">&quot;Columns contains too much null values. Dropping &quot;</span>
<a id="__codelineno-0-236" name="__codelineno-0-236" href="#__codelineno-0-236"></a>                    <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">drop_col_process</span><span class="p">)</span>
<a id="__codelineno-0-237" name="__codelineno-0-237" href="#__codelineno-0-237"></a>                <span class="p">)</span>
<a id="__codelineno-0-238" name="__codelineno-0-238" href="#__codelineno-0-238"></a>                <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
<a id="__codelineno-0-239" name="__codelineno-0-239" href="#__codelineno-0-239"></a>                    <span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_col_process</span><span class="p">])</span>
<a id="__codelineno-0-240" name="__codelineno-0-240" href="#__codelineno-0-240"></a>                <span class="p">)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241" href="#__codelineno-0-241"></a>        <span class="k">if</span> <span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span>
<a id="__codelineno-0-242" name="__codelineno-0-242" href="#__codelineno-0-242"></a>            <span class="n">df_model</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
<a id="__codelineno-0-243" name="__codelineno-0-243" href="#__codelineno-0-243"></a>                <span class="nb">zip</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="n">bin_cutoffs</span><span class="p">),</span> <span class="n">schema</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;parameters&quot;</span><span class="p">]</span>
<a id="__codelineno-0-244" name="__codelineno-0-244" href="#__codelineno-0-244"></a>            <span class="p">)</span>
<a id="__codelineno-0-245" name="__codelineno-0-245" href="#__codelineno-0-245"></a>
<a id="__codelineno-0-246" name="__codelineno-0-246" href="#__codelineno-0-246"></a>            <span class="n">df_model</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/attribute_binning&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span><span class="p">)</span>
<a id="__codelineno-0-247" name="__codelineno-0-247" href="#__codelineno-0-247"></a>
<a id="__codelineno-0-248" name="__codelineno-0-248" href="#__codelineno-0-248"></a>    <span class="k">def</span> <span class="nf">bucket_label</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<a id="__codelineno-0-249" name="__codelineno-0-249" href="#__codelineno-0-249"></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-250" name="__codelineno-0-250" href="#__codelineno-0-250"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-251" name="__codelineno-0-251" href="#__codelineno-0-251"></a>
<a id="__codelineno-0-252" name="__codelineno-0-252" href="#__codelineno-0-252"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bin_cutoffs</span><span class="p">[</span><span class="n">index</span><span class="p">])):</span>
<a id="__codelineno-0-253" name="__codelineno-0-253" href="#__codelineno-0-253"></a>            <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">bin_cutoffs</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
<a id="__codelineno-0-254" name="__codelineno-0-254" href="#__codelineno-0-254"></a>                <span class="k">if</span> <span class="n">bin_dtype</span> <span class="o">==</span> <span class="s2">&quot;numerical&quot;</span><span class="p">:</span>
<a id="__codelineno-0-255" name="__codelineno-0-255" href="#__codelineno-0-255"></a>                    <span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-256" name="__codelineno-0-256" href="#__codelineno-0-256"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-257" name="__codelineno-0-257" href="#__codelineno-0-257"></a>                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-258" name="__codelineno-0-258" href="#__codelineno-0-258"></a>                        <span class="k">return</span> <span class="s2">&quot;&lt;= &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">bin_cutoffs</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
<a id="__codelineno-0-259" name="__codelineno-0-259" href="#__codelineno-0-259"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-260" name="__codelineno-0-260" href="#__codelineno-0-260"></a>                        <span class="k">return</span> <span class="p">(</span>
<a id="__codelineno-0-261" name="__codelineno-0-261" href="#__codelineno-0-261"></a>                            <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">bin_cutoffs</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
<a id="__codelineno-0-262" name="__codelineno-0-262" href="#__codelineno-0-262"></a>                            <span class="o">+</span> <span class="s2">&quot;-&quot;</span>
<a id="__codelineno-0-263" name="__codelineno-0-263" href="#__codelineno-0-263"></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">bin_cutoffs</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
<a id="__codelineno-0-264" name="__codelineno-0-264" href="#__codelineno-0-264"></a>                        <span class="p">)</span>
<a id="__codelineno-0-265" name="__codelineno-0-265" href="#__codelineno-0-265"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-266" name="__codelineno-0-266" href="#__codelineno-0-266"></a>                <span class="nb">next</span>
<a id="__codelineno-0-267" name="__codelineno-0-267" href="#__codelineno-0-267"></a>
<a id="__codelineno-0-268" name="__codelineno-0-268" href="#__codelineno-0-268"></a>        <span class="k">if</span> <span class="n">bin_dtype</span> <span class="o">==</span> <span class="s2">&quot;numerical&quot;</span><span class="p">:</span>
<a id="__codelineno-0-269" name="__codelineno-0-269" href="#__codelineno-0-269"></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">bin_cutoffs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-270" name="__codelineno-0-270" href="#__codelineno-0-270"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-271" name="__codelineno-0-271" href="#__codelineno-0-271"></a>            <span class="k">return</span> <span class="s2">&quot;&gt; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">bin_cutoffs</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">bin_cutoffs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
<a id="__codelineno-0-272" name="__codelineno-0-272" href="#__codelineno-0-272"></a>
<a id="__codelineno-0-273" name="__codelineno-0-273" href="#__codelineno-0-273"></a>    <span class="k">if</span> <span class="n">bin_dtype</span> <span class="o">==</span> <span class="s2">&quot;numerical&quot;</span><span class="p">:</span>
<a id="__codelineno-0-274" name="__codelineno-0-274" href="#__codelineno-0-274"></a>        <span class="n">f_bucket_label</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">udf</span><span class="p">(</span><span class="n">bucket_label</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">IntegerType</span><span class="p">())</span>
<a id="__codelineno-0-275" name="__codelineno-0-275" href="#__codelineno-0-275"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276" href="#__codelineno-0-276"></a>        <span class="n">f_bucket_label</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">udf</span><span class="p">(</span><span class="n">bucket_label</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">())</span>
<a id="__codelineno-0-277" name="__codelineno-0-277" href="#__codelineno-0-277"></a>
<a id="__codelineno-0-278" name="__codelineno-0-278" href="#__codelineno-0-278"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-279" name="__codelineno-0-279" href="#__codelineno-0-279"></a>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-280" name="__codelineno-0-280" href="#__codelineno-0-280"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_binned&quot;</span><span class="p">,</span> <span class="n">f_bucket_label</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">idx</span><span class="p">)))</span>
<a id="__codelineno-0-281" name="__codelineno-0-281" href="#__codelineno-0-281"></a>
<a id="__codelineno-0-282" name="__codelineno-0-282" href="#__codelineno-0-282"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-283" name="__codelineno-0-283" href="#__codelineno-0-283"></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-284" name="__codelineno-0-284" href="#__codelineno-0-284"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">col</span> <span class="o">+</span> <span class="s2">&quot;_binned&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
<a id="__codelineno-0-285" name="__codelineno-0-285" href="#__codelineno-0-285"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-286" name="__codelineno-0-286" href="#__codelineno-0-286"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-287" name="__codelineno-0-287" href="#__codelineno-0-287"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="n">list_of_cols</span>
<a id="__codelineno-0-288" name="__codelineno-0-288" href="#__codelineno-0-288"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-289" name="__codelineno-0-289" href="#__codelineno-0-289"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_binned&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">]</span>
<a id="__codelineno-0-290" name="__codelineno-0-290" href="#__codelineno-0-290"></a>        <span class="n">uniqueCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">odf</span><span class="p">,</span> <span class="n">output_cols</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">output_cols</span><span class="p">),</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-291" name="__codelineno-0-291" href="#__codelineno-0-291"></a>    <span class="k">return</span> <span class="n">odf</span>
<a id="__codelineno-0-292" name="__codelineno-0-292" href="#__codelineno-0-292"></a>
<a id="__codelineno-0-293" name="__codelineno-0-293" href="#__codelineno-0-293"></a>
<a id="__codelineno-0-294" name="__codelineno-0-294" href="#__codelineno-0-294"></a><span class="k">def</span> <span class="nf">monotonic_binning</span><span class="p">(</span>
<a id="__codelineno-0-295" name="__codelineno-0-295" href="#__codelineno-0-295"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-296" name="__codelineno-0-296" href="#__codelineno-0-296"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-297" name="__codelineno-0-297" href="#__codelineno-0-297"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-0-298" name="__codelineno-0-298" href="#__codelineno-0-298"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-299" name="__codelineno-0-299" href="#__codelineno-0-299"></a>    <span class="n">label_col</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span>
<a id="__codelineno-0-300" name="__codelineno-0-300" href="#__codelineno-0-300"></a>    <span class="n">event_label</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-301" name="__codelineno-0-301" href="#__codelineno-0-301"></a>    <span class="n">bin_method</span><span class="o">=</span><span class="s2">&quot;equal_range&quot;</span><span class="p">,</span>
<a id="__codelineno-0-302" name="__codelineno-0-302" href="#__codelineno-0-302"></a>    <span class="n">bin_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-0-303" name="__codelineno-0-303" href="#__codelineno-0-303"></a>    <span class="n">bin_dtype</span><span class="o">=</span><span class="s2">&quot;numerical&quot;</span><span class="p">,</span>
<a id="__codelineno-0-304" name="__codelineno-0-304" href="#__codelineno-0-304"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-0-305" name="__codelineno-0-305" href="#__codelineno-0-305"></a><span class="p">):</span>
<a id="__codelineno-0-306" name="__codelineno-0-306" href="#__codelineno-0-306"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-307" name="__codelineno-0-307" href="#__codelineno-0-307"></a><span class="sd">    This function constitutes supervised way of binning the numerical attribute into discrete (integer or</span>
<a id="__codelineno-0-308" name="__codelineno-0-308" href="#__codelineno-0-308"></a><span class="sd">    categorical values) attribute. Instead of pre-defined fixed number of bins, number of bins are dynamically</span>
<a id="__codelineno-0-309" name="__codelineno-0-309" href="#__codelineno-0-309"></a><span class="sd">    computed to ensure the monotonic nature of bins i.e. % event should increase or decrease with the bin. Monotonic</span>
<a id="__codelineno-0-310" name="__codelineno-0-310" href="#__codelineno-0-310"></a><span class="sd">    nature of bins is evaluated by looking at spearman rank correlation, which should be either +1 or -1, between the</span>
<a id="__codelineno-0-311" name="__codelineno-0-311" href="#__codelineno-0-311"></a><span class="sd">    bin index and % event. In case, the monotonic nature is not attained, user defined fixed number of bins are used</span>
<a id="__codelineno-0-312" name="__codelineno-0-312" href="#__codelineno-0-312"></a><span class="sd">    for the binning.</span>
<a id="__codelineno-0-313" name="__codelineno-0-313" href="#__codelineno-0-313"></a>
<a id="__codelineno-0-314" name="__codelineno-0-314" href="#__codelineno-0-314"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-315" name="__codelineno-0-315" href="#__codelineno-0-315"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-316" name="__codelineno-0-316" href="#__codelineno-0-316"></a><span class="sd">    spark</span>
<a id="__codelineno-0-317" name="__codelineno-0-317" href="#__codelineno-0-317"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-0-318" name="__codelineno-0-318" href="#__codelineno-0-318"></a><span class="sd">    idf</span>
<a id="__codelineno-0-319" name="__codelineno-0-319" href="#__codelineno-0-319"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-320" name="__codelineno-0-320" href="#__codelineno-0-320"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-0-321" name="__codelineno-0-321" href="#__codelineno-0-321"></a><span class="sd">        List of numerical columns to transform e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-322" name="__codelineno-0-322" href="#__codelineno-0-322"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-323" name="__codelineno-0-323" href="#__codelineno-0-323"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-324" name="__codelineno-0-324" href="#__codelineno-0-324"></a><span class="sd">        &quot;all&quot; can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-0-325" name="__codelineno-0-325" href="#__codelineno-0-325"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-0-326" name="__codelineno-0-326" href="#__codelineno-0-326"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-0-327" name="__codelineno-0-327" href="#__codelineno-0-327"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-0-328" name="__codelineno-0-328" href="#__codelineno-0-328"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-329" name="__codelineno-0-329" href="#__codelineno-0-329"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-330" name="__codelineno-0-330" href="#__codelineno-0-330"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-331" name="__codelineno-0-331" href="#__codelineno-0-331"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-0-332" name="__codelineno-0-332" href="#__codelineno-0-332"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-0-333" name="__codelineno-0-333" href="#__codelineno-0-333"></a><span class="sd">    label_col</span>
<a id="__codelineno-0-334" name="__codelineno-0-334" href="#__codelineno-0-334"></a><span class="sd">        Label/Target column (Default value = &quot;label&quot;)</span>
<a id="__codelineno-0-335" name="__codelineno-0-335" href="#__codelineno-0-335"></a><span class="sd">    event_label</span>
<a id="__codelineno-0-336" name="__codelineno-0-336" href="#__codelineno-0-336"></a><span class="sd">        Value of (positive) event (i.e label 1) (Default value = 1)</span>
<a id="__codelineno-0-337" name="__codelineno-0-337" href="#__codelineno-0-337"></a><span class="sd">    bin_method</span>
<a id="__codelineno-0-338" name="__codelineno-0-338" href="#__codelineno-0-338"></a><span class="sd">        &quot;equal_frequency&quot;, &quot;equal_range&quot;.</span>
<a id="__codelineno-0-339" name="__codelineno-0-339" href="#__codelineno-0-339"></a><span class="sd">        In &quot;equal_range&quot; method, each bin is of equal size/width and in &quot;equal_frequency&quot;, each bin has</span>
<a id="__codelineno-0-340" name="__codelineno-0-340" href="#__codelineno-0-340"></a><span class="sd">        equal no. of rows, though the width of bins may vary. (Default value = &quot;equal_range&quot;)</span>
<a id="__codelineno-0-341" name="__codelineno-0-341" href="#__codelineno-0-341"></a><span class="sd">    bin_size</span>
<a id="__codelineno-0-342" name="__codelineno-0-342" href="#__codelineno-0-342"></a><span class="sd">        Default number of bins in case monotonicity is not achieved.</span>
<a id="__codelineno-0-343" name="__codelineno-0-343" href="#__codelineno-0-343"></a><span class="sd">    bin_dtype</span>
<a id="__codelineno-0-344" name="__codelineno-0-344" href="#__codelineno-0-344"></a><span class="sd">        &quot;numerical&quot;, &quot;categorical&quot;.</span>
<a id="__codelineno-0-345" name="__codelineno-0-345" href="#__codelineno-0-345"></a><span class="sd">        With &quot;numerical&quot; option, original value is replaced with an Integer (1,2,…) and</span>
<a id="__codelineno-0-346" name="__codelineno-0-346" href="#__codelineno-0-346"></a><span class="sd">        with &quot;categorical&quot; option, original replaced with a string describing min and max value allowed</span>
<a id="__codelineno-0-347" name="__codelineno-0-347" href="#__codelineno-0-347"></a><span class="sd">        in the bin (&quot;minval-maxval&quot;). (Default value = &quot;numerical&quot;)</span>
<a id="__codelineno-0-348" name="__codelineno-0-348" href="#__codelineno-0-348"></a><span class="sd">    output_mode</span>
<a id="__codelineno-0-349" name="__codelineno-0-349" href="#__codelineno-0-349"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-0-350" name="__codelineno-0-350" href="#__codelineno-0-350"></a><span class="sd">        “replace” option replaces original columns with transformed column. “append” option append transformed</span>
<a id="__codelineno-0-351" name="__codelineno-0-351" href="#__codelineno-0-351"></a><span class="sd">        column to the input dataset with a postfix &quot;_binned&quot; e.g. column X is appended as X_binned. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-0-352" name="__codelineno-0-352" href="#__codelineno-0-352"></a>
<a id="__codelineno-0-353" name="__codelineno-0-353" href="#__codelineno-0-353"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-354" name="__codelineno-0-354" href="#__codelineno-0-354"></a><span class="sd">    -------</span>
<a id="__codelineno-0-355" name="__codelineno-0-355" href="#__codelineno-0-355"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-0-356" name="__codelineno-0-356" href="#__codelineno-0-356"></a><span class="sd">        Binned Dataframe</span>
<a id="__codelineno-0-357" name="__codelineno-0-357" href="#__codelineno-0-357"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-358" name="__codelineno-0-358" href="#__codelineno-0-358"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-359" name="__codelineno-0-359" href="#__codelineno-0-359"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-360" name="__codelineno-0-360" href="#__codelineno-0-360"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-0-361" name="__codelineno-0-361" href="#__codelineno-0-361"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-362" name="__codelineno-0-362" href="#__codelineno-0-362"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-363" name="__codelineno-0-363" href="#__codelineno-0-363"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-364" name="__codelineno-0-364" href="#__codelineno-0-364"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-365" name="__codelineno-0-365" href="#__codelineno-0-365"></a>
<a id="__codelineno-0-366" name="__codelineno-0-366" href="#__codelineno-0-366"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
<a id="__codelineno-0-367" name="__codelineno-0-367" href="#__codelineno-0-367"></a>        <span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">drop_cols</span> <span class="o">+</span> <span class="p">[</span><span class="n">label_col</span><span class="p">])])</span>
<a id="__codelineno-0-368" name="__codelineno-0-368" href="#__codelineno-0-368"></a>    <span class="p">)</span>
<a id="__codelineno-0-369" name="__codelineno-0-369" href="#__codelineno-0-369"></a>
<a id="__codelineno-0-370" name="__codelineno-0-370" href="#__codelineno-0-370"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-371" name="__codelineno-0-371" href="#__codelineno-0-371"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-372" name="__codelineno-0-372" href="#__codelineno-0-372"></a>
<a id="__codelineno-0-373" name="__codelineno-0-373" href="#__codelineno-0-373"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-374" name="__codelineno-0-374" href="#__codelineno-0-374"></a>    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-375" name="__codelineno-0-375" href="#__codelineno-0-375"></a>        <span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
<a id="__codelineno-0-376" name="__codelineno-0-376" href="#__codelineno-0-376"></a>        <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-377" name="__codelineno-0-377" href="#__codelineno-0-377"></a>        <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-378" name="__codelineno-0-378" href="#__codelineno-0-378"></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-379" name="__codelineno-0-379" href="#__codelineno-0-379"></a>                <span class="n">attribute_binning</span><span class="p">(</span>
<a id="__codelineno-0-380" name="__codelineno-0-380" href="#__codelineno-0-380"></a>                    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-381" name="__codelineno-0-381" href="#__codelineno-0-381"></a>                    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-382" name="__codelineno-0-382" href="#__codelineno-0-382"></a>                    <span class="p">[</span><span class="n">col</span><span class="p">],</span>
<a id="__codelineno-0-383" name="__codelineno-0-383" href="#__codelineno-0-383"></a>                    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-384" name="__codelineno-0-384" href="#__codelineno-0-384"></a>                    <span class="n">method_type</span><span class="o">=</span><span class="n">bin_method</span><span class="p">,</span>
<a id="__codelineno-0-385" name="__codelineno-0-385" href="#__codelineno-0-385"></a>                    <span class="n">bin_size</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
<a id="__codelineno-0-386" name="__codelineno-0-386" href="#__codelineno-0-386"></a>                    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
<a id="__codelineno-0-387" name="__codelineno-0-387" href="#__codelineno-0-387"></a>                <span class="p">)</span>
<a id="__codelineno-0-388" name="__codelineno-0-388" href="#__codelineno-0-388"></a>                <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">label_col</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">col</span> <span class="o">+</span> <span class="s2">&quot;_binned&quot;</span><span class="p">)</span>
<a id="__codelineno-0-389" name="__codelineno-0-389" href="#__codelineno-0-389"></a>                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-390" name="__codelineno-0-390" href="#__codelineno-0-390"></a>                    <span class="n">label_col</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">label_col</span><span class="p">)</span> <span class="o">==</span> <span class="n">event_label</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-391" name="__codelineno-0-391" href="#__codelineno-0-391"></a>                <span class="p">)</span>
<a id="__codelineno-0-392" name="__codelineno-0-392" href="#__codelineno-0-392"></a>                <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">col</span> <span class="o">+</span> <span class="s2">&quot;_binned&quot;</span><span class="p">)</span>
<a id="__codelineno-0-393" name="__codelineno-0-393" href="#__codelineno-0-393"></a>                <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;mean_val&quot;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="n">label_col</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;mean_label&quot;</span><span class="p">))</span>
<a id="__codelineno-0-394" name="__codelineno-0-394" href="#__codelineno-0-394"></a>                <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<a id="__codelineno-0-395" name="__codelineno-0-395" href="#__codelineno-0-395"></a>            <span class="p">)</span>
<a id="__codelineno-0-396" name="__codelineno-0-396" href="#__codelineno-0-396"></a>            <span class="n">r</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">spearmanr</span><span class="p">(</span>
<a id="__codelineno-0-397" name="__codelineno-0-397" href="#__codelineno-0-397"></a>                <span class="n">tmp</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()[[</span><span class="s2">&quot;mean_val&quot;</span><span class="p">]],</span> <span class="n">tmp</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()[[</span><span class="s2">&quot;mean_label&quot;</span><span class="p">]]</span>
<a id="__codelineno-0-398" name="__codelineno-0-398" href="#__codelineno-0-398"></a>            <span class="p">)</span>
<a id="__codelineno-0-399" name="__codelineno-0-399" href="#__codelineno-0-399"></a>            <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
<a id="__codelineno-0-400" name="__codelineno-0-400" href="#__codelineno-0-400"></a>                <span class="n">odf</span> <span class="o">=</span> <span class="n">attribute_binning</span><span class="p">(</span>
<a id="__codelineno-0-401" name="__codelineno-0-401" href="#__codelineno-0-401"></a>                    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-402" name="__codelineno-0-402" href="#__codelineno-0-402"></a>                    <span class="n">odf</span><span class="p">,</span>
<a id="__codelineno-0-403" name="__codelineno-0-403" href="#__codelineno-0-403"></a>                    <span class="p">[</span><span class="n">col</span><span class="p">],</span>
<a id="__codelineno-0-404" name="__codelineno-0-404" href="#__codelineno-0-404"></a>                    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-405" name="__codelineno-0-405" href="#__codelineno-0-405"></a>                    <span class="n">method_type</span><span class="o">=</span><span class="n">bin_method</span><span class="p">,</span>
<a id="__codelineno-0-406" name="__codelineno-0-406" href="#__codelineno-0-406"></a>                    <span class="n">bin_size</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
<a id="__codelineno-0-407" name="__codelineno-0-407" href="#__codelineno-0-407"></a>                    <span class="n">bin_dtype</span><span class="o">=</span><span class="n">bin_dtype</span><span class="p">,</span>
<a id="__codelineno-0-408" name="__codelineno-0-408" href="#__codelineno-0-408"></a>                    <span class="n">output_mode</span><span class="o">=</span><span class="n">output_mode</span><span class="p">,</span>
<a id="__codelineno-0-409" name="__codelineno-0-409" href="#__codelineno-0-409"></a>                <span class="p">)</span>
<a id="__codelineno-0-410" name="__codelineno-0-410" href="#__codelineno-0-410"></a>                <span class="k">break</span>
<a id="__codelineno-0-411" name="__codelineno-0-411" href="#__codelineno-0-411"></a>            <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-412" name="__codelineno-0-412" href="#__codelineno-0-412"></a>            <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-413" name="__codelineno-0-413" href="#__codelineno-0-413"></a>        <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
<a id="__codelineno-0-414" name="__codelineno-0-414" href="#__codelineno-0-414"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">attribute_binning</span><span class="p">(</span>
<a id="__codelineno-0-415" name="__codelineno-0-415" href="#__codelineno-0-415"></a>                <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-416" name="__codelineno-0-416" href="#__codelineno-0-416"></a>                <span class="n">odf</span><span class="p">,</span>
<a id="__codelineno-0-417" name="__codelineno-0-417" href="#__codelineno-0-417"></a>                <span class="p">[</span><span class="n">col</span><span class="p">],</span>
<a id="__codelineno-0-418" name="__codelineno-0-418" href="#__codelineno-0-418"></a>                <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-419" name="__codelineno-0-419" href="#__codelineno-0-419"></a>                <span class="n">method_type</span><span class="o">=</span><span class="n">bin_method</span><span class="p">,</span>
<a id="__codelineno-0-420" name="__codelineno-0-420" href="#__codelineno-0-420"></a>                <span class="n">bin_size</span><span class="o">=</span><span class="n">bin_size</span><span class="p">,</span>
<a id="__codelineno-0-421" name="__codelineno-0-421" href="#__codelineno-0-421"></a>                <span class="n">bin_dtype</span><span class="o">=</span><span class="n">bin_dtype</span><span class="p">,</span>
<a id="__codelineno-0-422" name="__codelineno-0-422" href="#__codelineno-0-422"></a>                <span class="n">output_mode</span><span class="o">=</span><span class="n">output_mode</span><span class="p">,</span>
<a id="__codelineno-0-423" name="__codelineno-0-423" href="#__codelineno-0-423"></a>            <span class="p">)</span>
<a id="__codelineno-0-424" name="__codelineno-0-424" href="#__codelineno-0-424"></a>
<a id="__codelineno-0-425" name="__codelineno-0-425" href="#__codelineno-0-425"></a>    <span class="k">return</span> <span class="n">odf</span>
<a id="__codelineno-0-426" name="__codelineno-0-426" href="#__codelineno-0-426"></a>
<a id="__codelineno-0-427" name="__codelineno-0-427" href="#__codelineno-0-427"></a>
<a id="__codelineno-0-428" name="__codelineno-0-428" href="#__codelineno-0-428"></a><span class="k">def</span> <span class="nf">cat_to_num_transformer</span><span class="p">(</span>
<a id="__codelineno-0-429" name="__codelineno-0-429" href="#__codelineno-0-429"></a>    <span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">,</span> <span class="n">drop_cols</span><span class="p">,</span> <span class="n">method_type</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">label_col</span><span class="p">,</span> <span class="n">event_label</span>
<a id="__codelineno-0-430" name="__codelineno-0-430" href="#__codelineno-0-430"></a><span class="p">):</span>
<a id="__codelineno-0-431" name="__codelineno-0-431" href="#__codelineno-0-431"></a>
<a id="__codelineno-0-432" name="__codelineno-0-432" href="#__codelineno-0-432"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-433" name="__codelineno-0-433" href="#__codelineno-0-433"></a><span class="sd">    This is method which helps converting a categorical attribute into numerical attribute(s) based on the analysis dataset. If there&#39;s a presence of label column then the relevant processing would happen through cat_to_num_supervised. However, for unsupervised scenario, the processing would happen through cat_to_num_unsupervised. Computation details can be referred from the respective functions.</span>
<a id="__codelineno-0-434" name="__codelineno-0-434" href="#__codelineno-0-434"></a>
<a id="__codelineno-0-435" name="__codelineno-0-435" href="#__codelineno-0-435"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-436" name="__codelineno-0-436" href="#__codelineno-0-436"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-437" name="__codelineno-0-437" href="#__codelineno-0-437"></a><span class="sd">    spark</span>
<a id="__codelineno-0-438" name="__codelineno-0-438" href="#__codelineno-0-438"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-0-439" name="__codelineno-0-439" href="#__codelineno-0-439"></a><span class="sd">    idf</span>
<a id="__codelineno-0-440" name="__codelineno-0-440" href="#__codelineno-0-440"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-441" name="__codelineno-0-441" href="#__codelineno-0-441"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-0-442" name="__codelineno-0-442" href="#__codelineno-0-442"></a><span class="sd">        List of categorical columns to transform e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-443" name="__codelineno-0-443" href="#__codelineno-0-443"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-444" name="__codelineno-0-444" href="#__codelineno-0-444"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-445" name="__codelineno-0-445" href="#__codelineno-0-445"></a><span class="sd">        &quot;all&quot; can be passed to include all categorical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-0-446" name="__codelineno-0-446" href="#__codelineno-0-446"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-0-447" name="__codelineno-0-447" href="#__codelineno-0-447"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols.</span>
<a id="__codelineno-0-448" name="__codelineno-0-448" href="#__codelineno-0-448"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-0-449" name="__codelineno-0-449" href="#__codelineno-0-449"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-450" name="__codelineno-0-450" href="#__codelineno-0-450"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-451" name="__codelineno-0-451" href="#__codelineno-0-451"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-452" name="__codelineno-0-452" href="#__codelineno-0-452"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-0-453" name="__codelineno-0-453" href="#__codelineno-0-453"></a><span class="sd">        a few handful of them.</span>
<a id="__codelineno-0-454" name="__codelineno-0-454" href="#__codelineno-0-454"></a><span class="sd">    method_type</span>
<a id="__codelineno-0-455" name="__codelineno-0-455" href="#__codelineno-0-455"></a><span class="sd">        Depending upon the use case the method type can be either Supervised or Unsupervised. For Supervised use case, label_col is mandatory.</span>
<a id="__codelineno-0-456" name="__codelineno-0-456" href="#__codelineno-0-456"></a><span class="sd">    encoding</span>
<a id="__codelineno-0-457" name="__codelineno-0-457" href="#__codelineno-0-457"></a><span class="sd">        &quot;label_encoding&quot; or &quot;onehot_encoding&quot;</span>
<a id="__codelineno-0-458" name="__codelineno-0-458" href="#__codelineno-0-458"></a><span class="sd">        In label encoding, each categorical value is assigned a unique integer based on alphabetical</span>
<a id="__codelineno-0-459" name="__codelineno-0-459" href="#__codelineno-0-459"></a><span class="sd">        or frequency ordering (both ascending &amp; descending options are available that can be selected by index_order argument).</span>
<a id="__codelineno-0-460" name="__codelineno-0-460" href="#__codelineno-0-460"></a><span class="sd">        In one-hot encoding, every unique value in the column will be added in a form of dummy/binary column.</span>
<a id="__codelineno-0-461" name="__codelineno-0-461" href="#__codelineno-0-461"></a><span class="sd">    label_col</span>
<a id="__codelineno-0-462" name="__codelineno-0-462" href="#__codelineno-0-462"></a><span class="sd">        Label/Target column</span>
<a id="__codelineno-0-463" name="__codelineno-0-463" href="#__codelineno-0-463"></a><span class="sd">    event_label</span>
<a id="__codelineno-0-464" name="__codelineno-0-464" href="#__codelineno-0-464"></a><span class="sd">        Value of (positive) event</span>
<a id="__codelineno-0-465" name="__codelineno-0-465" href="#__codelineno-0-465"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-466" name="__codelineno-0-466" href="#__codelineno-0-466"></a>
<a id="__codelineno-0-467" name="__codelineno-0-467" href="#__codelineno-0-467"></a>    <span class="n">num_cols</span><span class="p">,</span> <span class="n">cat_cols</span><span class="p">,</span> <span class="n">other_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)</span>
<a id="__codelineno-0-468" name="__codelineno-0-468" href="#__codelineno-0-468"></a>
<a id="__codelineno-0-469" name="__codelineno-0-469" href="#__codelineno-0-469"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cat_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-470" name="__codelineno-0-470" href="#__codelineno-0-470"></a>        <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-471" name="__codelineno-0-471" href="#__codelineno-0-471"></a>            <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">cat_cols</span>
<a id="__codelineno-0-472" name="__codelineno-0-472" href="#__codelineno-0-472"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-473" name="__codelineno-0-473" href="#__codelineno-0-473"></a>            <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-474" name="__codelineno-0-474" href="#__codelineno-0-474"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-475" name="__codelineno-0-475" href="#__codelineno-0-475"></a>            <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-476" name="__codelineno-0-476" href="#__codelineno-0-476"></a>
<a id="__codelineno-0-477" name="__codelineno-0-477" href="#__codelineno-0-477"></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cat_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-478" name="__codelineno-0-478" href="#__codelineno-0-478"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-479" name="__codelineno-0-479" href="#__codelineno-0-479"></a>
<a id="__codelineno-0-480" name="__codelineno-0-480" href="#__codelineno-0-480"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">method_type</span> <span class="o">==</span> <span class="s2">&quot;supervised&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">label_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-481" name="__codelineno-0-481" href="#__codelineno-0-481"></a>
<a id="__codelineno-0-482" name="__codelineno-0-482" href="#__codelineno-0-482"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">cat_to_num_supervised</span><span class="p">(</span>
<a id="__codelineno-0-483" name="__codelineno-0-483" href="#__codelineno-0-483"></a>                <span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">label_col</span><span class="o">=</span><span class="n">label_col</span><span class="p">,</span> <span class="n">event_label</span><span class="o">=</span><span class="n">event_label</span>
<a id="__codelineno-0-484" name="__codelineno-0-484" href="#__codelineno-0-484"></a>            <span class="p">)</span>
<a id="__codelineno-0-485" name="__codelineno-0-485" href="#__codelineno-0-485"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-486" name="__codelineno-0-486" href="#__codelineno-0-486"></a>                <span class="n">label_col</span><span class="p">,</span>
<a id="__codelineno-0-487" name="__codelineno-0-487" href="#__codelineno-0-487"></a>                <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">label_col</span><span class="p">)</span> <span class="o">==</span> <span class="n">event_label</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>
<a id="__codelineno-0-488" name="__codelineno-0-488" href="#__codelineno-0-488"></a>            <span class="p">)</span>
<a id="__codelineno-0-489" name="__codelineno-0-489" href="#__codelineno-0-489"></a>
<a id="__codelineno-0-490" name="__codelineno-0-490" href="#__codelineno-0-490"></a>            <span class="k">return</span> <span class="n">odf</span>
<a id="__codelineno-0-491" name="__codelineno-0-491" href="#__codelineno-0-491"></a>
<a id="__codelineno-0-492" name="__codelineno-0-492" href="#__codelineno-0-492"></a>        <span class="k">elif</span> <span class="p">(</span><span class="n">method_type</span> <span class="o">==</span> <span class="s2">&quot;unsupervised&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">label_col</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-493" name="__codelineno-0-493" href="#__codelineno-0-493"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">cat_to_num_unsupervised</span><span class="p">(</span>
<a id="__codelineno-0-494" name="__codelineno-0-494" href="#__codelineno-0-494"></a>                <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-495" name="__codelineno-0-495" href="#__codelineno-0-495"></a>                <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-496" name="__codelineno-0-496" href="#__codelineno-0-496"></a>                <span class="n">method_type</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
<a id="__codelineno-0-497" name="__codelineno-0-497" href="#__codelineno-0-497"></a>                <span class="n">index_order</span><span class="o">=</span><span class="s2">&quot;frequencyDesc&quot;</span><span class="p">,</span>
<a id="__codelineno-0-498" name="__codelineno-0-498" href="#__codelineno-0-498"></a>            <span class="p">)</span>
<a id="__codelineno-0-499" name="__codelineno-0-499" href="#__codelineno-0-499"></a>
<a id="__codelineno-0-500" name="__codelineno-0-500" href="#__codelineno-0-500"></a>            <span class="k">return</span> <span class="n">odf</span>
<a id="__codelineno-0-501" name="__codelineno-0-501" href="#__codelineno-0-501"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-502" name="__codelineno-0-502" href="#__codelineno-0-502"></a>
<a id="__codelineno-0-503" name="__codelineno-0-503" href="#__codelineno-0-503"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-0-504" name="__codelineno-0-504" href="#__codelineno-0-504"></a>
<a id="__codelineno-0-505" name="__codelineno-0-505" href="#__codelineno-0-505"></a>
<a id="__codelineno-0-506" name="__codelineno-0-506" href="#__codelineno-0-506"></a><span class="k">def</span> <span class="nf">cat_to_num_unsupervised</span><span class="p">(</span>
<a id="__codelineno-0-507" name="__codelineno-0-507" href="#__codelineno-0-507"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-508" name="__codelineno-0-508" href="#__codelineno-0-508"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-509" name="__codelineno-0-509" href="#__codelineno-0-509"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-0-510" name="__codelineno-0-510" href="#__codelineno-0-510"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-511" name="__codelineno-0-511" href="#__codelineno-0-511"></a>    <span class="n">method_type</span><span class="o">=</span><span class="s2">&quot;label_encoding&quot;</span><span class="p">,</span>
<a id="__codelineno-0-512" name="__codelineno-0-512" href="#__codelineno-0-512"></a>    <span class="n">index_order</span><span class="o">=</span><span class="s2">&quot;frequencyDesc&quot;</span><span class="p">,</span>
<a id="__codelineno-0-513" name="__codelineno-0-513" href="#__codelineno-0-513"></a>    <span class="n">cardinality_threshold</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-0-514" name="__codelineno-0-514" href="#__codelineno-0-514"></a>    <span class="n">pre_existing_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-515" name="__codelineno-0-515" href="#__codelineno-0-515"></a>    <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-0-516" name="__codelineno-0-516" href="#__codelineno-0-516"></a>    <span class="n">stats_unique</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-0-517" name="__codelineno-0-517" href="#__codelineno-0-517"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-0-518" name="__codelineno-0-518" href="#__codelineno-0-518"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-519" name="__codelineno-0-519" href="#__codelineno-0-519"></a><span class="p">):</span>
<a id="__codelineno-0-520" name="__codelineno-0-520" href="#__codelineno-0-520"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-521" name="__codelineno-0-521" href="#__codelineno-0-521"></a><span class="sd">    This is unsupervised method of converting a categorical attribute into numerical attribute(s). This is among</span>
<a id="__codelineno-0-522" name="__codelineno-0-522" href="#__codelineno-0-522"></a><span class="sd">    the most important transformations required for any modelling exercise, as most of the machine learning</span>
<a id="__codelineno-0-523" name="__codelineno-0-523" href="#__codelineno-0-523"></a><span class="sd">    algorithms cannot process categorical values. It covers two popular encoding techniques – label encoding &amp;</span>
<a id="__codelineno-0-524" name="__codelineno-0-524" href="#__codelineno-0-524"></a><span class="sd">    one-hot encoding.</span>
<a id="__codelineno-0-525" name="__codelineno-0-525" href="#__codelineno-0-525"></a>
<a id="__codelineno-0-526" name="__codelineno-0-526" href="#__codelineno-0-526"></a><span class="sd">    In label encoding, each categorical value is assigned a unique integer based on alphabetical or frequency</span>
<a id="__codelineno-0-527" name="__codelineno-0-527" href="#__codelineno-0-527"></a><span class="sd">    ordering (both ascending &amp; descending options are available – can be selected by index_order argument). One of</span>
<a id="__codelineno-0-528" name="__codelineno-0-528" href="#__codelineno-0-528"></a><span class="sd">    the pitfalls of using this technique is that the model may learn some spurious relationship, which doesn&#39;t exist</span>
<a id="__codelineno-0-529" name="__codelineno-0-529" href="#__codelineno-0-529"></a><span class="sd">    or might not make any logical sense in the real world settings. In one-hot encoding, every unique value in the</span>
<a id="__codelineno-0-530" name="__codelineno-0-530" href="#__codelineno-0-530"></a><span class="sd">    attribute will be added as a feature in a form of dummy/binary attribute. However, using this method on high</span>
<a id="__codelineno-0-531" name="__codelineno-0-531" href="#__codelineno-0-531"></a><span class="sd">    cardinality attributes can further aggravate the dimensionality issue.</span>
<a id="__codelineno-0-532" name="__codelineno-0-532" href="#__codelineno-0-532"></a>
<a id="__codelineno-0-533" name="__codelineno-0-533" href="#__codelineno-0-533"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-534" name="__codelineno-0-534" href="#__codelineno-0-534"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-535" name="__codelineno-0-535" href="#__codelineno-0-535"></a><span class="sd">    spark</span>
<a id="__codelineno-0-536" name="__codelineno-0-536" href="#__codelineno-0-536"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-0-537" name="__codelineno-0-537" href="#__codelineno-0-537"></a><span class="sd">    idf</span>
<a id="__codelineno-0-538" name="__codelineno-0-538" href="#__codelineno-0-538"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-539" name="__codelineno-0-539" href="#__codelineno-0-539"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-0-540" name="__codelineno-0-540" href="#__codelineno-0-540"></a><span class="sd">        List of categorical columns to transform e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-541" name="__codelineno-0-541" href="#__codelineno-0-541"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-542" name="__codelineno-0-542" href="#__codelineno-0-542"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-543" name="__codelineno-0-543" href="#__codelineno-0-543"></a><span class="sd">        &quot;all&quot; can be passed to include all categorical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-0-544" name="__codelineno-0-544" href="#__codelineno-0-544"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-0-545" name="__codelineno-0-545" href="#__codelineno-0-545"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-0-546" name="__codelineno-0-546" href="#__codelineno-0-546"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-0-547" name="__codelineno-0-547" href="#__codelineno-0-547"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-548" name="__codelineno-0-548" href="#__codelineno-0-548"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-549" name="__codelineno-0-549" href="#__codelineno-0-549"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-550" name="__codelineno-0-550" href="#__codelineno-0-550"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-0-551" name="__codelineno-0-551" href="#__codelineno-0-551"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-0-552" name="__codelineno-0-552" href="#__codelineno-0-552"></a><span class="sd">    method_type</span>
<a id="__codelineno-0-553" name="__codelineno-0-553" href="#__codelineno-0-553"></a><span class="sd">        &quot;label_encoding&quot; or &quot;onehot_encoding&quot;</span>
<a id="__codelineno-0-554" name="__codelineno-0-554" href="#__codelineno-0-554"></a><span class="sd">        In label encoding, each categorical value is assigned a unique integer based on alphabetical</span>
<a id="__codelineno-0-555" name="__codelineno-0-555" href="#__codelineno-0-555"></a><span class="sd">        or frequency ordering (both ascending &amp; descending options are available that can be selected by index_order argument).</span>
<a id="__codelineno-0-556" name="__codelineno-0-556" href="#__codelineno-0-556"></a><span class="sd">        In one-hot encoding, every unique value in the column will be added in a form of dummy/binary column. (Default value = 1)</span>
<a id="__codelineno-0-557" name="__codelineno-0-557" href="#__codelineno-0-557"></a><span class="sd">    index_order</span>
<a id="__codelineno-0-558" name="__codelineno-0-558" href="#__codelineno-0-558"></a><span class="sd">        &quot;frequencyDesc&quot;, &quot;frequencyAsc&quot;, &quot;alphabetDesc&quot;, &quot;alphabetAsc&quot;.</span>
<a id="__codelineno-0-559" name="__codelineno-0-559" href="#__codelineno-0-559"></a><span class="sd">        Valid only for Label Encoding method_type. (Default value = &quot;frequencyDesc&quot;)</span>
<a id="__codelineno-0-560" name="__codelineno-0-560" href="#__codelineno-0-560"></a><span class="sd">    cardinality_threshold</span>
<a id="__codelineno-0-561" name="__codelineno-0-561" href="#__codelineno-0-561"></a><span class="sd">        Defines threshold to skip columns with higher cardinality values from encoding - a warning is issued. (Default value = 50)</span>
<a id="__codelineno-0-562" name="__codelineno-0-562" href="#__codelineno-0-562"></a><span class="sd">    pre_existing_model</span>
<a id="__codelineno-0-563" name="__codelineno-0-563" href="#__codelineno-0-563"></a><span class="sd">        Boolean argument - True or False. True if encoding model exists already, False Otherwise. (Default value = False)</span>
<a id="__codelineno-0-564" name="__codelineno-0-564" href="#__codelineno-0-564"></a><span class="sd">    model_path</span>
<a id="__codelineno-0-565" name="__codelineno-0-565" href="#__codelineno-0-565"></a><span class="sd">        If pre_existing_model is True, this argument is path for referring the pre-saved model.</span>
<a id="__codelineno-0-566" name="__codelineno-0-566" href="#__codelineno-0-566"></a><span class="sd">        If pre_existing_model is False, this argument can be used for saving the model.</span>
<a id="__codelineno-0-567" name="__codelineno-0-567" href="#__codelineno-0-567"></a><span class="sd">        Default &quot;NA&quot; means there is neither pre existing model nor there is a need to save one.</span>
<a id="__codelineno-0-568" name="__codelineno-0-568" href="#__codelineno-0-568"></a><span class="sd">    stats_unique</span>
<a id="__codelineno-0-569" name="__codelineno-0-569" href="#__codelineno-0-569"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-0-570" name="__codelineno-0-570" href="#__codelineno-0-570"></a><span class="sd">        to read pre-saved statistics on unique value count i.e. if measures_of_cardinality or</span>
<a id="__codelineno-0-571" name="__codelineno-0-571" href="#__codelineno-0-571"></a><span class="sd">        uniqueCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-0-572" name="__codelineno-0-572" href="#__codelineno-0-572"></a><span class="sd">    output_mode</span>
<a id="__codelineno-0-573" name="__codelineno-0-573" href="#__codelineno-0-573"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-0-574" name="__codelineno-0-574" href="#__codelineno-0-574"></a><span class="sd">        “replace” option replaces original columns with transformed column. “append” option append transformed</span>
<a id="__codelineno-0-575" name="__codelineno-0-575" href="#__codelineno-0-575"></a><span class="sd">        column to the input dataset with a postfix &quot;_index&quot; for label encoding e.g. column X is appended as X_index, or</span>
<a id="__codelineno-0-576" name="__codelineno-0-576" href="#__codelineno-0-576"></a><span class="sd">        a postfix &quot;_{n}&quot; for one hot encoding, n varies from 0 to unique value count e.g. column X is appended as X_0,</span>
<a id="__codelineno-0-577" name="__codelineno-0-577" href="#__codelineno-0-577"></a><span class="sd">        X_1, X_2 (n = 3 i.e. no. of unique values for X). (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-0-578" name="__codelineno-0-578" href="#__codelineno-0-578"></a><span class="sd">    print_impact</span>
<a id="__codelineno-0-579" name="__codelineno-0-579" href="#__codelineno-0-579"></a><span class="sd">        True, False (Default value = False)</span>
<a id="__codelineno-0-580" name="__codelineno-0-580" href="#__codelineno-0-580"></a><span class="sd">        This argument is to print out the change in schema (one hot encoding) or descriptive statistics (label encoding)</span>
<a id="__codelineno-0-581" name="__codelineno-0-581" href="#__codelineno-0-581"></a>
<a id="__codelineno-0-582" name="__codelineno-0-582" href="#__codelineno-0-582"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-583" name="__codelineno-0-583" href="#__codelineno-0-583"></a><span class="sd">    -------</span>
<a id="__codelineno-0-584" name="__codelineno-0-584" href="#__codelineno-0-584"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-0-585" name="__codelineno-0-585" href="#__codelineno-0-585"></a><span class="sd">        Encoded Dataframe</span>
<a id="__codelineno-0-586" name="__codelineno-0-586" href="#__codelineno-0-586"></a>
<a id="__codelineno-0-587" name="__codelineno-0-587" href="#__codelineno-0-587"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-588" name="__codelineno-0-588" href="#__codelineno-0-588"></a>
<a id="__codelineno-0-589" name="__codelineno-0-589" href="#__codelineno-0-589"></a>    <span class="n">cat_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-590" name="__codelineno-0-590" href="#__codelineno-0-590"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-591" name="__codelineno-0-591" href="#__codelineno-0-591"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">cat_cols</span>
<a id="__codelineno-0-592" name="__codelineno-0-592" href="#__codelineno-0-592"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-593" name="__codelineno-0-593" href="#__codelineno-0-593"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-594" name="__codelineno-0-594" href="#__codelineno-0-594"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-595" name="__codelineno-0-595" href="#__codelineno-0-595"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-596" name="__codelineno-0-596" href="#__codelineno-0-596"></a>
<a id="__codelineno-0-597" name="__codelineno-0-597" href="#__codelineno-0-597"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cat_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-598" name="__codelineno-0-598" href="#__codelineno-0-598"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-599" name="__codelineno-0-599" href="#__codelineno-0-599"></a>
<a id="__codelineno-0-600" name="__codelineno-0-600" href="#__codelineno-0-600"></a>    <span class="k">if</span> <span class="n">method_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;onehot_encoding&quot;</span><span class="p">,</span> <span class="s2">&quot;label_encoding&quot;</span><span class="p">):</span>
<a id="__codelineno-0-601" name="__codelineno-0-601" href="#__codelineno-0-601"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for method_type&quot;</span><span class="p">)</span>
<a id="__codelineno-0-602" name="__codelineno-0-602" href="#__codelineno-0-602"></a>    <span class="k">if</span> <span class="n">index_order</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
<a id="__codelineno-0-603" name="__codelineno-0-603" href="#__codelineno-0-603"></a>        <span class="s2">&quot;frequencyDesc&quot;</span><span class="p">,</span>
<a id="__codelineno-0-604" name="__codelineno-0-604" href="#__codelineno-0-604"></a>        <span class="s2">&quot;frequencyAsc&quot;</span><span class="p">,</span>
<a id="__codelineno-0-605" name="__codelineno-0-605" href="#__codelineno-0-605"></a>        <span class="s2">&quot;alphabetDesc&quot;</span><span class="p">,</span>
<a id="__codelineno-0-606" name="__codelineno-0-606" href="#__codelineno-0-606"></a>        <span class="s2">&quot;alphabetAsc&quot;</span><span class="p">,</span>
<a id="__codelineno-0-607" name="__codelineno-0-607" href="#__codelineno-0-607"></a>    <span class="p">):</span>
<a id="__codelineno-0-608" name="__codelineno-0-608" href="#__codelineno-0-608"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Encoding Index Order&quot;</span><span class="p">)</span>
<a id="__codelineno-0-609" name="__codelineno-0-609" href="#__codelineno-0-609"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">):</span>
<a id="__codelineno-0-610" name="__codelineno-0-610" href="#__codelineno-0-610"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for output_mode&quot;</span><span class="p">)</span>
<a id="__codelineno-0-611" name="__codelineno-0-611" href="#__codelineno-0-611"></a>
<a id="__codelineno-0-612" name="__codelineno-0-612" href="#__codelineno-0-612"></a>    <span class="k">if</span> <span class="n">stats_unique</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-0-613" name="__codelineno-0-613" href="#__codelineno-0-613"></a>        <span class="n">skip_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-614" name="__codelineno-0-614" href="#__codelineno-0-614"></a>            <span class="n">uniqueCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-0-615" name="__codelineno-0-615" href="#__codelineno-0-615"></a>            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;unique_values&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">cardinality_threshold</span><span class="p">)</span>
<a id="__codelineno-0-616" name="__codelineno-0-616" href="#__codelineno-0-616"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-0-617" name="__codelineno-0-617" href="#__codelineno-0-617"></a>            <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-618" name="__codelineno-0-618" href="#__codelineno-0-618"></a>            <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-619" name="__codelineno-0-619" href="#__codelineno-0-619"></a>        <span class="p">)</span>
<a id="__codelineno-0-620" name="__codelineno-0-620" href="#__codelineno-0-620"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-621" name="__codelineno-0-621" href="#__codelineno-0-621"></a>        <span class="n">skip_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-622" name="__codelineno-0-622" href="#__codelineno-0-622"></a>            <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_unique</span><span class="p">)</span>
<a id="__codelineno-0-623" name="__codelineno-0-623" href="#__codelineno-0-623"></a>            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;unique_values&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">cardinality_threshold</span><span class="p">)</span>
<a id="__codelineno-0-624" name="__codelineno-0-624" href="#__codelineno-0-624"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-0-625" name="__codelineno-0-625" href="#__codelineno-0-625"></a>            <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-626" name="__codelineno-0-626" href="#__codelineno-0-626"></a>            <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-627" name="__codelineno-0-627" href="#__codelineno-0-627"></a>        <span class="p">)</span>
<a id="__codelineno-0-628" name="__codelineno-0-628" href="#__codelineno-0-628"></a>    <span class="n">skip_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
<a id="__codelineno-0-629" name="__codelineno-0-629" href="#__codelineno-0-629"></a>        <span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">skip_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="ow">and</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">])</span>
<a id="__codelineno-0-630" name="__codelineno-0-630" href="#__codelineno-0-630"></a>    <span class="p">)</span>
<a id="__codelineno-0-631" name="__codelineno-0-631" href="#__codelineno-0-631"></a>
<a id="__codelineno-0-632" name="__codelineno-0-632" href="#__codelineno-0-632"></a>    <span class="k">if</span> <span class="n">skip_cols</span><span class="p">:</span>
<a id="__codelineno-0-633" name="__codelineno-0-633" href="#__codelineno-0-633"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-634" name="__codelineno-0-634" href="#__codelineno-0-634"></a>            <span class="s2">&quot;Columns dropped from encoding due to high cardinality: &quot;</span>
<a id="__codelineno-0-635" name="__codelineno-0-635" href="#__codelineno-0-635"></a>            <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">skip_cols</span><span class="p">)</span>
<a id="__codelineno-0-636" name="__codelineno-0-636" href="#__codelineno-0-636"></a>        <span class="p">)</span>
<a id="__codelineno-0-637" name="__codelineno-0-637" href="#__codelineno-0-637"></a>
<a id="__codelineno-0-638" name="__codelineno-0-638" href="#__codelineno-0-638"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
<a id="__codelineno-0-639" name="__codelineno-0-639" href="#__codelineno-0-639"></a>        <span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span> <span class="o">+</span> <span class="n">skip_cols</span><span class="p">])</span>
<a id="__codelineno-0-640" name="__codelineno-0-640" href="#__codelineno-0-640"></a>    <span class="p">)</span>
<a id="__codelineno-0-641" name="__codelineno-0-641" href="#__codelineno-0-641"></a>
<a id="__codelineno-0-642" name="__codelineno-0-642" href="#__codelineno-0-642"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-643" name="__codelineno-0-643" href="#__codelineno-0-643"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No Encoding Computation - No categorical column(s) to transform&quot;</span><span class="p">)</span>
<a id="__codelineno-0-644" name="__codelineno-0-644" href="#__codelineno-0-644"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-0-645" name="__codelineno-0-645" href="#__codelineno-0-645"></a>
<a id="__codelineno-0-646" name="__codelineno-0-646" href="#__codelineno-0-646"></a>    <span class="n">list_of_cols_vec</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-647" name="__codelineno-0-647" href="#__codelineno-0-647"></a>    <span class="n">list_of_cols_idx</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-648" name="__codelineno-0-648" href="#__codelineno-0-648"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-649" name="__codelineno-0-649" href="#__codelineno-0-649"></a>        <span class="n">list_of_cols_vec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_vec&quot;</span><span class="p">)</span>
<a id="__codelineno-0-650" name="__codelineno-0-650" href="#__codelineno-0-650"></a>        <span class="n">list_of_cols_idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_index&quot;</span><span class="p">)</span>
<a id="__codelineno-0-651" name="__codelineno-0-651" href="#__codelineno-0-651"></a>
<a id="__codelineno-0-652" name="__codelineno-0-652" href="#__codelineno-0-652"></a>    <span class="n">odf_indexed</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-653" name="__codelineno-0-653" href="#__codelineno-0-653"></a>    <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">pyspark</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;3.0.0&quot;</span><span class="p">):</span>
<a id="__codelineno-0-654" name="__codelineno-0-654" href="#__codelineno-0-654"></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-655" name="__codelineno-0-655" href="#__codelineno-0-655"></a>            <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-0-656" name="__codelineno-0-656" href="#__codelineno-0-656"></a>                <span class="n">indexerModel</span> <span class="o">=</span> <span class="n">StringIndexerModel</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
<a id="__codelineno-0-657" name="__codelineno-0-657" href="#__codelineno-0-657"></a>                    <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/cat_to_num_unsupervised/indexer-model/&quot;</span> <span class="o">+</span> <span class="n">i</span>
<a id="__codelineno-0-658" name="__codelineno-0-658" href="#__codelineno-0-658"></a>                <span class="p">)</span>
<a id="__codelineno-0-659" name="__codelineno-0-659" href="#__codelineno-0-659"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-660" name="__codelineno-0-660" href="#__codelineno-0-660"></a>                <span class="n">stringIndexer</span> <span class="o">=</span> <span class="n">StringIndexer</span><span class="p">(</span>
<a id="__codelineno-0-661" name="__codelineno-0-661" href="#__codelineno-0-661"></a>                    <span class="n">inputCol</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
<a id="__codelineno-0-662" name="__codelineno-0-662" href="#__codelineno-0-662"></a>                    <span class="n">outputCol</span><span class="o">=</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_index&quot;</span><span class="p">,</span>
<a id="__codelineno-0-663" name="__codelineno-0-663" href="#__codelineno-0-663"></a>                    <span class="n">stringOrderType</span><span class="o">=</span><span class="n">index_order</span><span class="p">,</span>
<a id="__codelineno-0-664" name="__codelineno-0-664" href="#__codelineno-0-664"></a>                    <span class="n">handleInvalid</span><span class="o">=</span><span class="s2">&quot;keep&quot;</span><span class="p">,</span>
<a id="__codelineno-0-665" name="__codelineno-0-665" href="#__codelineno-0-665"></a>                <span class="p">)</span>
<a id="__codelineno-0-666" name="__codelineno-0-666" href="#__codelineno-0-666"></a>                <span class="n">indexerModel</span> <span class="o">=</span> <span class="n">stringIndexer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a id="__codelineno-0-667" name="__codelineno-0-667" href="#__codelineno-0-667"></a>
<a id="__codelineno-0-668" name="__codelineno-0-668" href="#__codelineno-0-668"></a>                <span class="k">if</span> <span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span>
<a id="__codelineno-0-669" name="__codelineno-0-669" href="#__codelineno-0-669"></a>                    <span class="n">indexerModel</span><span class="o">.</span><span class="n">write</span><span class="p">()</span><span class="o">.</span><span class="n">overwrite</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
<a id="__codelineno-0-670" name="__codelineno-0-670" href="#__codelineno-0-670"></a>                        <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/cat_to_num_unsupervised/indexer-model/&quot;</span> <span class="o">+</span> <span class="n">i</span>
<a id="__codelineno-0-671" name="__codelineno-0-671" href="#__codelineno-0-671"></a>                    <span class="p">)</span>
<a id="__codelineno-0-672" name="__codelineno-0-672" href="#__codelineno-0-672"></a>
<a id="__codelineno-0-673" name="__codelineno-0-673" href="#__codelineno-0-673"></a>            <span class="n">odf_indexed</span> <span class="o">=</span> <span class="n">indexerModel</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">odf_indexed</span><span class="p">)</span>
<a id="__codelineno-0-674" name="__codelineno-0-674" href="#__codelineno-0-674"></a>
<a id="__codelineno-0-675" name="__codelineno-0-675" href="#__codelineno-0-675"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-676" name="__codelineno-0-676" href="#__codelineno-0-676"></a>        <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-0-677" name="__codelineno-0-677" href="#__codelineno-0-677"></a>            <span class="n">indexerModel</span> <span class="o">=</span> <span class="n">StringIndexerModel</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
<a id="__codelineno-0-678" name="__codelineno-0-678" href="#__codelineno-0-678"></a>                <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/cat_to_num_unsupervised/indexer&quot;</span>
<a id="__codelineno-0-679" name="__codelineno-0-679" href="#__codelineno-0-679"></a>            <span class="p">)</span>
<a id="__codelineno-0-680" name="__codelineno-0-680" href="#__codelineno-0-680"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-681" name="__codelineno-0-681" href="#__codelineno-0-681"></a>            <span class="n">stringIndexer</span> <span class="o">=</span> <span class="n">StringIndexer</span><span class="p">(</span>
<a id="__codelineno-0-682" name="__codelineno-0-682" href="#__codelineno-0-682"></a>                <span class="n">inputCols</span><span class="o">=</span><span class="n">list_of_cols</span><span class="p">,</span>
<a id="__codelineno-0-683" name="__codelineno-0-683" href="#__codelineno-0-683"></a>                <span class="n">outputCols</span><span class="o">=</span><span class="n">list_of_cols_idx</span><span class="p">,</span>
<a id="__codelineno-0-684" name="__codelineno-0-684" href="#__codelineno-0-684"></a>                <span class="n">stringOrderType</span><span class="o">=</span><span class="n">index_order</span><span class="p">,</span>
<a id="__codelineno-0-685" name="__codelineno-0-685" href="#__codelineno-0-685"></a>                <span class="n">handleInvalid</span><span class="o">=</span><span class="s2">&quot;keep&quot;</span><span class="p">,</span>
<a id="__codelineno-0-686" name="__codelineno-0-686" href="#__codelineno-0-686"></a>            <span class="p">)</span>
<a id="__codelineno-0-687" name="__codelineno-0-687" href="#__codelineno-0-687"></a>            <span class="n">indexerModel</span> <span class="o">=</span> <span class="n">stringIndexer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">odf_indexed</span><span class="p">)</span>
<a id="__codelineno-0-688" name="__codelineno-0-688" href="#__codelineno-0-688"></a>            <span class="k">if</span> <span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span>
<a id="__codelineno-0-689" name="__codelineno-0-689" href="#__codelineno-0-689"></a>                <span class="n">indexerModel</span><span class="o">.</span><span class="n">write</span><span class="p">()</span><span class="o">.</span><span class="n">overwrite</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
<a id="__codelineno-0-690" name="__codelineno-0-690" href="#__codelineno-0-690"></a>                    <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/cat_to_num_unsupervised/indexer&quot;</span>
<a id="__codelineno-0-691" name="__codelineno-0-691" href="#__codelineno-0-691"></a>                <span class="p">)</span>
<a id="__codelineno-0-692" name="__codelineno-0-692" href="#__codelineno-0-692"></a>        <span class="n">odf_indexed</span> <span class="o">=</span> <span class="n">indexerModel</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">odf_indexed</span><span class="p">)</span>
<a id="__codelineno-0-693" name="__codelineno-0-693" href="#__codelineno-0-693"></a>
<a id="__codelineno-0-694" name="__codelineno-0-694" href="#__codelineno-0-694"></a>    <span class="k">if</span> <span class="n">method_type</span> <span class="o">==</span> <span class="s2">&quot;onehot_encoding&quot;</span><span class="p">:</span>
<a id="__codelineno-0-695" name="__codelineno-0-695" href="#__codelineno-0-695"></a>        <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-0-696" name="__codelineno-0-696" href="#__codelineno-0-696"></a>            <span class="n">encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
<a id="__codelineno-0-697" name="__codelineno-0-697" href="#__codelineno-0-697"></a>                <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/cat_to_num_unsupervised/encoder&quot;</span>
<a id="__codelineno-0-698" name="__codelineno-0-698" href="#__codelineno-0-698"></a>            <span class="p">)</span>
<a id="__codelineno-0-699" name="__codelineno-0-699" href="#__codelineno-0-699"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-700" name="__codelineno-0-700" href="#__codelineno-0-700"></a>            <span class="n">encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span>
<a id="__codelineno-0-701" name="__codelineno-0-701" href="#__codelineno-0-701"></a>                <span class="n">inputCols</span><span class="o">=</span><span class="n">list_of_cols_idx</span><span class="p">,</span>
<a id="__codelineno-0-702" name="__codelineno-0-702" href="#__codelineno-0-702"></a>                <span class="n">outputCols</span><span class="o">=</span><span class="n">list_of_cols_vec</span><span class="p">,</span>
<a id="__codelineno-0-703" name="__codelineno-0-703" href="#__codelineno-0-703"></a>                <span class="n">handleInvalid</span><span class="o">=</span><span class="s2">&quot;keep&quot;</span><span class="p">,</span>
<a id="__codelineno-0-704" name="__codelineno-0-704" href="#__codelineno-0-704"></a>            <span class="p">)</span>
<a id="__codelineno-0-705" name="__codelineno-0-705" href="#__codelineno-0-705"></a>            <span class="k">if</span> <span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span>
<a id="__codelineno-0-706" name="__codelineno-0-706" href="#__codelineno-0-706"></a>                <span class="n">encoder</span><span class="o">.</span><span class="n">write</span><span class="p">()</span><span class="o">.</span><span class="n">overwrite</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
<a id="__codelineno-0-707" name="__codelineno-0-707" href="#__codelineno-0-707"></a>                    <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/cat_to_num_unsupervised/encoder&quot;</span>
<a id="__codelineno-0-708" name="__codelineno-0-708" href="#__codelineno-0-708"></a>                <span class="p">)</span>
<a id="__codelineno-0-709" name="__codelineno-0-709" href="#__codelineno-0-709"></a>
<a id="__codelineno-0-710" name="__codelineno-0-710" href="#__codelineno-0-710"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">odf_indexed</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">odf_indexed</span><span class="p">)</span>
<a id="__codelineno-0-711" name="__codelineno-0-711" href="#__codelineno-0-711"></a>
<a id="__codelineno-0-712" name="__codelineno-0-712" href="#__codelineno-0-712"></a>        <span class="n">new_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-713" name="__codelineno-0-713" href="#__codelineno-0-713"></a>        <span class="n">odf_sample</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-714" name="__codelineno-0-714" href="#__codelineno-0-714"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-715" name="__codelineno-0-715" href="#__codelineno-0-715"></a>            <span class="n">odf_schema</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">schema</span>
<a id="__codelineno-0-716" name="__codelineno-0-716" href="#__codelineno-0-716"></a>            <span class="n">uniq_cats</span> <span class="o">=</span> <span class="n">odf_sample</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asDict</span><span class="p">()[</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_vec&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
<a id="__codelineno-0-717" name="__codelineno-0-717" href="#__codelineno-0-717"></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">uniq_cats</span><span class="p">):</span>
<a id="__codelineno-0-718" name="__codelineno-0-718" href="#__codelineno-0-718"></a>                <span class="n">odf_schema</span> <span class="o">=</span> <span class="n">odf_schema</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<a id="__codelineno-0-719" name="__codelineno-0-719" href="#__codelineno-0-719"></a>                    <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">T</span><span class="o">.</span><span class="n">IntegerType</span><span class="p">())</span>
<a id="__codelineno-0-720" name="__codelineno-0-720" href="#__codelineno-0-720"></a>                <span class="p">)</span>
<a id="__codelineno-0-721" name="__codelineno-0-721" href="#__codelineno-0-721"></a>                <span class="n">new_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
<a id="__codelineno-0-722" name="__codelineno-0-722" href="#__codelineno-0-722"></a>
<a id="__codelineno-0-723" name="__codelineno-0-723" href="#__codelineno-0-723"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
<a id="__codelineno-0-724" name="__codelineno-0-724" href="#__codelineno-0-724"></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span>
<a id="__codelineno-0-725" name="__codelineno-0-725" href="#__codelineno-0-725"></a>                    <span class="o">*</span><span class="n">x</span><span class="p">,</span>
<a id="__codelineno-0-726" name="__codelineno-0-726" href="#__codelineno-0-726"></a>                    <span class="o">*</span><span class="p">(</span><span class="n">DenseVector</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_vec&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">toArray</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span>
<a id="__codelineno-0-727" name="__codelineno-0-727" href="#__codelineno-0-727"></a>                <span class="p">)</span>
<a id="__codelineno-0-728" name="__codelineno-0-728" href="#__codelineno-0-728"></a>            <span class="p">)</span><span class="o">.</span><span class="n">toDF</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">odf_schema</span><span class="p">)</span>
<a id="__codelineno-0-729" name="__codelineno-0-729" href="#__codelineno-0-729"></a>
<a id="__codelineno-0-730" name="__codelineno-0-730" href="#__codelineno-0-730"></a>            <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-731" name="__codelineno-0-731" href="#__codelineno-0-731"></a>                <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_vec&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_index&quot;</span><span class="p">)</span>
<a id="__codelineno-0-732" name="__codelineno-0-732" href="#__codelineno-0-732"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-733" name="__codelineno-0-733" href="#__codelineno-0-733"></a>                <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_vec&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_index&quot;</span><span class="p">)</span>
<a id="__codelineno-0-734" name="__codelineno-0-734" href="#__codelineno-0-734"></a>
<a id="__codelineno-0-735" name="__codelineno-0-735" href="#__codelineno-0-735"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-736" name="__codelineno-0-736" href="#__codelineno-0-736"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf_indexed</span>
<a id="__codelineno-0-737" name="__codelineno-0-737" href="#__codelineno-0-737"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-738" name="__codelineno-0-738" href="#__codelineno-0-738"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-739" name="__codelineno-0-739" href="#__codelineno-0-739"></a>                <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_index&quot;</span><span class="p">,</span>
<a id="__codelineno-0-740" name="__codelineno-0-740" href="#__codelineno-0-740"></a>                <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
<a id="__codelineno-0-741" name="__codelineno-0-741" href="#__codelineno-0-741"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">IntegerType</span><span class="p">())</span>
<a id="__codelineno-0-742" name="__codelineno-0-742" href="#__codelineno-0-742"></a>                <span class="p">),</span>
<a id="__codelineno-0-743" name="__codelineno-0-743" href="#__codelineno-0-743"></a>            <span class="p">)</span>
<a id="__codelineno-0-744" name="__codelineno-0-744" href="#__codelineno-0-744"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-745" name="__codelineno-0-745" href="#__codelineno-0-745"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-746" name="__codelineno-0-746" href="#__codelineno-0-746"></a>                <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_index&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-747" name="__codelineno-0-747" href="#__codelineno-0-747"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">idf</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<a id="__codelineno-0-748" name="__codelineno-0-748" href="#__codelineno-0-748"></a>
<a id="__codelineno-0-749" name="__codelineno-0-749" href="#__codelineno-0-749"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-750" name="__codelineno-0-750" href="#__codelineno-0-750"></a>        <span class="k">if</span> <span class="n">method_type</span> <span class="o">==</span> <span class="s2">&quot;label_encoding&quot;</span><span class="p">:</span>
<a id="__codelineno-0-751" name="__codelineno-0-751" href="#__codelineno-0-751"></a>            <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;append&quot;</span><span class="p">:</span>
<a id="__codelineno-0-752" name="__codelineno-0-752" href="#__codelineno-0-752"></a>                <span class="n">new_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_index&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">]</span>
<a id="__codelineno-0-753" name="__codelineno-0-753" href="#__codelineno-0-753"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-754" name="__codelineno-0-754" href="#__codelineno-0-754"></a>                <span class="n">new_cols</span> <span class="o">=</span> <span class="n">list_of_cols</span>
<a id="__codelineno-0-755" name="__codelineno-0-755" href="#__codelineno-0-755"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before&quot;</span><span class="p">)</span>
<a id="__codelineno-0-756" name="__codelineno-0-756" href="#__codelineno-0-756"></a>            <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-757" name="__codelineno-0-757" href="#__codelineno-0-757"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After&quot;</span><span class="p">)</span>
<a id="__codelineno-0-758" name="__codelineno-0-758" href="#__codelineno-0-758"></a>            <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">new_cols</span><span class="p">)</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-759" name="__codelineno-0-759" href="#__codelineno-0-759"></a>
<a id="__codelineno-0-760" name="__codelineno-0-760" href="#__codelineno-0-760"></a>        <span class="k">if</span> <span class="n">method_type</span> <span class="o">==</span> <span class="s2">&quot;onehot_encoding&quot;</span><span class="p">:</span>
<a id="__codelineno-0-761" name="__codelineno-0-761" href="#__codelineno-0-761"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before&quot;</span><span class="p">)</span>
<a id="__codelineno-0-762" name="__codelineno-0-762" href="#__codelineno-0-762"></a>            <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<a id="__codelineno-0-763" name="__codelineno-0-763" href="#__codelineno-0-763"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After&quot;</span><span class="p">)</span>
<a id="__codelineno-0-764" name="__codelineno-0-764" href="#__codelineno-0-764"></a>            <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;append&quot;</span><span class="p">:</span>
<a id="__codelineno-0-765" name="__codelineno-0-765" href="#__codelineno-0-765"></a>                <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span> <span class="o">+</span> <span class="n">new_cols</span><span class="p">)</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<a id="__codelineno-0-766" name="__codelineno-0-766" href="#__codelineno-0-766"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-767" name="__codelineno-0-767" href="#__codelineno-0-767"></a>                <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">new_cols</span><span class="p">)</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<a id="__codelineno-0-768" name="__codelineno-0-768" href="#__codelineno-0-768"></a>        <span class="k">if</span> <span class="n">skip_cols</span><span class="p">:</span>
<a id="__codelineno-0-769" name="__codelineno-0-769" href="#__codelineno-0-769"></a>            <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-770" name="__codelineno-0-770" href="#__codelineno-0-770"></a>                <span class="s2">&quot;Columns dropped from encoding due to high cardinality: &quot;</span>
<a id="__codelineno-0-771" name="__codelineno-0-771" href="#__codelineno-0-771"></a>                <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">skip_cols</span><span class="p">)</span>
<a id="__codelineno-0-772" name="__codelineno-0-772" href="#__codelineno-0-772"></a>            <span class="p">)</span>
<a id="__codelineno-0-773" name="__codelineno-0-773" href="#__codelineno-0-773"></a>    <span class="k">return</span> <span class="n">odf</span>
<a id="__codelineno-0-774" name="__codelineno-0-774" href="#__codelineno-0-774"></a>
<a id="__codelineno-0-775" name="__codelineno-0-775" href="#__codelineno-0-775"></a>
<a id="__codelineno-0-776" name="__codelineno-0-776" href="#__codelineno-0-776"></a><span class="k">def</span> <span class="nf">cat_to_num_supervised</span><span class="p">(</span>
<a id="__codelineno-0-777" name="__codelineno-0-777" href="#__codelineno-0-777"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-778" name="__codelineno-0-778" href="#__codelineno-0-778"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-779" name="__codelineno-0-779" href="#__codelineno-0-779"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-0-780" name="__codelineno-0-780" href="#__codelineno-0-780"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-781" name="__codelineno-0-781" href="#__codelineno-0-781"></a>    <span class="n">label_col</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span>
<a id="__codelineno-0-782" name="__codelineno-0-782" href="#__codelineno-0-782"></a>    <span class="n">event_label</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-783" name="__codelineno-0-783" href="#__codelineno-0-783"></a>    <span class="n">pre_existing_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-784" name="__codelineno-0-784" href="#__codelineno-0-784"></a>    <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-0-785" name="__codelineno-0-785" href="#__codelineno-0-785"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-0-786" name="__codelineno-0-786" href="#__codelineno-0-786"></a>    <span class="n">persist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-787" name="__codelineno-0-787" href="#__codelineno-0-787"></a>    <span class="n">persist_option</span><span class="o">=</span><span class="n">pyspark</span><span class="o">.</span><span class="n">StorageLevel</span><span class="o">.</span><span class="n">MEMORY_AND_DISK</span><span class="p">,</span>
<a id="__codelineno-0-788" name="__codelineno-0-788" href="#__codelineno-0-788"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-789" name="__codelineno-0-789" href="#__codelineno-0-789"></a><span class="p">):</span>
<a id="__codelineno-0-790" name="__codelineno-0-790" href="#__codelineno-0-790"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-791" name="__codelineno-0-791" href="#__codelineno-0-791"></a><span class="sd">    This is a supervised method to convert a categorical attribute into a numerical attribute. It takes a</span>
<a id="__codelineno-0-792" name="__codelineno-0-792" href="#__codelineno-0-792"></a><span class="sd">    label/target column to indicate whether the event is positive or negative. For each column, the positive event</span>
<a id="__codelineno-0-793" name="__codelineno-0-793" href="#__codelineno-0-793"></a><span class="sd">    rate for each categorical value is used as the encoded numerical value.</span>
<a id="__codelineno-0-794" name="__codelineno-0-794" href="#__codelineno-0-794"></a>
<a id="__codelineno-0-795" name="__codelineno-0-795" href="#__codelineno-0-795"></a><span class="sd">    For example, there are 3 distinct values in a categorical attribute X: X1, X2 and X3. Within the input dataframe, there are</span>
<a id="__codelineno-0-796" name="__codelineno-0-796" href="#__codelineno-0-796"></a><span class="sd">    - 15 positive events and 5 negative events with X==X1;</span>
<a id="__codelineno-0-797" name="__codelineno-0-797" href="#__codelineno-0-797"></a><span class="sd">    - 10 positive events and 40 negative events with X==X2;</span>
<a id="__codelineno-0-798" name="__codelineno-0-798" href="#__codelineno-0-798"></a><span class="sd">    - 20 positive events and 20 negative events with X==X3.</span>
<a id="__codelineno-0-799" name="__codelineno-0-799" href="#__codelineno-0-799"></a>
<a id="__codelineno-0-800" name="__codelineno-0-800" href="#__codelineno-0-800"></a><span class="sd">    Thus, value X1 is mapped to 15/(15+5) = 0.75, value X2 is mapped to 10/(10+40) = 0.2 and value X3 is mapped to</span>
<a id="__codelineno-0-801" name="__codelineno-0-801" href="#__codelineno-0-801"></a><span class="sd">    20/(20+20) = 0.5. This mapping will be applied to all values in attribute X. This encoding method can be helpful</span>
<a id="__codelineno-0-802" name="__codelineno-0-802" href="#__codelineno-0-802"></a><span class="sd">    in avoiding creating too many dummy variables which may cause dimensionality issue and it also works with</span>
<a id="__codelineno-0-803" name="__codelineno-0-803" href="#__codelineno-0-803"></a><span class="sd">    categorical attributes without an order or rank.</span>
<a id="__codelineno-0-804" name="__codelineno-0-804" href="#__codelineno-0-804"></a>
<a id="__codelineno-0-805" name="__codelineno-0-805" href="#__codelineno-0-805"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-806" name="__codelineno-0-806" href="#__codelineno-0-806"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-807" name="__codelineno-0-807" href="#__codelineno-0-807"></a><span class="sd">    spark</span>
<a id="__codelineno-0-808" name="__codelineno-0-808" href="#__codelineno-0-808"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-0-809" name="__codelineno-0-809" href="#__codelineno-0-809"></a><span class="sd">    idf</span>
<a id="__codelineno-0-810" name="__codelineno-0-810" href="#__codelineno-0-810"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-811" name="__codelineno-0-811" href="#__codelineno-0-811"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-0-812" name="__codelineno-0-812" href="#__codelineno-0-812"></a><span class="sd">        List of categorical columns to transform e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-813" name="__codelineno-0-813" href="#__codelineno-0-813"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-814" name="__codelineno-0-814" href="#__codelineno-0-814"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-815" name="__codelineno-0-815" href="#__codelineno-0-815"></a><span class="sd">        &quot;all&quot; can be passed to include all categorical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-0-816" name="__codelineno-0-816" href="#__codelineno-0-816"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-0-817" name="__codelineno-0-817" href="#__codelineno-0-817"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-0-818" name="__codelineno-0-818" href="#__codelineno-0-818"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-0-819" name="__codelineno-0-819" href="#__codelineno-0-819"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-820" name="__codelineno-0-820" href="#__codelineno-0-820"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-821" name="__codelineno-0-821" href="#__codelineno-0-821"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-822" name="__codelineno-0-822" href="#__codelineno-0-822"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-0-823" name="__codelineno-0-823" href="#__codelineno-0-823"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-0-824" name="__codelineno-0-824" href="#__codelineno-0-824"></a><span class="sd">    label_col</span>
<a id="__codelineno-0-825" name="__codelineno-0-825" href="#__codelineno-0-825"></a><span class="sd">        Label/Target column (Default value = &quot;label&quot;)</span>
<a id="__codelineno-0-826" name="__codelineno-0-826" href="#__codelineno-0-826"></a><span class="sd">    event_label</span>
<a id="__codelineno-0-827" name="__codelineno-0-827" href="#__codelineno-0-827"></a><span class="sd">        Value of (positive) event (i.e label 1) (Default value = 1)</span>
<a id="__codelineno-0-828" name="__codelineno-0-828" href="#__codelineno-0-828"></a><span class="sd">    pre_existing_model</span>
<a id="__codelineno-0-829" name="__codelineno-0-829" href="#__codelineno-0-829"></a><span class="sd">        Boolean argument – True or False. True if model (original and mapped numerical value</span>
<a id="__codelineno-0-830" name="__codelineno-0-830" href="#__codelineno-0-830"></a><span class="sd">        for each column) exists already, False Otherwise. (Default value = False)</span>
<a id="__codelineno-0-831" name="__codelineno-0-831" href="#__codelineno-0-831"></a><span class="sd">    model_path</span>
<a id="__codelineno-0-832" name="__codelineno-0-832" href="#__codelineno-0-832"></a><span class="sd">        If pre_existing_model is True, this argument is path for referring the pre-saved model.</span>
<a id="__codelineno-0-833" name="__codelineno-0-833" href="#__codelineno-0-833"></a><span class="sd">        If pre_existing_model is False, this argument can be used for saving the model.</span>
<a id="__codelineno-0-834" name="__codelineno-0-834" href="#__codelineno-0-834"></a><span class="sd">        Default &quot;NA&quot; is used to save the model in &quot;intermediate_data/&quot; folder for optimization purpose.</span>
<a id="__codelineno-0-835" name="__codelineno-0-835" href="#__codelineno-0-835"></a><span class="sd">    output_mode</span>
<a id="__codelineno-0-836" name="__codelineno-0-836" href="#__codelineno-0-836"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-0-837" name="__codelineno-0-837" href="#__codelineno-0-837"></a><span class="sd">        “replace” option replaces original columns with transformed column. “append” option append transformed</span>
<a id="__codelineno-0-838" name="__codelineno-0-838" href="#__codelineno-0-838"></a><span class="sd">        column to the input dataset with a postfix &quot;_encoded&quot; e.g. column X is appended as X_encoded. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-0-839" name="__codelineno-0-839" href="#__codelineno-0-839"></a><span class="sd">    persist</span>
<a id="__codelineno-0-840" name="__codelineno-0-840" href="#__codelineno-0-840"></a><span class="sd">        Boolean argument - True or False. This parameter is for optimization purpose. If True, repeatedly used dataframe</span>
<a id="__codelineno-0-841" name="__codelineno-0-841" href="#__codelineno-0-841"></a><span class="sd">        will be persisted (StorageLevel can be specified in persist_option). We recommend setting this parameter as True</span>
<a id="__codelineno-0-842" name="__codelineno-0-842" href="#__codelineno-0-842"></a><span class="sd">        if at least one of the following criteria is True:</span>
<a id="__codelineno-0-843" name="__codelineno-0-843" href="#__codelineno-0-843"></a><span class="sd">        (1) The underlying data source is in csv format</span>
<a id="__codelineno-0-844" name="__codelineno-0-844" href="#__codelineno-0-844"></a><span class="sd">        (2) The transformation will be applicable to most columns. (Default value = False)</span>
<a id="__codelineno-0-845" name="__codelineno-0-845" href="#__codelineno-0-845"></a><span class="sd">    persist_option</span>
<a id="__codelineno-0-846" name="__codelineno-0-846" href="#__codelineno-0-846"></a><span class="sd">        A pyspark.StorageLevel instance. This parameter is useful only when persist is True.</span>
<a id="__codelineno-0-847" name="__codelineno-0-847" href="#__codelineno-0-847"></a><span class="sd">        (Default value = pyspark.StorageLevel.MEMORY_AND_DISK)</span>
<a id="__codelineno-0-848" name="__codelineno-0-848" href="#__codelineno-0-848"></a><span class="sd">    print_impact</span>
<a id="__codelineno-0-849" name="__codelineno-0-849" href="#__codelineno-0-849"></a><span class="sd">        True, False (Default value = False)</span>
<a id="__codelineno-0-850" name="__codelineno-0-850" href="#__codelineno-0-850"></a><span class="sd">        This argument is to print out the descriptive statistics of encoded columns.</span>
<a id="__codelineno-0-851" name="__codelineno-0-851" href="#__codelineno-0-851"></a>
<a id="__codelineno-0-852" name="__codelineno-0-852" href="#__codelineno-0-852"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-853" name="__codelineno-0-853" href="#__codelineno-0-853"></a><span class="sd">    -------</span>
<a id="__codelineno-0-854" name="__codelineno-0-854" href="#__codelineno-0-854"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-0-855" name="__codelineno-0-855" href="#__codelineno-0-855"></a><span class="sd">        Encoded Dataframe</span>
<a id="__codelineno-0-856" name="__codelineno-0-856" href="#__codelineno-0-856"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-857" name="__codelineno-0-857" href="#__codelineno-0-857"></a>
<a id="__codelineno-0-858" name="__codelineno-0-858" href="#__codelineno-0-858"></a>    <span class="n">cat_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-859" name="__codelineno-0-859" href="#__codelineno-0-859"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-860" name="__codelineno-0-860" href="#__codelineno-0-860"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">cat_cols</span>
<a id="__codelineno-0-861" name="__codelineno-0-861" href="#__codelineno-0-861"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-862" name="__codelineno-0-862" href="#__codelineno-0-862"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-863" name="__codelineno-0-863" href="#__codelineno-0-863"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-864" name="__codelineno-0-864" href="#__codelineno-0-864"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-865" name="__codelineno-0-865" href="#__codelineno-0-865"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
<a id="__codelineno-0-866" name="__codelineno-0-866" href="#__codelineno-0-866"></a>        <span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">e</span> <span class="o">!=</span> <span class="n">label_col</span><span class="p">)])</span>
<a id="__codelineno-0-867" name="__codelineno-0-867" href="#__codelineno-0-867"></a>    <span class="p">)</span>
<a id="__codelineno-0-868" name="__codelineno-0-868" href="#__codelineno-0-868"></a>
<a id="__codelineno-0-869" name="__codelineno-0-869" href="#__codelineno-0-869"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cat_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-870" name="__codelineno-0-870" href="#__codelineno-0-870"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-871" name="__codelineno-0-871" href="#__codelineno-0-871"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-872" name="__codelineno-0-872" href="#__codelineno-0-872"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No Categorical Encoding - No categorical column(s) to transform&quot;</span><span class="p">)</span>
<a id="__codelineno-0-873" name="__codelineno-0-873" href="#__codelineno-0-873"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-0-874" name="__codelineno-0-874" href="#__codelineno-0-874"></a>    <span class="k">if</span> <span class="n">label_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-875" name="__codelineno-0-875" href="#__codelineno-0-875"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Label Column&quot;</span><span class="p">)</span>
<a id="__codelineno-0-876" name="__codelineno-0-876" href="#__codelineno-0-876"></a>
<a id="__codelineno-0-877" name="__codelineno-0-877" href="#__codelineno-0-877"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-878" name="__codelineno-0-878" href="#__codelineno-0-878"></a>    <span class="n">label_col_bool</span> <span class="o">=</span> <span class="n">label_col</span> <span class="o">+</span> <span class="s2">&quot;_cat_to_num_sup_temp&quot;</span>
<a id="__codelineno-0-879" name="__codelineno-0-879" href="#__codelineno-0-879"></a>    <span class="n">idf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-880" name="__codelineno-0-880" href="#__codelineno-0-880"></a>        <span class="n">label_col_bool</span><span class="p">,</span>
<a id="__codelineno-0-881" name="__codelineno-0-881" href="#__codelineno-0-881"></a>        <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">label_col</span><span class="p">)</span> <span class="o">==</span> <span class="n">event_label</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">),</span>
<a id="__codelineno-0-882" name="__codelineno-0-882" href="#__codelineno-0-882"></a>    <span class="p">)</span>
<a id="__codelineno-0-883" name="__codelineno-0-883" href="#__codelineno-0-883"></a>
<a id="__codelineno-0-884" name="__codelineno-0-884" href="#__codelineno-0-884"></a>    <span class="k">if</span> <span class="n">model_path</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span>
<a id="__codelineno-0-885" name="__codelineno-0-885" href="#__codelineno-0-885"></a>        <span class="n">skip_if_error</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-886" name="__codelineno-0-886" href="#__codelineno-0-886"></a>        <span class="n">model_path</span> <span class="o">=</span> <span class="s2">&quot;intermediate_data&quot;</span>
<a id="__codelineno-0-887" name="__codelineno-0-887" href="#__codelineno-0-887"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-888" name="__codelineno-0-888" href="#__codelineno-0-888"></a>        <span class="n">skip_if_error</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-889" name="__codelineno-0-889" href="#__codelineno-0-889"></a>    <span class="n">save_model</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-890" name="__codelineno-0-890" href="#__codelineno-0-890"></a>
<a id="__codelineno-0-891" name="__codelineno-0-891" href="#__codelineno-0-891"></a>    <span class="k">if</span> <span class="n">persist</span><span class="p">:</span>
<a id="__codelineno-0-892" name="__codelineno-0-892" href="#__codelineno-0-892"></a>        <span class="n">idf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">persist</span><span class="p">(</span><span class="n">persist_option</span><span class="p">)</span>
<a id="__codelineno-0-893" name="__codelineno-0-893" href="#__codelineno-0-893"></a>    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-894" name="__codelineno-0-894" href="#__codelineno-0-894"></a>        <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-0-895" name="__codelineno-0-895" href="#__codelineno-0-895"></a>            <span class="n">df_tmp</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span>
<a id="__codelineno-0-896" name="__codelineno-0-896" href="#__codelineno-0-896"></a>                <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/cat_to_num_supervised/&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span>
<a id="__codelineno-0-897" name="__codelineno-0-897" href="#__codelineno-0-897"></a>                <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-898" name="__codelineno-0-898" href="#__codelineno-0-898"></a>                <span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-899" name="__codelineno-0-899" href="#__codelineno-0-899"></a>            <span class="p">)</span>
<a id="__codelineno-0-900" name="__codelineno-0-900" href="#__codelineno-0-900"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-901" name="__codelineno-0-901" href="#__codelineno-0-901"></a>            <span class="n">df_tmp</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-902" name="__codelineno-0-902" href="#__codelineno-0-902"></a>                <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">label_col_bool</span><span class="p">)</span>
<a id="__codelineno-0-903" name="__codelineno-0-903" href="#__codelineno-0-903"></a>                <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-904" name="__codelineno-0-904" href="#__codelineno-0-904"></a>                <span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">label_col_bool</span><span class="p">)</span>
<a id="__codelineno-0-905" name="__codelineno-0-905" href="#__codelineno-0-905"></a>                <span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-0-906" name="__codelineno-0-906" href="#__codelineno-0-906"></a>                <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-907" name="__codelineno-0-907" href="#__codelineno-0-907"></a>                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-908" name="__codelineno-0-908" href="#__codelineno-0-908"></a>                    <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_encoded&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)),</span> <span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-909" name="__codelineno-0-909" href="#__codelineno-0-909"></a>                <span class="p">)</span>
<a id="__codelineno-0-910" name="__codelineno-0-910" href="#__codelineno-0-910"></a>                <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">])</span>
<a id="__codelineno-0-911" name="__codelineno-0-911" href="#__codelineno-0-911"></a>            <span class="p">)</span>
<a id="__codelineno-0-912" name="__codelineno-0-912" href="#__codelineno-0-912"></a>
<a id="__codelineno-0-913" name="__codelineno-0-913" href="#__codelineno-0-913"></a>            <span class="k">if</span> <span class="n">save_model</span><span class="p">:</span>
<a id="__codelineno-0-914" name="__codelineno-0-914" href="#__codelineno-0-914"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-915" name="__codelineno-0-915" href="#__codelineno-0-915"></a>                    <span class="n">df_tmp</span><span class="o">.</span><span class="n">coalesce</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span>
<a id="__codelineno-0-916" name="__codelineno-0-916" href="#__codelineno-0-916"></a>                        <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/cat_to_num_supervised/&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span>
<a id="__codelineno-0-917" name="__codelineno-0-917" href="#__codelineno-0-917"></a>                        <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-918" name="__codelineno-0-918" href="#__codelineno-0-918"></a>                        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span><span class="p">,</span>
<a id="__codelineno-0-919" name="__codelineno-0-919" href="#__codelineno-0-919"></a>                        <span class="n">ignoreLeadingWhiteSpace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-920" name="__codelineno-0-920" href="#__codelineno-0-920"></a>                        <span class="n">ignoreTrailingWhiteSpace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-921" name="__codelineno-0-921" href="#__codelineno-0-921"></a>                    <span class="p">)</span>
<a id="__codelineno-0-922" name="__codelineno-0-922" href="#__codelineno-0-922"></a>                    <span class="n">df_tmp</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span>
<a id="__codelineno-0-923" name="__codelineno-0-923" href="#__codelineno-0-923"></a>                        <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/cat_to_num_supervised/&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span>
<a id="__codelineno-0-924" name="__codelineno-0-924" href="#__codelineno-0-924"></a>                        <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-925" name="__codelineno-0-925" href="#__codelineno-0-925"></a>                        <span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-926" name="__codelineno-0-926" href="#__codelineno-0-926"></a>                    <span class="p">)</span>
<a id="__codelineno-0-927" name="__codelineno-0-927" href="#__codelineno-0-927"></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
<a id="__codelineno-0-928" name="__codelineno-0-928" href="#__codelineno-0-928"></a>                    <span class="k">if</span> <span class="n">skip_if_error</span><span class="p">:</span>
<a id="__codelineno-0-929" name="__codelineno-0-929" href="#__codelineno-0-929"></a>                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-930" name="__codelineno-0-930" href="#__codelineno-0-930"></a>                            <span class="s2">&quot;For optimization purpose, we recommend specifying a valid model_path value to save the intermediate data. Saving to the default path - &#39;&quot;</span>
<a id="__codelineno-0-931" name="__codelineno-0-931" href="#__codelineno-0-931"></a>                            <span class="o">+</span> <span class="n">model_path</span>
<a id="__codelineno-0-932" name="__codelineno-0-932" href="#__codelineno-0-932"></a>                            <span class="o">+</span> <span class="s2">&quot;/cat_to_num_supervised/&quot;</span>
<a id="__codelineno-0-933" name="__codelineno-0-933" href="#__codelineno-0-933"></a>                            <span class="o">+</span> <span class="n">i</span>
<a id="__codelineno-0-934" name="__codelineno-0-934" href="#__codelineno-0-934"></a>                            <span class="o">+</span> <span class="s2">&quot;&#39; faced an error.&quot;</span>
<a id="__codelineno-0-935" name="__codelineno-0-935" href="#__codelineno-0-935"></a>                        <span class="p">)</span>
<a id="__codelineno-0-936" name="__codelineno-0-936" href="#__codelineno-0-936"></a>                        <span class="n">save_model</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-937" name="__codelineno-0-937" href="#__codelineno-0-937"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-938" name="__codelineno-0-938" href="#__codelineno-0-938"></a>                        <span class="k">raise</span> <span class="n">error</span>
<a id="__codelineno-0-939" name="__codelineno-0-939" href="#__codelineno-0-939"></a>
<a id="__codelineno-0-940" name="__codelineno-0-940" href="#__codelineno-0-940"></a>        <span class="k">if</span> <span class="n">df_tmp</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-941" name="__codelineno-0-941" href="#__codelineno-0-941"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;left_outer&quot;</span><span class="p">)</span>
<a id="__codelineno-0-942" name="__codelineno-0-942" href="#__codelineno-0-942"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-943" name="__codelineno-0-943" href="#__codelineno-0-943"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">crossJoin</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">)</span>
<a id="__codelineno-0-944" name="__codelineno-0-944" href="#__codelineno-0-944"></a>
<a id="__codelineno-0-945" name="__codelineno-0-945" href="#__codelineno-0-945"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-946" name="__codelineno-0-946" href="#__codelineno-0-946"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-947" name="__codelineno-0-947" href="#__codelineno-0-947"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_encoded&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-948" name="__codelineno-0-948" href="#__codelineno-0-948"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">label_col_bool</span><span class="p">])</span>
<a id="__codelineno-0-949" name="__codelineno-0-949" href="#__codelineno-0-949"></a>
<a id="__codelineno-0-950" name="__codelineno-0-950" href="#__codelineno-0-950"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-951" name="__codelineno-0-951" href="#__codelineno-0-951"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-952" name="__codelineno-0-952" href="#__codelineno-0-952"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="n">list_of_cols</span>
<a id="__codelineno-0-953" name="__codelineno-0-953" href="#__codelineno-0-953"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-954" name="__codelineno-0-954" href="#__codelineno-0-954"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_encoded&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">]</span>
<a id="__codelineno-0-955" name="__codelineno-0-955" href="#__codelineno-0-955"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before: &quot;</span><span class="p">)</span>
<a id="__codelineno-0-956" name="__codelineno-0-956" href="#__codelineno-0-956"></a>        <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-957" name="__codelineno-0-957" href="#__codelineno-0-957"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After: &quot;</span><span class="p">)</span>
<a id="__codelineno-0-958" name="__codelineno-0-958" href="#__codelineno-0-958"></a>        <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">output_cols</span><span class="p">)</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-959" name="__codelineno-0-959" href="#__codelineno-0-959"></a>
<a id="__codelineno-0-960" name="__codelineno-0-960" href="#__codelineno-0-960"></a>    <span class="k">if</span> <span class="n">persist</span><span class="p">:</span>
<a id="__codelineno-0-961" name="__codelineno-0-961" href="#__codelineno-0-961"></a>        <span class="n">idf</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
<a id="__codelineno-0-962" name="__codelineno-0-962" href="#__codelineno-0-962"></a>    <span class="k">return</span> <span class="n">odf</span>
<a id="__codelineno-0-963" name="__codelineno-0-963" href="#__codelineno-0-963"></a>
<a id="__codelineno-0-964" name="__codelineno-0-964" href="#__codelineno-0-964"></a>
<a id="__codelineno-0-965" name="__codelineno-0-965" href="#__codelineno-0-965"></a><span class="k">def</span> <span class="nf">z_standardization</span><span class="p">(</span>
<a id="__codelineno-0-966" name="__codelineno-0-966" href="#__codelineno-0-966"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-967" name="__codelineno-0-967" href="#__codelineno-0-967"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-968" name="__codelineno-0-968" href="#__codelineno-0-968"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-0-969" name="__codelineno-0-969" href="#__codelineno-0-969"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-970" name="__codelineno-0-970" href="#__codelineno-0-970"></a>    <span class="n">pre_existing_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-971" name="__codelineno-0-971" href="#__codelineno-0-971"></a>    <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-0-972" name="__codelineno-0-972" href="#__codelineno-0-972"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-0-973" name="__codelineno-0-973" href="#__codelineno-0-973"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-974" name="__codelineno-0-974" href="#__codelineno-0-974"></a><span class="p">):</span>
<a id="__codelineno-0-975" name="__codelineno-0-975" href="#__codelineno-0-975"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-976" name="__codelineno-0-976" href="#__codelineno-0-976"></a><span class="sd">    Standardization is commonly used in data pre-processing process. z_standardization standardizes the selected</span>
<a id="__codelineno-0-977" name="__codelineno-0-977" href="#__codelineno-0-977"></a><span class="sd">    attributes of an input dataframe by normalizing each attribute to have standard deviation of 1 and mean of 0. For</span>
<a id="__codelineno-0-978" name="__codelineno-0-978" href="#__codelineno-0-978"></a><span class="sd">    each attribute, the standard deviation (s) and mean (u) are calculated and a sample x will be standardized into (</span>
<a id="__codelineno-0-979" name="__codelineno-0-979" href="#__codelineno-0-979"></a><span class="sd">    x-u)/s. If the standard deviation of an attribute is 0, it will be excluded in standardization and a warning will</span>
<a id="__codelineno-0-980" name="__codelineno-0-980" href="#__codelineno-0-980"></a><span class="sd">    be shown. None values will be kept as None in the output dataframe.</span>
<a id="__codelineno-0-981" name="__codelineno-0-981" href="#__codelineno-0-981"></a>
<a id="__codelineno-0-982" name="__codelineno-0-982" href="#__codelineno-0-982"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-983" name="__codelineno-0-983" href="#__codelineno-0-983"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-984" name="__codelineno-0-984" href="#__codelineno-0-984"></a><span class="sd">    spark</span>
<a id="__codelineno-0-985" name="__codelineno-0-985" href="#__codelineno-0-985"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-0-986" name="__codelineno-0-986" href="#__codelineno-0-986"></a><span class="sd">    idf</span>
<a id="__codelineno-0-987" name="__codelineno-0-987" href="#__codelineno-0-987"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-988" name="__codelineno-0-988" href="#__codelineno-0-988"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-0-989" name="__codelineno-0-989" href="#__codelineno-0-989"></a><span class="sd">        List of numerical columns to transform e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-990" name="__codelineno-0-990" href="#__codelineno-0-990"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-991" name="__codelineno-0-991" href="#__codelineno-0-991"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-992" name="__codelineno-0-992" href="#__codelineno-0-992"></a><span class="sd">        &quot;all&quot; can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-0-993" name="__codelineno-0-993" href="#__codelineno-0-993"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-0-994" name="__codelineno-0-994" href="#__codelineno-0-994"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-0-995" name="__codelineno-0-995" href="#__codelineno-0-995"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-0-996" name="__codelineno-0-996" href="#__codelineno-0-996"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-997" name="__codelineno-0-997" href="#__codelineno-0-997"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-998" name="__codelineno-0-998" href="#__codelineno-0-998"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-999" name="__codelineno-0-999" href="#__codelineno-0-999"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000" href="#__codelineno-0-1000"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001" href="#__codelineno-0-1001"></a><span class="sd">    pre_existing_model</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002" href="#__codelineno-0-1002"></a><span class="sd">        Boolean argument – True or False. True if model files (Mean/stddev for each feature) exists already, False Otherwise (Default value = False)</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003" href="#__codelineno-0-1003"></a><span class="sd">    model_path</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004" href="#__codelineno-0-1004"></a><span class="sd">        If pre_existing_model is True, this argument is path for referring the pre-saved model.</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005" href="#__codelineno-0-1005"></a><span class="sd">        If pre_existing_model is False, this argument can be used for saving the model.</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006" href="#__codelineno-0-1006"></a><span class="sd">        Default &quot;NA&quot; means there is neither pre-existing model nor there is a need to save one.</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007" href="#__codelineno-0-1007"></a><span class="sd">    output_mode</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008" href="#__codelineno-0-1008"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009" href="#__codelineno-0-1009"></a><span class="sd">        “replace” option replaces original columns with transformed column. “append” option append transformed</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010" href="#__codelineno-0-1010"></a><span class="sd">        column to the input dataset with a postfix &quot;_scaled&quot; e.g. column X is appended as X_scaled. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011" href="#__codelineno-0-1011"></a><span class="sd">    print_impact</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012" href="#__codelineno-0-1012"></a><span class="sd">        True, False (Default value = False)</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013" href="#__codelineno-0-1013"></a><span class="sd">        This argument is to print out the before and after descriptive statistics of rescaled columns.</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014" href="#__codelineno-0-1014"></a>
<a id="__codelineno-0-1015" name="__codelineno-0-1015" href="#__codelineno-0-1015"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016" href="#__codelineno-0-1016"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017" href="#__codelineno-0-1017"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018" href="#__codelineno-0-1018"></a><span class="sd">        Rescaled Dataframe</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019" href="#__codelineno-0-1019"></a>
<a id="__codelineno-0-1020" name="__codelineno-0-1020" href="#__codelineno-0-1020"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021" href="#__codelineno-0-1021"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022" href="#__codelineno-0-1022"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023" href="#__codelineno-0-1023"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024" href="#__codelineno-0-1024"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025" href="#__codelineno-0-1025"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026" href="#__codelineno-0-1026"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027" href="#__codelineno-0-1027"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028" href="#__codelineno-0-1028"></a>
<a id="__codelineno-0-1029" name="__codelineno-0-1029" href="#__codelineno-0-1029"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030" href="#__codelineno-0-1030"></a>
<a id="__codelineno-0-1031" name="__codelineno-0-1031" href="#__codelineno-0-1031"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032" href="#__codelineno-0-1032"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033" href="#__codelineno-0-1033"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034" href="#__codelineno-0-1034"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035" href="#__codelineno-0-1035"></a>            <span class="s2">&quot;No Standardization Performed - No numerical column(s) to transform&quot;</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036" href="#__codelineno-0-1036"></a>        <span class="p">)</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037" href="#__codelineno-0-1037"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038" href="#__codelineno-0-1038"></a>
<a id="__codelineno-0-1039" name="__codelineno-0-1039" href="#__codelineno-0-1039"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040" href="#__codelineno-0-1040"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for output_mode&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041" href="#__codelineno-0-1041"></a>
<a id="__codelineno-0-1042" name="__codelineno-0-1042" href="#__codelineno-0-1042"></a>    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043" href="#__codelineno-0-1043"></a>    <span class="n">excluded_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044" href="#__codelineno-0-1044"></a>    <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045" href="#__codelineno-0-1045"></a>        <span class="n">df_model</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/z_standardization&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046" href="#__codelineno-0-1046"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047" href="#__codelineno-0-1047"></a>            <span class="n">mapped_value</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048" href="#__codelineno-0-1048"></a>                <span class="n">df_model</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049" href="#__codelineno-0-1049"></a>                <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;parameters&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050" href="#__codelineno-0-1050"></a>                <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051" href="#__codelineno-0-1051"></a>                <span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052" href="#__codelineno-0-1052"></a>            <span class="p">)</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053" href="#__codelineno-0-1053"></a>            <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapped_value</span><span class="p">)</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054" href="#__codelineno-0-1054"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055" href="#__codelineno-0-1055"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056" href="#__codelineno-0-1056"></a>            <span class="n">mean</span><span class="p">,</span> <span class="n">stddev</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">stddev</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057" href="#__codelineno-0-1057"></a>            <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058" href="#__codelineno-0-1058"></a>                <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span> <span class="k">if</span> <span class="n">mean</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">stddev</span><span class="p">)</span> <span class="k">if</span> <span class="n">stddev</span> <span class="k">else</span> <span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059" href="#__codelineno-0-1059"></a>            <span class="p">)</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060" href="#__codelineno-0-1060"></a>            <span class="k">if</span> <span class="n">stddev</span><span class="p">:</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061" href="#__codelineno-0-1061"></a>                <span class="k">if</span> <span class="nb">round</span><span class="p">(</span><span class="n">stddev</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062" href="#__codelineno-0-1062"></a>                    <span class="n">excluded_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063" href="#__codelineno-0-1063"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064" href="#__codelineno-0-1064"></a>                <span class="n">excluded_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065" href="#__codelineno-0-1065"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">excluded_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066" href="#__codelineno-0-1066"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067" href="#__codelineno-0-1067"></a>            <span class="s2">&quot;The following column(s) are excluded from standardization because the standard deviation is zero:&quot;</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068" href="#__codelineno-0-1068"></a>            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">excluded_cols</span><span class="p">)</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069" href="#__codelineno-0-1069"></a>        <span class="p">)</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070" href="#__codelineno-0-1070"></a>
<a id="__codelineno-0-1071" name="__codelineno-0-1071" href="#__codelineno-0-1071"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072" href="#__codelineno-0-1072"></a>    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073" href="#__codelineno-0-1073"></a>        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">excluded_cols</span><span class="p">:</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074" href="#__codelineno-0-1074"></a>            <span class="n">modify_col</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;append&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">i</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075" href="#__codelineno-0-1075"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076" href="#__codelineno-0-1076"></a>                <span class="n">modify_col</span><span class="p">,</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">parameters</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">parameters</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077" href="#__codelineno-0-1077"></a>            <span class="p">)</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078" href="#__codelineno-0-1078"></a>
<a id="__codelineno-0-1079" name="__codelineno-0-1079" href="#__codelineno-0-1079"></a>    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pre_existing_model</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080" href="#__codelineno-0-1080"></a>        <span class="n">df_model</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081" href="#__codelineno-0-1081"></a>            <span class="nb">zip</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="n">parameters</span><span class="p">),</span> <span class="n">schema</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="s2">&quot;parameters&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082" href="#__codelineno-0-1082"></a>        <span class="p">)</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083" href="#__codelineno-0-1083"></a>        <span class="n">df_model</span><span class="o">.</span><span class="n">coalesce</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084" href="#__codelineno-0-1084"></a>            <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/z_standardization&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085" href="#__codelineno-0-1085"></a>        <span class="p">)</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086" href="#__codelineno-0-1086"></a>
<a id="__codelineno-0-1087" name="__codelineno-0-1087" href="#__codelineno-0-1087"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088" href="#__codelineno-0-1088"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089" href="#__codelineno-0-1089"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="n">list_of_cols</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090" href="#__codelineno-0-1090"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091" href="#__codelineno-0-1091"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092" href="#__codelineno-0-1092"></a>                <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">excluded_cols</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093" href="#__codelineno-0-1093"></a>            <span class="p">]</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094" href="#__codelineno-0-1094"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before: &quot;</span><span class="p">)</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095" href="#__codelineno-0-1095"></a>        <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096" href="#__codelineno-0-1096"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After: &quot;</span><span class="p">)</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097" href="#__codelineno-0-1097"></a>        <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">output_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098" href="#__codelineno-0-1098"></a>
<a id="__codelineno-0-1099" name="__codelineno-0-1099" href="#__codelineno-0-1099"></a>    <span class="k">return</span> <span class="n">odf</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100" href="#__codelineno-0-1100"></a>
<a id="__codelineno-0-1101" name="__codelineno-0-1101" href="#__codelineno-0-1101"></a>
<a id="__codelineno-0-1102" name="__codelineno-0-1102" href="#__codelineno-0-1102"></a><span class="k">def</span> <span class="nf">IQR_standardization</span><span class="p">(</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103" href="#__codelineno-0-1103"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104" href="#__codelineno-0-1104"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105" href="#__codelineno-0-1105"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106" href="#__codelineno-0-1106"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107" href="#__codelineno-0-1107"></a>    <span class="n">pre_existing_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108" href="#__codelineno-0-1108"></a>    <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109" href="#__codelineno-0-1109"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110" href="#__codelineno-0-1110"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111" href="#__codelineno-0-1111"></a><span class="p">):</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112" href="#__codelineno-0-1112"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113" href="#__codelineno-0-1113"></a>
<a id="__codelineno-0-1114" name="__codelineno-0-1114" href="#__codelineno-0-1114"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115" href="#__codelineno-0-1115"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116" href="#__codelineno-0-1116"></a><span class="sd">    spark</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117" href="#__codelineno-0-1117"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118" href="#__codelineno-0-1118"></a><span class="sd">    idf</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119" href="#__codelineno-0-1119"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120" href="#__codelineno-0-1120"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121" href="#__codelineno-0-1121"></a><span class="sd">        List of numerical columns to transform e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122" href="#__codelineno-0-1122"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123" href="#__codelineno-0-1123"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124" href="#__codelineno-0-1124"></a><span class="sd">        &quot;all&quot; can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125" href="#__codelineno-0-1125"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126" href="#__codelineno-0-1126"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127" href="#__codelineno-0-1127"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128" href="#__codelineno-0-1128"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129" href="#__codelineno-0-1129"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130" href="#__codelineno-0-1130"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131" href="#__codelineno-0-1131"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132" href="#__codelineno-0-1132"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133" href="#__codelineno-0-1133"></a><span class="sd">    pre_existing_model</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134" href="#__codelineno-0-1134"></a><span class="sd">        Boolean argument – True or False. True if model files (25/50/75 percentile for each feature) exists already, False Otherwise (Default value = False)</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135" href="#__codelineno-0-1135"></a><span class="sd">    model_path</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136" href="#__codelineno-0-1136"></a><span class="sd">        If pre_existing_model is True, this argument is path for referring the pre-saved model.</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137" href="#__codelineno-0-1137"></a><span class="sd">        If pre_existing_model is False, this argument can be used for saving the model.</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138" href="#__codelineno-0-1138"></a><span class="sd">        Default &quot;NA&quot; means there is neither pre-existing model nor there is a need to save one.</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139" href="#__codelineno-0-1139"></a><span class="sd">    output_mode</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140" href="#__codelineno-0-1140"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141" href="#__codelineno-0-1141"></a><span class="sd">        “replace” option replaces original columns with transformed column. “append” option append transformed</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142" href="#__codelineno-0-1142"></a><span class="sd">        column to the input dataset with a postfix &quot;_scaled&quot; e.g. column X is appended as X_scaled. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143" href="#__codelineno-0-1143"></a><span class="sd">    print_impact</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144" href="#__codelineno-0-1144"></a><span class="sd">        True, False (Default value = False)</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145" href="#__codelineno-0-1145"></a><span class="sd">        This argument is to print out the before and after descriptive statistics of rescaled columns.</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146" href="#__codelineno-0-1146"></a>
<a id="__codelineno-0-1147" name="__codelineno-0-1147" href="#__codelineno-0-1147"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148" href="#__codelineno-0-1148"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149" href="#__codelineno-0-1149"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150" href="#__codelineno-0-1150"></a><span class="sd">        Rescaled Dataframe</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151" href="#__codelineno-0-1151"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152" href="#__codelineno-0-1152"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153" href="#__codelineno-0-1153"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154" href="#__codelineno-0-1154"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155" href="#__codelineno-0-1155"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156" href="#__codelineno-0-1156"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157" href="#__codelineno-0-1157"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158" href="#__codelineno-0-1158"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159" href="#__codelineno-0-1159"></a>
<a id="__codelineno-0-1160" name="__codelineno-0-1160" href="#__codelineno-0-1160"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161" href="#__codelineno-0-1161"></a>
<a id="__codelineno-0-1162" name="__codelineno-0-1162" href="#__codelineno-0-1162"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163" href="#__codelineno-0-1163"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164" href="#__codelineno-0-1164"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165" href="#__codelineno-0-1165"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-1166" name="__codelineno-0-1166" href="#__codelineno-0-1166"></a>            <span class="s2">&quot;No Standardization Performed - No numerical column(s) to transform&quot;</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167" href="#__codelineno-0-1167"></a>        <span class="p">)</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168" href="#__codelineno-0-1168"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169" href="#__codelineno-0-1169"></a>
<a id="__codelineno-0-1170" name="__codelineno-0-1170" href="#__codelineno-0-1170"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171" href="#__codelineno-0-1171"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for output_mode&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172" href="#__codelineno-0-1172"></a>
<a id="__codelineno-0-1173" name="__codelineno-0-1173" href="#__codelineno-0-1173"></a>    <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174" href="#__codelineno-0-1174"></a>        <span class="n">df_model</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/IQR_standardization&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175" href="#__codelineno-0-1175"></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176" href="#__codelineno-0-1176"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177" href="#__codelineno-0-1177"></a>            <span class="n">mapped_value</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178" href="#__codelineno-0-1178"></a>                <span class="n">df_model</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179" href="#__codelineno-0-1179"></a>                <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;parameters&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180" href="#__codelineno-0-1180"></a>                <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181" href="#__codelineno-0-1181"></a>                <span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182" href="#__codelineno-0-1182"></a>            <span class="p">)</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183" href="#__codelineno-0-1183"></a>            <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapped_value</span><span class="p">)</span>
<a id="__codelineno-0-1184" name="__codelineno-0-1184" href="#__codelineno-0-1184"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185" href="#__codelineno-0-1185"></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">approxQuantile</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">],</span> <span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186" href="#__codelineno-0-1186"></a>
<a id="__codelineno-0-1187" name="__codelineno-0-1187" href="#__codelineno-0-1187"></a>    <span class="n">excluded_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188" href="#__codelineno-0-1188"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189" href="#__codelineno-0-1189"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190" href="#__codelineno-0-1190"></a>            <span class="k">if</span> <span class="nb">round</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="nb">round</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">5</span><span class="p">):</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191" href="#__codelineno-0-1191"></a>                <span class="n">excluded_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192" href="#__codelineno-0-1192"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193" href="#__codelineno-0-1193"></a>            <span class="n">excluded_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194" href="#__codelineno-0-1194"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">excluded_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195" href="#__codelineno-0-1195"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196" href="#__codelineno-0-1196"></a>            <span class="s2">&quot;The following column(s) are excluded from standardization because the 75th and 25th percentiles are the same:&quot;</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197" href="#__codelineno-0-1197"></a>            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">excluded_cols</span><span class="p">)</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198" href="#__codelineno-0-1198"></a>        <span class="p">)</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199" href="#__codelineno-0-1199"></a>
<a id="__codelineno-0-1200" name="__codelineno-0-1200" href="#__codelineno-0-1200"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201" href="#__codelineno-0-1201"></a>    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202" href="#__codelineno-0-1202"></a>        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">excluded_cols</span><span class="p">:</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203" href="#__codelineno-0-1203"></a>            <span class="n">modify_col</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;append&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">i</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204" href="#__codelineno-0-1204"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205" href="#__codelineno-0-1205"></a>                <span class="n">modify_col</span><span class="p">,</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206" href="#__codelineno-0-1206"></a>                <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">parameters</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207" href="#__codelineno-0-1207"></a>                <span class="o">/</span> <span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">parameters</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208" href="#__codelineno-0-1208"></a>            <span class="p">)</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209" href="#__codelineno-0-1209"></a>
<a id="__codelineno-0-1210" name="__codelineno-0-1210" href="#__codelineno-0-1210"></a>    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pre_existing_model</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1211" name="__codelineno-0-1211" href="#__codelineno-0-1211"></a>        <span class="n">df_model</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212" href="#__codelineno-0-1212"></a>            <span class="nb">zip</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="n">parameters</span><span class="p">),</span> <span class="n">schema</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="s2">&quot;parameters&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213" href="#__codelineno-0-1213"></a>        <span class="p">)</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214" href="#__codelineno-0-1214"></a>        <span class="n">df_model</span><span class="o">.</span><span class="n">coalesce</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span>
<a id="__codelineno-0-1215" name="__codelineno-0-1215" href="#__codelineno-0-1215"></a>            <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/IQR_standardization&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216" href="#__codelineno-0-1216"></a>        <span class="p">)</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217" href="#__codelineno-0-1217"></a>
<a id="__codelineno-0-1218" name="__codelineno-0-1218" href="#__codelineno-0-1218"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219" href="#__codelineno-0-1219"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220" href="#__codelineno-0-1220"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="n">list_of_cols</span>
<a id="__codelineno-0-1221" name="__codelineno-0-1221" href="#__codelineno-0-1221"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222" href="#__codelineno-0-1222"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1223" name="__codelineno-0-1223" href="#__codelineno-0-1223"></a>                <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">excluded_cols</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224" href="#__codelineno-0-1224"></a>            <span class="p">]</span>
<a id="__codelineno-0-1225" name="__codelineno-0-1225" href="#__codelineno-0-1225"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before: &quot;</span><span class="p">)</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226" href="#__codelineno-0-1226"></a>        <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1227" name="__codelineno-0-1227" href="#__codelineno-0-1227"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After: &quot;</span><span class="p">)</span>
<a id="__codelineno-0-1228" name="__codelineno-0-1228" href="#__codelineno-0-1228"></a>        <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">output_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1229" name="__codelineno-0-1229" href="#__codelineno-0-1229"></a>
<a id="__codelineno-0-1230" name="__codelineno-0-1230" href="#__codelineno-0-1230"></a>    <span class="k">return</span> <span class="n">odf</span>
<a id="__codelineno-0-1231" name="__codelineno-0-1231" href="#__codelineno-0-1231"></a>
<a id="__codelineno-0-1232" name="__codelineno-0-1232" href="#__codelineno-0-1232"></a>
<a id="__codelineno-0-1233" name="__codelineno-0-1233" href="#__codelineno-0-1233"></a><span class="k">def</span> <span class="nf">normalization</span><span class="p">(</span>
<a id="__codelineno-0-1234" name="__codelineno-0-1234" href="#__codelineno-0-1234"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235" href="#__codelineno-0-1235"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236" href="#__codelineno-0-1236"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-1237" name="__codelineno-0-1237" href="#__codelineno-0-1237"></a>    <span class="n">pre_existing_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1238" name="__codelineno-0-1238" href="#__codelineno-0-1238"></a>    <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239" href="#__codelineno-0-1239"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1240" name="__codelineno-0-1240" href="#__codelineno-0-1240"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241" href="#__codelineno-0-1241"></a><span class="p">):</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242" href="#__codelineno-0-1242"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1243" name="__codelineno-0-1243" href="#__codelineno-0-1243"></a>
<a id="__codelineno-0-1244" name="__codelineno-0-1244" href="#__codelineno-0-1244"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1245" name="__codelineno-0-1245" href="#__codelineno-0-1245"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246" href="#__codelineno-0-1246"></a><span class="sd">    idf</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247" href="#__codelineno-0-1247"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248" href="#__codelineno-0-1248"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249" href="#__codelineno-0-1249"></a><span class="sd">        List of numerical columns to transform e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250" href="#__codelineno-0-1250"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-1251" name="__codelineno-0-1251" href="#__codelineno-0-1251"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252" href="#__codelineno-0-1252"></a><span class="sd">        &quot;all&quot; can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253" href="#__codelineno-0-1253"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-0-1254" name="__codelineno-0-1254" href="#__codelineno-0-1254"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-0-1255" name="__codelineno-0-1255" href="#__codelineno-0-1255"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256" href="#__codelineno-0-1256"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-1257" name="__codelineno-0-1257" href="#__codelineno-0-1257"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-1258" name="__codelineno-0-1258" href="#__codelineno-0-1258"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259" href="#__codelineno-0-1259"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-0-1260" name="__codelineno-0-1260" href="#__codelineno-0-1260"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261" href="#__codelineno-0-1261"></a><span class="sd">    pre_existing_model</span>
<a id="__codelineno-0-1262" name="__codelineno-0-1262" href="#__codelineno-0-1262"></a><span class="sd">        Boolean argument – True or False. True if normalization/scalar model exists already, False Otherwise (Default value = False)</span>
<a id="__codelineno-0-1263" name="__codelineno-0-1263" href="#__codelineno-0-1263"></a><span class="sd">    model_path</span>
<a id="__codelineno-0-1264" name="__codelineno-0-1264" href="#__codelineno-0-1264"></a><span class="sd">        If pre_existing_model is True, this argument is path for referring the pre-saved model.</span>
<a id="__codelineno-0-1265" name="__codelineno-0-1265" href="#__codelineno-0-1265"></a><span class="sd">        If pre_existing_model is False, this argument can be used for saving the model.</span>
<a id="__codelineno-0-1266" name="__codelineno-0-1266" href="#__codelineno-0-1266"></a><span class="sd">        Default &quot;NA&quot; means there is neither pre-existing model nor there is a need to save one.</span>
<a id="__codelineno-0-1267" name="__codelineno-0-1267" href="#__codelineno-0-1267"></a><span class="sd">    output_mode</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268" href="#__codelineno-0-1268"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-0-1269" name="__codelineno-0-1269" href="#__codelineno-0-1269"></a><span class="sd">        “replace” option replaces original columns with transformed column. “append” option append transformed</span>
<a id="__codelineno-0-1270" name="__codelineno-0-1270" href="#__codelineno-0-1270"></a><span class="sd">        column to the input dataset with a postfix &quot;_scaled&quot; e.g. column X is appended as X_scaled. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-0-1271" name="__codelineno-0-1271" href="#__codelineno-0-1271"></a><span class="sd">    print_impact</span>
<a id="__codelineno-0-1272" name="__codelineno-0-1272" href="#__codelineno-0-1272"></a><span class="sd">        True, False (Default value = False)</span>
<a id="__codelineno-0-1273" name="__codelineno-0-1273" href="#__codelineno-0-1273"></a><span class="sd">        This argument is to print out before and after descriptive statistics of rescaled columns.</span>
<a id="__codelineno-0-1274" name="__codelineno-0-1274" href="#__codelineno-0-1274"></a>
<a id="__codelineno-0-1275" name="__codelineno-0-1275" href="#__codelineno-0-1275"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276" href="#__codelineno-0-1276"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1277" name="__codelineno-0-1277" href="#__codelineno-0-1277"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-0-1278" name="__codelineno-0-1278" href="#__codelineno-0-1278"></a><span class="sd">        Rescaled Dataframe</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279" href="#__codelineno-0-1279"></a>
<a id="__codelineno-0-1280" name="__codelineno-0-1280" href="#__codelineno-0-1280"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1281" name="__codelineno-0-1281" href="#__codelineno-0-1281"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282" href="#__codelineno-0-1282"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1283" name="__codelineno-0-1283" href="#__codelineno-0-1283"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-0-1284" name="__codelineno-0-1284" href="#__codelineno-0-1284"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-1285" name="__codelineno-0-1285" href="#__codelineno-0-1285"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286" href="#__codelineno-0-1286"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-1287" name="__codelineno-0-1287" href="#__codelineno-0-1287"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-1288" name="__codelineno-0-1288" href="#__codelineno-0-1288"></a>
<a id="__codelineno-0-1289" name="__codelineno-0-1289" href="#__codelineno-0-1289"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-0-1290" name="__codelineno-0-1290" href="#__codelineno-0-1290"></a>
<a id="__codelineno-0-1291" name="__codelineno-0-1291" href="#__codelineno-0-1291"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292" href="#__codelineno-0-1292"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1293" name="__codelineno-0-1293" href="#__codelineno-0-1293"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1294" name="__codelineno-0-1294" href="#__codelineno-0-1294"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295" href="#__codelineno-0-1295"></a>            <span class="s2">&quot;No Normalization Performed - No numerical column(s) to transform&quot;</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296" href="#__codelineno-0-1296"></a>        <span class="p">)</span>
<a id="__codelineno-0-1297" name="__codelineno-0-1297" href="#__codelineno-0-1297"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-0-1298" name="__codelineno-0-1298" href="#__codelineno-0-1298"></a>
<a id="__codelineno-0-1299" name="__codelineno-0-1299" href="#__codelineno-0-1299"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1300" name="__codelineno-0-1300" href="#__codelineno-0-1300"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for output_mode&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1301" name="__codelineno-0-1301" href="#__codelineno-0-1301"></a>
<a id="__codelineno-0-1302" name="__codelineno-0-1302" href="#__codelineno-0-1302"></a>    <span class="n">idf_id</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;tempID&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">monotonically_increasing_id</span><span class="p">())</span>
<a id="__codelineno-0-1303" name="__codelineno-0-1303" href="#__codelineno-0-1303"></a>    <span class="n">idf_partial</span> <span class="o">=</span> <span class="n">idf_id</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s2">&quot;tempID&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-0-1304" name="__codelineno-0-1304" href="#__codelineno-0-1304"></a>
<a id="__codelineno-0-1305" name="__codelineno-0-1305" href="#__codelineno-0-1305"></a>    <span class="n">assembler</span> <span class="o">=</span> <span class="n">VectorAssembler</span><span class="p">(</span>
<a id="__codelineno-0-1306" name="__codelineno-0-1306" href="#__codelineno-0-1306"></a>        <span class="n">inputCols</span><span class="o">=</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;list_of_cols_vector&quot;</span><span class="p">,</span> <span class="n">handleInvalid</span><span class="o">=</span><span class="s2">&quot;keep&quot;</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307" href="#__codelineno-0-1307"></a>    <span class="p">)</span>
<a id="__codelineno-0-1308" name="__codelineno-0-1308" href="#__codelineno-0-1308"></a>    <span class="n">assembled_data</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">idf_partial</span><span class="p">)</span>
<a id="__codelineno-0-1309" name="__codelineno-0-1309" href="#__codelineno-0-1309"></a>    <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-0-1310" name="__codelineno-0-1310" href="#__codelineno-0-1310"></a>        <span class="n">scalerModel</span> <span class="o">=</span> <span class="n">MinMaxScalerModel</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/normalization&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1311" name="__codelineno-0-1311" href="#__codelineno-0-1311"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1312" name="__codelineno-0-1312" href="#__codelineno-0-1312"></a>        <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span>
<a id="__codelineno-0-1313" name="__codelineno-0-1313" href="#__codelineno-0-1313"></a>            <span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;list_of_cols_vector&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;list_of_cols_scaled&quot;</span>
<a id="__codelineno-0-1314" name="__codelineno-0-1314" href="#__codelineno-0-1314"></a>        <span class="p">)</span>
<a id="__codelineno-0-1315" name="__codelineno-0-1315" href="#__codelineno-0-1315"></a>        <span class="n">scalerModel</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">assembled_data</span><span class="p">)</span>
<a id="__codelineno-0-1316" name="__codelineno-0-1316" href="#__codelineno-0-1316"></a>
<a id="__codelineno-0-1317" name="__codelineno-0-1317" href="#__codelineno-0-1317"></a>        <span class="k">if</span> <span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1318" name="__codelineno-0-1318" href="#__codelineno-0-1318"></a>            <span class="n">scalerModel</span><span class="o">.</span><span class="n">write</span><span class="p">()</span><span class="o">.</span><span class="n">overwrite</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/normalization&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1319" name="__codelineno-0-1319" href="#__codelineno-0-1319"></a>
<a id="__codelineno-0-1320" name="__codelineno-0-1320" href="#__codelineno-0-1320"></a>    <span class="n">scaledData</span> <span class="o">=</span> <span class="n">scalerModel</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">assembled_data</span><span class="p">)</span>
<a id="__codelineno-0-1321" name="__codelineno-0-1321" href="#__codelineno-0-1321"></a>
<a id="__codelineno-0-1322" name="__codelineno-0-1322" href="#__codelineno-0-1322"></a>    <span class="k">def</span> <span class="nf">vector_to_array</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
<a id="__codelineno-0-1323" name="__codelineno-0-1323" href="#__codelineno-0-1323"></a>        <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">toArray</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-1324" name="__codelineno-0-1324" href="#__codelineno-0-1324"></a>
<a id="__codelineno-0-1325" name="__codelineno-0-1325" href="#__codelineno-0-1325"></a>    <span class="n">f_vector_to_array</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">udf</span><span class="p">(</span><span class="n">vector_to_array</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">ArrayType</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">FloatType</span><span class="p">()))</span>
<a id="__codelineno-0-1326" name="__codelineno-0-1326" href="#__codelineno-0-1326"></a>
<a id="__codelineno-0-1327" name="__codelineno-0-1327" href="#__codelineno-0-1327"></a>    <span class="n">odf_partial</span> <span class="o">=</span> <span class="n">scaledData</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-1328" name="__codelineno-0-1328" href="#__codelineno-0-1328"></a>        <span class="s2">&quot;list_of_cols_array&quot;</span><span class="p">,</span> <span class="n">f_vector_to_array</span><span class="p">(</span><span class="s2">&quot;list_of_cols_scaled&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1329" name="__codelineno-0-1329" href="#__codelineno-0-1329"></a>    <span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="s2">&quot;list_of_cols_scaled&quot;</span><span class="p">,</span> <span class="s2">&quot;list_of_cols_vector&quot;</span><span class="p">])</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330" href="#__codelineno-0-1330"></a>
<a id="__codelineno-0-1331" name="__codelineno-0-1331" href="#__codelineno-0-1331"></a>    <span class="n">odf_schema</span> <span class="o">=</span> <span class="n">odf_partial</span><span class="o">.</span><span class="n">schema</span>
<a id="__codelineno-0-1332" name="__codelineno-0-1332" href="#__codelineno-0-1332"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-1333" name="__codelineno-0-1333" href="#__codelineno-0-1333"></a>        <span class="n">odf_schema</span> <span class="o">=</span> <span class="n">odf_schema</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">FloatType</span><span class="p">()))</span>
<a id="__codelineno-0-1334" name="__codelineno-0-1334" href="#__codelineno-0-1334"></a>    <span class="n">odf_partial</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1335" name="__codelineno-0-1335" href="#__codelineno-0-1335"></a>        <span class="n">odf_partial</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;list_of_cols_array&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-1336" name="__codelineno-0-1336" href="#__codelineno-0-1336"></a>        <span class="o">.</span><span class="n">toDF</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">odf_schema</span><span class="p">)</span>
<a id="__codelineno-0-1337" name="__codelineno-0-1337" href="#__codelineno-0-1337"></a>        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;list_of_cols_array&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1338" name="__codelineno-0-1338" href="#__codelineno-0-1338"></a>    <span class="p">)</span>
<a id="__codelineno-0-1339" name="__codelineno-0-1339" href="#__codelineno-0-1339"></a>
<a id="__codelineno-0-1340" name="__codelineno-0-1340" href="#__codelineno-0-1340"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf_id</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">odf_partial</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_cols</span><span class="p">),</span> <span class="s2">&quot;tempID&quot;</span><span class="p">,</span> <span class="s2">&quot;left_outer&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-0-1341" name="__codelineno-0-1341" href="#__codelineno-0-1341"></a>        <span class="n">idf</span><span class="o">.</span><span class="n">columns</span>
<a id="__codelineno-0-1342" name="__codelineno-0-1342" href="#__codelineno-0-1342"></a>        <span class="o">+</span> <span class="p">[</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343" href="#__codelineno-0-1343"></a>            <span class="p">(</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344" href="#__codelineno-0-1344"></a>                <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">)),</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
<a id="__codelineno-0-1345" name="__codelineno-0-1345" href="#__codelineno-0-1345"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346" href="#__codelineno-0-1346"></a>                <span class="p">)</span>
<a id="__codelineno-0-1347" name="__codelineno-0-1347" href="#__codelineno-0-1347"></a>            <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348" href="#__codelineno-0-1348"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span>
<a id="__codelineno-0-1349" name="__codelineno-0-1349" href="#__codelineno-0-1349"></a>        <span class="p">]</span>
<a id="__codelineno-0-1350" name="__codelineno-0-1350" href="#__codelineno-0-1350"></a>    <span class="p">)</span>
<a id="__codelineno-0-1351" name="__codelineno-0-1351" href="#__codelineno-0-1351"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1352" name="__codelineno-0-1352" href="#__codelineno-0-1352"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-1353" name="__codelineno-0-1353" href="#__codelineno-0-1353"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1354" name="__codelineno-0-1354" href="#__codelineno-0-1354"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">idf</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<a id="__codelineno-0-1355" name="__codelineno-0-1355" href="#__codelineno-0-1355"></a>
<a id="__codelineno-0-1356" name="__codelineno-0-1356" href="#__codelineno-0-1356"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-1357" name="__codelineno-0-1357" href="#__codelineno-0-1357"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1358" name="__codelineno-0-1358" href="#__codelineno-0-1358"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="n">list_of_cols</span>
<a id="__codelineno-0-1359" name="__codelineno-0-1359" href="#__codelineno-0-1359"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1360" name="__codelineno-0-1360" href="#__codelineno-0-1360"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">]</span>
<a id="__codelineno-0-1361" name="__codelineno-0-1361" href="#__codelineno-0-1361"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before: &quot;</span><span class="p">)</span>
<a id="__codelineno-0-1362" name="__codelineno-0-1362" href="#__codelineno-0-1362"></a>        <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1363" name="__codelineno-0-1363" href="#__codelineno-0-1363"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After: &quot;</span><span class="p">)</span>
<a id="__codelineno-0-1364" name="__codelineno-0-1364" href="#__codelineno-0-1364"></a>        <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">output_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1365" name="__codelineno-0-1365" href="#__codelineno-0-1365"></a>
<a id="__codelineno-0-1366" name="__codelineno-0-1366" href="#__codelineno-0-1366"></a>    <span class="k">return</span> <span class="n">odf</span>
<a id="__codelineno-0-1367" name="__codelineno-0-1367" href="#__codelineno-0-1367"></a>
<a id="__codelineno-0-1368" name="__codelineno-0-1368" href="#__codelineno-0-1368"></a>
<a id="__codelineno-0-1369" name="__codelineno-0-1369" href="#__codelineno-0-1369"></a><span class="k">def</span> <span class="nf">imputation_MMM</span><span class="p">(</span>
<a id="__codelineno-0-1370" name="__codelineno-0-1370" href="#__codelineno-0-1370"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-1371" name="__codelineno-0-1371" href="#__codelineno-0-1371"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-1372" name="__codelineno-0-1372" href="#__codelineno-0-1372"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1373" name="__codelineno-0-1373" href="#__codelineno-0-1373"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374" href="#__codelineno-0-1374"></a>    <span class="n">method_type</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375" href="#__codelineno-0-1375"></a>    <span class="n">pre_existing_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1376" name="__codelineno-0-1376" href="#__codelineno-0-1376"></a>    <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1377" name="__codelineno-0-1377" href="#__codelineno-0-1377"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1378" name="__codelineno-0-1378" href="#__codelineno-0-1378"></a>    <span class="n">stats_missing</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379" href="#__codelineno-0-1379"></a>    <span class="n">stats_mode</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380" href="#__codelineno-0-1380"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381" href="#__codelineno-0-1381"></a><span class="p">):</span>
<a id="__codelineno-0-1382" name="__codelineno-0-1382" href="#__codelineno-0-1382"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383" href="#__codelineno-0-1383"></a><span class="sd">    This function handles missing value related issues by substituting null values by the measure of central</span>
<a id="__codelineno-0-1384" name="__codelineno-0-1384" href="#__codelineno-0-1384"></a><span class="sd">    tendency (mode for categorical features and mean/median for numerical features). For numerical attributes,</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385" href="#__codelineno-0-1385"></a><span class="sd">    it leverages [Imputer](https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.feature.Imputer</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386" href="#__codelineno-0-1386"></a><span class="sd">    .html) functionality of Spark MLlib. Though, Imputer can be used for categorical attributes but this feature is</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387" href="#__codelineno-0-1387"></a><span class="sd">    available only in Spark3.x, therefore for categorical features, we compute mode or leverage mode computation from</span>
<a id="__codelineno-0-1388" name="__codelineno-0-1388" href="#__codelineno-0-1388"></a><span class="sd">    Measures of Central Tendency.</span>
<a id="__codelineno-0-1389" name="__codelineno-0-1389" href="#__codelineno-0-1389"></a>
<a id="__codelineno-0-1390" name="__codelineno-0-1390" href="#__codelineno-0-1390"></a>
<a id="__codelineno-0-1391" name="__codelineno-0-1391" href="#__codelineno-0-1391"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1392" name="__codelineno-0-1392" href="#__codelineno-0-1392"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393" href="#__codelineno-0-1393"></a><span class="sd">    spark</span>
<a id="__codelineno-0-1394" name="__codelineno-0-1394" href="#__codelineno-0-1394"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395" href="#__codelineno-0-1395"></a><span class="sd">    idf</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396" href="#__codelineno-0-1396"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-1397" name="__codelineno-0-1397" href="#__codelineno-0-1397"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-0-1398" name="__codelineno-0-1398" href="#__codelineno-0-1398"></a><span class="sd">        List of columns to impute e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-1399" name="__codelineno-0-1399" href="#__codelineno-0-1399"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-1400" name="__codelineno-0-1400" href="#__codelineno-0-1400"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-1401" name="__codelineno-0-1401" href="#__codelineno-0-1401"></a><span class="sd">        &quot;all&quot; can be passed to include all (non-array) columns for analysis.</span>
<a id="__codelineno-0-1402" name="__codelineno-0-1402" href="#__codelineno-0-1402"></a><span class="sd">        This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-0-1403" name="__codelineno-0-1403" href="#__codelineno-0-1403"></a><span class="sd">        &quot;missing&quot; (default) can be passed to include only those columns with missing values.</span>
<a id="__codelineno-0-1404" name="__codelineno-0-1404" href="#__codelineno-0-1404"></a><span class="sd">        One of the usecases where &quot;all&quot; may be preferable over &quot;missing&quot; is when the user wants to save</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405" href="#__codelineno-0-1405"></a><span class="sd">        the imputation model for the future use e.g. a column may not have missing value in the training</span>
<a id="__codelineno-0-1406" name="__codelineno-0-1406" href="#__codelineno-0-1406"></a><span class="sd">        dataset but missing values may possibly appear in the prediction dataset.</span>
<a id="__codelineno-0-1407" name="__codelineno-0-1407" href="#__codelineno-0-1407"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-0-1408" name="__codelineno-0-1408" href="#__codelineno-0-1408"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols.</span>
<a id="__codelineno-0-1409" name="__codelineno-0-1409" href="#__codelineno-0-1409"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-0-1410" name="__codelineno-0-1410" href="#__codelineno-0-1410"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-1411" name="__codelineno-0-1411" href="#__codelineno-0-1411"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-1412" name="__codelineno-0-1412" href="#__codelineno-0-1412"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413" href="#__codelineno-0-1413"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-0-1414" name="__codelineno-0-1414" href="#__codelineno-0-1414"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-0-1415" name="__codelineno-0-1415" href="#__codelineno-0-1415"></a><span class="sd">    method_type</span>
<a id="__codelineno-0-1416" name="__codelineno-0-1416" href="#__codelineno-0-1416"></a><span class="sd">        &quot;median&quot;, &quot;mean&quot; (valid only for for numerical columns attributes).</span>
<a id="__codelineno-0-1417" name="__codelineno-0-1417" href="#__codelineno-0-1417"></a><span class="sd">        Mode is only option for categorical columns. (Default value = &quot;median&quot;)</span>
<a id="__codelineno-0-1418" name="__codelineno-0-1418" href="#__codelineno-0-1418"></a><span class="sd">    pre_existing_model</span>
<a id="__codelineno-0-1419" name="__codelineno-0-1419" href="#__codelineno-0-1419"></a><span class="sd">        Boolean argument – True or False. True if imputation model exists already, False otherwise. (Default value = False)</span>
<a id="__codelineno-0-1420" name="__codelineno-0-1420" href="#__codelineno-0-1420"></a><span class="sd">    model_path</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421" href="#__codelineno-0-1421"></a><span class="sd">        If pre_existing_model is True, this argument is path for referring the pre-saved model.</span>
<a id="__codelineno-0-1422" name="__codelineno-0-1422" href="#__codelineno-0-1422"></a><span class="sd">        If pre_existing_model is False, this argument can be used for saving the model.</span>
<a id="__codelineno-0-1423" name="__codelineno-0-1423" href="#__codelineno-0-1423"></a><span class="sd">        Default &quot;NA&quot; means there is neither pre-existing model nor there is a need to save one.</span>
<a id="__codelineno-0-1424" name="__codelineno-0-1424" href="#__codelineno-0-1424"></a><span class="sd">    output_mode</span>
<a id="__codelineno-0-1425" name="__codelineno-0-1425" href="#__codelineno-0-1425"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-0-1426" name="__codelineno-0-1426" href="#__codelineno-0-1426"></a><span class="sd">        “replace” option replaces original columns with transformed column. “append” option append transformed</span>
<a id="__codelineno-0-1427" name="__codelineno-0-1427" href="#__codelineno-0-1427"></a><span class="sd">        column to the input dataset with a postfix &quot;_imputed&quot; e.g. column X is appended as X_imputed. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-0-1428" name="__codelineno-0-1428" href="#__codelineno-0-1428"></a><span class="sd">    stats_missing</span>
<a id="__codelineno-0-1429" name="__codelineno-0-1429" href="#__codelineno-0-1429"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-0-1430" name="__codelineno-0-1430" href="#__codelineno-0-1430"></a><span class="sd">        to read pre-saved statistics on missing count/pct i.e. if measures_of_counts or</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431" href="#__codelineno-0-1431"></a><span class="sd">        missingCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-0-1432" name="__codelineno-0-1432" href="#__codelineno-0-1432"></a><span class="sd">    stats_mode</span>
<a id="__codelineno-0-1433" name="__codelineno-0-1433" href="#__codelineno-0-1433"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-0-1434" name="__codelineno-0-1434" href="#__codelineno-0-1434"></a><span class="sd">        to read pre-saved statistics on most frequently seen values i.e. if measures_of_centralTendency or</span>
<a id="__codelineno-0-1435" name="__codelineno-0-1435" href="#__codelineno-0-1435"></a><span class="sd">        mode_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-0-1436" name="__codelineno-0-1436" href="#__codelineno-0-1436"></a><span class="sd">    print_impact</span>
<a id="__codelineno-0-1437" name="__codelineno-0-1437" href="#__codelineno-0-1437"></a><span class="sd">        True, False (Default value = False)</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438" href="#__codelineno-0-1438"></a><span class="sd">        This argument is to print out before and after missing counts of imputed columns.</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439" href="#__codelineno-0-1439"></a>
<a id="__codelineno-0-1440" name="__codelineno-0-1440" href="#__codelineno-0-1440"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1441" name="__codelineno-0-1441" href="#__codelineno-0-1441"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1442" name="__codelineno-0-1442" href="#__codelineno-0-1442"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443" href="#__codelineno-0-1443"></a><span class="sd">        Imputed Dataframe</span>
<a id="__codelineno-0-1444" name="__codelineno-0-1444" href="#__codelineno-0-1444"></a>
<a id="__codelineno-0-1445" name="__codelineno-0-1445" href="#__codelineno-0-1445"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1446" name="__codelineno-0-1446" href="#__codelineno-0-1446"></a>    <span class="k">if</span> <span class="n">stats_missing</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-0-1447" name="__codelineno-0-1447" href="#__codelineno-0-1447"></a>        <span class="n">missing_df</span> <span class="o">=</span> <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">)</span>
<a id="__codelineno-0-1448" name="__codelineno-0-1448" href="#__codelineno-0-1448"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1449" name="__codelineno-0-1449" href="#__codelineno-0-1449"></a>        <span class="n">missing_df</span> <span class="o">=</span> <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_missing</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450" href="#__codelineno-0-1450"></a>            <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_count&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_pct&quot;</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451" href="#__codelineno-0-1451"></a>        <span class="p">)</span>
<a id="__codelineno-0-1452" name="__codelineno-0-1452" href="#__codelineno-0-1452"></a>
<a id="__codelineno-0-1453" name="__codelineno-0-1453" href="#__codelineno-0-1453"></a>    <span class="n">missing_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1454" name="__codelineno-0-1454" href="#__codelineno-0-1454"></a>        <span class="n">missing_df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1455" name="__codelineno-0-1455" href="#__codelineno-0-1455"></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1456" name="__codelineno-0-1456" href="#__codelineno-0-1456"></a>        <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-1457" name="__codelineno-0-1457" href="#__codelineno-0-1457"></a>        <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-1458" name="__codelineno-0-1458" href="#__codelineno-0-1458"></a>    <span class="p">)</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459" href="#__codelineno-0-1459"></a>
<a id="__codelineno-0-1460" name="__codelineno-0-1460" href="#__codelineno-0-1460"></a>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_existing_model</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1461" name="__codelineno-0-1461" href="#__codelineno-0-1461"></a>        <span class="n">pre_existing_model</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1462" name="__codelineno-0-1462" href="#__codelineno-0-1462"></a>    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_existing_model</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1463" name="__codelineno-0-1463" href="#__codelineno-0-1463"></a>        <span class="n">pre_existing_model</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464" href="#__codelineno-0-1464"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465" href="#__codelineno-0-1465"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Non-Boolean input for pre_existing_model&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1466" name="__codelineno-0-1466" href="#__codelineno-0-1466"></a>
<a id="__codelineno-0-1467" name="__codelineno-0-1467" href="#__codelineno-0-1467"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">missing_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pre_existing_model</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">model_path</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1468" name="__codelineno-0-1468" href="#__codelineno-0-1468"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-0-1469" name="__codelineno-0-1469" href="#__codelineno-0-1469"></a>
<a id="__codelineno-0-1470" name="__codelineno-0-1470" href="#__codelineno-0-1470"></a>    <span class="n">num_cols</span><span class="p">,</span> <span class="n">cat_cols</span><span class="p">,</span> <span class="n">other_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)</span>
<a id="__codelineno-0-1471" name="__codelineno-0-1471" href="#__codelineno-0-1471"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1472" name="__codelineno-0-1472" href="#__codelineno-0-1472"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span> <span class="o">+</span> <span class="n">cat_cols</span>
<a id="__codelineno-0-1473" name="__codelineno-0-1473" href="#__codelineno-0-1473"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;missing&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1474" name="__codelineno-0-1474" href="#__codelineno-0-1474"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">missing_cols</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="o">+</span> <span class="n">cat_cols</span><span class="p">]</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475" href="#__codelineno-0-1475"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-1476" name="__codelineno-0-1476" href="#__codelineno-0-1476"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-1477" name="__codelineno-0-1477" href="#__codelineno-0-1477"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-1478" name="__codelineno-0-1478" href="#__codelineno-0-1478"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-1479" name="__codelineno-0-1479" href="#__codelineno-0-1479"></a>
<a id="__codelineno-0-1480" name="__codelineno-0-1480" href="#__codelineno-0-1480"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-0-1481" name="__codelineno-0-1481" href="#__codelineno-0-1481"></a>
<a id="__codelineno-0-1482" name="__codelineno-0-1482" href="#__codelineno-0-1482"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1483" name="__codelineno-0-1483" href="#__codelineno-0-1483"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No Imputation performed- No column(s) to impute&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1484" name="__codelineno-0-1484" href="#__codelineno-0-1484"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-0-1485" name="__codelineno-0-1485" href="#__codelineno-0-1485"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="o">+</span> <span class="n">cat_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-1486" name="__codelineno-0-1486" href="#__codelineno-0-1486"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1487" name="__codelineno-0-1487" href="#__codelineno-0-1487"></a>    <span class="k">if</span> <span class="n">method_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;median&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1488" name="__codelineno-0-1488" href="#__codelineno-0-1488"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for method_type&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1489" name="__codelineno-0-1489" href="#__codelineno-0-1489"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1490" name="__codelineno-0-1490" href="#__codelineno-0-1490"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for output_mode&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1491" name="__codelineno-0-1491" href="#__codelineno-0-1491"></a>
<a id="__codelineno-0-1492" name="__codelineno-0-1492" href="#__codelineno-0-1492"></a>    <span class="n">num_cols</span><span class="p">,</span> <span class="n">cat_cols</span><span class="p">,</span> <span class="n">other_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-0-1493" name="__codelineno-0-1493" href="#__codelineno-0-1493"></a>
<a id="__codelineno-0-1494" name="__codelineno-0-1494" href="#__codelineno-0-1494"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-1495" name="__codelineno-0-1495" href="#__codelineno-0-1495"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">num_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1496" name="__codelineno-0-1496" href="#__codelineno-0-1496"></a>        <span class="n">recast_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1497" name="__codelineno-0-1497" href="#__codelineno-0-1497"></a>        <span class="n">recast_type</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1498" name="__codelineno-0-1498" href="#__codelineno-0-1498"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">num_cols</span><span class="p">:</span>
<a id="__codelineno-0-1499" name="__codelineno-0-1499" href="#__codelineno-0-1499"></a>            <span class="k">if</span> <span class="n">get_dtype</span><span class="p">(</span><span class="n">idf</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;double&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1500" name="__codelineno-0-1500" href="#__codelineno-0-1500"></a>                <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">DoubleType</span><span class="p">()))</span>
<a id="__codelineno-0-1501" name="__codelineno-0-1501" href="#__codelineno-0-1501"></a>                <span class="n">recast_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1502" name="__codelineno-0-1502" href="#__codelineno-0-1502"></a>                <span class="n">recast_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_dtype</span><span class="p">(</span><span class="n">idf</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
<a id="__codelineno-0-1503" name="__codelineno-0-1503" href="#__codelineno-0-1503"></a>
<a id="__codelineno-0-1504" name="__codelineno-0-1504" href="#__codelineno-0-1504"></a>        <span class="c1"># For mode imputation</span>
<a id="__codelineno-0-1505" name="__codelineno-0-1505" href="#__codelineno-0-1505"></a>        <span class="k">if</span> <span class="n">method_type</span> <span class="o">==</span> <span class="s2">&quot;mode&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1506" name="__codelineno-0-1506" href="#__codelineno-0-1506"></a>            <span class="k">if</span> <span class="n">stats_mode</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-0-1507" name="__codelineno-0-1507" href="#__codelineno-0-1507"></a>                <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1508" name="__codelineno-0-1508" href="#__codelineno-0-1508"></a>                    <span class="nb">str</span><span class="p">(</span>
<a id="__codelineno-0-1509" name="__codelineno-0-1509" href="#__codelineno-0-1509"></a>                        <span class="p">(</span>
<a id="__codelineno-0-1510" name="__codelineno-0-1510" href="#__codelineno-0-1510"></a>                            <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1511" name="__codelineno-0-1511" href="#__codelineno-0-1511"></a>                            <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<a id="__codelineno-0-1512" name="__codelineno-0-1512" href="#__codelineno-0-1512"></a>                            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1513" name="__codelineno-0-1513" href="#__codelineno-0-1513"></a>                            <span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-0-1514" name="__codelineno-0-1514" href="#__codelineno-0-1514"></a>                            <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1515" name="__codelineno-0-1515" href="#__codelineno-0-1515"></a>                            <span class="o">.</span><span class="n">first</span><span class="p">()</span>
<a id="__codelineno-0-1516" name="__codelineno-0-1516" href="#__codelineno-0-1516"></a>                            <span class="ow">or</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-0-1517" name="__codelineno-0-1517" href="#__codelineno-0-1517"></a>                        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1518" name="__codelineno-0-1518" href="#__codelineno-0-1518"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1519" name="__codelineno-0-1519" href="#__codelineno-0-1519"></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">num_cols</span>
<a id="__codelineno-0-1520" name="__codelineno-0-1520" href="#__codelineno-0-1520"></a>                <span class="p">]</span>
<a id="__codelineno-0-1521" name="__codelineno-0-1521" href="#__codelineno-0-1521"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522" href="#__codelineno-0-1522"></a>                <span class="n">mode_df</span> <span class="o">=</span> <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_mode</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523" href="#__codelineno-0-1523"></a>                <span class="n">mode_df_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mode_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()[</span><span class="s2">&quot;attribute&quot;</span><span class="p">])</span>
<a id="__codelineno-0-1524" name="__codelineno-0-1524" href="#__codelineno-0-1524"></a>                <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1525" name="__codelineno-0-1525" href="#__codelineno-0-1525"></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">num_cols</span><span class="p">:</span>
<a id="__codelineno-0-1526" name="__codelineno-0-1526" href="#__codelineno-0-1526"></a>                    <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode_df_cols</span><span class="p">:</span>
<a id="__codelineno-0-1527" name="__codelineno-0-1527" href="#__codelineno-0-1527"></a>                        <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1528" name="__codelineno-0-1528" href="#__codelineno-0-1528"></a>                            <span class="nb">str</span><span class="p">(</span>
<a id="__codelineno-0-1529" name="__codelineno-0-1529" href="#__codelineno-0-1529"></a>                                <span class="p">(</span>
<a id="__codelineno-0-1530" name="__codelineno-0-1530" href="#__codelineno-0-1530"></a>                                    <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1531" name="__codelineno-0-1531" href="#__codelineno-0-1531"></a>                                    <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532" href="#__codelineno-0-1532"></a>                                    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1533" name="__codelineno-0-1533" href="#__codelineno-0-1533"></a>                                    <span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-0-1534" name="__codelineno-0-1534" href="#__codelineno-0-1534"></a>                                    <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535" href="#__codelineno-0-1535"></a>                                    <span class="o">.</span><span class="n">first</span><span class="p">()</span>
<a id="__codelineno-0-1536" name="__codelineno-0-1536" href="#__codelineno-0-1536"></a>                                    <span class="ow">or</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-0-1537" name="__codelineno-0-1537" href="#__codelineno-0-1537"></a>                                <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538" href="#__codelineno-0-1538"></a>                            <span class="p">)</span>
<a id="__codelineno-0-1539" name="__codelineno-0-1539" href="#__codelineno-0-1539"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1540" name="__codelineno-0-1540" href="#__codelineno-0-1540"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1541" name="__codelineno-0-1541" href="#__codelineno-0-1541"></a>                        <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1542" name="__codelineno-0-1542" href="#__codelineno-0-1542"></a>                            <span class="n">mode_df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543" href="#__codelineno-0-1543"></a>                            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1544" name="__codelineno-0-1544" href="#__codelineno-0-1544"></a>                            <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545" href="#__codelineno-0-1545"></a>                            <span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546" href="#__codelineno-0-1546"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547" href="#__codelineno-0-1547"></a>
<a id="__codelineno-0-1548" name="__codelineno-0-1548" href="#__codelineno-0-1548"></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">num_cols</span><span class="p">):</span>
<a id="__codelineno-0-1549" name="__codelineno-0-1549" href="#__codelineno-0-1549"></a>                <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-1550" name="__codelineno-0-1550" href="#__codelineno-0-1550"></a>                    <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1551" name="__codelineno-0-1551" href="#__codelineno-0-1551"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="n">parameters</span><span class="p">[</span><span class="n">index</span><span class="p">])</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span>
<a id="__codelineno-0-1552" name="__codelineno-0-1552" href="#__codelineno-0-1552"></a>                <span class="p">)</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553" href="#__codelineno-0-1553"></a>
<a id="__codelineno-0-1554" name="__codelineno-0-1554" href="#__codelineno-0-1554"></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># For mean, median imputation</span>
<a id="__codelineno-0-1555" name="__codelineno-0-1555" href="#__codelineno-0-1555"></a>            <span class="c1"># Building new imputer model or uploading the existing model</span>
<a id="__codelineno-0-1556" name="__codelineno-0-1556" href="#__codelineno-0-1556"></a>            <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557" href="#__codelineno-0-1557"></a>                <span class="n">imputerModel</span> <span class="o">=</span> <span class="n">ImputerModel</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558" href="#__codelineno-0-1558"></a>                    <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/imputation_MMM/num_imputer-model&quot;</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559" href="#__codelineno-0-1559"></a>                <span class="p">)</span>
<a id="__codelineno-0-1560" name="__codelineno-0-1560" href="#__codelineno-0-1560"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1561" name="__codelineno-0-1561" href="#__codelineno-0-1561"></a>                <span class="n">imputer</span> <span class="o">=</span> <span class="n">Imputer</span><span class="p">(</span>
<a id="__codelineno-0-1562" name="__codelineno-0-1562" href="#__codelineno-0-1562"></a>                    <span class="n">strategy</span><span class="o">=</span><span class="n">method_type</span><span class="p">,</span>
<a id="__codelineno-0-1563" name="__codelineno-0-1563" href="#__codelineno-0-1563"></a>                    <span class="n">inputCols</span><span class="o">=</span><span class="n">num_cols</span><span class="p">,</span>
<a id="__codelineno-0-1564" name="__codelineno-0-1564" href="#__codelineno-0-1564"></a>                    <span class="n">outputCols</span><span class="o">=</span><span class="p">[(</span><span class="n">e</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">num_cols</span><span class="p">],</span>
<a id="__codelineno-0-1565" name="__codelineno-0-1565" href="#__codelineno-0-1565"></a>                <span class="p">)</span>
<a id="__codelineno-0-1566" name="__codelineno-0-1566" href="#__codelineno-0-1566"></a>                <span class="n">imputerModel</span> <span class="o">=</span> <span class="n">imputer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">odf</span><span class="p">)</span>
<a id="__codelineno-0-1567" name="__codelineno-0-1567" href="#__codelineno-0-1567"></a>
<a id="__codelineno-0-1568" name="__codelineno-0-1568" href="#__codelineno-0-1568"></a>            <span class="c1"># Applying model</span>
<a id="__codelineno-0-1569" name="__codelineno-0-1569" href="#__codelineno-0-1569"></a>            <span class="c1"># odf = recast_column(imputerModel.transform(odf), recast_cols, recast_type)</span>
<a id="__codelineno-0-1570" name="__codelineno-0-1570" href="#__codelineno-0-1570"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">imputerModel</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">odf</span><span class="p">)</span>
<a id="__codelineno-0-1571" name="__codelineno-0-1571" href="#__codelineno-0-1571"></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">recast_cols</span><span class="p">,</span> <span class="n">recast_type</span><span class="p">):</span>
<a id="__codelineno-0-1572" name="__codelineno-0-1572" href="#__codelineno-0-1572"></a>                <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
<a id="__codelineno-0-1573" name="__codelineno-0-1573" href="#__codelineno-0-1573"></a>
<a id="__codelineno-0-1574" name="__codelineno-0-1574" href="#__codelineno-0-1574"></a>            <span class="c1"># Saving model if required</span>
<a id="__codelineno-0-1575" name="__codelineno-0-1575" href="#__codelineno-0-1575"></a>            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pre_existing_model</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1576" name="__codelineno-0-1576" href="#__codelineno-0-1576"></a>                <span class="n">imputerModel</span><span class="o">.</span><span class="n">write</span><span class="p">()</span><span class="o">.</span><span class="n">overwrite</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
<a id="__codelineno-0-1577" name="__codelineno-0-1577" href="#__codelineno-0-1577"></a>                    <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/imputation_MMM/num_imputer-model&quot;</span>
<a id="__codelineno-0-1578" name="__codelineno-0-1578" href="#__codelineno-0-1578"></a>                <span class="p">)</span>
<a id="__codelineno-0-1579" name="__codelineno-0-1579" href="#__codelineno-0-1579"></a>
<a id="__codelineno-0-1580" name="__codelineno-0-1580" href="#__codelineno-0-1580"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cat_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1581" name="__codelineno-0-1581" href="#__codelineno-0-1581"></a>        <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-0-1582" name="__codelineno-0-1582" href="#__codelineno-0-1582"></a>            <span class="n">df_model</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span>
<a id="__codelineno-0-1583" name="__codelineno-0-1583" href="#__codelineno-0-1583"></a>                <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/imputation_MMM/cat_imputer&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1584" name="__codelineno-0-1584" href="#__codelineno-0-1584"></a>                <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1585" name="__codelineno-0-1585" href="#__codelineno-0-1585"></a>                <span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1586" name="__codelineno-0-1586" href="#__codelineno-0-1586"></a>            <span class="p">)</span>
<a id="__codelineno-0-1587" name="__codelineno-0-1587" href="#__codelineno-0-1587"></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1588" name="__codelineno-0-1588" href="#__codelineno-0-1588"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cat_cols</span><span class="p">:</span>
<a id="__codelineno-0-1589" name="__codelineno-0-1589" href="#__codelineno-0-1589"></a>                <span class="n">mapped_value</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1590" name="__codelineno-0-1590" href="#__codelineno-0-1590"></a>                    <span class="n">df_model</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1591" name="__codelineno-0-1591" href="#__codelineno-0-1591"></a>                    <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;parameters&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1592" name="__codelineno-0-1592" href="#__codelineno-0-1592"></a>                    <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-1593" name="__codelineno-0-1593" href="#__codelineno-0-1593"></a>                    <span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1594" name="__codelineno-0-1594" href="#__codelineno-0-1594"></a>                <span class="p">)</span>
<a id="__codelineno-0-1595" name="__codelineno-0-1595" href="#__codelineno-0-1595"></a>                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapped_value</span><span class="p">)</span>
<a id="__codelineno-0-1596" name="__codelineno-0-1596" href="#__codelineno-0-1596"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1597" name="__codelineno-0-1597" href="#__codelineno-0-1597"></a>            <span class="k">if</span> <span class="n">stats_mode</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-0-1598" name="__codelineno-0-1598" href="#__codelineno-0-1598"></a>                <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1599" name="__codelineno-0-1599" href="#__codelineno-0-1599"></a>                    <span class="nb">str</span><span class="p">(</span>
<a id="__codelineno-0-1600" name="__codelineno-0-1600" href="#__codelineno-0-1600"></a>                        <span class="p">(</span>
<a id="__codelineno-0-1601" name="__codelineno-0-1601" href="#__codelineno-0-1601"></a>                            <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1602" name="__codelineno-0-1602" href="#__codelineno-0-1602"></a>                            <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<a id="__codelineno-0-1603" name="__codelineno-0-1603" href="#__codelineno-0-1603"></a>                            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1604" name="__codelineno-0-1604" href="#__codelineno-0-1604"></a>                            <span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-0-1605" name="__codelineno-0-1605" href="#__codelineno-0-1605"></a>                            <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1606" name="__codelineno-0-1606" href="#__codelineno-0-1606"></a>                            <span class="o">.</span><span class="n">first</span><span class="p">()</span>
<a id="__codelineno-0-1607" name="__codelineno-0-1607" href="#__codelineno-0-1607"></a>                            <span class="ow">or</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-0-1608" name="__codelineno-0-1608" href="#__codelineno-0-1608"></a>                        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609" href="#__codelineno-0-1609"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1610" name="__codelineno-0-1610" href="#__codelineno-0-1610"></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cat_cols</span>
<a id="__codelineno-0-1611" name="__codelineno-0-1611" href="#__codelineno-0-1611"></a>                <span class="p">]</span>
<a id="__codelineno-0-1612" name="__codelineno-0-1612" href="#__codelineno-0-1612"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1613" name="__codelineno-0-1613" href="#__codelineno-0-1613"></a>                <span class="n">mode_df</span> <span class="o">=</span> <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_mode</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-1614" name="__codelineno-0-1614" href="#__codelineno-0-1614"></a>                <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1615" name="__codelineno-0-1615" href="#__codelineno-0-1615"></a>                    <span class="n">mode_df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1616" name="__codelineno-0-1616" href="#__codelineno-0-1616"></a>                    <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1617" name="__codelineno-0-1617" href="#__codelineno-0-1617"></a>                    <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<a id="__codelineno-0-1618" name="__codelineno-0-1618" href="#__codelineno-0-1618"></a>                    <span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1619" name="__codelineno-0-1619" href="#__codelineno-0-1619"></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cat_cols</span>
<a id="__codelineno-0-1620" name="__codelineno-0-1620" href="#__codelineno-0-1620"></a>                <span class="p">]</span>
<a id="__codelineno-0-1621" name="__codelineno-0-1621" href="#__codelineno-0-1621"></a>
<a id="__codelineno-0-1622" name="__codelineno-0-1622" href="#__codelineno-0-1622"></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cat_cols</span><span class="p">):</span>
<a id="__codelineno-0-1623" name="__codelineno-0-1623" href="#__codelineno-0-1623"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-1624" name="__codelineno-0-1624" href="#__codelineno-0-1624"></a>                <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1625" name="__codelineno-0-1625" href="#__codelineno-0-1625"></a>                <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="n">parameters</span><span class="p">[</span><span class="n">index</span><span class="p">])</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span>
<a id="__codelineno-0-1626" name="__codelineno-0-1626" href="#__codelineno-0-1626"></a>            <span class="p">)</span>
<a id="__codelineno-0-1627" name="__codelineno-0-1627" href="#__codelineno-0-1627"></a>
<a id="__codelineno-0-1628" name="__codelineno-0-1628" href="#__codelineno-0-1628"></a>        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pre_existing_model</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1629" name="__codelineno-0-1629" href="#__codelineno-0-1629"></a>            <span class="n">df_model</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
<a id="__codelineno-0-1630" name="__codelineno-0-1630" href="#__codelineno-0-1630"></a>                <span class="nb">zip</span><span class="p">(</span><span class="n">cat_cols</span><span class="p">,</span> <span class="n">parameters</span><span class="p">),</span> <span class="n">schema</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;parameters&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1631" name="__codelineno-0-1631" href="#__codelineno-0-1631"></a>            <span class="p">)</span>
<a id="__codelineno-0-1632" name="__codelineno-0-1632" href="#__codelineno-0-1632"></a>            <span class="n">df_model</span><span class="o">.</span><span class="n">repartition</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span>
<a id="__codelineno-0-1633" name="__codelineno-0-1633" href="#__codelineno-0-1633"></a>                <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/imputation_MMM/cat_imputer&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1634" name="__codelineno-0-1634" href="#__codelineno-0-1634"></a>                <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1635" name="__codelineno-0-1635" href="#__codelineno-0-1635"></a>                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1636" name="__codelineno-0-1636" href="#__codelineno-0-1636"></a>            <span class="p">)</span>
<a id="__codelineno-0-1637" name="__codelineno-0-1637" href="#__codelineno-0-1637"></a>
<a id="__codelineno-0-1638" name="__codelineno-0-1638" href="#__codelineno-0-1638"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="o">+</span> <span class="n">cat_cols</span><span class="p">:</span>
<a id="__codelineno-0-1639" name="__codelineno-0-1639" href="#__codelineno-0-1639"></a>        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">missing_cols</span><span class="p">:</span>
<a id="__codelineno-0-1640" name="__codelineno-0-1640" href="#__codelineno-0-1640"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1641" name="__codelineno-0-1641" href="#__codelineno-0-1641"></a>        <span class="k">elif</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1642" name="__codelineno-0-1642" href="#__codelineno-0-1642"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1643" name="__codelineno-0-1643" href="#__codelineno-0-1643"></a>
<a id="__codelineno-0-1644" name="__codelineno-0-1644" href="#__codelineno-0-1644"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-1645" name="__codelineno-0-1645" href="#__codelineno-0-1645"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1646" name="__codelineno-0-1646" href="#__codelineno-0-1646"></a>            <span class="n">odf_print</span> <span class="o">=</span> <span class="n">missing_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-0-1647" name="__codelineno-0-1647" href="#__codelineno-0-1647"></a>                <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;missingCount_before&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1648" name="__codelineno-0-1648" href="#__codelineno-0-1648"></a>            <span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1649" name="__codelineno-0-1649" href="#__codelineno-0-1649"></a>                <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">odf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-0-1650" name="__codelineno-0-1650" href="#__codelineno-0-1650"></a>                    <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;missingCount_after&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1651" name="__codelineno-0-1651" href="#__codelineno-0-1651"></a>                <span class="p">),</span>
<a id="__codelineno-0-1652" name="__codelineno-0-1652" href="#__codelineno-0-1652"></a>                <span class="s2">&quot;attribute&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1653" name="__codelineno-0-1653" href="#__codelineno-0-1653"></a>                <span class="s2">&quot;inner&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1654" name="__codelineno-0-1654" href="#__codelineno-0-1654"></a>            <span class="p">)</span>
<a id="__codelineno-0-1655" name="__codelineno-0-1655" href="#__codelineno-0-1655"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1656" name="__codelineno-0-1656" href="#__codelineno-0-1656"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1657" name="__codelineno-0-1657" href="#__codelineno-0-1657"></a>                <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1658" name="__codelineno-0-1658" href="#__codelineno-0-1658"></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="p">(</span><span class="n">num_cols</span> <span class="o">+</span> <span class="n">cat_cols</span><span class="p">)</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">missing_cols</span><span class="p">]</span>
<a id="__codelineno-0-1659" name="__codelineno-0-1659" href="#__codelineno-0-1659"></a>            <span class="p">]</span>
<a id="__codelineno-0-1660" name="__codelineno-0-1660" href="#__codelineno-0-1660"></a>            <span class="n">odf_print</span> <span class="o">=</span> <span class="n">missing_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-0-1661" name="__codelineno-0-1661" href="#__codelineno-0-1661"></a>                <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;missingCount_before&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1662" name="__codelineno-0-1662" href="#__codelineno-0-1662"></a>            <span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1663" name="__codelineno-0-1663" href="#__codelineno-0-1663"></a>                <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">odf</span><span class="p">,</span> <span class="n">output_cols</span><span class="p">)</span>
<a id="__codelineno-0-1664" name="__codelineno-0-1664" href="#__codelineno-0-1664"></a>                <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;attribute_after&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1665" name="__codelineno-0-1665" href="#__codelineno-0-1665"></a>                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-1666" name="__codelineno-0-1666" href="#__codelineno-0-1666"></a>                    <span class="s2">&quot;attribute&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1667" name="__codelineno-0-1667" href="#__codelineno-0-1667"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">expr</span><span class="p">(</span><span class="s2">&quot;substring(attribute_after, 1, length(attribute_after)-8)&quot;</span><span class="p">),</span>
<a id="__codelineno-0-1668" name="__codelineno-0-1668" href="#__codelineno-0-1668"></a>                <span class="p">)</span>
<a id="__codelineno-0-1669" name="__codelineno-0-1669" href="#__codelineno-0-1669"></a>                <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">),</span>
<a id="__codelineno-0-1670" name="__codelineno-0-1670" href="#__codelineno-0-1670"></a>                <span class="s2">&quot;attribute&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1671" name="__codelineno-0-1671" href="#__codelineno-0-1671"></a>                <span class="s2">&quot;inner&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1672" name="__codelineno-0-1672" href="#__codelineno-0-1672"></a>            <span class="p">)</span>
<a id="__codelineno-0-1673" name="__codelineno-0-1673" href="#__codelineno-0-1673"></a>        <span class="n">odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">),</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1674" name="__codelineno-0-1674" href="#__codelineno-0-1674"></a>    <span class="k">return</span> <span class="n">odf</span>
<a id="__codelineno-0-1675" name="__codelineno-0-1675" href="#__codelineno-0-1675"></a>
<a id="__codelineno-0-1676" name="__codelineno-0-1676" href="#__codelineno-0-1676"></a>
<a id="__codelineno-0-1677" name="__codelineno-0-1677" href="#__codelineno-0-1677"></a><span class="k">def</span> <span class="nf">imputation_sklearn</span><span class="p">(</span>
<a id="__codelineno-0-1678" name="__codelineno-0-1678" href="#__codelineno-0-1678"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-1679" name="__codelineno-0-1679" href="#__codelineno-0-1679"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-1680" name="__codelineno-0-1680" href="#__codelineno-0-1680"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1681" name="__codelineno-0-1681" href="#__codelineno-0-1681"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-1682" name="__codelineno-0-1682" href="#__codelineno-0-1682"></a>    <span class="n">missing_threshold</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-1683" name="__codelineno-0-1683" href="#__codelineno-0-1683"></a>    <span class="n">method_type</span><span class="o">=</span><span class="s2">&quot;regression&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1684" name="__codelineno-0-1684" href="#__codelineno-0-1684"></a>    <span class="n">use_sampling</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1685" name="__codelineno-0-1685" href="#__codelineno-0-1685"></a>    <span class="n">sample_method</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1686" name="__codelineno-0-1686" href="#__codelineno-0-1686"></a>    <span class="n">strata_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1687" name="__codelineno-0-1687" href="#__codelineno-0-1687"></a>    <span class="n">stratified_type</span><span class="o">=</span><span class="s2">&quot;population&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1688" name="__codelineno-0-1688" href="#__codelineno-0-1688"></a>    <span class="n">sample_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
<a id="__codelineno-0-1689" name="__codelineno-0-1689" href="#__codelineno-0-1689"></a>    <span class="n">sample_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
<a id="__codelineno-0-1690" name="__codelineno-0-1690" href="#__codelineno-0-1690"></a>    <span class="n">persist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1691" name="__codelineno-0-1691" href="#__codelineno-0-1691"></a>    <span class="n">persist_option</span><span class="o">=</span><span class="n">pyspark</span><span class="o">.</span><span class="n">StorageLevel</span><span class="o">.</span><span class="n">MEMORY_AND_DISK</span><span class="p">,</span>
<a id="__codelineno-0-1692" name="__codelineno-0-1692" href="#__codelineno-0-1692"></a>    <span class="n">pre_existing_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1693" name="__codelineno-0-1693" href="#__codelineno-0-1693"></a>    <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1694" name="__codelineno-0-1694" href="#__codelineno-0-1694"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1695" name="__codelineno-0-1695" href="#__codelineno-0-1695"></a>    <span class="n">stats_missing</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-0-1696" name="__codelineno-0-1696" href="#__codelineno-0-1696"></a>    <span class="n">run_type</span><span class="o">=</span><span class="s2">&quot;local&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1697" name="__codelineno-0-1697" href="#__codelineno-0-1697"></a>    <span class="n">auth_key</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1698" name="__codelineno-0-1698" href="#__codelineno-0-1698"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1699" name="__codelineno-0-1699" href="#__codelineno-0-1699"></a><span class="p">):</span>
<a id="__codelineno-0-1700" name="__codelineno-0-1700" href="#__codelineno-0-1700"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1701" name="__codelineno-0-1701" href="#__codelineno-0-1701"></a><span class="sd">    The function &quot;imputation_sklearn&quot; leverages sklearn imputer algorithms. Two methods are supported via this function:</span>
<a id="__codelineno-0-1702" name="__codelineno-0-1702" href="#__codelineno-0-1702"></a><span class="sd">    “KNN” and “regression”.</span>
<a id="__codelineno-0-1703" name="__codelineno-0-1703" href="#__codelineno-0-1703"></a>
<a id="__codelineno-0-1704" name="__codelineno-0-1704" href="#__codelineno-0-1704"></a><span class="sd">    “KNN” option trains a sklearn.impute.KNNImputer which is based on k-Nearest Neighbors algorithm. The missing</span>
<a id="__codelineno-0-1705" name="__codelineno-0-1705" href="#__codelineno-0-1705"></a><span class="sd">    values of a sample are imputed using the mean of its 5 nearest neighbors in the training set. “regression” option</span>
<a id="__codelineno-0-1706" name="__codelineno-0-1706" href="#__codelineno-0-1706"></a><span class="sd">    trains a sklearn.impute.IterativeImputer which models attribute to impute as a function of rest of the attributes</span>
<a id="__codelineno-0-1707" name="__codelineno-0-1707" href="#__codelineno-0-1707"></a><span class="sd">    and imputes using the estimation. Imputation is performed in an iterative way from attributes with fewest number</span>
<a id="__codelineno-0-1708" name="__codelineno-0-1708" href="#__codelineno-0-1708"></a><span class="sd">    of missing values to most. All the hyperparameters used in the above mentioned imputers are their default values.</span>
<a id="__codelineno-0-1709" name="__codelineno-0-1709" href="#__codelineno-0-1709"></a>
<a id="__codelineno-0-1710" name="__codelineno-0-1710" href="#__codelineno-0-1710"></a><span class="sd">    However, sklearn imputers are not scalable, which might be slow if the size of the input dataframe is large.</span>
<a id="__codelineno-0-1711" name="__codelineno-0-1711" href="#__codelineno-0-1711"></a><span class="sd">    In fact, if the input dataframe size exceeds 10 GigaBytes, the model fitting step powered by sklearn might fail.</span>
<a id="__codelineno-0-1712" name="__codelineno-0-1712" href="#__codelineno-0-1712"></a><span class="sd">    Thus, an input sample_size (the default value is 10,000) can be set to control the number of samples to be used</span>
<a id="__codelineno-0-1713" name="__codelineno-0-1713" href="#__codelineno-0-1713"></a><span class="sd">    to train the imputer. If the total number of input dataset exceeds sample_size, the rest of the samples will be imputed</span>
<a id="__codelineno-0-1714" name="__codelineno-0-1714" href="#__codelineno-0-1714"></a><span class="sd">    using the trained imputer in a scalable manner. This is one of the way to demonstrate how Anovos has been</span>
<a id="__codelineno-0-1715" name="__codelineno-0-1715" href="#__codelineno-0-1715"></a><span class="sd">    designed as a scalable feature engineering library.</span>
<a id="__codelineno-0-1716" name="__codelineno-0-1716" href="#__codelineno-0-1716"></a>
<a id="__codelineno-0-1717" name="__codelineno-0-1717" href="#__codelineno-0-1717"></a>
<a id="__codelineno-0-1718" name="__codelineno-0-1718" href="#__codelineno-0-1718"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-1719" name="__codelineno-0-1719" href="#__codelineno-0-1719"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-1720" name="__codelineno-0-1720" href="#__codelineno-0-1720"></a><span class="sd">    spark</span>
<a id="__codelineno-0-1721" name="__codelineno-0-1721" href="#__codelineno-0-1721"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-0-1722" name="__codelineno-0-1722" href="#__codelineno-0-1722"></a><span class="sd">    idf</span>
<a id="__codelineno-0-1723" name="__codelineno-0-1723" href="#__codelineno-0-1723"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-1724" name="__codelineno-0-1724" href="#__codelineno-0-1724"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-0-1725" name="__codelineno-0-1725" href="#__codelineno-0-1725"></a><span class="sd">        List of columns to impute e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-1726" name="__codelineno-0-1726" href="#__codelineno-0-1726"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-1727" name="__codelineno-0-1727" href="#__codelineno-0-1727"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-1728" name="__codelineno-0-1728" href="#__codelineno-0-1728"></a><span class="sd">        &quot;all&quot; can be passed to include all (non-array) columns for analysis.</span>
<a id="__codelineno-0-1729" name="__codelineno-0-1729" href="#__codelineno-0-1729"></a><span class="sd">        This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-0-1730" name="__codelineno-0-1730" href="#__codelineno-0-1730"></a><span class="sd">        &quot;missing&quot; (default) can be passed to include only those columns with missing values.</span>
<a id="__codelineno-0-1731" name="__codelineno-0-1731" href="#__codelineno-0-1731"></a><span class="sd">        One of the usecases where &quot;all&quot; may be preferable over &quot;missing&quot; is when the user wants to save</span>
<a id="__codelineno-0-1732" name="__codelineno-0-1732" href="#__codelineno-0-1732"></a><span class="sd">        the imputation model for the future use e.g. a column may not have missing value in the training</span>
<a id="__codelineno-0-1733" name="__codelineno-0-1733" href="#__codelineno-0-1733"></a><span class="sd">        dataset but missing values may possibly appear in the prediction dataset.</span>
<a id="__codelineno-0-1734" name="__codelineno-0-1734" href="#__codelineno-0-1734"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-0-1735" name="__codelineno-0-1735" href="#__codelineno-0-1735"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols.</span>
<a id="__codelineno-0-1736" name="__codelineno-0-1736" href="#__codelineno-0-1736"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-0-1737" name="__codelineno-0-1737" href="#__codelineno-0-1737"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-1738" name="__codelineno-0-1738" href="#__codelineno-0-1738"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-1739" name="__codelineno-0-1739" href="#__codelineno-0-1739"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-1740" name="__codelineno-0-1740" href="#__codelineno-0-1740"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-0-1741" name="__codelineno-0-1741" href="#__codelineno-0-1741"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-0-1742" name="__codelineno-0-1742" href="#__codelineno-0-1742"></a><span class="sd">    missing_threshold</span>
<a id="__codelineno-0-1743" name="__codelineno-0-1743" href="#__codelineno-0-1743"></a><span class="sd">        Float argument - If list_of_cols is &quot;missing&quot;, this argument is used to determined the missing threshold</span>
<a id="__codelineno-0-1744" name="__codelineno-0-1744" href="#__codelineno-0-1744"></a><span class="sd">        for every column. The column that has more (count of missing value/ count of total value) &gt;= missing_threshold</span>
<a id="__codelineno-0-1745" name="__codelineno-0-1745" href="#__codelineno-0-1745"></a><span class="sd">        will be excluded from the list of columns to be imputed. (Default value = 1.0)</span>
<a id="__codelineno-0-1746" name="__codelineno-0-1746" href="#__codelineno-0-1746"></a><span class="sd">    method_type</span>
<a id="__codelineno-0-1747" name="__codelineno-0-1747" href="#__codelineno-0-1747"></a><span class="sd">        &quot;KNN&quot;, &quot;regression&quot;.</span>
<a id="__codelineno-0-1748" name="__codelineno-0-1748" href="#__codelineno-0-1748"></a><span class="sd">        &quot;KNN&quot; option trains a sklearn.impute.KNNImputer. &quot;regression&quot; option trains a sklearn.impute.IterativeImputer</span>
<a id="__codelineno-0-1749" name="__codelineno-0-1749" href="#__codelineno-0-1749"></a><span class="sd">        (Default value = &quot;regression&quot;)</span>
<a id="__codelineno-0-1750" name="__codelineno-0-1750" href="#__codelineno-0-1750"></a><span class="sd">    use_sampling</span>
<a id="__codelineno-0-1751" name="__codelineno-0-1751" href="#__codelineno-0-1751"></a><span class="sd">        Boolean argument - True or False. This argument is used to determine whether to use sampling on</span>
<a id="__codelineno-0-1752" name="__codelineno-0-1752" href="#__codelineno-0-1752"></a><span class="sd">        source and target dataset, True will enable the use of sample method, otherwise False.</span>
<a id="__codelineno-0-1753" name="__codelineno-0-1753" href="#__codelineno-0-1753"></a><span class="sd">        It is recommended to set this as True for large datasets. (Default value = True)</span>
<a id="__codelineno-0-1754" name="__codelineno-0-1754" href="#__codelineno-0-1754"></a><span class="sd">    sample_method</span>
<a id="__codelineno-0-1755" name="__codelineno-0-1755" href="#__codelineno-0-1755"></a><span class="sd">        If use_sampling is True, this argument is used to determine the sampling method.</span>
<a id="__codelineno-0-1756" name="__codelineno-0-1756" href="#__codelineno-0-1756"></a><span class="sd">        &quot;stratified&quot; for Stratified sampling, &quot;random&quot; for Random Sampling.</span>
<a id="__codelineno-0-1757" name="__codelineno-0-1757" href="#__codelineno-0-1757"></a><span class="sd">        For more details, please refer to https://docs.anovos.ai/api/data_ingest/data_sampling.html.</span>
<a id="__codelineno-0-1758" name="__codelineno-0-1758" href="#__codelineno-0-1758"></a><span class="sd">        (Default value = &quot;random&quot;)</span>
<a id="__codelineno-0-1759" name="__codelineno-0-1759" href="#__codelineno-0-1759"></a><span class="sd">    strata_cols</span>
<a id="__codelineno-0-1760" name="__codelineno-0-1760" href="#__codelineno-0-1760"></a><span class="sd">        If use_sampling is True and sample_method is &quot;stratified&quot;, this argument is used to determine the list</span>
<a id="__codelineno-0-1761" name="__codelineno-0-1761" href="#__codelineno-0-1761"></a><span class="sd">        of columns used to be treated as strata. For more details, please refer to</span>
<a id="__codelineno-0-1762" name="__codelineno-0-1762" href="#__codelineno-0-1762"></a><span class="sd">        https://docs.anovos.ai/api/data_ingest/data_sampling.html. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-0-1763" name="__codelineno-0-1763" href="#__codelineno-0-1763"></a><span class="sd">    stratified_type</span>
<a id="__codelineno-0-1764" name="__codelineno-0-1764" href="#__codelineno-0-1764"></a><span class="sd">        If use_sampling is True and sample_method is &quot;stratified&quot;, this argument is used to determine the stratified</span>
<a id="__codelineno-0-1765" name="__codelineno-0-1765" href="#__codelineno-0-1765"></a><span class="sd">        sampling method. &quot;population&quot; stands for Proportionate Stratified Sampling,</span>
<a id="__codelineno-0-1766" name="__codelineno-0-1766" href="#__codelineno-0-1766"></a><span class="sd">        &quot;balanced&quot; stands for Optimum Stratified Sampling. For more details, please refer to</span>
<a id="__codelineno-0-1767" name="__codelineno-0-1767" href="#__codelineno-0-1767"></a><span class="sd">        https://docs.anovos.ai/api/data_ingest/data_sampling.html. (Default value = &quot;population&quot;)</span>
<a id="__codelineno-0-1768" name="__codelineno-0-1768" href="#__codelineno-0-1768"></a><span class="sd">    sample_size</span>
<a id="__codelineno-0-1769" name="__codelineno-0-1769" href="#__codelineno-0-1769"></a><span class="sd">        If use_sampling is True, this argument is used to determine maximum rows for training the sklearn imputer</span>
<a id="__codelineno-0-1770" name="__codelineno-0-1770" href="#__codelineno-0-1770"></a><span class="sd">        (Default value = 10000)</span>
<a id="__codelineno-0-1771" name="__codelineno-0-1771" href="#__codelineno-0-1771"></a><span class="sd">    sample_seed</span>
<a id="__codelineno-0-1772" name="__codelineno-0-1772" href="#__codelineno-0-1772"></a><span class="sd">        If use_sampling is True, this argument is used to determine the seed of sampling method.</span>
<a id="__codelineno-0-1773" name="__codelineno-0-1773" href="#__codelineno-0-1773"></a><span class="sd">        (Default value = 42)</span>
<a id="__codelineno-0-1774" name="__codelineno-0-1774" href="#__codelineno-0-1774"></a><span class="sd">    persist</span>
<a id="__codelineno-0-1775" name="__codelineno-0-1775" href="#__codelineno-0-1775"></a><span class="sd">        Boolean argument - True or False. This argument is used to determine whether to persist on</span>
<a id="__codelineno-0-1776" name="__codelineno-0-1776" href="#__codelineno-0-1776"></a><span class="sd">        binning result of source and target dataset, True will enable the use of persist, otherwise False.</span>
<a id="__codelineno-0-1777" name="__codelineno-0-1777" href="#__codelineno-0-1777"></a><span class="sd">        It is recommended to set this as True for large datasets. (Default value = True)</span>
<a id="__codelineno-0-1778" name="__codelineno-0-1778" href="#__codelineno-0-1778"></a><span class="sd">    persist_option</span>
<a id="__codelineno-0-1779" name="__codelineno-0-1779" href="#__codelineno-0-1779"></a><span class="sd">        If persist is True, this argument is used to determine the type of persist.</span>
<a id="__codelineno-0-1780" name="__codelineno-0-1780" href="#__codelineno-0-1780"></a><span class="sd">        For all the pyspark.StorageLevel option available in persist, please refer to</span>
<a id="__codelineno-0-1781" name="__codelineno-0-1781" href="#__codelineno-0-1781"></a><span class="sd">        https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.StorageLevel.html</span>
<a id="__codelineno-0-1782" name="__codelineno-0-1782" href="#__codelineno-0-1782"></a><span class="sd">        (Default value = pyspark.StorageLevel.MEMORY_AND_DISK)</span>
<a id="__codelineno-0-1783" name="__codelineno-0-1783" href="#__codelineno-0-1783"></a><span class="sd">    pre_existing_model</span>
<a id="__codelineno-0-1784" name="__codelineno-0-1784" href="#__codelineno-0-1784"></a><span class="sd">        Boolean argument – True or False. True if imputation model exists already, False otherwise. (Default value = False)</span>
<a id="__codelineno-0-1785" name="__codelineno-0-1785" href="#__codelineno-0-1785"></a><span class="sd">    model_path</span>
<a id="__codelineno-0-1786" name="__codelineno-0-1786" href="#__codelineno-0-1786"></a><span class="sd">        If pre_existing_model is True, this argument is path for referring the pre-saved model.</span>
<a id="__codelineno-0-1787" name="__codelineno-0-1787" href="#__codelineno-0-1787"></a><span class="sd">        If pre_existing_model is False, this argument can be used for saving the model.</span>
<a id="__codelineno-0-1788" name="__codelineno-0-1788" href="#__codelineno-0-1788"></a><span class="sd">        Default &quot;NA&quot; means there is neither pre-existing model nor there is a need to save one.</span>
<a id="__codelineno-0-1789" name="__codelineno-0-1789" href="#__codelineno-0-1789"></a><span class="sd">    output_mode</span>
<a id="__codelineno-0-1790" name="__codelineno-0-1790" href="#__codelineno-0-1790"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-0-1791" name="__codelineno-0-1791" href="#__codelineno-0-1791"></a><span class="sd">        “replace” option replaces original columns with transformed column. “append” option append transformed</span>
<a id="__codelineno-0-1792" name="__codelineno-0-1792" href="#__codelineno-0-1792"></a><span class="sd">        column to the input dataset with a postfix &quot;_imputed&quot; e.g. column X is appended as X_imputed. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-0-1793" name="__codelineno-0-1793" href="#__codelineno-0-1793"></a><span class="sd">    stats_missing</span>
<a id="__codelineno-0-1794" name="__codelineno-0-1794" href="#__codelineno-0-1794"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-0-1795" name="__codelineno-0-1795" href="#__codelineno-0-1795"></a><span class="sd">        to read pre-saved statistics on missing count/pct i.e. if measures_of_counts or</span>
<a id="__codelineno-0-1796" name="__codelineno-0-1796" href="#__codelineno-0-1796"></a><span class="sd">        missingCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-0-1797" name="__codelineno-0-1797" href="#__codelineno-0-1797"></a><span class="sd">    run_type</span>
<a id="__codelineno-0-1798" name="__codelineno-0-1798" href="#__codelineno-0-1798"></a><span class="sd">        &quot;local&quot;, &quot;emr&quot;, &quot;databricks&quot;, &quot;ak8s&quot; (Default value = &quot;local&quot;)</span>
<a id="__codelineno-0-1799" name="__codelineno-0-1799" href="#__codelineno-0-1799"></a><span class="sd">    auth_key</span>
<a id="__codelineno-0-1800" name="__codelineno-0-1800" href="#__codelineno-0-1800"></a><span class="sd">        Option to pass an authorization key to write to filesystems. Currently applicable only for ak8s run_type. Default value is kept as &quot;NA&quot;</span>
<a id="__codelineno-0-1801" name="__codelineno-0-1801" href="#__codelineno-0-1801"></a><span class="sd">    print_impact</span>
<a id="__codelineno-0-1802" name="__codelineno-0-1802" href="#__codelineno-0-1802"></a><span class="sd">        True, False (Default value = False)</span>
<a id="__codelineno-0-1803" name="__codelineno-0-1803" href="#__codelineno-0-1803"></a><span class="sd">        This argument is to print out before and after missing counts of imputed columns.</span>
<a id="__codelineno-0-1804" name="__codelineno-0-1804" href="#__codelineno-0-1804"></a>
<a id="__codelineno-0-1805" name="__codelineno-0-1805" href="#__codelineno-0-1805"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-1806" name="__codelineno-0-1806" href="#__codelineno-0-1806"></a><span class="sd">    -------</span>
<a id="__codelineno-0-1807" name="__codelineno-0-1807" href="#__codelineno-0-1807"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-0-1808" name="__codelineno-0-1808" href="#__codelineno-0-1808"></a><span class="sd">        Imputed Dataframe</span>
<a id="__codelineno-0-1809" name="__codelineno-0-1809" href="#__codelineno-0-1809"></a>
<a id="__codelineno-0-1810" name="__codelineno-0-1810" href="#__codelineno-0-1810"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1811" name="__codelineno-0-1811" href="#__codelineno-0-1811"></a>
<a id="__codelineno-0-1812" name="__codelineno-0-1812" href="#__codelineno-0-1812"></a>    <span class="k">if</span> <span class="n">persist</span><span class="p">:</span>
<a id="__codelineno-0-1813" name="__codelineno-0-1813" href="#__codelineno-0-1813"></a>        <span class="n">idf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">persist</span><span class="p">(</span><span class="n">persist_option</span><span class="p">)</span>
<a id="__codelineno-0-1814" name="__codelineno-0-1814" href="#__codelineno-0-1814"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1815" name="__codelineno-0-1815" href="#__codelineno-0-1815"></a>    <span class="k">if</span> <span class="n">stats_missing</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-0-1816" name="__codelineno-0-1816" href="#__codelineno-0-1816"></a>        <span class="n">missing_df</span> <span class="o">=</span> <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">)</span>
<a id="__codelineno-0-1817" name="__codelineno-0-1817" href="#__codelineno-0-1817"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1818" name="__codelineno-0-1818" href="#__codelineno-0-1818"></a>        <span class="n">missing_df</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1819" name="__codelineno-0-1819" href="#__codelineno-0-1819"></a>            <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_missing</span><span class="p">)</span>
<a id="__codelineno-0-1820" name="__codelineno-0-1820" href="#__codelineno-0-1820"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_count&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1821" name="__codelineno-0-1821" href="#__codelineno-0-1821"></a>            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">num_cols</span><span class="p">))</span>
<a id="__codelineno-0-1822" name="__codelineno-0-1822" href="#__codelineno-0-1822"></a>        <span class="p">)</span>
<a id="__codelineno-0-1823" name="__codelineno-0-1823" href="#__codelineno-0-1823"></a>    <span class="n">empty_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1824" name="__codelineno-0-1824" href="#__codelineno-0-1824"></a>        <span class="n">missing_df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-0-1825" name="__codelineno-0-1825" href="#__codelineno-0-1825"></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1826" name="__codelineno-0-1826" href="#__codelineno-0-1826"></a>        <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-1827" name="__codelineno-0-1827" href="#__codelineno-0-1827"></a>        <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-1828" name="__codelineno-0-1828" href="#__codelineno-0-1828"></a>    <span class="p">)</span>
<a id="__codelineno-0-1829" name="__codelineno-0-1829" href="#__codelineno-0-1829"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">empty_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1830" name="__codelineno-0-1830" href="#__codelineno-0-1830"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-1831" name="__codelineno-0-1831" href="#__codelineno-0-1831"></a>            <span class="s2">&quot;Following columns dropped from the imputation as all values are null: &quot;</span>
<a id="__codelineno-0-1832" name="__codelineno-0-1832" href="#__codelineno-0-1832"></a>            <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">empty_cols</span><span class="p">)</span>
<a id="__codelineno-0-1833" name="__codelineno-0-1833" href="#__codelineno-0-1833"></a>        <span class="p">)</span>
<a id="__codelineno-0-1834" name="__codelineno-0-1834" href="#__codelineno-0-1834"></a>
<a id="__codelineno-0-1835" name="__codelineno-0-1835" href="#__codelineno-0-1835"></a>    <span class="n">missing_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1836" name="__codelineno-0-1836" href="#__codelineno-0-1836"></a>        <span class="n">missing_df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1837" name="__codelineno-0-1837" href="#__codelineno-0-1837"></a>        <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">missing_threshold</span><span class="p">)</span>
<a id="__codelineno-0-1838" name="__codelineno-0-1838" href="#__codelineno-0-1838"></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1839" name="__codelineno-0-1839" href="#__codelineno-0-1839"></a>        <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-1840" name="__codelineno-0-1840" href="#__codelineno-0-1840"></a>        <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-1841" name="__codelineno-0-1841" href="#__codelineno-0-1841"></a>    <span class="p">)</span>
<a id="__codelineno-0-1842" name="__codelineno-0-1842" href="#__codelineno-0-1842"></a>
<a id="__codelineno-0-1843" name="__codelineno-0-1843" href="#__codelineno-0-1843"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1844" name="__codelineno-0-1844" href="#__codelineno-0-1844"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-0-1845" name="__codelineno-0-1845" href="#__codelineno-0-1845"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;missing&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1846" name="__codelineno-0-1846" href="#__codelineno-0-1846"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">missing_cols</span>
<a id="__codelineno-0-1847" name="__codelineno-0-1847" href="#__codelineno-0-1847"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-1848" name="__codelineno-0-1848" href="#__codelineno-0-1848"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-1849" name="__codelineno-0-1849" href="#__codelineno-0-1849"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-1850" name="__codelineno-0-1850" href="#__codelineno-0-1850"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-1851" name="__codelineno-0-1851" href="#__codelineno-0-1851"></a>
<a id="__codelineno-0-1852" name="__codelineno-0-1852" href="#__codelineno-0-1852"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
<a id="__codelineno-0-1853" name="__codelineno-0-1853" href="#__codelineno-0-1853"></a>        <span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">empty_cols</span><span class="p">)])</span>
<a id="__codelineno-0-1854" name="__codelineno-0-1854" href="#__codelineno-0-1854"></a>    <span class="p">)</span>
<a id="__codelineno-0-1855" name="__codelineno-0-1855" href="#__codelineno-0-1855"></a>
<a id="__codelineno-0-1856" name="__codelineno-0-1856" href="#__codelineno-0-1856"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1857" name="__codelineno-0-1857" href="#__codelineno-0-1857"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-1858" name="__codelineno-0-1858" href="#__codelineno-0-1858"></a>            <span class="s2">&quot;No Imputation Performed - No Column(s) or Insufficient Column(s) to Impute&quot;</span>
<a id="__codelineno-0-1859" name="__codelineno-0-1859" href="#__codelineno-0-1859"></a>        <span class="p">)</span>
<a id="__codelineno-0-1860" name="__codelineno-0-1860" href="#__codelineno-0-1860"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-0-1861" name="__codelineno-0-1861" href="#__codelineno-0-1861"></a>
<a id="__codelineno-0-1862" name="__codelineno-0-1862" href="#__codelineno-0-1862"></a>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_existing_model</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1863" name="__codelineno-0-1863" href="#__codelineno-0-1863"></a>        <span class="n">pre_existing_model</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1864" name="__codelineno-0-1864" href="#__codelineno-0-1864"></a>    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_existing_model</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1865" name="__codelineno-0-1865" href="#__codelineno-0-1865"></a>        <span class="n">pre_existing_model</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1866" name="__codelineno-0-1866" href="#__codelineno-0-1866"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1867" name="__codelineno-0-1867" href="#__codelineno-0-1867"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Non-Boolean input for pre_existing_model&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1868" name="__codelineno-0-1868" href="#__codelineno-0-1868"></a>    <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-1869" name="__codelineno-0-1869" href="#__codelineno-0-1869"></a>        <span class="p">(</span><span class="nb">len</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">missing_cols</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1870" name="__codelineno-0-1870" href="#__codelineno-0-1870"></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pre_existing_model</span><span class="p">)</span>
<a id="__codelineno-0-1871" name="__codelineno-0-1871" href="#__codelineno-0-1871"></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="n">model_path</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1872" name="__codelineno-0-1872" href="#__codelineno-0-1872"></a>    <span class="p">):</span>
<a id="__codelineno-0-1873" name="__codelineno-0-1873" href="#__codelineno-0-1873"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-1874" name="__codelineno-0-1874" href="#__codelineno-0-1874"></a>            <span class="s2">&quot;No Imputation Performed - No Column(s) to Impute and No Imputation Model to be saved&quot;</span>
<a id="__codelineno-0-1875" name="__codelineno-0-1875" href="#__codelineno-0-1875"></a>        <span class="p">)</span>
<a id="__codelineno-0-1876" name="__codelineno-0-1876" href="#__codelineno-0-1876"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-0-1877" name="__codelineno-0-1877" href="#__codelineno-0-1877"></a>
<a id="__codelineno-0-1878" name="__codelineno-0-1878" href="#__codelineno-0-1878"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-1879" name="__codelineno-0-1879" href="#__codelineno-0-1879"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1880" name="__codelineno-0-1880" href="#__codelineno-0-1880"></a>    <span class="k">if</span> <span class="n">method_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;KNN&quot;</span><span class="p">,</span> <span class="s2">&quot;regression&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1881" name="__codelineno-0-1881" href="#__codelineno-0-1881"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for method_type&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1882" name="__codelineno-0-1882" href="#__codelineno-0-1882"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1883" name="__codelineno-0-1883" href="#__codelineno-0-1883"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for output_mode&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1884" name="__codelineno-0-1884" href="#__codelineno-0-1884"></a>
<a id="__codelineno-0-1885" name="__codelineno-0-1885" href="#__codelineno-0-1885"></a>    <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-0-1886" name="__codelineno-0-1886" href="#__codelineno-0-1886"></a>        <span class="k">if</span> <span class="n">run_type</span> <span class="o">==</span> <span class="s2">&quot;emr&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1887" name="__codelineno-0-1887" href="#__codelineno-0-1887"></a>            <span class="n">bash_cmd</span> <span class="o">=</span> <span class="s2">&quot;aws s3 cp &quot;</span> <span class="o">+</span> <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/imputation_sklearn.sav .&quot;</span>
<a id="__codelineno-0-1888" name="__codelineno-0-1888" href="#__codelineno-0-1888"></a>            <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">bash_cmd</span><span class="p">])</span>
<a id="__codelineno-0-1889" name="__codelineno-0-1889" href="#__codelineno-0-1889"></a>            <span class="n">imputer</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;imputation_sklearn.sav&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1890" name="__codelineno-0-1890" href="#__codelineno-0-1890"></a>        <span class="k">elif</span> <span class="n">run_type</span> <span class="o">==</span> <span class="s2">&quot;ak8s&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1891" name="__codelineno-0-1891" href="#__codelineno-0-1891"></a>            <span class="n">bash_cmd</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1892" name="__codelineno-0-1892" href="#__codelineno-0-1892"></a>                <span class="s1">&#39;azcopy cp &quot;&#39;</span>
<a id="__codelineno-0-1893" name="__codelineno-0-1893" href="#__codelineno-0-1893"></a>                <span class="o">+</span> <span class="n">model_path</span>
<a id="__codelineno-0-1894" name="__codelineno-0-1894" href="#__codelineno-0-1894"></a>                <span class="o">+</span> <span class="s2">&quot;/imputation_sklearn.sav&quot;</span>
<a id="__codelineno-0-1895" name="__codelineno-0-1895" href="#__codelineno-0-1895"></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">auth_key</span><span class="p">)</span>
<a id="__codelineno-0-1896" name="__codelineno-0-1896" href="#__codelineno-0-1896"></a>                <span class="o">+</span> <span class="s1">&#39;&quot; .&#39;</span>
<a id="__codelineno-0-1897" name="__codelineno-0-1897" href="#__codelineno-0-1897"></a>            <span class="p">)</span>
<a id="__codelineno-0-1898" name="__codelineno-0-1898" href="#__codelineno-0-1898"></a>            <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">bash_cmd</span><span class="p">])</span>
<a id="__codelineno-0-1899" name="__codelineno-0-1899" href="#__codelineno-0-1899"></a>            <span class="n">imputer</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;imputation_sklearn.sav&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1900" name="__codelineno-0-1900" href="#__codelineno-0-1900"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1901" name="__codelineno-0-1901" href="#__codelineno-0-1901"></a>            <span class="n">imputer</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/imputation_sklearn.sav&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1902" name="__codelineno-0-1902" href="#__codelineno-0-1902"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1903" name="__codelineno-0-1903" href="#__codelineno-0-1903"></a>        <span class="k">if</span> <span class="n">use_sampling</span><span class="p">:</span>
<a id="__codelineno-0-1904" name="__codelineno-0-1904" href="#__codelineno-0-1904"></a>            <span class="n">count_idf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-0-1905" name="__codelineno-0-1905" href="#__codelineno-0-1905"></a>            <span class="k">if</span> <span class="n">count_idf</span> <span class="o">&gt;</span> <span class="n">sample_size</span><span class="p">:</span>
<a id="__codelineno-0-1906" name="__codelineno-0-1906" href="#__codelineno-0-1906"></a>                <span class="n">idf_model</span> <span class="o">=</span> <span class="n">data_sample</span><span class="p">(</span>
<a id="__codelineno-0-1907" name="__codelineno-0-1907" href="#__codelineno-0-1907"></a>                    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-1908" name="__codelineno-0-1908" href="#__codelineno-0-1908"></a>                    <span class="n">strata_cols</span><span class="o">=</span><span class="n">strata_cols</span><span class="p">,</span>
<a id="__codelineno-0-1909" name="__codelineno-0-1909" href="#__codelineno-0-1909"></a>                    <span class="n">fraction</span><span class="o">=</span><span class="n">sample_size</span> <span class="o">/</span> <span class="n">count_idf</span><span class="p">,</span>
<a id="__codelineno-0-1910" name="__codelineno-0-1910" href="#__codelineno-0-1910"></a>                    <span class="n">method_type</span><span class="o">=</span><span class="n">sample_method</span><span class="p">,</span>
<a id="__codelineno-0-1911" name="__codelineno-0-1911" href="#__codelineno-0-1911"></a>                    <span class="n">stratified_type</span><span class="o">=</span><span class="n">stratified_type</span><span class="p">,</span>
<a id="__codelineno-0-1912" name="__codelineno-0-1912" href="#__codelineno-0-1912"></a>                    <span class="n">seed_value</span><span class="o">=</span><span class="n">sample_seed</span><span class="p">,</span>
<a id="__codelineno-0-1913" name="__codelineno-0-1913" href="#__codelineno-0-1913"></a>                <span class="p">)</span>
<a id="__codelineno-0-1914" name="__codelineno-0-1914" href="#__codelineno-0-1914"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1915" name="__codelineno-0-1915" href="#__codelineno-0-1915"></a>                <span class="n">idf_model</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-1916" name="__codelineno-0-1916" href="#__codelineno-0-1916"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1917" name="__codelineno-0-1917" href="#__codelineno-0-1917"></a>            <span class="n">idf_model</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-1918" name="__codelineno-0-1918" href="#__codelineno-0-1918"></a>        <span class="k">if</span> <span class="n">persist</span><span class="p">:</span>
<a id="__codelineno-0-1919" name="__codelineno-0-1919" href="#__codelineno-0-1919"></a>            <span class="n">idf_model</span> <span class="o">=</span> <span class="n">idf_model</span><span class="o">.</span><span class="n">persist</span><span class="p">(</span><span class="n">persist_option</span><span class="p">)</span>
<a id="__codelineno-0-1920" name="__codelineno-0-1920" href="#__codelineno-0-1920"></a>        <span class="n">idf_pd</span> <span class="o">=</span> <span class="n">idf_model</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<a id="__codelineno-0-1921" name="__codelineno-0-1921" href="#__codelineno-0-1921"></a>
<a id="__codelineno-0-1922" name="__codelineno-0-1922" href="#__codelineno-0-1922"></a>        <span class="k">if</span> <span class="n">method_type</span> <span class="o">==</span> <span class="s2">&quot;KNN&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1923" name="__codelineno-0-1923" href="#__codelineno-0-1923"></a>            <span class="n">imputer</span> <span class="o">=</span> <span class="n">KNNImputer</span><span class="p">(</span>
<a id="__codelineno-0-1924" name="__codelineno-0-1924" href="#__codelineno-0-1924"></a>                <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s2">&quot;uniform&quot;</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;nan_euclidean&quot;</span>
<a id="__codelineno-0-1925" name="__codelineno-0-1925" href="#__codelineno-0-1925"></a>            <span class="p">)</span>
<a id="__codelineno-0-1926" name="__codelineno-0-1926" href="#__codelineno-0-1926"></a>        <span class="k">if</span> <span class="n">method_type</span> <span class="o">==</span> <span class="s2">&quot;regression&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1927" name="__codelineno-0-1927" href="#__codelineno-0-1927"></a>            <span class="n">imputer</span> <span class="o">=</span> <span class="n">IterativeImputer</span><span class="p">()</span>
<a id="__codelineno-0-1928" name="__codelineno-0-1928" href="#__codelineno-0-1928"></a>        <span class="n">imputer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">idf_pd</span><span class="p">)</span>
<a id="__codelineno-0-1929" name="__codelineno-0-1929" href="#__codelineno-0-1929"></a>
<a id="__codelineno-0-1930" name="__codelineno-0-1930" href="#__codelineno-0-1930"></a>        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pre_existing_model</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1931" name="__codelineno-0-1931" href="#__codelineno-0-1931"></a>            <span class="k">if</span> <span class="n">run_type</span> <span class="o">==</span> <span class="s2">&quot;emr&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1932" name="__codelineno-0-1932" href="#__codelineno-0-1932"></a>                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">imputer</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;imputation_sklearn.sav&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1933" name="__codelineno-0-1933" href="#__codelineno-0-1933"></a>                <span class="n">bash_cmd</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1934" name="__codelineno-0-1934" href="#__codelineno-0-1934"></a>                    <span class="s2">&quot;aws s3 cp imputation_sklearn.sav &quot;</span>
<a id="__codelineno-0-1935" name="__codelineno-0-1935" href="#__codelineno-0-1935"></a>                    <span class="o">+</span> <span class="n">model_path</span>
<a id="__codelineno-0-1936" name="__codelineno-0-1936" href="#__codelineno-0-1936"></a>                    <span class="o">+</span> <span class="s2">&quot;/imputation_sklearn.sav&quot;</span>
<a id="__codelineno-0-1937" name="__codelineno-0-1937" href="#__codelineno-0-1937"></a>                <span class="p">)</span>
<a id="__codelineno-0-1938" name="__codelineno-0-1938" href="#__codelineno-0-1938"></a>                <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">bash_cmd</span><span class="p">])</span>
<a id="__codelineno-0-1939" name="__codelineno-0-1939" href="#__codelineno-0-1939"></a>                <span class="n">imputer</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;imputation_sklearn.sav&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1940" name="__codelineno-0-1940" href="#__codelineno-0-1940"></a>            <span class="k">elif</span> <span class="n">run_type</span> <span class="o">==</span> <span class="s2">&quot;ak8s&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1941" name="__codelineno-0-1941" href="#__codelineno-0-1941"></a>                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">imputer</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;imputation_sklearn.sav&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1942" name="__codelineno-0-1942" href="#__codelineno-0-1942"></a>                <span class="n">bash_cmd</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1943" name="__codelineno-0-1943" href="#__codelineno-0-1943"></a>                    <span class="s1">&#39;azcopy cp &quot;imputation_sklearn.sav&quot; &quot;&#39;</span>
<a id="__codelineno-0-1944" name="__codelineno-0-1944" href="#__codelineno-0-1944"></a>                    <span class="o">+</span> <span class="n">ends_with</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
<a id="__codelineno-0-1945" name="__codelineno-0-1945" href="#__codelineno-0-1945"></a>                    <span class="o">+</span> <span class="s2">&quot;imputation_sklearn.sav&quot;</span>
<a id="__codelineno-0-1946" name="__codelineno-0-1946" href="#__codelineno-0-1946"></a>                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">auth_key</span><span class="p">)</span>
<a id="__codelineno-0-1947" name="__codelineno-0-1947" href="#__codelineno-0-1947"></a>                    <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
<a id="__codelineno-0-1948" name="__codelineno-0-1948" href="#__codelineno-0-1948"></a>                <span class="p">)</span>
<a id="__codelineno-0-1949" name="__codelineno-0-1949" href="#__codelineno-0-1949"></a>                <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">bash_cmd</span><span class="p">])</span>
<a id="__codelineno-0-1950" name="__codelineno-0-1950" href="#__codelineno-0-1950"></a>                <span class="n">imputer</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;imputation_sklearn.sav&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1951" name="__codelineno-0-1951" href="#__codelineno-0-1951"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1952" name="__codelineno-0-1952" href="#__codelineno-0-1952"></a>                <span class="n">local_path</span> <span class="o">=</span> <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/imputation_sklearn.sav&quot;</span>
<a id="__codelineno-0-1953" name="__codelineno-0-1953" href="#__codelineno-0-1953"></a>                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">local_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1954" name="__codelineno-0-1954" href="#__codelineno-0-1954"></a>                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">imputer</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1955" name="__codelineno-0-1955" href="#__codelineno-0-1955"></a>                <span class="n">imputer</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
<a id="__codelineno-0-1956" name="__codelineno-0-1956" href="#__codelineno-0-1956"></a>                    <span class="nb">open</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/imputation_sklearn.sav&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1957" name="__codelineno-0-1957" href="#__codelineno-0-1957"></a>                <span class="p">)</span>
<a id="__codelineno-0-1958" name="__codelineno-0-1958" href="#__codelineno-0-1958"></a>
<a id="__codelineno-0-1959" name="__codelineno-0-1959" href="#__codelineno-0-1959"></a>    <span class="nd">@F</span><span class="o">.</span><span class="n">pandas_udf</span><span class="p">(</span><span class="n">returnType</span><span class="o">=</span><span class="n">T</span><span class="o">.</span><span class="n">ArrayType</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">DoubleType</span><span class="p">()))</span>
<a id="__codelineno-0-1960" name="__codelineno-0-1960" href="#__codelineno-0-1960"></a>    <span class="k">def</span> <span class="nf">prediction</span><span class="p">(</span><span class="o">*</span><span class="n">cols</span><span class="p">):</span>
<a id="__codelineno-0-1961" name="__codelineno-0-1961" href="#__codelineno-0-1961"></a>        <span class="n">input_pdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1962" name="__codelineno-0-1962" href="#__codelineno-0-1962"></a>        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">imputer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">input_pdf</span><span class="p">))</span>
<a id="__codelineno-0-1963" name="__codelineno-0-1963" href="#__codelineno-0-1963"></a>
<a id="__codelineno-0-1964" name="__codelineno-0-1964" href="#__codelineno-0-1964"></a>    <span class="n">result_df</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">prediction</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-0-1965" name="__codelineno-0-1965" href="#__codelineno-0-1965"></a>    <span class="k">if</span> <span class="n">persist</span><span class="p">:</span>
<a id="__codelineno-0-1966" name="__codelineno-0-1966" href="#__codelineno-0-1966"></a>        <span class="n">result_df</span> <span class="o">=</span> <span class="n">result_df</span><span class="o">.</span><span class="n">persist</span><span class="p">(</span><span class="n">persist_option</span><span class="p">)</span>
<a id="__codelineno-0-1967" name="__codelineno-0-1967" href="#__codelineno-0-1967"></a>
<a id="__codelineno-0-1968" name="__codelineno-0-1968" href="#__codelineno-0-1968"></a>    <span class="n">odf_schema</span> <span class="o">=</span> <span class="n">result_df</span><span class="o">.</span><span class="n">schema</span>
<a id="__codelineno-0-1969" name="__codelineno-0-1969" href="#__codelineno-0-1969"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-1970" name="__codelineno-0-1970" href="#__codelineno-0-1970"></a>        <span class="n">odf_schema</span> <span class="o">=</span> <span class="n">odf_schema</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">FloatType</span><span class="p">()))</span>
<a id="__codelineno-0-1971" name="__codelineno-0-1971" href="#__codelineno-0-1971"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1972" name="__codelineno-0-1972" href="#__codelineno-0-1972"></a>        <span class="n">result_df</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-1973" name="__codelineno-0-1973" href="#__codelineno-0-1973"></a>        <span class="o">.</span><span class="n">toDF</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">odf_schema</span><span class="p">)</span>
<a id="__codelineno-0-1974" name="__codelineno-0-1974" href="#__codelineno-0-1974"></a>        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1975" name="__codelineno-0-1975" href="#__codelineno-0-1975"></a>    <span class="p">)</span>
<a id="__codelineno-0-1976" name="__codelineno-0-1976" href="#__codelineno-0-1976"></a>
<a id="__codelineno-0-1977" name="__codelineno-0-1977" href="#__codelineno-0-1977"></a>    <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1978" name="__codelineno-0-1978" href="#__codelineno-0-1978"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-1979" name="__codelineno-0-1979" href="#__codelineno-0-1979"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;append&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1980" name="__codelineno-0-1980" href="#__codelineno-0-1980"></a>            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">missing_cols</span><span class="p">:</span>
<a id="__codelineno-0-1981" name="__codelineno-0-1981" href="#__codelineno-0-1981"></a>                <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1982" name="__codelineno-0-1982" href="#__codelineno-0-1982"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1983" name="__codelineno-0-1983" href="#__codelineno-0-1983"></a>                <span class="n">output_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1984" name="__codelineno-0-1984" href="#__codelineno-0-1984"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1985" name="__codelineno-0-1985" href="#__codelineno-0-1985"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-1986" name="__codelineno-0-1986" href="#__codelineno-0-1986"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">idf</span><span class="o">.</span><span class="n">columns</span> <span class="o">+</span> <span class="n">output_cols</span><span class="p">)</span>
<a id="__codelineno-0-1987" name="__codelineno-0-1987" href="#__codelineno-0-1987"></a>
<a id="__codelineno-0-1988" name="__codelineno-0-1988" href="#__codelineno-0-1988"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-1989" name="__codelineno-0-1989" href="#__codelineno-0-1989"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1990" name="__codelineno-0-1990" href="#__codelineno-0-1990"></a>            <span class="n">odf_print</span> <span class="o">=</span> <span class="n">missing_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-0-1991" name="__codelineno-0-1991" href="#__codelineno-0-1991"></a>                <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;missingCount_before&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1992" name="__codelineno-0-1992" href="#__codelineno-0-1992"></a>            <span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1993" name="__codelineno-0-1993" href="#__codelineno-0-1993"></a>                <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">odf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-0-1994" name="__codelineno-0-1994" href="#__codelineno-0-1994"></a>                    <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;missingCount_after&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1995" name="__codelineno-0-1995" href="#__codelineno-0-1995"></a>                <span class="p">),</span>
<a id="__codelineno-0-1996" name="__codelineno-0-1996" href="#__codelineno-0-1996"></a>                <span class="s2">&quot;attribute&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1997" name="__codelineno-0-1997" href="#__codelineno-0-1997"></a>                <span class="s2">&quot;inner&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1998" name="__codelineno-0-1998" href="#__codelineno-0-1998"></a>            <span class="p">)</span>
<a id="__codelineno-0-1999" name="__codelineno-0-1999" href="#__codelineno-0-1999"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2000" name="__codelineno-0-2000" href="#__codelineno-0-2000"></a>            <span class="n">odf_print</span> <span class="o">=</span> <span class="n">missing_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-0-2001" name="__codelineno-0-2001" href="#__codelineno-0-2001"></a>                <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;missingCount_before&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2002" name="__codelineno-0-2002" href="#__codelineno-0-2002"></a>            <span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-2003" name="__codelineno-0-2003" href="#__codelineno-0-2003"></a>                <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">odf</span><span class="p">,</span> <span class="n">output_cols</span><span class="p">)</span>
<a id="__codelineno-0-2004" name="__codelineno-0-2004" href="#__codelineno-0-2004"></a>                <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;attribute_after&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2005" name="__codelineno-0-2005" href="#__codelineno-0-2005"></a>                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-2006" name="__codelineno-0-2006" href="#__codelineno-0-2006"></a>                    <span class="s2">&quot;attribute&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2007" name="__codelineno-0-2007" href="#__codelineno-0-2007"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">expr</span><span class="p">(</span><span class="s2">&quot;substring(attribute_after, 1, length(attribute_after)-8)&quot;</span><span class="p">),</span>
<a id="__codelineno-0-2008" name="__codelineno-0-2008" href="#__codelineno-0-2008"></a>                <span class="p">)</span>
<a id="__codelineno-0-2009" name="__codelineno-0-2009" href="#__codelineno-0-2009"></a>                <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">),</span>
<a id="__codelineno-0-2010" name="__codelineno-0-2010" href="#__codelineno-0-2010"></a>                <span class="s2">&quot;attribute&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2011" name="__codelineno-0-2011" href="#__codelineno-0-2011"></a>                <span class="s2">&quot;inner&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2012" name="__codelineno-0-2012" href="#__codelineno-0-2012"></a>            <span class="p">)</span>
<a id="__codelineno-0-2013" name="__codelineno-0-2013" href="#__codelineno-0-2013"></a>        <span class="n">odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">),</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-2014" name="__codelineno-0-2014" href="#__codelineno-0-2014"></a>    <span class="k">if</span> <span class="n">persist</span><span class="p">:</span>
<a id="__codelineno-0-2015" name="__codelineno-0-2015" href="#__codelineno-0-2015"></a>        <span class="n">idf</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
<a id="__codelineno-0-2016" name="__codelineno-0-2016" href="#__codelineno-0-2016"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-0-2017" name="__codelineno-0-2017" href="#__codelineno-0-2017"></a>            <span class="n">idf_model</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
<a id="__codelineno-0-2018" name="__codelineno-0-2018" href="#__codelineno-0-2018"></a>        <span class="n">result_df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
<a id="__codelineno-0-2019" name="__codelineno-0-2019" href="#__codelineno-0-2019"></a>    <span class="k">return</span> <span class="n">odf</span>
<a id="__codelineno-0-2020" name="__codelineno-0-2020" href="#__codelineno-0-2020"></a>
<a id="__codelineno-0-2021" name="__codelineno-0-2021" href="#__codelineno-0-2021"></a>
<a id="__codelineno-0-2022" name="__codelineno-0-2022" href="#__codelineno-0-2022"></a><span class="k">def</span> <span class="nf">imputation_matrixFactorization</span><span class="p">(</span>
<a id="__codelineno-0-2023" name="__codelineno-0-2023" href="#__codelineno-0-2023"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-2024" name="__codelineno-0-2024" href="#__codelineno-0-2024"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-2025" name="__codelineno-0-2025" href="#__codelineno-0-2025"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2026" name="__codelineno-0-2026" href="#__codelineno-0-2026"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-2027" name="__codelineno-0-2027" href="#__codelineno-0-2027"></a>    <span class="n">id_col</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2028" name="__codelineno-0-2028" href="#__codelineno-0-2028"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2029" name="__codelineno-0-2029" href="#__codelineno-0-2029"></a>    <span class="n">stats_missing</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-0-2030" name="__codelineno-0-2030" href="#__codelineno-0-2030"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2031" name="__codelineno-0-2031" href="#__codelineno-0-2031"></a><span class="p">):</span>
<a id="__codelineno-0-2032" name="__codelineno-0-2032" href="#__codelineno-0-2032"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2033" name="__codelineno-0-2033" href="#__codelineno-0-2033"></a><span class="sd">    imputation_matrixFactorization uses collaborative filtering technique to impute missing values. Collaborative</span>
<a id="__codelineno-0-2034" name="__codelineno-0-2034" href="#__codelineno-0-2034"></a><span class="sd">    filtering is commonly used in recommender systems to fill the missing user-item entries and PySpark provides an</span>
<a id="__codelineno-0-2035" name="__codelineno-0-2035" href="#__codelineno-0-2035"></a><span class="sd">    implementation using alternating least squares (ALS) algorithm, which is used in this function. To fit our</span>
<a id="__codelineno-0-2036" name="__codelineno-0-2036" href="#__codelineno-0-2036"></a><span class="sd">    problem into the ALS model, each attribute is treated as an item and an id column needs to be specified by the</span>
<a id="__codelineno-0-2037" name="__codelineno-0-2037" href="#__codelineno-0-2037"></a><span class="sd">    user to generate the user-item pairs. In the case, ID column doesn&#39;t exist in the dataset and proxu ID column is</span>
<a id="__codelineno-0-2038" name="__codelineno-0-2038" href="#__codelineno-0-2038"></a><span class="sd">    implicitly generated by the function. Subsequently, all user-item pairs with known values will be used to train</span>
<a id="__codelineno-0-2039" name="__codelineno-0-2039" href="#__codelineno-0-2039"></a><span class="sd">    the ALS model and the trained model can be used to predict the user-item pairs with missing values.</span>
<a id="__codelineno-0-2040" name="__codelineno-0-2040" href="#__codelineno-0-2040"></a>
<a id="__codelineno-0-2041" name="__codelineno-0-2041" href="#__codelineno-0-2041"></a>
<a id="__codelineno-0-2042" name="__codelineno-0-2042" href="#__codelineno-0-2042"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-2043" name="__codelineno-0-2043" href="#__codelineno-0-2043"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-2044" name="__codelineno-0-2044" href="#__codelineno-0-2044"></a><span class="sd">    spark</span>
<a id="__codelineno-0-2045" name="__codelineno-0-2045" href="#__codelineno-0-2045"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-0-2046" name="__codelineno-0-2046" href="#__codelineno-0-2046"></a><span class="sd">    idf</span>
<a id="__codelineno-0-2047" name="__codelineno-0-2047" href="#__codelineno-0-2047"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-2048" name="__codelineno-0-2048" href="#__codelineno-0-2048"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-0-2049" name="__codelineno-0-2049" href="#__codelineno-0-2049"></a><span class="sd">        List of columns to impute e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-2050" name="__codelineno-0-2050" href="#__codelineno-0-2050"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-2051" name="__codelineno-0-2051" href="#__codelineno-0-2051"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-2052" name="__codelineno-0-2052" href="#__codelineno-0-2052"></a><span class="sd">        &quot;all&quot; can be passed to include all (non-array) columns for analysis.</span>
<a id="__codelineno-0-2053" name="__codelineno-0-2053" href="#__codelineno-0-2053"></a><span class="sd">        This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-0-2054" name="__codelineno-0-2054" href="#__codelineno-0-2054"></a><span class="sd">        &quot;missing&quot; (default) can be passed to include only those columns with missing values.</span>
<a id="__codelineno-0-2055" name="__codelineno-0-2055" href="#__codelineno-0-2055"></a><span class="sd">        One of the usecases where &quot;all&quot; may be preferable over &quot;missing&quot; is when the user wants to save</span>
<a id="__codelineno-0-2056" name="__codelineno-0-2056" href="#__codelineno-0-2056"></a><span class="sd">        the imputation model for the future use e.g. a column may not have missing value in the training</span>
<a id="__codelineno-0-2057" name="__codelineno-0-2057" href="#__codelineno-0-2057"></a><span class="sd">        dataset but missing values may possibly appear in the prediction dataset.</span>
<a id="__codelineno-0-2058" name="__codelineno-0-2058" href="#__codelineno-0-2058"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-0-2059" name="__codelineno-0-2059" href="#__codelineno-0-2059"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols.</span>
<a id="__codelineno-0-2060" name="__codelineno-0-2060" href="#__codelineno-0-2060"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-0-2061" name="__codelineno-0-2061" href="#__codelineno-0-2061"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-2062" name="__codelineno-0-2062" href="#__codelineno-0-2062"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-2063" name="__codelineno-0-2063" href="#__codelineno-0-2063"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-2064" name="__codelineno-0-2064" href="#__codelineno-0-2064"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-0-2065" name="__codelineno-0-2065" href="#__codelineno-0-2065"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-0-2066" name="__codelineno-0-2066" href="#__codelineno-0-2066"></a><span class="sd">    id_col</span>
<a id="__codelineno-0-2067" name="__codelineno-0-2067" href="#__codelineno-0-2067"></a><span class="sd">        ID column (Default value = &quot;&quot;)</span>
<a id="__codelineno-0-2068" name="__codelineno-0-2068" href="#__codelineno-0-2068"></a><span class="sd">    output_mode</span>
<a id="__codelineno-0-2069" name="__codelineno-0-2069" href="#__codelineno-0-2069"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-0-2070" name="__codelineno-0-2070" href="#__codelineno-0-2070"></a><span class="sd">        “replace” option replaces original columns with transformed column. “append” option append transformed</span>
<a id="__codelineno-0-2071" name="__codelineno-0-2071" href="#__codelineno-0-2071"></a><span class="sd">        column to the input dataset with a postfix &quot;_imputed&quot; e.g. column X is appended as X_imputed. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-0-2072" name="__codelineno-0-2072" href="#__codelineno-0-2072"></a><span class="sd">    stats_missing</span>
<a id="__codelineno-0-2073" name="__codelineno-0-2073" href="#__codelineno-0-2073"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-0-2074" name="__codelineno-0-2074" href="#__codelineno-0-2074"></a><span class="sd">        to read pre-saved statistics on missing count/pct i.e. if measures_of_counts or</span>
<a id="__codelineno-0-2075" name="__codelineno-0-2075" href="#__codelineno-0-2075"></a><span class="sd">        missingCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-0-2076" name="__codelineno-0-2076" href="#__codelineno-0-2076"></a><span class="sd">    print_impact</span>
<a id="__codelineno-0-2077" name="__codelineno-0-2077" href="#__codelineno-0-2077"></a><span class="sd">        True, False (Default value = False)</span>
<a id="__codelineno-0-2078" name="__codelineno-0-2078" href="#__codelineno-0-2078"></a><span class="sd">        This argument is to print out before and after missing counts of imputed columns.</span>
<a id="__codelineno-0-2079" name="__codelineno-0-2079" href="#__codelineno-0-2079"></a>
<a id="__codelineno-0-2080" name="__codelineno-0-2080" href="#__codelineno-0-2080"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-2081" name="__codelineno-0-2081" href="#__codelineno-0-2081"></a><span class="sd">    -------</span>
<a id="__codelineno-0-2082" name="__codelineno-0-2082" href="#__codelineno-0-2082"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-0-2083" name="__codelineno-0-2083" href="#__codelineno-0-2083"></a><span class="sd">        Imputed Dataframe</span>
<a id="__codelineno-0-2084" name="__codelineno-0-2084" href="#__codelineno-0-2084"></a>
<a id="__codelineno-0-2085" name="__codelineno-0-2085" href="#__codelineno-0-2085"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-2086" name="__codelineno-0-2086" href="#__codelineno-0-2086"></a>
<a id="__codelineno-0-2087" name="__codelineno-0-2087" href="#__codelineno-0-2087"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-2088" name="__codelineno-0-2088" href="#__codelineno-0-2088"></a>    <span class="k">if</span> <span class="n">stats_missing</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-0-2089" name="__codelineno-0-2089" href="#__codelineno-0-2089"></a>        <span class="n">missing_df</span> <span class="o">=</span> <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">)</span>
<a id="__codelineno-0-2090" name="__codelineno-0-2090" href="#__codelineno-0-2090"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2091" name="__codelineno-0-2091" href="#__codelineno-0-2091"></a>        <span class="n">missing_df</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2092" name="__codelineno-0-2092" href="#__codelineno-0-2092"></a>            <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_missing</span><span class="p">)</span>
<a id="__codelineno-0-2093" name="__codelineno-0-2093" href="#__codelineno-0-2093"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_count&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2094" name="__codelineno-0-2094" href="#__codelineno-0-2094"></a>            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">num_cols</span><span class="p">))</span>
<a id="__codelineno-0-2095" name="__codelineno-0-2095" href="#__codelineno-0-2095"></a>        <span class="p">)</span>
<a id="__codelineno-0-2096" name="__codelineno-0-2096" href="#__codelineno-0-2096"></a>
<a id="__codelineno-0-2097" name="__codelineno-0-2097" href="#__codelineno-0-2097"></a>    <span class="n">empty_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2098" name="__codelineno-0-2098" href="#__codelineno-0-2098"></a>        <span class="n">missing_df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-0-2099" name="__codelineno-0-2099" href="#__codelineno-0-2099"></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2100" name="__codelineno-0-2100" href="#__codelineno-0-2100"></a>        <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-2101" name="__codelineno-0-2101" href="#__codelineno-0-2101"></a>        <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-2102" name="__codelineno-0-2102" href="#__codelineno-0-2102"></a>    <span class="p">)</span>
<a id="__codelineno-0-2103" name="__codelineno-0-2103" href="#__codelineno-0-2103"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">empty_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-2104" name="__codelineno-0-2104" href="#__codelineno-0-2104"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-2105" name="__codelineno-0-2105" href="#__codelineno-0-2105"></a>            <span class="s2">&quot;Following columns dropped from the imputation as all values are null: &quot;</span>
<a id="__codelineno-0-2106" name="__codelineno-0-2106" href="#__codelineno-0-2106"></a>            <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">empty_cols</span><span class="p">)</span>
<a id="__codelineno-0-2107" name="__codelineno-0-2107" href="#__codelineno-0-2107"></a>        <span class="p">)</span>
<a id="__codelineno-0-2108" name="__codelineno-0-2108" href="#__codelineno-0-2108"></a>
<a id="__codelineno-0-2109" name="__codelineno-0-2109" href="#__codelineno-0-2109"></a>    <span class="n">missing_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2110" name="__codelineno-0-2110" href="#__codelineno-0-2110"></a>        <span class="n">missing_df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-2111" name="__codelineno-0-2111" href="#__codelineno-0-2111"></a>        <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-0-2112" name="__codelineno-0-2112" href="#__codelineno-0-2112"></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2113" name="__codelineno-0-2113" href="#__codelineno-0-2113"></a>        <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-2114" name="__codelineno-0-2114" href="#__codelineno-0-2114"></a>        <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-2115" name="__codelineno-0-2115" href="#__codelineno-0-2115"></a>    <span class="p">)</span>
<a id="__codelineno-0-2116" name="__codelineno-0-2116" href="#__codelineno-0-2116"></a>
<a id="__codelineno-0-2117" name="__codelineno-0-2117" href="#__codelineno-0-2117"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2118" name="__codelineno-0-2118" href="#__codelineno-0-2118"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-0-2119" name="__codelineno-0-2119" href="#__codelineno-0-2119"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;missing&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2120" name="__codelineno-0-2120" href="#__codelineno-0-2120"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">missing_cols</span>
<a id="__codelineno-0-2121" name="__codelineno-0-2121" href="#__codelineno-0-2121"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-2122" name="__codelineno-0-2122" href="#__codelineno-0-2122"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-2123" name="__codelineno-0-2123" href="#__codelineno-0-2123"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-2124" name="__codelineno-0-2124" href="#__codelineno-0-2124"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-2125" name="__codelineno-0-2125" href="#__codelineno-0-2125"></a>
<a id="__codelineno-0-2126" name="__codelineno-0-2126" href="#__codelineno-0-2126"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
<a id="__codelineno-0-2127" name="__codelineno-0-2127" href="#__codelineno-0-2127"></a>        <span class="nb">set</span><span class="p">(</span>
<a id="__codelineno-0-2128" name="__codelineno-0-2128" href="#__codelineno-0-2128"></a>            <span class="p">[</span>
<a id="__codelineno-0-2129" name="__codelineno-0-2129" href="#__codelineno-0-2129"></a>                <span class="n">e</span>
<a id="__codelineno-0-2130" name="__codelineno-0-2130" href="#__codelineno-0-2130"></a>                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span>
<a id="__codelineno-0-2131" name="__codelineno-0-2131" href="#__codelineno-0-2131"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">e</span> <span class="o">!=</span> <span class="n">id_col</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">empty_cols</span><span class="p">)</span>
<a id="__codelineno-0-2132" name="__codelineno-0-2132" href="#__codelineno-0-2132"></a>            <span class="p">]</span>
<a id="__codelineno-0-2133" name="__codelineno-0-2133" href="#__codelineno-0-2133"></a>        <span class="p">)</span>
<a id="__codelineno-0-2134" name="__codelineno-0-2134" href="#__codelineno-0-2134"></a>    <span class="p">)</span>
<a id="__codelineno-0-2135" name="__codelineno-0-2135" href="#__codelineno-0-2135"></a>
<a id="__codelineno-0-2136" name="__codelineno-0-2136" href="#__codelineno-0-2136"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span>
<a id="__codelineno-0-2137" name="__codelineno-0-2137" href="#__codelineno-0-2137"></a>        <span class="nb">len</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">missing_cols</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
<a id="__codelineno-0-2138" name="__codelineno-0-2138" href="#__codelineno-0-2138"></a>    <span class="p">):</span>
<a id="__codelineno-0-2139" name="__codelineno-0-2139" href="#__codelineno-0-2139"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No Imputation Performed - No Column(s) to Impute&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2140" name="__codelineno-0-2140" href="#__codelineno-0-2140"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-0-2141" name="__codelineno-0-2141" href="#__codelineno-0-2141"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-2142" name="__codelineno-0-2142" href="#__codelineno-0-2142"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-2143" name="__codelineno-0-2143" href="#__codelineno-0-2143"></a>            <span class="s2">&quot;No Imputation Performed - Needs more than 1 column for matrix factorization&quot;</span>
<a id="__codelineno-0-2144" name="__codelineno-0-2144" href="#__codelineno-0-2144"></a>        <span class="p">)</span>
<a id="__codelineno-0-2145" name="__codelineno-0-2145" href="#__codelineno-0-2145"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-0-2146" name="__codelineno-0-2146" href="#__codelineno-0-2146"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-2147" name="__codelineno-0-2147" href="#__codelineno-0-2147"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2148" name="__codelineno-0-2148" href="#__codelineno-0-2148"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">):</span>
<a id="__codelineno-0-2149" name="__codelineno-0-2149" href="#__codelineno-0-2149"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for output_mode&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2150" name="__codelineno-0-2150" href="#__codelineno-0-2150"></a>
<a id="__codelineno-0-2151" name="__codelineno-0-2151" href="#__codelineno-0-2151"></a>    <span class="n">remove_id</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-2152" name="__codelineno-0-2152" href="#__codelineno-0-2152"></a>    <span class="k">if</span> <span class="n">id_col</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2153" name="__codelineno-0-2153" href="#__codelineno-0-2153"></a>        <span class="n">idf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">monotonically_increasing_id</span><span class="p">())</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-2154" name="__codelineno-0-2154" href="#__codelineno-0-2154"></a>            <span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">row_number</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">Window</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">))</span>
<a id="__codelineno-0-2155" name="__codelineno-0-2155" href="#__codelineno-0-2155"></a>        <span class="p">)</span>
<a id="__codelineno-0-2156" name="__codelineno-0-2156" href="#__codelineno-0-2156"></a>        <span class="n">id_col</span> <span class="o">=</span> <span class="s2">&quot;id&quot;</span>
<a id="__codelineno-0-2157" name="__codelineno-0-2157" href="#__codelineno-0-2157"></a>        <span class="n">remove_id</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-2158" name="__codelineno-0-2158" href="#__codelineno-0-2158"></a>
<a id="__codelineno-0-2159" name="__codelineno-0-2159" href="#__codelineno-0-2159"></a>    <span class="n">key_and_val</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">create_map</span><span class="p">(</span>
<a id="__codelineno-0-2160" name="__codelineno-0-2160" href="#__codelineno-0-2160"></a>        <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">([[</span><span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">]))</span>
<a id="__codelineno-0-2161" name="__codelineno-0-2161" href="#__codelineno-0-2161"></a>    <span class="p">)</span>
<a id="__codelineno-0-2162" name="__codelineno-0-2162" href="#__codelineno-0-2162"></a>    <span class="n">df_flatten</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">id_col</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="n">key_and_val</span><span class="p">))</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-2163" name="__codelineno-0-2163" href="#__codelineno-0-2163"></a>        <span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&quot;_imputed&quot;</span><span class="p">))</span>
<a id="__codelineno-0-2164" name="__codelineno-0-2164" href="#__codelineno-0-2164"></a>    <span class="p">)</span>
<a id="__codelineno-0-2165" name="__codelineno-0-2165" href="#__codelineno-0-2165"></a>
<a id="__codelineno-0-2166" name="__codelineno-0-2166" href="#__codelineno-0-2166"></a>    <span class="n">id_type</span> <span class="o">=</span> <span class="n">get_dtype</span><span class="p">(</span><span class="n">idf</span><span class="p">,</span> <span class="n">id_col</span><span class="p">)</span>
<a id="__codelineno-0-2167" name="__codelineno-0-2167" href="#__codelineno-0-2167"></a>    <span class="k">if</span> <span class="n">id_type</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2168" name="__codelineno-0-2168" href="#__codelineno-0-2168"></a>        <span class="n">id_indexer</span> <span class="o">=</span> <span class="n">StringIndexer</span><span class="p">()</span><span class="o">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="n">id_col</span><span class="p">)</span><span class="o">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s2">&quot;IDLabel&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2169" name="__codelineno-0-2169" href="#__codelineno-0-2169"></a>        <span class="n">id_indexer_model</span> <span class="o">=</span> <span class="n">id_indexer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df_flatten</span><span class="p">)</span>
<a id="__codelineno-0-2170" name="__codelineno-0-2170" href="#__codelineno-0-2170"></a>        <span class="n">df_flatten</span> <span class="o">=</span> <span class="n">id_indexer_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df_flatten</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">id_col</span><span class="p">)</span>
<a id="__codelineno-0-2171" name="__codelineno-0-2171" href="#__codelineno-0-2171"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2172" name="__codelineno-0-2172" href="#__codelineno-0-2172"></a>        <span class="n">df_flatten</span> <span class="o">=</span> <span class="n">df_flatten</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">id_col</span><span class="p">,</span> <span class="s2">&quot;IDLabel&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2173" name="__codelineno-0-2173" href="#__codelineno-0-2173"></a>
<a id="__codelineno-0-2174" name="__codelineno-0-2174" href="#__codelineno-0-2174"></a>    <span class="n">indexer</span> <span class="o">=</span> <span class="n">StringIndexer</span><span class="p">()</span><span class="o">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s2">&quot;keyLabel&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2175" name="__codelineno-0-2175" href="#__codelineno-0-2175"></a>    <span class="n">indexer_model</span> <span class="o">=</span> <span class="n">indexer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df_flatten</span><span class="p">)</span>
<a id="__codelineno-0-2176" name="__codelineno-0-2176" href="#__codelineno-0-2176"></a>    <span class="n">df_encoded</span> <span class="o">=</span> <span class="n">indexer_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df_flatten</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2177" name="__codelineno-0-2177" href="#__codelineno-0-2177"></a>    <span class="n">df_model</span> <span class="o">=</span> <span class="n">df_encoded</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">())</span>
<a id="__codelineno-0-2178" name="__codelineno-0-2178" href="#__codelineno-0-2178"></a>    <span class="n">df_test</span> <span class="o">=</span> <span class="n">df_encoded</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">())</span>
<a id="__codelineno-0-2179" name="__codelineno-0-2179" href="#__codelineno-0-2179"></a>    <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-2180" name="__codelineno-0-2180" href="#__codelineno-0-2180"></a>        <span class="n">df_model</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;IDLabel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-0-2181" name="__codelineno-0-2181" href="#__codelineno-0-2181"></a>        <span class="o">&lt;</span> <span class="n">df_encoded</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;IDLabel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-0-2182" name="__codelineno-0-2182" href="#__codelineno-0-2182"></a>    <span class="p">):</span>
<a id="__codelineno-0-2183" name="__codelineno-0-2183" href="#__codelineno-0-2183"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-2184" name="__codelineno-0-2184" href="#__codelineno-0-2184"></a>            <span class="s2">&quot;The returned odf may not be fully imputed because values for all list_of_cols are null for some IDs&quot;</span>
<a id="__codelineno-0-2185" name="__codelineno-0-2185" href="#__codelineno-0-2185"></a>        <span class="p">)</span>
<a id="__codelineno-0-2186" name="__codelineno-0-2186" href="#__codelineno-0-2186"></a>    <span class="n">als</span> <span class="o">=</span> <span class="n">ALS</span><span class="p">(</span>
<a id="__codelineno-0-2187" name="__codelineno-0-2187" href="#__codelineno-0-2187"></a>        <span class="n">maxIter</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<a id="__codelineno-0-2188" name="__codelineno-0-2188" href="#__codelineno-0-2188"></a>        <span class="n">regParam</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
<a id="__codelineno-0-2189" name="__codelineno-0-2189" href="#__codelineno-0-2189"></a>        <span class="n">userCol</span><span class="o">=</span><span class="s2">&quot;IDLabel&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2190" name="__codelineno-0-2190" href="#__codelineno-0-2190"></a>        <span class="n">itemCol</span><span class="o">=</span><span class="s2">&quot;keyLabel&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2191" name="__codelineno-0-2191" href="#__codelineno-0-2191"></a>        <span class="n">ratingCol</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2192" name="__codelineno-0-2192" href="#__codelineno-0-2192"></a>        <span class="n">coldStartStrategy</span><span class="o">=</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2193" name="__codelineno-0-2193" href="#__codelineno-0-2193"></a>    <span class="p">)</span>
<a id="__codelineno-0-2194" name="__codelineno-0-2194" href="#__codelineno-0-2194"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">als</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df_model</span><span class="p">)</span>
<a id="__codelineno-0-2195" name="__codelineno-0-2195" href="#__codelineno-0-2195"></a>    <span class="n">df_pred</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2196" name="__codelineno-0-2196" href="#__codelineno-0-2196"></a>        <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df_test</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2197" name="__codelineno-0-2197" href="#__codelineno-0-2197"></a>    <span class="p">)</span>
<a id="__codelineno-0-2198" name="__codelineno-0-2198" href="#__codelineno-0-2198"></a>    <span class="n">df_encoded_pred</span> <span class="o">=</span> <span class="n">df_model</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">df_pred</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">df_model</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
<a id="__codelineno-0-2199" name="__codelineno-0-2199" href="#__codelineno-0-2199"></a>
<a id="__codelineno-0-2200" name="__codelineno-0-2200" href="#__codelineno-0-2200"></a>    <span class="k">if</span> <span class="n">id_type</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2201" name="__codelineno-0-2201" href="#__codelineno-0-2201"></a>        <span class="n">IDlabelReverse</span> <span class="o">=</span> <span class="n">IndexToString</span><span class="p">()</span><span class="o">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s2">&quot;IDLabel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="n">id_col</span><span class="p">)</span>
<a id="__codelineno-0-2202" name="__codelineno-0-2202" href="#__codelineno-0-2202"></a>        <span class="n">df_encoded_pred</span> <span class="o">=</span> <span class="n">IDlabelReverse</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df_encoded_pred</span><span class="p">)</span>
<a id="__codelineno-0-2203" name="__codelineno-0-2203" href="#__codelineno-0-2203"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2204" name="__codelineno-0-2204" href="#__codelineno-0-2204"></a>        <span class="n">df_encoded_pred</span> <span class="o">=</span> <span class="n">df_encoded_pred</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;IDLabel&quot;</span><span class="p">,</span> <span class="n">id_col</span><span class="p">)</span>
<a id="__codelineno-0-2205" name="__codelineno-0-2205" href="#__codelineno-0-2205"></a>
<a id="__codelineno-0-2206" name="__codelineno-0-2206" href="#__codelineno-0-2206"></a>    <span class="n">keylabelReverse</span> <span class="o">=</span> <span class="n">IndexToString</span><span class="p">()</span><span class="o">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s2">&quot;keyLabel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2207" name="__codelineno-0-2207" href="#__codelineno-0-2207"></a>    <span class="n">odf_imputed</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2208" name="__codelineno-0-2208" href="#__codelineno-0-2208"></a>        <span class="n">keylabelReverse</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df_encoded_pred</span><span class="p">)</span>
<a id="__codelineno-0-2209" name="__codelineno-0-2209" href="#__codelineno-0-2209"></a>        <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">id_col</span><span class="p">)</span>
<a id="__codelineno-0-2210" name="__codelineno-0-2210" href="#__codelineno-0-2210"></a>        <span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2211" name="__codelineno-0-2211" href="#__codelineno-0-2211"></a>        <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">))</span>
<a id="__codelineno-0-2212" name="__codelineno-0-2212" href="#__codelineno-0-2212"></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-0-2213" name="__codelineno-0-2213" href="#__codelineno-0-2213"></a>            <span class="p">[</span><span class="n">id_col</span><span class="p">]</span> <span class="o">+</span> <span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">missing_cols</span><span class="p">]</span>
<a id="__codelineno-0-2214" name="__codelineno-0-2214" href="#__codelineno-0-2214"></a>        <span class="p">)</span>
<a id="__codelineno-0-2215" name="__codelineno-0-2215" href="#__codelineno-0-2215"></a>    <span class="p">)</span>
<a id="__codelineno-0-2216" name="__codelineno-0-2216" href="#__codelineno-0-2216"></a>
<a id="__codelineno-0-2217" name="__codelineno-0-2217" href="#__codelineno-0-2217"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">odf_imputed</span><span class="p">,</span> <span class="n">id_col</span><span class="p">,</span> <span class="s2">&quot;left_outer&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2218" name="__codelineno-0-2218" href="#__codelineno-0-2218"></a>
<a id="__codelineno-0-2219" name="__codelineno-0-2219" href="#__codelineno-0-2219"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-2220" name="__codelineno-0-2220" href="#__codelineno-0-2220"></a>        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">missing_cols</span><span class="p">:</span>
<a id="__codelineno-0-2221" name="__codelineno-0-2221" href="#__codelineno-0-2221"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2222" name="__codelineno-0-2222" href="#__codelineno-0-2222"></a>        <span class="k">elif</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2223" name="__codelineno-0-2223" href="#__codelineno-0-2223"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-2224" name="__codelineno-0-2224" href="#__codelineno-0-2224"></a>
<a id="__codelineno-0-2225" name="__codelineno-0-2225" href="#__codelineno-0-2225"></a>    <span class="k">if</span> <span class="n">remove_id</span><span class="p">:</span>
<a id="__codelineno-0-2226" name="__codelineno-0-2226" href="#__codelineno-0-2226"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2227" name="__codelineno-0-2227" href="#__codelineno-0-2227"></a>
<a id="__codelineno-0-2228" name="__codelineno-0-2228" href="#__codelineno-0-2228"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-2229" name="__codelineno-0-2229" href="#__codelineno-0-2229"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2230" name="__codelineno-0-2230" href="#__codelineno-0-2230"></a>            <span class="n">odf_print</span> <span class="o">=</span> <span class="n">missing_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-0-2231" name="__codelineno-0-2231" href="#__codelineno-0-2231"></a>                <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;missingCount_before&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2232" name="__codelineno-0-2232" href="#__codelineno-0-2232"></a>            <span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-2233" name="__codelineno-0-2233" href="#__codelineno-0-2233"></a>                <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">odf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-0-2234" name="__codelineno-0-2234" href="#__codelineno-0-2234"></a>                    <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;missingCount_after&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2235" name="__codelineno-0-2235" href="#__codelineno-0-2235"></a>                <span class="p">),</span>
<a id="__codelineno-0-2236" name="__codelineno-0-2236" href="#__codelineno-0-2236"></a>                <span class="s2">&quot;attribute&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2237" name="__codelineno-0-2237" href="#__codelineno-0-2237"></a>                <span class="s2">&quot;inner&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2238" name="__codelineno-0-2238" href="#__codelineno-0-2238"></a>            <span class="p">)</span>
<a id="__codelineno-0-2239" name="__codelineno-0-2239" href="#__codelineno-0-2239"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2240" name="__codelineno-0-2240" href="#__codelineno-0-2240"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-2241" name="__codelineno-0-2241" href="#__codelineno-0-2241"></a>                <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">missing_cols</span><span class="p">]</span>
<a id="__codelineno-0-2242" name="__codelineno-0-2242" href="#__codelineno-0-2242"></a>            <span class="p">]</span>
<a id="__codelineno-0-2243" name="__codelineno-0-2243" href="#__codelineno-0-2243"></a>            <span class="n">odf_print</span> <span class="o">=</span> <span class="n">missing_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-0-2244" name="__codelineno-0-2244" href="#__codelineno-0-2244"></a>                <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;missingCount_before&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2245" name="__codelineno-0-2245" href="#__codelineno-0-2245"></a>            <span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-2246" name="__codelineno-0-2246" href="#__codelineno-0-2246"></a>                <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">odf</span><span class="p">,</span> <span class="n">output_cols</span><span class="p">)</span>
<a id="__codelineno-0-2247" name="__codelineno-0-2247" href="#__codelineno-0-2247"></a>                <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;attribute_after&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2248" name="__codelineno-0-2248" href="#__codelineno-0-2248"></a>                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-2249" name="__codelineno-0-2249" href="#__codelineno-0-2249"></a>                    <span class="s2">&quot;attribute&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2250" name="__codelineno-0-2250" href="#__codelineno-0-2250"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">expr</span><span class="p">(</span><span class="s2">&quot;substring(attribute_after, 1, length(attribute_after)-8)&quot;</span><span class="p">),</span>
<a id="__codelineno-0-2251" name="__codelineno-0-2251" href="#__codelineno-0-2251"></a>                <span class="p">)</span>
<a id="__codelineno-0-2252" name="__codelineno-0-2252" href="#__codelineno-0-2252"></a>                <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">),</span>
<a id="__codelineno-0-2253" name="__codelineno-0-2253" href="#__codelineno-0-2253"></a>                <span class="s2">&quot;attribute&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2254" name="__codelineno-0-2254" href="#__codelineno-0-2254"></a>                <span class="s2">&quot;inner&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2255" name="__codelineno-0-2255" href="#__codelineno-0-2255"></a>            <span class="p">)</span>
<a id="__codelineno-0-2256" name="__codelineno-0-2256" href="#__codelineno-0-2256"></a>        <span class="n">odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">),</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-2257" name="__codelineno-0-2257" href="#__codelineno-0-2257"></a>    <span class="k">return</span> <span class="n">odf</span>
<a id="__codelineno-0-2258" name="__codelineno-0-2258" href="#__codelineno-0-2258"></a>
<a id="__codelineno-0-2259" name="__codelineno-0-2259" href="#__codelineno-0-2259"></a>
<a id="__codelineno-0-2260" name="__codelineno-0-2260" href="#__codelineno-0-2260"></a><span class="k">def</span> <span class="nf">auto_imputation</span><span class="p">(</span>
<a id="__codelineno-0-2261" name="__codelineno-0-2261" href="#__codelineno-0-2261"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-2262" name="__codelineno-0-2262" href="#__codelineno-0-2262"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-2263" name="__codelineno-0-2263" href="#__codelineno-0-2263"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2264" name="__codelineno-0-2264" href="#__codelineno-0-2264"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-2265" name="__codelineno-0-2265" href="#__codelineno-0-2265"></a>    <span class="n">id_col</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2266" name="__codelineno-0-2266" href="#__codelineno-0-2266"></a>    <span class="n">null_pct</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
<a id="__codelineno-0-2267" name="__codelineno-0-2267" href="#__codelineno-0-2267"></a>    <span class="n">stats_missing</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-0-2268" name="__codelineno-0-2268" href="#__codelineno-0-2268"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2269" name="__codelineno-0-2269" href="#__codelineno-0-2269"></a>    <span class="n">run_type</span><span class="o">=</span><span class="s2">&quot;local&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2270" name="__codelineno-0-2270" href="#__codelineno-0-2270"></a>    <span class="n">root_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2271" name="__codelineno-0-2271" href="#__codelineno-0-2271"></a>    <span class="n">auth_key</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2272" name="__codelineno-0-2272" href="#__codelineno-0-2272"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-2273" name="__codelineno-0-2273" href="#__codelineno-0-2273"></a><span class="p">):</span>
<a id="__codelineno-0-2274" name="__codelineno-0-2274" href="#__codelineno-0-2274"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2275" name="__codelineno-0-2275" href="#__codelineno-0-2275"></a><span class="sd">    auto_imputation tests for 5 imputation methods using the other imputation functions provided in this module</span>
<a id="__codelineno-0-2276" name="__codelineno-0-2276" href="#__codelineno-0-2276"></a><span class="sd">    and returns the one with the best performance. The 5 methods are: (1) imputation_MMM with method_type=&quot;mean&quot; (2)</span>
<a id="__codelineno-0-2277" name="__codelineno-0-2277" href="#__codelineno-0-2277"></a><span class="sd">    imputation_MMM with method_type=&quot;median&quot; (3) imputation_sklearn with method_type=&quot;KNN&quot; (4) imputation_sklearn</span>
<a id="__codelineno-0-2278" name="__codelineno-0-2278" href="#__codelineno-0-2278"></a><span class="sd">    with method_type=&quot;regression&quot; (5) imputation_matrixFactorization</span>
<a id="__codelineno-0-2279" name="__codelineno-0-2279" href="#__codelineno-0-2279"></a>
<a id="__codelineno-0-2280" name="__codelineno-0-2280" href="#__codelineno-0-2280"></a><span class="sd">    Samples without missing values in attributes to impute are used for testing by removing some % of values and impute</span>
<a id="__codelineno-0-2281" name="__codelineno-0-2281" href="#__codelineno-0-2281"></a><span class="sd">    them again using the above 5 methods. RMSE/attribute_mean is used as the evaluation metric for each attribute to</span>
<a id="__codelineno-0-2282" name="__codelineno-0-2282" href="#__codelineno-0-2282"></a><span class="sd">    reduce the effect of unit difference among attributes. The final error of a method is calculated by the sum of (</span>
<a id="__codelineno-0-2283" name="__codelineno-0-2283" href="#__codelineno-0-2283"></a><span class="sd">    RMSE/attribute_mean) for all numerical attributes to impute and the method with the least error will be selected.</span>
<a id="__codelineno-0-2284" name="__codelineno-0-2284" href="#__codelineno-0-2284"></a>
<a id="__codelineno-0-2285" name="__codelineno-0-2285" href="#__codelineno-0-2285"></a><span class="sd">    The above testing is only applicable for numerical attributes. If categorical attributes are included,</span>
<a id="__codelineno-0-2286" name="__codelineno-0-2286" href="#__codelineno-0-2286"></a><span class="sd">    they will be automatically imputed using imputation_MMM. In addition, if there is only one numerical attribute to</span>
<a id="__codelineno-0-2287" name="__codelineno-0-2287" href="#__codelineno-0-2287"></a><span class="sd">    impute, only method (1) and (2) will be tested because the rest of the methods require more than one column.</span>
<a id="__codelineno-0-2288" name="__codelineno-0-2288" href="#__codelineno-0-2288"></a>
<a id="__codelineno-0-2289" name="__codelineno-0-2289" href="#__codelineno-0-2289"></a>
<a id="__codelineno-0-2290" name="__codelineno-0-2290" href="#__codelineno-0-2290"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-2291" name="__codelineno-0-2291" href="#__codelineno-0-2291"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-2292" name="__codelineno-0-2292" href="#__codelineno-0-2292"></a><span class="sd">    spark</span>
<a id="__codelineno-0-2293" name="__codelineno-0-2293" href="#__codelineno-0-2293"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-0-2294" name="__codelineno-0-2294" href="#__codelineno-0-2294"></a><span class="sd">    idf</span>
<a id="__codelineno-0-2295" name="__codelineno-0-2295" href="#__codelineno-0-2295"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-2296" name="__codelineno-0-2296" href="#__codelineno-0-2296"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-0-2297" name="__codelineno-0-2297" href="#__codelineno-0-2297"></a><span class="sd">        List of columns to impute e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-2298" name="__codelineno-0-2298" href="#__codelineno-0-2298"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-2299" name="__codelineno-0-2299" href="#__codelineno-0-2299"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-2300" name="__codelineno-0-2300" href="#__codelineno-0-2300"></a><span class="sd">        &quot;all&quot; can be passed to include all (non-array) columns for analysis.</span>
<a id="__codelineno-0-2301" name="__codelineno-0-2301" href="#__codelineno-0-2301"></a><span class="sd">        This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-0-2302" name="__codelineno-0-2302" href="#__codelineno-0-2302"></a><span class="sd">        &quot;missing&quot; (default) can be passed to include only those columns with missing values.</span>
<a id="__codelineno-0-2303" name="__codelineno-0-2303" href="#__codelineno-0-2303"></a><span class="sd">        One of the usecases where &quot;all&quot; may be preferable over &quot;missing&quot; is when the user wants to save</span>
<a id="__codelineno-0-2304" name="__codelineno-0-2304" href="#__codelineno-0-2304"></a><span class="sd">        the imputation model for the future use e.g. a column may not have missing value in the training</span>
<a id="__codelineno-0-2305" name="__codelineno-0-2305" href="#__codelineno-0-2305"></a><span class="sd">        dataset but missing values may possibly appear in the prediction dataset.</span>
<a id="__codelineno-0-2306" name="__codelineno-0-2306" href="#__codelineno-0-2306"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-0-2307" name="__codelineno-0-2307" href="#__codelineno-0-2307"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols.</span>
<a id="__codelineno-0-2308" name="__codelineno-0-2308" href="#__codelineno-0-2308"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-0-2309" name="__codelineno-0-2309" href="#__codelineno-0-2309"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-2310" name="__codelineno-0-2310" href="#__codelineno-0-2310"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-2311" name="__codelineno-0-2311" href="#__codelineno-0-2311"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-2312" name="__codelineno-0-2312" href="#__codelineno-0-2312"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-0-2313" name="__codelineno-0-2313" href="#__codelineno-0-2313"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-0-2314" name="__codelineno-0-2314" href="#__codelineno-0-2314"></a><span class="sd">    id_col</span>
<a id="__codelineno-0-2315" name="__codelineno-0-2315" href="#__codelineno-0-2315"></a><span class="sd">        ID column (Default value = &quot;&quot;)</span>
<a id="__codelineno-0-2316" name="__codelineno-0-2316" href="#__codelineno-0-2316"></a><span class="sd">    null_pct</span>
<a id="__codelineno-0-2317" name="__codelineno-0-2317" href="#__codelineno-0-2317"></a><span class="sd">        proportion of the valid input data to be replaced by None to form the test data (Default value = 0.1)</span>
<a id="__codelineno-0-2318" name="__codelineno-0-2318" href="#__codelineno-0-2318"></a><span class="sd">    stats_missing</span>
<a id="__codelineno-0-2319" name="__codelineno-0-2319" href="#__codelineno-0-2319"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-0-2320" name="__codelineno-0-2320" href="#__codelineno-0-2320"></a><span class="sd">        to read pre-saved statistics on missing count/pct i.e. if measures_of_counts or</span>
<a id="__codelineno-0-2321" name="__codelineno-0-2321" href="#__codelineno-0-2321"></a><span class="sd">        missingCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-0-2322" name="__codelineno-0-2322" href="#__codelineno-0-2322"></a><span class="sd">    output_mode</span>
<a id="__codelineno-0-2323" name="__codelineno-0-2323" href="#__codelineno-0-2323"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-0-2324" name="__codelineno-0-2324" href="#__codelineno-0-2324"></a><span class="sd">        “replace” option replaces original columns with transformed column. “append” option append transformed</span>
<a id="__codelineno-0-2325" name="__codelineno-0-2325" href="#__codelineno-0-2325"></a><span class="sd">        column to the input dataset with a postfix &quot;_imputed&quot; e.g. column X is appended as X_imputed. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-0-2326" name="__codelineno-0-2326" href="#__codelineno-0-2326"></a><span class="sd">    run_type</span>
<a id="__codelineno-0-2327" name="__codelineno-0-2327" href="#__codelineno-0-2327"></a><span class="sd">        &quot;local&quot;, &quot;emr&quot;, &quot;databricks&quot;, &quot;ak8s&quot; (Default value = &quot;local&quot;)</span>
<a id="__codelineno-0-2328" name="__codelineno-0-2328" href="#__codelineno-0-2328"></a><span class="sd">    root_path</span>
<a id="__codelineno-0-2329" name="__codelineno-0-2329" href="#__codelineno-0-2329"></a><span class="sd">        This argument takes in a base folder path for writing out intermediate_data/ folder to. Default value is &quot;&quot;</span>
<a id="__codelineno-0-2330" name="__codelineno-0-2330" href="#__codelineno-0-2330"></a><span class="sd">    auth_key</span>
<a id="__codelineno-0-2331" name="__codelineno-0-2331" href="#__codelineno-0-2331"></a><span class="sd">        Option to pass an authorization key to write to filesystems. Currently applicable only for ak8s run_type. Default value is kept as &quot;NA&quot;</span>
<a id="__codelineno-0-2332" name="__codelineno-0-2332" href="#__codelineno-0-2332"></a><span class="sd">    print_impact</span>
<a id="__codelineno-0-2333" name="__codelineno-0-2333" href="#__codelineno-0-2333"></a><span class="sd">        True, False (Default value = False)</span>
<a id="__codelineno-0-2334" name="__codelineno-0-2334" href="#__codelineno-0-2334"></a><span class="sd">        This argument is to print out before and after missing counts of imputed columns. It also print the name of best</span>
<a id="__codelineno-0-2335" name="__codelineno-0-2335" href="#__codelineno-0-2335"></a><span class="sd">        performing imputation method along with RMSE details.</span>
<a id="__codelineno-0-2336" name="__codelineno-0-2336" href="#__codelineno-0-2336"></a>
<a id="__codelineno-0-2337" name="__codelineno-0-2337" href="#__codelineno-0-2337"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-2338" name="__codelineno-0-2338" href="#__codelineno-0-2338"></a><span class="sd">    -------</span>
<a id="__codelineno-0-2339" name="__codelineno-0-2339" href="#__codelineno-0-2339"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-0-2340" name="__codelineno-0-2340" href="#__codelineno-0-2340"></a><span class="sd">        Imputed Dataframe</span>
<a id="__codelineno-0-2341" name="__codelineno-0-2341" href="#__codelineno-0-2341"></a>
<a id="__codelineno-0-2342" name="__codelineno-0-2342" href="#__codelineno-0-2342"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-2343" name="__codelineno-0-2343" href="#__codelineno-0-2343"></a>
<a id="__codelineno-0-2344" name="__codelineno-0-2344" href="#__codelineno-0-2344"></a>    <span class="k">if</span> <span class="n">stats_missing</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-0-2345" name="__codelineno-0-2345" href="#__codelineno-0-2345"></a>        <span class="n">missing_df</span> <span class="o">=</span> <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">)</span>
<a id="__codelineno-0-2346" name="__codelineno-0-2346" href="#__codelineno-0-2346"></a>        <span class="n">missing_df</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span>
<a id="__codelineno-0-2347" name="__codelineno-0-2347" href="#__codelineno-0-2347"></a>            <span class="n">root_path</span>
<a id="__codelineno-0-2348" name="__codelineno-0-2348" href="#__codelineno-0-2348"></a>            <span class="o">+</span> <span class="s2">&quot;intermediate_data/imputation_comparison/missingCount_computation&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2349" name="__codelineno-0-2349" href="#__codelineno-0-2349"></a>            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2350" name="__codelineno-0-2350" href="#__codelineno-0-2350"></a>        <span class="p">)</span>
<a id="__codelineno-0-2351" name="__codelineno-0-2351" href="#__codelineno-0-2351"></a>        <span class="n">stats_missing</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-2352" name="__codelineno-0-2352" href="#__codelineno-0-2352"></a>            <span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="n">root_path</span>
<a id="__codelineno-0-2353" name="__codelineno-0-2353" href="#__codelineno-0-2353"></a>            <span class="o">+</span> <span class="s2">&quot;intermediate_data/imputation_comparison/missingCount_computation&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2354" name="__codelineno-0-2354" href="#__codelineno-0-2354"></a>            <span class="s2">&quot;file_type&quot;</span><span class="p">:</span> <span class="s2">&quot;parquet&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2355" name="__codelineno-0-2355" href="#__codelineno-0-2355"></a>        <span class="p">}</span>
<a id="__codelineno-0-2356" name="__codelineno-0-2356" href="#__codelineno-0-2356"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2357" name="__codelineno-0-2357" href="#__codelineno-0-2357"></a>        <span class="n">missing_df</span> <span class="o">=</span> <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_missing</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-0-2358" name="__codelineno-0-2358" href="#__codelineno-0-2358"></a>            <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_count&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_pct&quot;</span>
<a id="__codelineno-0-2359" name="__codelineno-0-2359" href="#__codelineno-0-2359"></a>        <span class="p">)</span>
<a id="__codelineno-0-2360" name="__codelineno-0-2360" href="#__codelineno-0-2360"></a>
<a id="__codelineno-0-2361" name="__codelineno-0-2361" href="#__codelineno-0-2361"></a>    <span class="n">empty_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2362" name="__codelineno-0-2362" href="#__codelineno-0-2362"></a>        <span class="n">missing_df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-0-2363" name="__codelineno-0-2363" href="#__codelineno-0-2363"></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2364" name="__codelineno-0-2364" href="#__codelineno-0-2364"></a>        <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-2365" name="__codelineno-0-2365" href="#__codelineno-0-2365"></a>        <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-2366" name="__codelineno-0-2366" href="#__codelineno-0-2366"></a>    <span class="p">)</span>
<a id="__codelineno-0-2367" name="__codelineno-0-2367" href="#__codelineno-0-2367"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">empty_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-2368" name="__codelineno-0-2368" href="#__codelineno-0-2368"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Following columns have all null values: &quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">empty_cols</span><span class="p">))</span>
<a id="__codelineno-0-2369" name="__codelineno-0-2369" href="#__codelineno-0-2369"></a>
<a id="__codelineno-0-2370" name="__codelineno-0-2370" href="#__codelineno-0-2370"></a>    <span class="n">missing_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2371" name="__codelineno-0-2371" href="#__codelineno-0-2371"></a>        <span class="n">missing_df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-2372" name="__codelineno-0-2372" href="#__codelineno-0-2372"></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2373" name="__codelineno-0-2373" href="#__codelineno-0-2373"></a>        <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-2374" name="__codelineno-0-2374" href="#__codelineno-0-2374"></a>        <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-2375" name="__codelineno-0-2375" href="#__codelineno-0-2375"></a>    <span class="p">)</span>
<a id="__codelineno-0-2376" name="__codelineno-0-2376" href="#__codelineno-0-2376"></a>
<a id="__codelineno-0-2377" name="__codelineno-0-2377" href="#__codelineno-0-2377"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2378" name="__codelineno-0-2378" href="#__codelineno-0-2378"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">columns</span>
<a id="__codelineno-0-2379" name="__codelineno-0-2379" href="#__codelineno-0-2379"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;missing&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2380" name="__codelineno-0-2380" href="#__codelineno-0-2380"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">missing_cols</span>
<a id="__codelineno-0-2381" name="__codelineno-0-2381" href="#__codelineno-0-2381"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-2382" name="__codelineno-0-2382" href="#__codelineno-0-2382"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-2383" name="__codelineno-0-2383" href="#__codelineno-0-2383"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-2384" name="__codelineno-0-2384" href="#__codelineno-0-2384"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-2385" name="__codelineno-0-2385" href="#__codelineno-0-2385"></a>
<a id="__codelineno-0-2386" name="__codelineno-0-2386" href="#__codelineno-0-2386"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
<a id="__codelineno-0-2387" name="__codelineno-0-2387" href="#__codelineno-0-2387"></a>        <span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">e</span> <span class="o">!=</span> <span class="n">id_col</span><span class="p">)])</span>
<a id="__codelineno-0-2388" name="__codelineno-0-2388" href="#__codelineno-0-2388"></a>    <span class="p">)</span>
<a id="__codelineno-0-2389" name="__codelineno-0-2389" href="#__codelineno-0-2389"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-2390" name="__codelineno-0-2390" href="#__codelineno-0-2390"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2391" name="__codelineno-0-2391" href="#__codelineno-0-2391"></a>
<a id="__codelineno-0-2392" name="__codelineno-0-2392" href="#__codelineno-0-2392"></a>    <span class="n">del_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">empty_cols</span><span class="p">]</span>
<a id="__codelineno-0-2393" name="__codelineno-0-2393" href="#__codelineno-0-2393"></a>    <span class="n">odf_del</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="n">del_cols</span><span class="p">)</span>
<a id="__codelineno-0-2394" name="__codelineno-0-2394" href="#__codelineno-0-2394"></a>
<a id="__codelineno-0-2395" name="__codelineno-0-2395" href="#__codelineno-0-2395"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">empty_cols</span><span class="p">]</span>
<a id="__codelineno-0-2396" name="__codelineno-0-2396" href="#__codelineno-0-2396"></a>    <span class="n">num_cols</span><span class="p">,</span> <span class="n">cat_cols</span><span class="p">,</span> <span class="n">other_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span>
<a id="__codelineno-0-2397" name="__codelineno-0-2397" href="#__codelineno-0-2397"></a>        <span class="n">odf_del</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-0-2398" name="__codelineno-0-2398" href="#__codelineno-0-2398"></a>    <span class="p">)</span>
<a id="__codelineno-0-2399" name="__codelineno-0-2399" href="#__codelineno-0-2399"></a>    <span class="n">missing_catcols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">cat_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">missing_cols</span><span class="p">]</span>
<a id="__codelineno-0-2400" name="__codelineno-0-2400" href="#__codelineno-0-2400"></a>    <span class="n">missing_numcols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">missing_cols</span><span class="p">]</span>
<a id="__codelineno-0-2401" name="__codelineno-0-2401" href="#__codelineno-0-2401"></a>
<a id="__codelineno-0-2402" name="__codelineno-0-2402" href="#__codelineno-0-2402"></a>    <span class="k">if</span> <span class="n">missing_catcols</span><span class="p">:</span>
<a id="__codelineno-0-2403" name="__codelineno-0-2403" href="#__codelineno-0-2403"></a>        <span class="n">odf_imputed_cat</span> <span class="o">=</span> <span class="n">imputation_MMM</span><span class="p">(</span>
<a id="__codelineno-0-2404" name="__codelineno-0-2404" href="#__codelineno-0-2404"></a>            <span class="n">spark</span><span class="p">,</span> <span class="n">odf_del</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="o">=</span><span class="n">missing_catcols</span><span class="p">,</span> <span class="n">stats_missing</span><span class="o">=</span><span class="n">stats_missing</span>
<a id="__codelineno-0-2405" name="__codelineno-0-2405" href="#__codelineno-0-2405"></a>        <span class="p">)</span>
<a id="__codelineno-0-2406" name="__codelineno-0-2406" href="#__codelineno-0-2406"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2407" name="__codelineno-0-2407" href="#__codelineno-0-2407"></a>        <span class="n">odf_imputed_cat</span> <span class="o">=</span> <span class="n">odf_del</span>
<a id="__codelineno-0-2408" name="__codelineno-0-2408" href="#__codelineno-0-2408"></a>
<a id="__codelineno-0-2409" name="__codelineno-0-2409" href="#__codelineno-0-2409"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_numcols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-2410" name="__codelineno-0-2410" href="#__codelineno-0-2410"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-2411" name="__codelineno-0-2411" href="#__codelineno-0-2411"></a>            <span class="s2">&quot;No Imputation Performed for numerical columns - No Column(s) to Impute&quot;</span>
<a id="__codelineno-0-2412" name="__codelineno-0-2412" href="#__codelineno-0-2412"></a>        <span class="p">)</span>
<a id="__codelineno-0-2413" name="__codelineno-0-2413" href="#__codelineno-0-2413"></a>        <span class="k">return</span> <span class="n">odf_imputed_cat</span>
<a id="__codelineno-0-2414" name="__codelineno-0-2414" href="#__codelineno-0-2414"></a>
<a id="__codelineno-0-2415" name="__codelineno-0-2415" href="#__codelineno-0-2415"></a>    <span class="n">idf_test</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2416" name="__codelineno-0-2416" href="#__codelineno-0-2416"></a>        <span class="n">odf_imputed_cat</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">missing_numcols</span><span class="p">)</span>
<a id="__codelineno-0-2417" name="__codelineno-0-2417" href="#__codelineno-0-2417"></a>        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">monotonically_increasing_id</span><span class="p">())</span>
<a id="__codelineno-0-2418" name="__codelineno-0-2418" href="#__codelineno-0-2418"></a>        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">row_number</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">Window</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)))</span>
<a id="__codelineno-0-2419" name="__codelineno-0-2419" href="#__codelineno-0-2419"></a>    <span class="p">)</span>
<a id="__codelineno-0-2420" name="__codelineno-0-2420" href="#__codelineno-0-2420"></a>    <span class="n">null_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">null_pct</span> <span class="o">*</span> <span class="n">idf_test</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
<a id="__codelineno-0-2421" name="__codelineno-0-2421" href="#__codelineno-0-2421"></a>    <span class="n">idf_null</span> <span class="o">=</span> <span class="n">idf_test</span>
<a id="__codelineno-0-2422" name="__codelineno-0-2422" href="#__codelineno-0-2422"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">missing_numcols</span><span class="p">:</span>
<a id="__codelineno-0-2423" name="__codelineno-0-2423" href="#__codelineno-0-2423"></a>        <span class="n">null_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">idf_test</span><span class="o">.</span><span class="n">count</span><span class="p">()),</span> <span class="n">null_count</span><span class="p">)</span>
<a id="__codelineno-0-2424" name="__codelineno-0-2424" href="#__codelineno-0-2424"></a>        <span class="n">idf_null</span> <span class="o">=</span> <span class="n">idf_null</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-2425" name="__codelineno-0-2425" href="#__codelineno-0-2425"></a>            <span class="n">i</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">null_index</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a id="__codelineno-0-2426" name="__codelineno-0-2426" href="#__codelineno-0-2426"></a>        <span class="p">)</span>
<a id="__codelineno-0-2427" name="__codelineno-0-2427" href="#__codelineno-0-2427"></a>
<a id="__codelineno-0-2428" name="__codelineno-0-2428" href="#__codelineno-0-2428"></a>    <span class="n">idf_null</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span>
<a id="__codelineno-0-2429" name="__codelineno-0-2429" href="#__codelineno-0-2429"></a>        <span class="n">root_path</span> <span class="o">+</span> <span class="s2">&quot;intermediate_data/imputation_comparison/test_dataset&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2430" name="__codelineno-0-2430" href="#__codelineno-0-2430"></a>        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2431" name="__codelineno-0-2431" href="#__codelineno-0-2431"></a>    <span class="p">)</span>
<a id="__codelineno-0-2432" name="__codelineno-0-2432" href="#__codelineno-0-2432"></a>    <span class="n">idf_null</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span>
<a id="__codelineno-0-2433" name="__codelineno-0-2433" href="#__codelineno-0-2433"></a>        <span class="n">root_path</span> <span class="o">+</span> <span class="s2">&quot;intermediate_data/imputation_comparison/test_dataset&quot;</span>
<a id="__codelineno-0-2434" name="__codelineno-0-2434" href="#__codelineno-0-2434"></a>    <span class="p">)</span>
<a id="__codelineno-0-2435" name="__codelineno-0-2435" href="#__codelineno-0-2435"></a>
<a id="__codelineno-0-2436" name="__codelineno-0-2436" href="#__codelineno-0-2436"></a>    <span class="n">method1</span> <span class="o">=</span> <span class="n">imputation_MMM</span><span class="p">(</span>
<a id="__codelineno-0-2437" name="__codelineno-0-2437" href="#__codelineno-0-2437"></a>        <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-2438" name="__codelineno-0-2438" href="#__codelineno-0-2438"></a>        <span class="n">idf_null</span><span class="p">,</span>
<a id="__codelineno-0-2439" name="__codelineno-0-2439" href="#__codelineno-0-2439"></a>        <span class="n">list_of_cols</span><span class="o">=</span><span class="n">missing_numcols</span><span class="p">,</span>
<a id="__codelineno-0-2440" name="__codelineno-0-2440" href="#__codelineno-0-2440"></a>        <span class="n">method_type</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2441" name="__codelineno-0-2441" href="#__codelineno-0-2441"></a>        <span class="n">stats_missing</span><span class="o">=</span><span class="n">stats_missing</span><span class="p">,</span>
<a id="__codelineno-0-2442" name="__codelineno-0-2442" href="#__codelineno-0-2442"></a>        <span class="n">output_mode</span><span class="o">=</span><span class="n">output_mode</span><span class="p">,</span>
<a id="__codelineno-0-2443" name="__codelineno-0-2443" href="#__codelineno-0-2443"></a>    <span class="p">)</span>
<a id="__codelineno-0-2444" name="__codelineno-0-2444" href="#__codelineno-0-2444"></a>    <span class="n">method2</span> <span class="o">=</span> <span class="n">imputation_MMM</span><span class="p">(</span>
<a id="__codelineno-0-2445" name="__codelineno-0-2445" href="#__codelineno-0-2445"></a>        <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-2446" name="__codelineno-0-2446" href="#__codelineno-0-2446"></a>        <span class="n">idf_null</span><span class="p">,</span>
<a id="__codelineno-0-2447" name="__codelineno-0-2447" href="#__codelineno-0-2447"></a>        <span class="n">list_of_cols</span><span class="o">=</span><span class="n">missing_numcols</span><span class="p">,</span>
<a id="__codelineno-0-2448" name="__codelineno-0-2448" href="#__codelineno-0-2448"></a>        <span class="n">method_type</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2449" name="__codelineno-0-2449" href="#__codelineno-0-2449"></a>        <span class="n">stats_missing</span><span class="o">=</span><span class="n">stats_missing</span><span class="p">,</span>
<a id="__codelineno-0-2450" name="__codelineno-0-2450" href="#__codelineno-0-2450"></a>        <span class="n">output_mode</span><span class="o">=</span><span class="n">output_mode</span><span class="p">,</span>
<a id="__codelineno-0-2451" name="__codelineno-0-2451" href="#__codelineno-0-2451"></a>    <span class="p">)</span>
<a id="__codelineno-0-2452" name="__codelineno-0-2452" href="#__codelineno-0-2452"></a>    <span class="n">valid_methods</span> <span class="o">=</span> <span class="p">[</span><span class="n">method1</span><span class="p">,</span> <span class="n">method2</span><span class="p">]</span>
<a id="__codelineno-0-2453" name="__codelineno-0-2453" href="#__codelineno-0-2453"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">num_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-2454" name="__codelineno-0-2454" href="#__codelineno-0-2454"></a>        <span class="n">method3</span> <span class="o">=</span> <span class="n">imputation_sklearn</span><span class="p">(</span>
<a id="__codelineno-0-2455" name="__codelineno-0-2455" href="#__codelineno-0-2455"></a>            <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-2456" name="__codelineno-0-2456" href="#__codelineno-0-2456"></a>            <span class="n">idf_null</span><span class="p">,</span>
<a id="__codelineno-0-2457" name="__codelineno-0-2457" href="#__codelineno-0-2457"></a>            <span class="n">list_of_cols</span><span class="o">=</span><span class="n">num_cols</span><span class="p">,</span>
<a id="__codelineno-0-2458" name="__codelineno-0-2458" href="#__codelineno-0-2458"></a>            <span class="n">method_type</span><span class="o">=</span><span class="s2">&quot;KNN&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2459" name="__codelineno-0-2459" href="#__codelineno-0-2459"></a>            <span class="n">stats_missing</span><span class="o">=</span><span class="n">stats_missing</span><span class="p">,</span>
<a id="__codelineno-0-2460" name="__codelineno-0-2460" href="#__codelineno-0-2460"></a>            <span class="n">output_mode</span><span class="o">=</span><span class="n">output_mode</span><span class="p">,</span>
<a id="__codelineno-0-2461" name="__codelineno-0-2461" href="#__codelineno-0-2461"></a>            <span class="n">auth_key</span><span class="o">=</span><span class="n">auth_key</span><span class="p">,</span>
<a id="__codelineno-0-2462" name="__codelineno-0-2462" href="#__codelineno-0-2462"></a>        <span class="p">)</span>
<a id="__codelineno-0-2463" name="__codelineno-0-2463" href="#__codelineno-0-2463"></a>        <span class="n">method4</span> <span class="o">=</span> <span class="n">imputation_sklearn</span><span class="p">(</span>
<a id="__codelineno-0-2464" name="__codelineno-0-2464" href="#__codelineno-0-2464"></a>            <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-2465" name="__codelineno-0-2465" href="#__codelineno-0-2465"></a>            <span class="n">idf_null</span><span class="p">,</span>
<a id="__codelineno-0-2466" name="__codelineno-0-2466" href="#__codelineno-0-2466"></a>            <span class="n">list_of_cols</span><span class="o">=</span><span class="n">num_cols</span><span class="p">,</span>
<a id="__codelineno-0-2467" name="__codelineno-0-2467" href="#__codelineno-0-2467"></a>            <span class="n">method_type</span><span class="o">=</span><span class="s2">&quot;regression&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2468" name="__codelineno-0-2468" href="#__codelineno-0-2468"></a>            <span class="n">stats_missing</span><span class="o">=</span><span class="n">stats_missing</span><span class="p">,</span>
<a id="__codelineno-0-2469" name="__codelineno-0-2469" href="#__codelineno-0-2469"></a>            <span class="n">output_mode</span><span class="o">=</span><span class="n">output_mode</span><span class="p">,</span>
<a id="__codelineno-0-2470" name="__codelineno-0-2470" href="#__codelineno-0-2470"></a>            <span class="n">auth_key</span><span class="o">=</span><span class="n">auth_key</span><span class="p">,</span>
<a id="__codelineno-0-2471" name="__codelineno-0-2471" href="#__codelineno-0-2471"></a>        <span class="p">)</span>
<a id="__codelineno-0-2472" name="__codelineno-0-2472" href="#__codelineno-0-2472"></a>        <span class="n">method5</span> <span class="o">=</span> <span class="n">imputation_matrixFactorization</span><span class="p">(</span>
<a id="__codelineno-0-2473" name="__codelineno-0-2473" href="#__codelineno-0-2473"></a>            <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-2474" name="__codelineno-0-2474" href="#__codelineno-0-2474"></a>            <span class="n">idf_null</span><span class="p">,</span>
<a id="__codelineno-0-2475" name="__codelineno-0-2475" href="#__codelineno-0-2475"></a>            <span class="n">list_of_cols</span><span class="o">=</span><span class="n">num_cols</span><span class="p">,</span>
<a id="__codelineno-0-2476" name="__codelineno-0-2476" href="#__codelineno-0-2476"></a>            <span class="n">id_col</span><span class="o">=</span><span class="n">id_col</span><span class="p">,</span>
<a id="__codelineno-0-2477" name="__codelineno-0-2477" href="#__codelineno-0-2477"></a>            <span class="n">stats_missing</span><span class="o">=</span><span class="n">stats_missing</span><span class="p">,</span>
<a id="__codelineno-0-2478" name="__codelineno-0-2478" href="#__codelineno-0-2478"></a>            <span class="n">output_mode</span><span class="o">=</span><span class="n">output_mode</span><span class="p">,</span>
<a id="__codelineno-0-2479" name="__codelineno-0-2479" href="#__codelineno-0-2479"></a>        <span class="p">)</span>
<a id="__codelineno-0-2480" name="__codelineno-0-2480" href="#__codelineno-0-2480"></a>        <span class="n">valid_methods</span> <span class="o">=</span> <span class="p">[</span><span class="n">method1</span><span class="p">,</span> <span class="n">method2</span><span class="p">,</span> <span class="n">method3</span><span class="p">,</span> <span class="n">method4</span><span class="p">,</span> <span class="n">method5</span><span class="p">]</span>
<a id="__codelineno-0-2481" name="__codelineno-0-2481" href="#__codelineno-0-2481"></a>
<a id="__codelineno-0-2482" name="__codelineno-0-2482" href="#__codelineno-0-2482"></a>    <span class="n">nrmse_all</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-2483" name="__codelineno-0-2483" href="#__codelineno-0-2483"></a>    <span class="n">method_all</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MMM-mean&quot;</span><span class="p">,</span> <span class="s2">&quot;MMM-median&quot;</span><span class="p">,</span> <span class="s2">&quot;KNN&quot;</span><span class="p">,</span> <span class="s2">&quot;regression&quot;</span><span class="p">,</span> <span class="s2">&quot;matrix_factorization&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2484" name="__codelineno-0-2484" href="#__codelineno-0-2484"></a>
<a id="__codelineno-0-2485" name="__codelineno-0-2485" href="#__codelineno-0-2485"></a>    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">valid_methods</span><span class="p">):</span>
<a id="__codelineno-0-2486" name="__codelineno-0-2486" href="#__codelineno-0-2486"></a>        <span class="n">nrmse</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-2487" name="__codelineno-0-2487" href="#__codelineno-0-2487"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">missing_numcols</span><span class="p">:</span>
<a id="__codelineno-0-2488" name="__codelineno-0-2488" href="#__codelineno-0-2488"></a>            <span class="n">pred_col</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;append&quot;</span> <span class="k">else</span> <span class="n">i</span>
<a id="__codelineno-0-2489" name="__codelineno-0-2489" href="#__codelineno-0-2489"></a>            <span class="n">idf_joined</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2490" name="__codelineno-0-2490" href="#__codelineno-0-2490"></a>                <span class="n">idf_test</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;val&quot;</span><span class="p">))</span>
<a id="__codelineno-0-2491" name="__codelineno-0-2491" href="#__codelineno-0-2491"></a>                <span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-2492" name="__codelineno-0-2492" href="#__codelineno-0-2492"></a>                    <span class="n">method</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">pred_col</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;pred&quot;</span><span class="p">)),</span>
<a id="__codelineno-0-2493" name="__codelineno-0-2493" href="#__codelineno-0-2493"></a>                    <span class="s2">&quot;index&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2494" name="__codelineno-0-2494" href="#__codelineno-0-2494"></a>                    <span class="s2">&quot;left_outer&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2495" name="__codelineno-0-2495" href="#__codelineno-0-2495"></a>                <span class="p">)</span>
<a id="__codelineno-0-2496" name="__codelineno-0-2496" href="#__codelineno-0-2496"></a>                <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<a id="__codelineno-0-2497" name="__codelineno-0-2497" href="#__codelineno-0-2497"></a>            <span class="p">)</span>
<a id="__codelineno-0-2498" name="__codelineno-0-2498" href="#__codelineno-0-2498"></a>            <span class="n">idf_joined</span> <span class="o">=</span> <span class="n">recast_column</span><span class="p">(</span>
<a id="__codelineno-0-2499" name="__codelineno-0-2499" href="#__codelineno-0-2499"></a>                <span class="n">idf</span><span class="o">=</span><span class="n">idf_joined</span><span class="p">,</span>
<a id="__codelineno-0-2500" name="__codelineno-0-2500" href="#__codelineno-0-2500"></a>                <span class="n">list_of_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;val&quot;</span><span class="p">,</span> <span class="s2">&quot;pred&quot;</span><span class="p">],</span>
<a id="__codelineno-0-2501" name="__codelineno-0-2501" href="#__codelineno-0-2501"></a>                <span class="n">list_of_dtypes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="s2">&quot;double&quot;</span><span class="p">],</span>
<a id="__codelineno-0-2502" name="__codelineno-0-2502" href="#__codelineno-0-2502"></a>            <span class="p">)</span>
<a id="__codelineno-0-2503" name="__codelineno-0-2503" href="#__codelineno-0-2503"></a>            <span class="n">pred_mean</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
<a id="__codelineno-0-2504" name="__codelineno-0-2504" href="#__codelineno-0-2504"></a>                <span class="n">method</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pred_col</span><span class="p">))</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-2505" name="__codelineno-0-2505" href="#__codelineno-0-2505"></a>            <span class="p">)</span>
<a id="__codelineno-0-2506" name="__codelineno-0-2506" href="#__codelineno-0-2506"></a>            <span class="n">i_nrmse</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2507" name="__codelineno-0-2507" href="#__codelineno-0-2507"></a>                <span class="n">RegressionEvaluator</span><span class="p">(</span>
<a id="__codelineno-0-2508" name="__codelineno-0-2508" href="#__codelineno-0-2508"></a>                    <span class="n">metricName</span><span class="o">=</span><span class="s2">&quot;rmse&quot;</span><span class="p">,</span> <span class="n">labelCol</span><span class="o">=</span><span class="s2">&quot;val&quot;</span><span class="p">,</span> <span class="n">predictionCol</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span>
<a id="__codelineno-0-2509" name="__codelineno-0-2509" href="#__codelineno-0-2509"></a>                <span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">idf_joined</span><span class="p">)</span>
<a id="__codelineno-0-2510" name="__codelineno-0-2510" href="#__codelineno-0-2510"></a>            <span class="p">)</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pred_mean</span><span class="p">)</span>
<a id="__codelineno-0-2511" name="__codelineno-0-2511" href="#__codelineno-0-2511"></a>            <span class="n">nrmse</span> <span class="o">+=</span> <span class="n">i_nrmse</span>
<a id="__codelineno-0-2512" name="__codelineno-0-2512" href="#__codelineno-0-2512"></a>        <span class="n">nrmse_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nrmse</span><span class="p">)</span>
<a id="__codelineno-0-2513" name="__codelineno-0-2513" href="#__codelineno-0-2513"></a>
<a id="__codelineno-0-2514" name="__codelineno-0-2514" href="#__codelineno-0-2514"></a>    <span class="n">min_index</span> <span class="o">=</span> <span class="n">nrmse_all</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">nrmse_all</span><span class="p">))</span>
<a id="__codelineno-0-2515" name="__codelineno-0-2515" href="#__codelineno-0-2515"></a>    <span class="n">best_method</span> <span class="o">=</span> <span class="n">method_all</span><span class="p">[</span><span class="n">min_index</span><span class="p">]</span>
<a id="__codelineno-0-2516" name="__codelineno-0-2516" href="#__codelineno-0-2516"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">valid_methods</span><span class="p">[</span><span class="n">min_index</span><span class="p">]</span>
<a id="__codelineno-0-2517" name="__codelineno-0-2517" href="#__codelineno-0-2517"></a>
<a id="__codelineno-0-2518" name="__codelineno-0-2518" href="#__codelineno-0-2518"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-2519" name="__codelineno-0-2519" href="#__codelineno-0-2519"></a>        <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">method_all</span><span class="p">,</span> <span class="n">nrmse_all</span><span class="p">)))</span>
<a id="__codelineno-0-2520" name="__codelineno-0-2520" href="#__codelineno-0-2520"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best Imputation Method: &quot;</span><span class="p">,</span> <span class="n">best_method</span><span class="p">)</span>
<a id="__codelineno-0-2521" name="__codelineno-0-2521" href="#__codelineno-0-2521"></a>    <span class="k">return</span> <span class="n">odf</span>
<a id="__codelineno-0-2522" name="__codelineno-0-2522" href="#__codelineno-0-2522"></a>
<a id="__codelineno-0-2523" name="__codelineno-0-2523" href="#__codelineno-0-2523"></a>
<a id="__codelineno-0-2524" name="__codelineno-0-2524" href="#__codelineno-0-2524"></a><span class="k">def</span> <span class="nf">autoencoder_latentFeatures</span><span class="p">(</span>
<a id="__codelineno-0-2525" name="__codelineno-0-2525" href="#__codelineno-0-2525"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-2526" name="__codelineno-0-2526" href="#__codelineno-0-2526"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-2527" name="__codelineno-0-2527" href="#__codelineno-0-2527"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2528" name="__codelineno-0-2528" href="#__codelineno-0-2528"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-2529" name="__codelineno-0-2529" href="#__codelineno-0-2529"></a>    <span class="n">reduction_params</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-0-2530" name="__codelineno-0-2530" href="#__codelineno-0-2530"></a>    <span class="n">sample_size</span><span class="o">=</span><span class="mi">500000</span><span class="p">,</span>
<a id="__codelineno-0-2531" name="__codelineno-0-2531" href="#__codelineno-0-2531"></a>    <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-0-2532" name="__codelineno-0-2532" href="#__codelineno-0-2532"></a>    <span class="n">batch_size</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
<a id="__codelineno-0-2533" name="__codelineno-0-2533" href="#__codelineno-0-2533"></a>    <span class="n">pre_existing_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2534" name="__codelineno-0-2534" href="#__codelineno-0-2534"></a>    <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2535" name="__codelineno-0-2535" href="#__codelineno-0-2535"></a>    <span class="n">standardization</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-2536" name="__codelineno-0-2536" href="#__codelineno-0-2536"></a>    <span class="n">standardization_configs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pre_existing_model&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;model_path&quot;</span><span class="p">:</span> <span class="s2">&quot;NA&quot;</span><span class="p">},</span>
<a id="__codelineno-0-2537" name="__codelineno-0-2537" href="#__codelineno-0-2537"></a>    <span class="n">imputation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2538" name="__codelineno-0-2538" href="#__codelineno-0-2538"></a>    <span class="n">imputation_configs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;imputation_function&quot;</span><span class="p">:</span> <span class="s2">&quot;imputation_MMM&quot;</span><span class="p">},</span>
<a id="__codelineno-0-2539" name="__codelineno-0-2539" href="#__codelineno-0-2539"></a>    <span class="n">stats_missing</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-0-2540" name="__codelineno-0-2540" href="#__codelineno-0-2540"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2541" name="__codelineno-0-2541" href="#__codelineno-0-2541"></a>    <span class="n">run_type</span><span class="o">=</span><span class="s2">&quot;local&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2542" name="__codelineno-0-2542" href="#__codelineno-0-2542"></a>    <span class="n">root_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2543" name="__codelineno-0-2543" href="#__codelineno-0-2543"></a>    <span class="n">auth_key</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2544" name="__codelineno-0-2544" href="#__codelineno-0-2544"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2545" name="__codelineno-0-2545" href="#__codelineno-0-2545"></a><span class="p">):</span>
<a id="__codelineno-0-2546" name="__codelineno-0-2546" href="#__codelineno-0-2546"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2547" name="__codelineno-0-2547" href="#__codelineno-0-2547"></a><span class="sd">    Many machine learning models suffer from &quot;the curse of dimensionality&quot; when the number of features is too</span>
<a id="__codelineno-0-2548" name="__codelineno-0-2548" href="#__codelineno-0-2548"></a><span class="sd">    large. autoencoder_latentFeatures is able to reduce the dimensionality by compressing input attributes to a</span>
<a id="__codelineno-0-2549" name="__codelineno-0-2549" href="#__codelineno-0-2549"></a><span class="sd">    smaller number of latent features.</span>
<a id="__codelineno-0-2550" name="__codelineno-0-2550" href="#__codelineno-0-2550"></a>
<a id="__codelineno-0-2551" name="__codelineno-0-2551" href="#__codelineno-0-2551"></a><span class="sd">    To be more specific, it trains a neural network model using TensorFlow library. The neural network contains an</span>
<a id="__codelineno-0-2552" name="__codelineno-0-2552" href="#__codelineno-0-2552"></a><span class="sd">    encoder and a decoder, where the encoder learns to represent the input using smaller number of latent features</span>
<a id="__codelineno-0-2553" name="__codelineno-0-2553" href="#__codelineno-0-2553"></a><span class="sd">    controlled by the input *reduction_params* and the decoder learns to reproduce the input using the latent</span>
<a id="__codelineno-0-2554" name="__codelineno-0-2554" href="#__codelineno-0-2554"></a><span class="sd">    features. In the end, only the encoder will be kept and the latent features generated by the encoder will be</span>
<a id="__codelineno-0-2555" name="__codelineno-0-2555" href="#__codelineno-0-2555"></a><span class="sd">    added to the output dataframe.</span>
<a id="__codelineno-0-2556" name="__codelineno-0-2556" href="#__codelineno-0-2556"></a>
<a id="__codelineno-0-2557" name="__codelineno-0-2557" href="#__codelineno-0-2557"></a><span class="sd">    However, the neural network model is not trained in a scalable manner, which might not be able to handle large</span>
<a id="__codelineno-0-2558" name="__codelineno-0-2558" href="#__codelineno-0-2558"></a><span class="sd">    input dataframe. Thus, an input *sample_size* (the default value is 500,000) can be set to control the number of</span>
<a id="__codelineno-0-2559" name="__codelineno-0-2559" href="#__codelineno-0-2559"></a><span class="sd">    samples to be used to train the model. If the total number of samples exceeds *sample_size*, the rest of the</span>
<a id="__codelineno-0-2560" name="__codelineno-0-2560" href="#__codelineno-0-2560"></a><span class="sd">    samples will be predicted using the fitted encoder.</span>
<a id="__codelineno-0-2561" name="__codelineno-0-2561" href="#__codelineno-0-2561"></a>
<a id="__codelineno-0-2562" name="__codelineno-0-2562" href="#__codelineno-0-2562"></a><span class="sd">    Standardization is highly recommended if the input attributes are not of the same scale. Otherwise, the model</span>
<a id="__codelineno-0-2563" name="__codelineno-0-2563" href="#__codelineno-0-2563"></a><span class="sd">    might not converge smoothly. Inputs *standardization* and *standardization_configs* can be set accordingly to</span>
<a id="__codelineno-0-2564" name="__codelineno-0-2564" href="#__codelineno-0-2564"></a><span class="sd">    perform standardization within the function. In addition, if a sample contains missing values in the model input,</span>
<a id="__codelineno-0-2565" name="__codelineno-0-2565" href="#__codelineno-0-2565"></a><span class="sd">    the output values for its latent features will all be None. Thus data imputation is also recommended if missing</span>
<a id="__codelineno-0-2566" name="__codelineno-0-2566" href="#__codelineno-0-2566"></a><span class="sd">    values exist, which can be done within the function by setting inputs *imputation* and *imputation_configs*.</span>
<a id="__codelineno-0-2567" name="__codelineno-0-2567" href="#__codelineno-0-2567"></a>
<a id="__codelineno-0-2568" name="__codelineno-0-2568" href="#__codelineno-0-2568"></a>
<a id="__codelineno-0-2569" name="__codelineno-0-2569" href="#__codelineno-0-2569"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-2570" name="__codelineno-0-2570" href="#__codelineno-0-2570"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-2571" name="__codelineno-0-2571" href="#__codelineno-0-2571"></a><span class="sd">    spark</span>
<a id="__codelineno-0-2572" name="__codelineno-0-2572" href="#__codelineno-0-2572"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-0-2573" name="__codelineno-0-2573" href="#__codelineno-0-2573"></a><span class="sd">    idf</span>
<a id="__codelineno-0-2574" name="__codelineno-0-2574" href="#__codelineno-0-2574"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-2575" name="__codelineno-0-2575" href="#__codelineno-0-2575"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-0-2576" name="__codelineno-0-2576" href="#__codelineno-0-2576"></a><span class="sd">        List of numerical columns to encode e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-2577" name="__codelineno-0-2577" href="#__codelineno-0-2577"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-2578" name="__codelineno-0-2578" href="#__codelineno-0-2578"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-2579" name="__codelineno-0-2579" href="#__codelineno-0-2579"></a><span class="sd">        &quot;all&quot; can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-0-2580" name="__codelineno-0-2580" href="#__codelineno-0-2580"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-0-2581" name="__codelineno-0-2581" href="#__codelineno-0-2581"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-0-2582" name="__codelineno-0-2582" href="#__codelineno-0-2582"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-0-2583" name="__codelineno-0-2583" href="#__codelineno-0-2583"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-2584" name="__codelineno-0-2584" href="#__codelineno-0-2584"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-2585" name="__codelineno-0-2585" href="#__codelineno-0-2585"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-2586" name="__codelineno-0-2586" href="#__codelineno-0-2586"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-0-2587" name="__codelineno-0-2587" href="#__codelineno-0-2587"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-0-2588" name="__codelineno-0-2588" href="#__codelineno-0-2588"></a><span class="sd">    reduction_params</span>
<a id="__codelineno-0-2589" name="__codelineno-0-2589" href="#__codelineno-0-2589"></a><span class="sd">        Determines the number of encoded features in the result.</span>
<a id="__codelineno-0-2590" name="__codelineno-0-2590" href="#__codelineno-0-2590"></a><span class="sd">        If reduction_params &lt; 1, int(reduction_params * &lt;number of columns&gt;)</span>
<a id="__codelineno-0-2591" name="__codelineno-0-2591" href="#__codelineno-0-2591"></a><span class="sd">        columns will be generated. Else, reduction_params columns will be generated. (Default value = 0.5)</span>
<a id="__codelineno-0-2592" name="__codelineno-0-2592" href="#__codelineno-0-2592"></a><span class="sd">    sample_size</span>
<a id="__codelineno-0-2593" name="__codelineno-0-2593" href="#__codelineno-0-2593"></a><span class="sd">        Maximum rows for training the autoencoder model using tensorflow. (Default value = 500000)</span>
<a id="__codelineno-0-2594" name="__codelineno-0-2594" href="#__codelineno-0-2594"></a><span class="sd">    epochs</span>
<a id="__codelineno-0-2595" name="__codelineno-0-2595" href="#__codelineno-0-2595"></a><span class="sd">        Number of epochs to train the tensorflow model. (Default value = 100)</span>
<a id="__codelineno-0-2596" name="__codelineno-0-2596" href="#__codelineno-0-2596"></a><span class="sd">    batch_size</span>
<a id="__codelineno-0-2597" name="__codelineno-0-2597" href="#__codelineno-0-2597"></a><span class="sd">        Number of samples per gradient update when fitting the tensorflow model. (Default value = 256)</span>
<a id="__codelineno-0-2598" name="__codelineno-0-2598" href="#__codelineno-0-2598"></a><span class="sd">    pre_existing_model</span>
<a id="__codelineno-0-2599" name="__codelineno-0-2599" href="#__codelineno-0-2599"></a><span class="sd">        Boolean argument – True or False. True if model exists already, False Otherwise (Default value = False)</span>
<a id="__codelineno-0-2600" name="__codelineno-0-2600" href="#__codelineno-0-2600"></a><span class="sd">    model_path</span>
<a id="__codelineno-0-2601" name="__codelineno-0-2601" href="#__codelineno-0-2601"></a><span class="sd">        If pre_existing_model is True, this argument is path for referring the pre-saved model.</span>
<a id="__codelineno-0-2602" name="__codelineno-0-2602" href="#__codelineno-0-2602"></a><span class="sd">        If pre_existing_model is False, this argument can be used for saving the model.</span>
<a id="__codelineno-0-2603" name="__codelineno-0-2603" href="#__codelineno-0-2603"></a><span class="sd">        Default &quot;NA&quot; means there is neither pre-existing model nor there is a need to save one.</span>
<a id="__codelineno-0-2604" name="__codelineno-0-2604" href="#__codelineno-0-2604"></a><span class="sd">    standardization</span>
<a id="__codelineno-0-2605" name="__codelineno-0-2605" href="#__codelineno-0-2605"></a><span class="sd">        Boolean argument – True or False. True, if the standardization required. (Default value = True)</span>
<a id="__codelineno-0-2606" name="__codelineno-0-2606" href="#__codelineno-0-2606"></a><span class="sd">    standardization_configs</span>
<a id="__codelineno-0-2607" name="__codelineno-0-2607" href="#__codelineno-0-2607"></a><span class="sd">        z_standardization function arguments in dictionary format. (Default value = {&quot;pre_existing_model&quot;: False)</span>
<a id="__codelineno-0-2608" name="__codelineno-0-2608" href="#__codelineno-0-2608"></a><span class="sd">    imputation</span>
<a id="__codelineno-0-2609" name="__codelineno-0-2609" href="#__codelineno-0-2609"></a><span class="sd">        Boolean argument – True or False. True, if the imputation required. (Default value = False)</span>
<a id="__codelineno-0-2610" name="__codelineno-0-2610" href="#__codelineno-0-2610"></a><span class="sd">    imputation_configs</span>
<a id="__codelineno-0-2611" name="__codelineno-0-2611" href="#__codelineno-0-2611"></a><span class="sd">        Takes input in dictionary format.</span>
<a id="__codelineno-0-2612" name="__codelineno-0-2612" href="#__codelineno-0-2612"></a><span class="sd">        Imputation function name is provided with key &quot;imputation_name&quot;.</span>
<a id="__codelineno-0-2613" name="__codelineno-0-2613" href="#__codelineno-0-2613"></a><span class="sd">        optional arguments pertaining to that imputation function can be provided with argument name as key. (Default value = {&quot;imputation_function&quot;: &quot;imputation_MMM&quot;})</span>
<a id="__codelineno-0-2614" name="__codelineno-0-2614" href="#__codelineno-0-2614"></a><span class="sd">    stats_missing</span>
<a id="__codelineno-0-2615" name="__codelineno-0-2615" href="#__codelineno-0-2615"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-0-2616" name="__codelineno-0-2616" href="#__codelineno-0-2616"></a><span class="sd">        to read pre-saved statistics on missing count/pct i.e. if measures_of_counts or</span>
<a id="__codelineno-0-2617" name="__codelineno-0-2617" href="#__codelineno-0-2617"></a><span class="sd">        missingCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-0-2618" name="__codelineno-0-2618" href="#__codelineno-0-2618"></a><span class="sd">    output_mode</span>
<a id="__codelineno-0-2619" name="__codelineno-0-2619" href="#__codelineno-0-2619"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-0-2620" name="__codelineno-0-2620" href="#__codelineno-0-2620"></a><span class="sd">        “replace” option replaces original columns with transformed columns: latent_&lt;col_index&gt;.</span>
<a id="__codelineno-0-2621" name="__codelineno-0-2621" href="#__codelineno-0-2621"></a><span class="sd">        “append” option append transformed columns with format latent_&lt;col_index&gt; to the input dataset,</span>
<a id="__codelineno-0-2622" name="__codelineno-0-2622" href="#__codelineno-0-2622"></a><span class="sd">        e.g. latent_0, latent_1 will be appended if reduction_params=2. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-0-2623" name="__codelineno-0-2623" href="#__codelineno-0-2623"></a><span class="sd">    run_type</span>
<a id="__codelineno-0-2624" name="__codelineno-0-2624" href="#__codelineno-0-2624"></a><span class="sd">        &quot;local&quot;, &quot;emr&quot;, &quot;databricks&quot;, &quot;ak8s&quot; (Default value = &quot;local&quot;)</span>
<a id="__codelineno-0-2625" name="__codelineno-0-2625" href="#__codelineno-0-2625"></a><span class="sd">    root_path</span>
<a id="__codelineno-0-2626" name="__codelineno-0-2626" href="#__codelineno-0-2626"></a><span class="sd">        This argument takes in a base folder path for writing out intermediate_data/ folder to. Default value is &quot;&quot;</span>
<a id="__codelineno-0-2627" name="__codelineno-0-2627" href="#__codelineno-0-2627"></a><span class="sd">    auth_key</span>
<a id="__codelineno-0-2628" name="__codelineno-0-2628" href="#__codelineno-0-2628"></a><span class="sd">        Option to pass an authorization key to write to filesystems. Currently applicable only for ak8s run_type. Default value is kept as &quot;NA&quot;</span>
<a id="__codelineno-0-2629" name="__codelineno-0-2629" href="#__codelineno-0-2629"></a><span class="sd">    print_impact</span>
<a id="__codelineno-0-2630" name="__codelineno-0-2630" href="#__codelineno-0-2630"></a><span class="sd">        True, False</span>
<a id="__codelineno-0-2631" name="__codelineno-0-2631" href="#__codelineno-0-2631"></a><span class="sd">        This argument is to print descriptive statistics of the latest features (Default value = False)</span>
<a id="__codelineno-0-2632" name="__codelineno-0-2632" href="#__codelineno-0-2632"></a>
<a id="__codelineno-0-2633" name="__codelineno-0-2633" href="#__codelineno-0-2633"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-2634" name="__codelineno-0-2634" href="#__codelineno-0-2634"></a><span class="sd">    -------</span>
<a id="__codelineno-0-2635" name="__codelineno-0-2635" href="#__codelineno-0-2635"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-0-2636" name="__codelineno-0-2636" href="#__codelineno-0-2636"></a><span class="sd">        Dataframe with Latent Features</span>
<a id="__codelineno-0-2637" name="__codelineno-0-2637" href="#__codelineno-0-2637"></a>
<a id="__codelineno-0-2638" name="__codelineno-0-2638" href="#__codelineno-0-2638"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-2639" name="__codelineno-0-2639" href="#__codelineno-0-2639"></a>    <span class="k">if</span> <span class="s2">&quot;arm64&quot;</span> <span class="ow">in</span> <span class="n">platform</span><span class="o">.</span><span class="n">version</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
<a id="__codelineno-0-2640" name="__codelineno-0-2640" href="#__codelineno-0-2640"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-2641" name="__codelineno-0-2641" href="#__codelineno-0-2641"></a>            <span class="s2">&quot;This function is currently not supported for ARM64 - Mac M1 Machine&quot;</span>
<a id="__codelineno-0-2642" name="__codelineno-0-2642" href="#__codelineno-0-2642"></a>        <span class="p">)</span>
<a id="__codelineno-0-2643" name="__codelineno-0-2643" href="#__codelineno-0-2643"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-0-2644" name="__codelineno-0-2644" href="#__codelineno-0-2644"></a>
<a id="__codelineno-0-2645" name="__codelineno-0-2645" href="#__codelineno-0-2645"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-2646" name="__codelineno-0-2646" href="#__codelineno-0-2646"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2647" name="__codelineno-0-2647" href="#__codelineno-0-2647"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-0-2648" name="__codelineno-0-2648" href="#__codelineno-0-2648"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-2649" name="__codelineno-0-2649" href="#__codelineno-0-2649"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-2650" name="__codelineno-0-2650" href="#__codelineno-0-2650"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-2651" name="__codelineno-0-2651" href="#__codelineno-0-2651"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-2652" name="__codelineno-0-2652" href="#__codelineno-0-2652"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-0-2653" name="__codelineno-0-2653" href="#__codelineno-0-2653"></a>
<a id="__codelineno-0-2654" name="__codelineno-0-2654" href="#__codelineno-0-2654"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-2655" name="__codelineno-0-2655" href="#__codelineno-0-2655"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2656" name="__codelineno-0-2656" href="#__codelineno-0-2656"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-2657" name="__codelineno-0-2657" href="#__codelineno-0-2657"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No Latent Features Generated - No Column(s) to Transform&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2658" name="__codelineno-0-2658" href="#__codelineno-0-2658"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-0-2659" name="__codelineno-0-2659" href="#__codelineno-0-2659"></a>
<a id="__codelineno-0-2660" name="__codelineno-0-2660" href="#__codelineno-0-2660"></a>    <span class="k">if</span> <span class="n">stats_missing</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-0-2661" name="__codelineno-0-2661" href="#__codelineno-0-2661"></a>        <span class="n">missing_df</span> <span class="o">=</span> <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-0-2662" name="__codelineno-0-2662" href="#__codelineno-0-2662"></a>        <span class="n">missing_df</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span>
<a id="__codelineno-0-2663" name="__codelineno-0-2663" href="#__codelineno-0-2663"></a>            <span class="n">root_path</span>
<a id="__codelineno-0-2664" name="__codelineno-0-2664" href="#__codelineno-0-2664"></a>            <span class="o">+</span> <span class="s2">&quot;intermediate_data/autoencoder_latentFeatures/missingCount_computation&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2665" name="__codelineno-0-2665" href="#__codelineno-0-2665"></a>            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2666" name="__codelineno-0-2666" href="#__codelineno-0-2666"></a>        <span class="p">)</span>
<a id="__codelineno-0-2667" name="__codelineno-0-2667" href="#__codelineno-0-2667"></a>        <span class="n">stats_missing</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-2668" name="__codelineno-0-2668" href="#__codelineno-0-2668"></a>            <span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="n">root_path</span>
<a id="__codelineno-0-2669" name="__codelineno-0-2669" href="#__codelineno-0-2669"></a>            <span class="o">+</span> <span class="s2">&quot;intermediate_data/autoencoder_latentFeatures/missingCount_computation&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2670" name="__codelineno-0-2670" href="#__codelineno-0-2670"></a>            <span class="s2">&quot;file_type&quot;</span><span class="p">:</span> <span class="s2">&quot;parquet&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2671" name="__codelineno-0-2671" href="#__codelineno-0-2671"></a>        <span class="p">}</span>
<a id="__codelineno-0-2672" name="__codelineno-0-2672" href="#__codelineno-0-2672"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2673" name="__codelineno-0-2673" href="#__codelineno-0-2673"></a>        <span class="n">missing_df</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2674" name="__codelineno-0-2674" href="#__codelineno-0-2674"></a>            <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_missing</span><span class="p">)</span>
<a id="__codelineno-0-2675" name="__codelineno-0-2675" href="#__codelineno-0-2675"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_count&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2676" name="__codelineno-0-2676" href="#__codelineno-0-2676"></a>            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-0-2677" name="__codelineno-0-2677" href="#__codelineno-0-2677"></a>        <span class="p">)</span>
<a id="__codelineno-0-2678" name="__codelineno-0-2678" href="#__codelineno-0-2678"></a>
<a id="__codelineno-0-2679" name="__codelineno-0-2679" href="#__codelineno-0-2679"></a>    <span class="n">empty_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2680" name="__codelineno-0-2680" href="#__codelineno-0-2680"></a>        <span class="n">missing_df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-0-2681" name="__codelineno-0-2681" href="#__codelineno-0-2681"></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2682" name="__codelineno-0-2682" href="#__codelineno-0-2682"></a>        <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-2683" name="__codelineno-0-2683" href="#__codelineno-0-2683"></a>        <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-2684" name="__codelineno-0-2684" href="#__codelineno-0-2684"></a>    <span class="p">)</span>
<a id="__codelineno-0-2685" name="__codelineno-0-2685" href="#__codelineno-0-2685"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">empty_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-2686" name="__codelineno-0-2686" href="#__codelineno-0-2686"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-2687" name="__codelineno-0-2687" href="#__codelineno-0-2687"></a>            <span class="s2">&quot;The following column(s) are excluded from dimensionality reduction as all values are null: &quot;</span>
<a id="__codelineno-0-2688" name="__codelineno-0-2688" href="#__codelineno-0-2688"></a>            <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">empty_cols</span><span class="p">)</span>
<a id="__codelineno-0-2689" name="__codelineno-0-2689" href="#__codelineno-0-2689"></a>        <span class="p">)</span>
<a id="__codelineno-0-2690" name="__codelineno-0-2690" href="#__codelineno-0-2690"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">empty_cols</span><span class="p">]</span>
<a id="__codelineno-0-2691" name="__codelineno-0-2691" href="#__codelineno-0-2691"></a>
<a id="__codelineno-0-2692" name="__codelineno-0-2692" href="#__codelineno-0-2692"></a>    <span class="k">if</span> <span class="n">standardization</span><span class="p">:</span>
<a id="__codelineno-0-2693" name="__codelineno-0-2693" href="#__codelineno-0-2693"></a>        <span class="n">idf_standardized</span> <span class="o">=</span> <span class="n">z_standardization</span><span class="p">(</span>
<a id="__codelineno-0-2694" name="__codelineno-0-2694" href="#__codelineno-0-2694"></a>            <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-2695" name="__codelineno-0-2695" href="#__codelineno-0-2695"></a>            <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-2696" name="__codelineno-0-2696" href="#__codelineno-0-2696"></a>            <span class="n">list_of_cols</span><span class="o">=</span><span class="n">list_of_cols</span><span class="p">,</span>
<a id="__codelineno-0-2697" name="__codelineno-0-2697" href="#__codelineno-0-2697"></a>            <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2698" name="__codelineno-0-2698" href="#__codelineno-0-2698"></a>            <span class="o">**</span><span class="n">standardization_configs</span><span class="p">,</span>
<a id="__codelineno-0-2699" name="__codelineno-0-2699" href="#__codelineno-0-2699"></a>        <span class="p">)</span>
<a id="__codelineno-0-2700" name="__codelineno-0-2700" href="#__codelineno-0-2700"></a>        <span class="n">list_of_cols_scaled</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-2701" name="__codelineno-0-2701" href="#__codelineno-0-2701"></a>            <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span>
<a id="__codelineno-0-2702" name="__codelineno-0-2702" href="#__codelineno-0-2702"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span>
<a id="__codelineno-0-2703" name="__codelineno-0-2703" href="#__codelineno-0-2703"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">idf_standardized</span><span class="o">.</span><span class="n">columns</span>
<a id="__codelineno-0-2704" name="__codelineno-0-2704" href="#__codelineno-0-2704"></a>        <span class="p">]</span>
<a id="__codelineno-0-2705" name="__codelineno-0-2705" href="#__codelineno-0-2705"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2706" name="__codelineno-0-2706" href="#__codelineno-0-2706"></a>        <span class="n">idf_standardized</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-2707" name="__codelineno-0-2707" href="#__codelineno-0-2707"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-2708" name="__codelineno-0-2708" href="#__codelineno-0-2708"></a>            <span class="n">idf_standardized</span> <span class="o">=</span> <span class="n">idf_standardized</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a id="__codelineno-0-2709" name="__codelineno-0-2709" href="#__codelineno-0-2709"></a>            <span class="n">list_of_cols_scaled</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">]</span>
<a id="__codelineno-0-2710" name="__codelineno-0-2710" href="#__codelineno-0-2710"></a>
<a id="__codelineno-0-2711" name="__codelineno-0-2711" href="#__codelineno-0-2711"></a>    <span class="k">if</span> <span class="n">imputation</span><span class="p">:</span>
<a id="__codelineno-0-2712" name="__codelineno-0-2712" href="#__codelineno-0-2712"></a>        <span class="n">all_functions</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-2713" name="__codelineno-0-2713" href="#__codelineno-0-2713"></a>        <span class="n">all_functions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">locals</span><span class="p">())</span>
<a id="__codelineno-0-2714" name="__codelineno-0-2714" href="#__codelineno-0-2714"></a>        <span class="n">f</span> <span class="o">=</span> <span class="n">all_functions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">imputation_configs</span><span class="p">[</span><span class="s2">&quot;imputation_function&quot;</span><span class="p">])</span>
<a id="__codelineno-0-2715" name="__codelineno-0-2715" href="#__codelineno-0-2715"></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">imputation_configs</span><span class="p">)</span>
<a id="__codelineno-0-2716" name="__codelineno-0-2716" href="#__codelineno-0-2716"></a>        <span class="n">args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;imputation_function&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-2717" name="__codelineno-0-2717" href="#__codelineno-0-2717"></a>        <span class="n">missing_df_scaled</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2718" name="__codelineno-0-2718" href="#__codelineno-0-2718"></a>            <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_missing</span><span class="p">)</span>
<a id="__codelineno-0-2719" name="__codelineno-0-2719" href="#__codelineno-0-2719"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_count&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2720" name="__codelineno-0-2720" href="#__codelineno-0-2720"></a>            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&quot;_scaled&quot;</span><span class="p">)))</span>
<a id="__codelineno-0-2721" name="__codelineno-0-2721" href="#__codelineno-0-2721"></a>        <span class="p">)</span>
<a id="__codelineno-0-2722" name="__codelineno-0-2722" href="#__codelineno-0-2722"></a>        <span class="n">missing_df_scaled</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span>
<a id="__codelineno-0-2723" name="__codelineno-0-2723" href="#__codelineno-0-2723"></a>            <span class="n">root_path</span>
<a id="__codelineno-0-2724" name="__codelineno-0-2724" href="#__codelineno-0-2724"></a>            <span class="o">+</span> <span class="s2">&quot;intermediate_data/autoencoder_latentFeatures/missingCount_computation_scaled&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2725" name="__codelineno-0-2725" href="#__codelineno-0-2725"></a>            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2726" name="__codelineno-0-2726" href="#__codelineno-0-2726"></a>        <span class="p">)</span>
<a id="__codelineno-0-2727" name="__codelineno-0-2727" href="#__codelineno-0-2727"></a>        <span class="n">stats_missing_scaled</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-2728" name="__codelineno-0-2728" href="#__codelineno-0-2728"></a>            <span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="n">root_path</span>
<a id="__codelineno-0-2729" name="__codelineno-0-2729" href="#__codelineno-0-2729"></a>            <span class="o">+</span> <span class="s2">&quot;intermediate_data/autoencoder_latentFeatures/missingCount_computation_scaled&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2730" name="__codelineno-0-2730" href="#__codelineno-0-2730"></a>            <span class="s2">&quot;file_type&quot;</span><span class="p">:</span> <span class="s2">&quot;parquet&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2731" name="__codelineno-0-2731" href="#__codelineno-0-2731"></a>        <span class="p">}</span>
<a id="__codelineno-0-2732" name="__codelineno-0-2732" href="#__codelineno-0-2732"></a>        <span class="n">idf_imputed</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span>
<a id="__codelineno-0-2733" name="__codelineno-0-2733" href="#__codelineno-0-2733"></a>            <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-2734" name="__codelineno-0-2734" href="#__codelineno-0-2734"></a>            <span class="n">idf_standardized</span><span class="p">,</span>
<a id="__codelineno-0-2735" name="__codelineno-0-2735" href="#__codelineno-0-2735"></a>            <span class="n">list_of_cols_scaled</span><span class="p">,</span>
<a id="__codelineno-0-2736" name="__codelineno-0-2736" href="#__codelineno-0-2736"></a>            <span class="n">stats_missing</span><span class="o">=</span><span class="n">stats_missing_scaled</span><span class="p">,</span>
<a id="__codelineno-0-2737" name="__codelineno-0-2737" href="#__codelineno-0-2737"></a>            <span class="o">**</span><span class="n">args</span><span class="p">,</span>
<a id="__codelineno-0-2738" name="__codelineno-0-2738" href="#__codelineno-0-2738"></a>        <span class="p">)</span>
<a id="__codelineno-0-2739" name="__codelineno-0-2739" href="#__codelineno-0-2739"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2740" name="__codelineno-0-2740" href="#__codelineno-0-2740"></a>        <span class="n">idf_imputed</span> <span class="o">=</span> <span class="n">idf_standardized</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">list_of_cols_scaled</span><span class="p">)</span>
<a id="__codelineno-0-2741" name="__codelineno-0-2741" href="#__codelineno-0-2741"></a>
<a id="__codelineno-0-2742" name="__codelineno-0-2742" href="#__codelineno-0-2742"></a>    <span class="n">n_inputs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols_scaled</span><span class="p">)</span>
<a id="__codelineno-0-2743" name="__codelineno-0-2743" href="#__codelineno-0-2743"></a>    <span class="k">if</span> <span class="n">reduction_params</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-2744" name="__codelineno-0-2744" href="#__codelineno-0-2744"></a>        <span class="n">n_bottleneck</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">reduction_params</span> <span class="o">*</span> <span class="n">n_inputs</span><span class="p">)</span>
<a id="__codelineno-0-2745" name="__codelineno-0-2745" href="#__codelineno-0-2745"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2746" name="__codelineno-0-2746" href="#__codelineno-0-2746"></a>        <span class="n">n_bottleneck</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">reduction_params</span><span class="p">)</span>
<a id="__codelineno-0-2747" name="__codelineno-0-2747" href="#__codelineno-0-2747"></a>
<a id="__codelineno-0-2748" name="__codelineno-0-2748" href="#__codelineno-0-2748"></a>    <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-0-2749" name="__codelineno-0-2749" href="#__codelineno-0-2749"></a>        <span class="k">if</span> <span class="n">run_type</span> <span class="o">==</span> <span class="s2">&quot;emr&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2750" name="__codelineno-0-2750" href="#__codelineno-0-2750"></a>            <span class="n">bash_cmd</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2751" name="__codelineno-0-2751" href="#__codelineno-0-2751"></a>                <span class="s2">&quot;aws s3 cp &quot;</span> <span class="o">+</span> <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/encoder.h5 .&quot;</span>
<a id="__codelineno-0-2752" name="__codelineno-0-2752" href="#__codelineno-0-2752"></a>            <span class="p">)</span>
<a id="__codelineno-0-2753" name="__codelineno-0-2753" href="#__codelineno-0-2753"></a>            <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">bash_cmd</span><span class="p">])</span>
<a id="__codelineno-0-2754" name="__codelineno-0-2754" href="#__codelineno-0-2754"></a>            <span class="n">bash_cmd</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2755" name="__codelineno-0-2755" href="#__codelineno-0-2755"></a>                <span class="s2">&quot;aws s3 cp &quot;</span> <span class="o">+</span> <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/model.h5 .&quot;</span>
<a id="__codelineno-0-2756" name="__codelineno-0-2756" href="#__codelineno-0-2756"></a>            <span class="p">)</span>
<a id="__codelineno-0-2757" name="__codelineno-0-2757" href="#__codelineno-0-2757"></a>            <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">bash_cmd</span><span class="p">])</span>
<a id="__codelineno-0-2758" name="__codelineno-0-2758" href="#__codelineno-0-2758"></a>            <span class="n">encoder</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;encoder.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2759" name="__codelineno-0-2759" href="#__codelineno-0-2759"></a>            <span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;model.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2760" name="__codelineno-0-2760" href="#__codelineno-0-2760"></a>        <span class="k">elif</span> <span class="n">run_type</span> <span class="o">==</span> <span class="s2">&quot;ak8s&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2761" name="__codelineno-0-2761" href="#__codelineno-0-2761"></a>            <span class="n">bash_cmd</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2762" name="__codelineno-0-2762" href="#__codelineno-0-2762"></a>                <span class="s1">&#39;azcopy cp &quot;&#39;</span>
<a id="__codelineno-0-2763" name="__codelineno-0-2763" href="#__codelineno-0-2763"></a>                <span class="o">+</span> <span class="n">model_path</span>
<a id="__codelineno-0-2764" name="__codelineno-0-2764" href="#__codelineno-0-2764"></a>                <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/encoder.h5&quot;</span>
<a id="__codelineno-0-2765" name="__codelineno-0-2765" href="#__codelineno-0-2765"></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">auth_key</span><span class="p">)</span>
<a id="__codelineno-0-2766" name="__codelineno-0-2766" href="#__codelineno-0-2766"></a>                <span class="o">+</span> <span class="s1">&#39;&quot; .&#39;</span>
<a id="__codelineno-0-2767" name="__codelineno-0-2767" href="#__codelineno-0-2767"></a>            <span class="p">)</span>
<a id="__codelineno-0-2768" name="__codelineno-0-2768" href="#__codelineno-0-2768"></a>            <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">bash_cmd</span><span class="p">])</span>
<a id="__codelineno-0-2769" name="__codelineno-0-2769" href="#__codelineno-0-2769"></a>            <span class="n">bash_cmd</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2770" name="__codelineno-0-2770" href="#__codelineno-0-2770"></a>                <span class="s1">&#39;azcopy cp &quot;&#39;</span>
<a id="__codelineno-0-2771" name="__codelineno-0-2771" href="#__codelineno-0-2771"></a>                <span class="o">+</span> <span class="n">model_path</span>
<a id="__codelineno-0-2772" name="__codelineno-0-2772" href="#__codelineno-0-2772"></a>                <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/model.h5&quot;</span>
<a id="__codelineno-0-2773" name="__codelineno-0-2773" href="#__codelineno-0-2773"></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">auth_key</span><span class="p">)</span>
<a id="__codelineno-0-2774" name="__codelineno-0-2774" href="#__codelineno-0-2774"></a>                <span class="o">+</span> <span class="s1">&#39;&quot; .&#39;</span>
<a id="__codelineno-0-2775" name="__codelineno-0-2775" href="#__codelineno-0-2775"></a>            <span class="p">)</span>
<a id="__codelineno-0-2776" name="__codelineno-0-2776" href="#__codelineno-0-2776"></a>            <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">bash_cmd</span><span class="p">])</span>
<a id="__codelineno-0-2777" name="__codelineno-0-2777" href="#__codelineno-0-2777"></a>            <span class="n">encoder</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;encoder.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2778" name="__codelineno-0-2778" href="#__codelineno-0-2778"></a>            <span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;model.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2779" name="__codelineno-0-2779" href="#__codelineno-0-2779"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2780" name="__codelineno-0-2780" href="#__codelineno-0-2780"></a>            <span class="n">encoder</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/encoder.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2781" name="__codelineno-0-2781" href="#__codelineno-0-2781"></a>            <span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/model.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2782" name="__codelineno-0-2782" href="#__codelineno-0-2782"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2783" name="__codelineno-0-2783" href="#__codelineno-0-2783"></a>        <span class="n">idf_valid</span> <span class="o">=</span> <span class="n">idf_imputed</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols_scaled</span><span class="p">)</span>
<a id="__codelineno-0-2784" name="__codelineno-0-2784" href="#__codelineno-0-2784"></a>        <span class="n">idf_model</span> <span class="o">=</span> <span class="n">idf_valid</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
<a id="__codelineno-0-2785" name="__codelineno-0-2785" href="#__codelineno-0-2785"></a>            <span class="kc">False</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">sample_size</span><span class="p">)</span> <span class="o">/</span> <span class="n">idf_valid</span><span class="o">.</span><span class="n">count</span><span class="p">()),</span> <span class="mi">0</span>
<a id="__codelineno-0-2786" name="__codelineno-0-2786" href="#__codelineno-0-2786"></a>        <span class="p">)</span>
<a id="__codelineno-0-2787" name="__codelineno-0-2787" href="#__codelineno-0-2787"></a>
<a id="__codelineno-0-2788" name="__codelineno-0-2788" href="#__codelineno-0-2788"></a>        <span class="n">idf_train</span> <span class="o">=</span> <span class="n">idf_model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-2789" name="__codelineno-0-2789" href="#__codelineno-0-2789"></a>        <span class="n">idf_test</span> <span class="o">=</span> <span class="n">idf_model</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">idf_train</span><span class="p">)</span>
<a id="__codelineno-0-2790" name="__codelineno-0-2790" href="#__codelineno-0-2790"></a>        <span class="n">X_train</span> <span class="o">=</span> <span class="n">idf_train</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<a id="__codelineno-0-2791" name="__codelineno-0-2791" href="#__codelineno-0-2791"></a>        <span class="n">X_test</span> <span class="o">=</span> <span class="n">idf_test</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<a id="__codelineno-0-2792" name="__codelineno-0-2792" href="#__codelineno-0-2792"></a>
<a id="__codelineno-0-2793" name="__codelineno-0-2793" href="#__codelineno-0-2793"></a>        <span class="n">visible</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_inputs</span><span class="p">,))</span>
<a id="__codelineno-0-2794" name="__codelineno-0-2794" href="#__codelineno-0-2794"></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">n_inputs</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)(</span><span class="n">visible</span><span class="p">)</span>
<a id="__codelineno-0-2795" name="__codelineno-0-2795" href="#__codelineno-0-2795"></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">()(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-2796" name="__codelineno-0-2796" href="#__codelineno-0-2796"></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">LeakyReLU</span><span class="p">()(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-2797" name="__codelineno-0-2797" href="#__codelineno-0-2797"></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">n_inputs</span><span class="p">)(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-2798" name="__codelineno-0-2798" href="#__codelineno-0-2798"></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">()(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-2799" name="__codelineno-0-2799" href="#__codelineno-0-2799"></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">LeakyReLU</span><span class="p">()(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-2800" name="__codelineno-0-2800" href="#__codelineno-0-2800"></a>        <span class="n">bottleneck</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">n_bottleneck</span><span class="p">)(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-2801" name="__codelineno-0-2801" href="#__codelineno-0-2801"></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">n_inputs</span><span class="p">)(</span><span class="n">bottleneck</span><span class="p">)</span>
<a id="__codelineno-0-2802" name="__codelineno-0-2802" href="#__codelineno-0-2802"></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">()(</span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-0-2803" name="__codelineno-0-2803" href="#__codelineno-0-2803"></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">LeakyReLU</span><span class="p">()(</span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-0-2804" name="__codelineno-0-2804" href="#__codelineno-0-2804"></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">n_inputs</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)(</span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-0-2805" name="__codelineno-0-2805" href="#__codelineno-0-2805"></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">()(</span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-0-2806" name="__codelineno-0-2806" href="#__codelineno-0-2806"></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">LeakyReLU</span><span class="p">()(</span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-0-2807" name="__codelineno-0-2807" href="#__codelineno-0-2807"></a>        <span class="n">output</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">n_inputs</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)(</span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-0-2808" name="__codelineno-0-2808" href="#__codelineno-0-2808"></a>
<a id="__codelineno-0-2809" name="__codelineno-0-2809" href="#__codelineno-0-2809"></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">visible</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
<a id="__codelineno-0-2810" name="__codelineno-0-2810" href="#__codelineno-0-2810"></a>        <span class="n">encoder</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">visible</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">bottleneck</span><span class="p">)</span>
<a id="__codelineno-0-2811" name="__codelineno-0-2811" href="#__codelineno-0-2811"></a>        <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;adam&quot;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s2">&quot;mse&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2812" name="__codelineno-0-2812" href="#__codelineno-0-2812"></a>        <span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
<a id="__codelineno-0-2813" name="__codelineno-0-2813" href="#__codelineno-0-2813"></a>            <span class="n">X_train</span><span class="p">,</span>
<a id="__codelineno-0-2814" name="__codelineno-0-2814" href="#__codelineno-0-2814"></a>            <span class="n">X_train</span><span class="p">,</span>
<a id="__codelineno-0-2815" name="__codelineno-0-2815" href="#__codelineno-0-2815"></a>            <span class="n">epochs</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">epochs</span><span class="p">),</span>
<a id="__codelineno-0-2816" name="__codelineno-0-2816" href="#__codelineno-0-2816"></a>            <span class="n">batch_size</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">batch_size</span><span class="p">),</span>
<a id="__codelineno-0-2817" name="__codelineno-0-2817" href="#__codelineno-0-2817"></a>            <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-2818" name="__codelineno-0-2818" href="#__codelineno-0-2818"></a>            <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">X_test</span><span class="p">),</span>
<a id="__codelineno-0-2819" name="__codelineno-0-2819" href="#__codelineno-0-2819"></a>        <span class="p">)</span>
<a id="__codelineno-0-2820" name="__codelineno-0-2820" href="#__codelineno-0-2820"></a>
<a id="__codelineno-0-2821" name="__codelineno-0-2821" href="#__codelineno-0-2821"></a>        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pre_existing_model</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">):</span>
<a id="__codelineno-0-2822" name="__codelineno-0-2822" href="#__codelineno-0-2822"></a>            <span class="k">if</span> <span class="n">run_type</span> <span class="o">==</span> <span class="s2">&quot;emr&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2823" name="__codelineno-0-2823" href="#__codelineno-0-2823"></a>                <span class="n">encoder</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;encoder.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2824" name="__codelineno-0-2824" href="#__codelineno-0-2824"></a>                <span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;model.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2825" name="__codelineno-0-2825" href="#__codelineno-0-2825"></a>                <span class="n">bash_cmd</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2826" name="__codelineno-0-2826" href="#__codelineno-0-2826"></a>                    <span class="s2">&quot;aws s3 cp encoder.h5 &quot;</span>
<a id="__codelineno-0-2827" name="__codelineno-0-2827" href="#__codelineno-0-2827"></a>                    <span class="o">+</span> <span class="n">model_path</span>
<a id="__codelineno-0-2828" name="__codelineno-0-2828" href="#__codelineno-0-2828"></a>                    <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/encoder.h5&quot;</span>
<a id="__codelineno-0-2829" name="__codelineno-0-2829" href="#__codelineno-0-2829"></a>                <span class="p">)</span>
<a id="__codelineno-0-2830" name="__codelineno-0-2830" href="#__codelineno-0-2830"></a>                <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">bash_cmd</span><span class="p">])</span>
<a id="__codelineno-0-2831" name="__codelineno-0-2831" href="#__codelineno-0-2831"></a>                <span class="n">bash_cmd</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2832" name="__codelineno-0-2832" href="#__codelineno-0-2832"></a>                    <span class="s2">&quot;aws s3 cp model.h5 &quot;</span>
<a id="__codelineno-0-2833" name="__codelineno-0-2833" href="#__codelineno-0-2833"></a>                    <span class="o">+</span> <span class="n">model_path</span>
<a id="__codelineno-0-2834" name="__codelineno-0-2834" href="#__codelineno-0-2834"></a>                    <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/model.h5&quot;</span>
<a id="__codelineno-0-2835" name="__codelineno-0-2835" href="#__codelineno-0-2835"></a>                <span class="p">)</span>
<a id="__codelineno-0-2836" name="__codelineno-0-2836" href="#__codelineno-0-2836"></a>                <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">bash_cmd</span><span class="p">])</span>
<a id="__codelineno-0-2837" name="__codelineno-0-2837" href="#__codelineno-0-2837"></a>            <span class="k">elif</span> <span class="n">run_type</span> <span class="o">==</span> <span class="s2">&quot;ak8s&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2838" name="__codelineno-0-2838" href="#__codelineno-0-2838"></a>                <span class="n">encoder</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;encoder.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2839" name="__codelineno-0-2839" href="#__codelineno-0-2839"></a>                <span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;model.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2840" name="__codelineno-0-2840" href="#__codelineno-0-2840"></a>                <span class="n">bash_cmd</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2841" name="__codelineno-0-2841" href="#__codelineno-0-2841"></a>                    <span class="s1">&#39;azcopy cp &quot;encoder.h5&quot; &quot;&#39;</span>
<a id="__codelineno-0-2842" name="__codelineno-0-2842" href="#__codelineno-0-2842"></a>                    <span class="o">+</span> <span class="n">model_path</span>
<a id="__codelineno-0-2843" name="__codelineno-0-2843" href="#__codelineno-0-2843"></a>                    <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/encoder.h5&quot;</span>
<a id="__codelineno-0-2844" name="__codelineno-0-2844" href="#__codelineno-0-2844"></a>                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">auth_key</span><span class="p">)</span>
<a id="__codelineno-0-2845" name="__codelineno-0-2845" href="#__codelineno-0-2845"></a>                    <span class="o">+</span> <span class="s1">&#39;&quot; &#39;</span>
<a id="__codelineno-0-2846" name="__codelineno-0-2846" href="#__codelineno-0-2846"></a>                <span class="p">)</span>
<a id="__codelineno-0-2847" name="__codelineno-0-2847" href="#__codelineno-0-2847"></a>                <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">bash_cmd</span><span class="p">])</span>
<a id="__codelineno-0-2848" name="__codelineno-0-2848" href="#__codelineno-0-2848"></a>                <span class="n">bash_cmd</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2849" name="__codelineno-0-2849" href="#__codelineno-0-2849"></a>                    <span class="s1">&#39;azcopy cp &quot;model.h5&quot; &quot;&#39;</span>
<a id="__codelineno-0-2850" name="__codelineno-0-2850" href="#__codelineno-0-2850"></a>                    <span class="o">+</span> <span class="n">model_path</span>
<a id="__codelineno-0-2851" name="__codelineno-0-2851" href="#__codelineno-0-2851"></a>                    <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/model.h5&quot;</span>
<a id="__codelineno-0-2852" name="__codelineno-0-2852" href="#__codelineno-0-2852"></a>                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">auth_key</span><span class="p">)</span>
<a id="__codelineno-0-2853" name="__codelineno-0-2853" href="#__codelineno-0-2853"></a>                    <span class="o">+</span> <span class="s1">&#39;&quot; &#39;</span>
<a id="__codelineno-0-2854" name="__codelineno-0-2854" href="#__codelineno-0-2854"></a>                <span class="p">)</span>
<a id="__codelineno-0-2855" name="__codelineno-0-2855" href="#__codelineno-0-2855"></a>                <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">bash_cmd</span><span class="p">])</span>
<a id="__codelineno-0-2856" name="__codelineno-0-2856" href="#__codelineno-0-2856"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2857" name="__codelineno-0-2857" href="#__codelineno-0-2857"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/&quot;</span><span class="p">):</span>
<a id="__codelineno-0-2858" name="__codelineno-0-2858" href="#__codelineno-0-2858"></a>                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2859" name="__codelineno-0-2859" href="#__codelineno-0-2859"></a>                <span class="n">encoder</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/encoder.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2860" name="__codelineno-0-2860" href="#__codelineno-0-2860"></a>                <span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/model.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2861" name="__codelineno-0-2861" href="#__codelineno-0-2861"></a>
<a id="__codelineno-0-2862" name="__codelineno-0-2862" href="#__codelineno-0-2862"></a>    <span class="k">class</span> <span class="nc">ModelWrapperPickable</span><span class="p">:</span>
<a id="__codelineno-0-2863" name="__codelineno-0-2863" href="#__codelineno-0-2863"></a>        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
<a id="__codelineno-0-2864" name="__codelineno-0-2864" href="#__codelineno-0-2864"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
<a id="__codelineno-0-2865" name="__codelineno-0-2865" href="#__codelineno-0-2865"></a>
<a id="__codelineno-0-2866" name="__codelineno-0-2866" href="#__codelineno-0-2866"></a>        <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-2867" name="__codelineno-0-2867" href="#__codelineno-0-2867"></a>            <span class="n">model_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-2868" name="__codelineno-0-2868" href="#__codelineno-0-2868"></a>            <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.hdf5&quot;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
<a id="__codelineno-0-2869" name="__codelineno-0-2869" href="#__codelineno-0-2869"></a>                <span class="n">tensorflow</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">fd</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-2870" name="__codelineno-0-2870" href="#__codelineno-0-2870"></a>                <span class="n">model_str</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-0-2871" name="__codelineno-0-2871" href="#__codelineno-0-2871"></a>            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;model_str&quot;</span><span class="p">:</span> <span class="n">model_str</span><span class="p">}</span>
<a id="__codelineno-0-2872" name="__codelineno-0-2872" href="#__codelineno-0-2872"></a>            <span class="k">return</span> <span class="n">d</span>
<a id="__codelineno-0-2873" name="__codelineno-0-2873" href="#__codelineno-0-2873"></a>
<a id="__codelineno-0-2874" name="__codelineno-0-2874" href="#__codelineno-0-2874"></a>        <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
<a id="__codelineno-0-2875" name="__codelineno-0-2875" href="#__codelineno-0-2875"></a>            <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.hdf5&quot;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
<a id="__codelineno-0-2876" name="__codelineno-0-2876" href="#__codelineno-0-2876"></a>                <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;model_str&quot;</span><span class="p">])</span>
<a id="__codelineno-0-2877" name="__codelineno-0-2877" href="#__codelineno-0-2877"></a>                <span class="n">fd</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
<a id="__codelineno-0-2878" name="__codelineno-0-2878" href="#__codelineno-0-2878"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">tensorflow</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-2879" name="__codelineno-0-2879" href="#__codelineno-0-2879"></a>
<a id="__codelineno-0-2880" name="__codelineno-0-2880" href="#__codelineno-0-2880"></a>    <span class="n">model_wrapper</span> <span class="o">=</span> <span class="n">ModelWrapperPickable</span><span class="p">(</span><span class="n">encoder</span><span class="p">)</span>
<a id="__codelineno-0-2881" name="__codelineno-0-2881" href="#__codelineno-0-2881"></a>
<a id="__codelineno-0-2882" name="__codelineno-0-2882" href="#__codelineno-0-2882"></a>    <span class="k">def</span> <span class="nf">compute_output_pandas_udf</span><span class="p">(</span><span class="n">model_wrapper</span><span class="p">):</span>
<a id="__codelineno-0-2883" name="__codelineno-0-2883" href="#__codelineno-0-2883"></a>        <span class="nd">@F</span><span class="o">.</span><span class="n">pandas_udf</span><span class="p">(</span><span class="n">returnType</span><span class="o">=</span><span class="n">T</span><span class="o">.</span><span class="n">ArrayType</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">DoubleType</span><span class="p">()))</span>
<a id="__codelineno-0-2884" name="__codelineno-0-2884" href="#__codelineno-0-2884"></a>        <span class="k">def</span> <span class="nf">predict_pandas_udf</span><span class="p">(</span><span class="o">*</span><span class="n">cols</span><span class="p">):</span>
<a id="__codelineno-0-2885" name="__codelineno-0-2885" href="#__codelineno-0-2885"></a>            <span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2886" name="__codelineno-0-2886" href="#__codelineno-0-2886"></a>            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">model_wrapper</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
<a id="__codelineno-0-2887" name="__codelineno-0-2887" href="#__codelineno-0-2887"></a>
<a id="__codelineno-0-2888" name="__codelineno-0-2888" href="#__codelineno-0-2888"></a>        <span class="k">return</span> <span class="n">predict_pandas_udf</span>
<a id="__codelineno-0-2889" name="__codelineno-0-2889" href="#__codelineno-0-2889"></a>
<a id="__codelineno-0-2890" name="__codelineno-0-2890" href="#__codelineno-0-2890"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf_imputed</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-2891" name="__codelineno-0-2891" href="#__codelineno-0-2891"></a>        <span class="s2">&quot;predicted_output&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2892" name="__codelineno-0-2892" href="#__codelineno-0-2892"></a>        <span class="n">compute_output_pandas_udf</span><span class="p">(</span><span class="n">model_wrapper</span><span class="p">)(</span><span class="o">*</span><span class="n">list_of_cols_scaled</span><span class="p">),</span>
<a id="__codelineno-0-2893" name="__codelineno-0-2893" href="#__codelineno-0-2893"></a>    <span class="p">)</span>
<a id="__codelineno-0-2894" name="__codelineno-0-2894" href="#__codelineno-0-2894"></a>    <span class="n">odf_schema</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">schema</span>
<a id="__codelineno-0-2895" name="__codelineno-0-2895" href="#__codelineno-0-2895"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_bottleneck</span><span class="p">):</span>
<a id="__codelineno-0-2896" name="__codelineno-0-2896" href="#__codelineno-0-2896"></a>        <span class="n">odf_schema</span> <span class="o">=</span> <span class="n">odf_schema</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;latent_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">T</span><span class="o">.</span><span class="n">FloatType</span><span class="p">()))</span>
<a id="__codelineno-0-2897" name="__codelineno-0-2897" href="#__codelineno-0-2897"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2898" name="__codelineno-0-2898" href="#__codelineno-0-2898"></a>        <span class="n">odf</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;predicted_output&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-2899" name="__codelineno-0-2899" href="#__codelineno-0-2899"></a>        <span class="o">.</span><span class="n">toDF</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">odf_schema</span><span class="p">)</span>
<a id="__codelineno-0-2900" name="__codelineno-0-2900" href="#__codelineno-0-2900"></a>        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;predicted_output&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2901" name="__codelineno-0-2901" href="#__codelineno-0-2901"></a>    <span class="p">)</span>
<a id="__codelineno-0-2902" name="__codelineno-0-2902" href="#__codelineno-0-2902"></a>
<a id="__codelineno-0-2903" name="__codelineno-0-2903" href="#__codelineno-0-2903"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_cols_scaled</span><span class="p">)</span>
<a id="__codelineno-0-2904" name="__codelineno-0-2904" href="#__codelineno-0-2904"></a>
<a id="__codelineno-0-2905" name="__codelineno-0-2905" href="#__codelineno-0-2905"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2906" name="__codelineno-0-2906" href="#__codelineno-0-2906"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-0-2907" name="__codelineno-0-2907" href="#__codelineno-0-2907"></a>
<a id="__codelineno-0-2908" name="__codelineno-0-2908" href="#__codelineno-0-2908"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-2909" name="__codelineno-0-2909" href="#__codelineno-0-2909"></a>        <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;latent_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_bottleneck</span><span class="p">)]</span>
<a id="__codelineno-0-2910" name="__codelineno-0-2910" href="#__codelineno-0-2910"></a>        <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">output_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-2911" name="__codelineno-0-2911" href="#__codelineno-0-2911"></a>
<a id="__codelineno-0-2912" name="__codelineno-0-2912" href="#__codelineno-0-2912"></a>    <span class="k">return</span> <span class="n">odf</span>
<a id="__codelineno-0-2913" name="__codelineno-0-2913" href="#__codelineno-0-2913"></a>
<a id="__codelineno-0-2914" name="__codelineno-0-2914" href="#__codelineno-0-2914"></a>
<a id="__codelineno-0-2915" name="__codelineno-0-2915" href="#__codelineno-0-2915"></a><span class="k">def</span> <span class="nf">PCA_latentFeatures</span><span class="p">(</span>
<a id="__codelineno-0-2916" name="__codelineno-0-2916" href="#__codelineno-0-2916"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-2917" name="__codelineno-0-2917" href="#__codelineno-0-2917"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-2918" name="__codelineno-0-2918" href="#__codelineno-0-2918"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2919" name="__codelineno-0-2919" href="#__codelineno-0-2919"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-2920" name="__codelineno-0-2920" href="#__codelineno-0-2920"></a>    <span class="n">explained_variance_cutoff</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
<a id="__codelineno-0-2921" name="__codelineno-0-2921" href="#__codelineno-0-2921"></a>    <span class="n">pre_existing_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2922" name="__codelineno-0-2922" href="#__codelineno-0-2922"></a>    <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2923" name="__codelineno-0-2923" href="#__codelineno-0-2923"></a>    <span class="n">standardization</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-2924" name="__codelineno-0-2924" href="#__codelineno-0-2924"></a>    <span class="n">standardization_configs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pre_existing_model&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;model_path&quot;</span><span class="p">:</span> <span class="s2">&quot;NA&quot;</span><span class="p">},</span>
<a id="__codelineno-0-2925" name="__codelineno-0-2925" href="#__codelineno-0-2925"></a>    <span class="n">imputation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2926" name="__codelineno-0-2926" href="#__codelineno-0-2926"></a>    <span class="n">imputation_configs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;imputation_function&quot;</span><span class="p">:</span> <span class="s2">&quot;imputation_MMM&quot;</span><span class="p">},</span>
<a id="__codelineno-0-2927" name="__codelineno-0-2927" href="#__codelineno-0-2927"></a>    <span class="n">stats_missing</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-0-2928" name="__codelineno-0-2928" href="#__codelineno-0-2928"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2929" name="__codelineno-0-2929" href="#__codelineno-0-2929"></a>    <span class="n">run_type</span><span class="o">=</span><span class="s2">&quot;local&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2930" name="__codelineno-0-2930" href="#__codelineno-0-2930"></a>    <span class="n">root_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2931" name="__codelineno-0-2931" href="#__codelineno-0-2931"></a>    <span class="n">auth_key</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2932" name="__codelineno-0-2932" href="#__codelineno-0-2932"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2933" name="__codelineno-0-2933" href="#__codelineno-0-2933"></a><span class="p">):</span>
<a id="__codelineno-0-2934" name="__codelineno-0-2934" href="#__codelineno-0-2934"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2935" name="__codelineno-0-2935" href="#__codelineno-0-2935"></a><span class="sd">    Similar to autoencoder_latentFeatures, PCA_latentFeatures also generates latent features which reduces the</span>
<a id="__codelineno-0-2936" name="__codelineno-0-2936" href="#__codelineno-0-2936"></a><span class="sd">    dimensionality of the input dataframe but through a different technique: Principal Component Analysis (PCA). PCA</span>
<a id="__codelineno-0-2937" name="__codelineno-0-2937" href="#__codelineno-0-2937"></a><span class="sd">    algorithm produces principal components such that it can describe most of the remaining variance and all the</span>
<a id="__codelineno-0-2938" name="__codelineno-0-2938" href="#__codelineno-0-2938"></a><span class="sd">    principal components are orthogonal to each other. The final number of generated principal components is</span>
<a id="__codelineno-0-2939" name="__codelineno-0-2939" href="#__codelineno-0-2939"></a><span class="sd">    controlled by the input *explained_variance_cutoff*. In other words, the number of selected principal components,</span>
<a id="__codelineno-0-2940" name="__codelineno-0-2940" href="#__codelineno-0-2940"></a><span class="sd">    k, is the minimum value such that top k components (latent features) can explain at least</span>
<a id="__codelineno-0-2941" name="__codelineno-0-2941" href="#__codelineno-0-2941"></a><span class="sd">    *explained_variance_cutoff* of the total variance.</span>
<a id="__codelineno-0-2942" name="__codelineno-0-2942" href="#__codelineno-0-2942"></a>
<a id="__codelineno-0-2943" name="__codelineno-0-2943" href="#__codelineno-0-2943"></a><span class="sd">    Standardization is highly recommended if the input attributes are not of the same scale. Otherwise the generated</span>
<a id="__codelineno-0-2944" name="__codelineno-0-2944" href="#__codelineno-0-2944"></a><span class="sd">    latent features might be dominated by the attributes with larger variance. Inputs *standardization* and</span>
<a id="__codelineno-0-2945" name="__codelineno-0-2945" href="#__codelineno-0-2945"></a><span class="sd">    *standardization_configs* can be set accordingly to perform standardization within the function. In addition,</span>
<a id="__codelineno-0-2946" name="__codelineno-0-2946" href="#__codelineno-0-2946"></a><span class="sd">    data imputation is also recommended if missing values exist, which can be done within the function by setting</span>
<a id="__codelineno-0-2947" name="__codelineno-0-2947" href="#__codelineno-0-2947"></a><span class="sd">    inputs *imputation* and *imputation_configs*.</span>
<a id="__codelineno-0-2948" name="__codelineno-0-2948" href="#__codelineno-0-2948"></a>
<a id="__codelineno-0-2949" name="__codelineno-0-2949" href="#__codelineno-0-2949"></a>
<a id="__codelineno-0-2950" name="__codelineno-0-2950" href="#__codelineno-0-2950"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-2951" name="__codelineno-0-2951" href="#__codelineno-0-2951"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-2952" name="__codelineno-0-2952" href="#__codelineno-0-2952"></a><span class="sd">    spark</span>
<a id="__codelineno-0-2953" name="__codelineno-0-2953" href="#__codelineno-0-2953"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-0-2954" name="__codelineno-0-2954" href="#__codelineno-0-2954"></a><span class="sd">    idf</span>
<a id="__codelineno-0-2955" name="__codelineno-0-2955" href="#__codelineno-0-2955"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-2956" name="__codelineno-0-2956" href="#__codelineno-0-2956"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-0-2957" name="__codelineno-0-2957" href="#__codelineno-0-2957"></a><span class="sd">        List of numerical columns to encode e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-2958" name="__codelineno-0-2958" href="#__codelineno-0-2958"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-2959" name="__codelineno-0-2959" href="#__codelineno-0-2959"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-2960" name="__codelineno-0-2960" href="#__codelineno-0-2960"></a><span class="sd">        &quot;all&quot; can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-0-2961" name="__codelineno-0-2961" href="#__codelineno-0-2961"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-0-2962" name="__codelineno-0-2962" href="#__codelineno-0-2962"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-0-2963" name="__codelineno-0-2963" href="#__codelineno-0-2963"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-0-2964" name="__codelineno-0-2964" href="#__codelineno-0-2964"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-2965" name="__codelineno-0-2965" href="#__codelineno-0-2965"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-2966" name="__codelineno-0-2966" href="#__codelineno-0-2966"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-2967" name="__codelineno-0-2967" href="#__codelineno-0-2967"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-0-2968" name="__codelineno-0-2968" href="#__codelineno-0-2968"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-0-2969" name="__codelineno-0-2969" href="#__codelineno-0-2969"></a><span class="sd">    explained_variance_cutoff</span>
<a id="__codelineno-0-2970" name="__codelineno-0-2970" href="#__codelineno-0-2970"></a><span class="sd">        Determines the number of latent columns in the output. If N is the smallest</span>
<a id="__codelineno-0-2971" name="__codelineno-0-2971" href="#__codelineno-0-2971"></a><span class="sd">        integer such that top N latent columns explain more than explained_variance_cutoff</span>
<a id="__codelineno-0-2972" name="__codelineno-0-2972" href="#__codelineno-0-2972"></a><span class="sd">        variance, these N columns will be selected. (Default value = 0.95)</span>
<a id="__codelineno-0-2973" name="__codelineno-0-2973" href="#__codelineno-0-2973"></a><span class="sd">    pre_existing_model</span>
<a id="__codelineno-0-2974" name="__codelineno-0-2974" href="#__codelineno-0-2974"></a><span class="sd">        Boolean argument – True or False. True if model exists already, False Otherwise (Default value = False)</span>
<a id="__codelineno-0-2975" name="__codelineno-0-2975" href="#__codelineno-0-2975"></a><span class="sd">    model_path</span>
<a id="__codelineno-0-2976" name="__codelineno-0-2976" href="#__codelineno-0-2976"></a><span class="sd">        If pre_existing_model is True, this argument is path for referring the pre-saved model.</span>
<a id="__codelineno-0-2977" name="__codelineno-0-2977" href="#__codelineno-0-2977"></a><span class="sd">        If pre_existing_model is False, this argument can be used for saving the model.</span>
<a id="__codelineno-0-2978" name="__codelineno-0-2978" href="#__codelineno-0-2978"></a><span class="sd">        Default &quot;NA&quot; means there is neither pre-existing model nor there is a need to save one.</span>
<a id="__codelineno-0-2979" name="__codelineno-0-2979" href="#__codelineno-0-2979"></a><span class="sd">    standardization</span>
<a id="__codelineno-0-2980" name="__codelineno-0-2980" href="#__codelineno-0-2980"></a><span class="sd">        Boolean argument – True or False. True, if the standardization required. (Default value = True)</span>
<a id="__codelineno-0-2981" name="__codelineno-0-2981" href="#__codelineno-0-2981"></a><span class="sd">    standardization_configs</span>
<a id="__codelineno-0-2982" name="__codelineno-0-2982" href="#__codelineno-0-2982"></a><span class="sd">        z_standardization function arguments in dictionary format. (Default value = {&quot;pre_existing_model&quot;: False)</span>
<a id="__codelineno-0-2983" name="__codelineno-0-2983" href="#__codelineno-0-2983"></a><span class="sd">    imputation</span>
<a id="__codelineno-0-2984" name="__codelineno-0-2984" href="#__codelineno-0-2984"></a><span class="sd">        Boolean argument – True or False. True, if the imputation required. (Default value = False)</span>
<a id="__codelineno-0-2985" name="__codelineno-0-2985" href="#__codelineno-0-2985"></a><span class="sd">    imputation_configs</span>
<a id="__codelineno-0-2986" name="__codelineno-0-2986" href="#__codelineno-0-2986"></a><span class="sd">        Takes input in dictionary format.</span>
<a id="__codelineno-0-2987" name="__codelineno-0-2987" href="#__codelineno-0-2987"></a><span class="sd">        Imputation function name is provided with key &quot;imputation_name&quot;.</span>
<a id="__codelineno-0-2988" name="__codelineno-0-2988" href="#__codelineno-0-2988"></a><span class="sd">        optional arguments pertaining to that imputation function can be provided with argument name as key. (Default value = {&quot;imputation_function&quot;: &quot;imputation_MMM&quot;})</span>
<a id="__codelineno-0-2989" name="__codelineno-0-2989" href="#__codelineno-0-2989"></a><span class="sd">    stats_missing</span>
<a id="__codelineno-0-2990" name="__codelineno-0-2990" href="#__codelineno-0-2990"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-0-2991" name="__codelineno-0-2991" href="#__codelineno-0-2991"></a><span class="sd">        to read pre-saved statistics on missing count/pct i.e. if measures_of_counts or</span>
<a id="__codelineno-0-2992" name="__codelineno-0-2992" href="#__codelineno-0-2992"></a><span class="sd">        missingCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-0-2993" name="__codelineno-0-2993" href="#__codelineno-0-2993"></a><span class="sd">    output_mode</span>
<a id="__codelineno-0-2994" name="__codelineno-0-2994" href="#__codelineno-0-2994"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-0-2995" name="__codelineno-0-2995" href="#__codelineno-0-2995"></a><span class="sd">        “replace” option replaces original columns with transformed columns: latent_&lt;col_index&gt;.</span>
<a id="__codelineno-0-2996" name="__codelineno-0-2996" href="#__codelineno-0-2996"></a><span class="sd">        “append” option append transformed columns with format latent_&lt;col_index&gt; to the input dataset,</span>
<a id="__codelineno-0-2997" name="__codelineno-0-2997" href="#__codelineno-0-2997"></a><span class="sd">        e.g. latent_0, latent_1. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-0-2998" name="__codelineno-0-2998" href="#__codelineno-0-2998"></a><span class="sd">    run_type</span>
<a id="__codelineno-0-2999" name="__codelineno-0-2999" href="#__codelineno-0-2999"></a><span class="sd">        &quot;local&quot;, &quot;emr&quot;, &quot;databricks&quot;, &quot;ak8s&quot; (Default value = &quot;local&quot;)</span>
<a id="__codelineno-0-3000" name="__codelineno-0-3000" href="#__codelineno-0-3000"></a><span class="sd">    root_path</span>
<a id="__codelineno-0-3001" name="__codelineno-0-3001" href="#__codelineno-0-3001"></a><span class="sd">        This argument takes in a base folder path for writing out intermediate_data/ folder to. Default value is &quot;&quot;</span>
<a id="__codelineno-0-3002" name="__codelineno-0-3002" href="#__codelineno-0-3002"></a><span class="sd">    auth_key</span>
<a id="__codelineno-0-3003" name="__codelineno-0-3003" href="#__codelineno-0-3003"></a><span class="sd">        Option to pass an authorization key to write to filesystems. Currently applicable only for ak8s run_type. Default value is kept as &quot;NA&quot;</span>
<a id="__codelineno-0-3004" name="__codelineno-0-3004" href="#__codelineno-0-3004"></a><span class="sd">    print_impact</span>
<a id="__codelineno-0-3005" name="__codelineno-0-3005" href="#__codelineno-0-3005"></a><span class="sd">        True, False</span>
<a id="__codelineno-0-3006" name="__codelineno-0-3006" href="#__codelineno-0-3006"></a><span class="sd">        This argument is to print descriptive statistics of the latest features (Default value = False)</span>
<a id="__codelineno-0-3007" name="__codelineno-0-3007" href="#__codelineno-0-3007"></a>
<a id="__codelineno-0-3008" name="__codelineno-0-3008" href="#__codelineno-0-3008"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-3009" name="__codelineno-0-3009" href="#__codelineno-0-3009"></a><span class="sd">    -------</span>
<a id="__codelineno-0-3010" name="__codelineno-0-3010" href="#__codelineno-0-3010"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-0-3011" name="__codelineno-0-3011" href="#__codelineno-0-3011"></a><span class="sd">        Dataframe with Latent Features</span>
<a id="__codelineno-0-3012" name="__codelineno-0-3012" href="#__codelineno-0-3012"></a>
<a id="__codelineno-0-3013" name="__codelineno-0-3013" href="#__codelineno-0-3013"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-3014" name="__codelineno-0-3014" href="#__codelineno-0-3014"></a>
<a id="__codelineno-0-3015" name="__codelineno-0-3015" href="#__codelineno-0-3015"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-3016" name="__codelineno-0-3016" href="#__codelineno-0-3016"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-3017" name="__codelineno-0-3017" href="#__codelineno-0-3017"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-0-3018" name="__codelineno-0-3018" href="#__codelineno-0-3018"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-3019" name="__codelineno-0-3019" href="#__codelineno-0-3019"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-3020" name="__codelineno-0-3020" href="#__codelineno-0-3020"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-3021" name="__codelineno-0-3021" href="#__codelineno-0-3021"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-3022" name="__codelineno-0-3022" href="#__codelineno-0-3022"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-0-3023" name="__codelineno-0-3023" href="#__codelineno-0-3023"></a>
<a id="__codelineno-0-3024" name="__codelineno-0-3024" href="#__codelineno-0-3024"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-3025" name="__codelineno-0-3025" href="#__codelineno-0-3025"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3026" name="__codelineno-0-3026" href="#__codelineno-0-3026"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-3027" name="__codelineno-0-3027" href="#__codelineno-0-3027"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No Latent Features Generated - No Column(s) to Transform&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3028" name="__codelineno-0-3028" href="#__codelineno-0-3028"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-0-3029" name="__codelineno-0-3029" href="#__codelineno-0-3029"></a>
<a id="__codelineno-0-3030" name="__codelineno-0-3030" href="#__codelineno-0-3030"></a>    <span class="k">if</span> <span class="n">stats_missing</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-0-3031" name="__codelineno-0-3031" href="#__codelineno-0-3031"></a>        <span class="n">missing_df</span> <span class="o">=</span> <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-0-3032" name="__codelineno-0-3032" href="#__codelineno-0-3032"></a>        <span class="n">missing_df</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span>
<a id="__codelineno-0-3033" name="__codelineno-0-3033" href="#__codelineno-0-3033"></a>            <span class="n">root_path</span> <span class="o">+</span> <span class="s2">&quot;intermediate_data/PCA_latentFeatures/missingCount_computation&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3034" name="__codelineno-0-3034" href="#__codelineno-0-3034"></a>            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3035" name="__codelineno-0-3035" href="#__codelineno-0-3035"></a>        <span class="p">)</span>
<a id="__codelineno-0-3036" name="__codelineno-0-3036" href="#__codelineno-0-3036"></a>        <span class="n">stats_missing</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-3037" name="__codelineno-0-3037" href="#__codelineno-0-3037"></a>            <span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="n">root_path</span>
<a id="__codelineno-0-3038" name="__codelineno-0-3038" href="#__codelineno-0-3038"></a>            <span class="o">+</span> <span class="s2">&quot;intermediate_data/PCA_latentFeatures/missingCount_computation&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3039" name="__codelineno-0-3039" href="#__codelineno-0-3039"></a>            <span class="s2">&quot;file_type&quot;</span><span class="p">:</span> <span class="s2">&quot;parquet&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3040" name="__codelineno-0-3040" href="#__codelineno-0-3040"></a>        <span class="p">}</span>
<a id="__codelineno-0-3041" name="__codelineno-0-3041" href="#__codelineno-0-3041"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-3042" name="__codelineno-0-3042" href="#__codelineno-0-3042"></a>        <span class="n">missing_df</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-3043" name="__codelineno-0-3043" href="#__codelineno-0-3043"></a>            <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_missing</span><span class="p">)</span>
<a id="__codelineno-0-3044" name="__codelineno-0-3044" href="#__codelineno-0-3044"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_count&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3045" name="__codelineno-0-3045" href="#__codelineno-0-3045"></a>            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-0-3046" name="__codelineno-0-3046" href="#__codelineno-0-3046"></a>        <span class="p">)</span>
<a id="__codelineno-0-3047" name="__codelineno-0-3047" href="#__codelineno-0-3047"></a>
<a id="__codelineno-0-3048" name="__codelineno-0-3048" href="#__codelineno-0-3048"></a>    <span class="n">empty_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-3049" name="__codelineno-0-3049" href="#__codelineno-0-3049"></a>        <span class="n">missing_df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-0-3050" name="__codelineno-0-3050" href="#__codelineno-0-3050"></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3051" name="__codelineno-0-3051" href="#__codelineno-0-3051"></a>        <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-3052" name="__codelineno-0-3052" href="#__codelineno-0-3052"></a>        <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-3053" name="__codelineno-0-3053" href="#__codelineno-0-3053"></a>    <span class="p">)</span>
<a id="__codelineno-0-3054" name="__codelineno-0-3054" href="#__codelineno-0-3054"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">empty_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-3055" name="__codelineno-0-3055" href="#__codelineno-0-3055"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-3056" name="__codelineno-0-3056" href="#__codelineno-0-3056"></a>            <span class="s2">&quot;The following column(s) are excluded from dimensionality reduction as all values are null: &quot;</span>
<a id="__codelineno-0-3057" name="__codelineno-0-3057" href="#__codelineno-0-3057"></a>            <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">empty_cols</span><span class="p">)</span>
<a id="__codelineno-0-3058" name="__codelineno-0-3058" href="#__codelineno-0-3058"></a>        <span class="p">)</span>
<a id="__codelineno-0-3059" name="__codelineno-0-3059" href="#__codelineno-0-3059"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">empty_cols</span><span class="p">]</span>
<a id="__codelineno-0-3060" name="__codelineno-0-3060" href="#__codelineno-0-3060"></a>
<a id="__codelineno-0-3061" name="__codelineno-0-3061" href="#__codelineno-0-3061"></a>    <span class="k">if</span> <span class="n">standardization</span><span class="p">:</span>
<a id="__codelineno-0-3062" name="__codelineno-0-3062" href="#__codelineno-0-3062"></a>        <span class="n">idf_standardized</span> <span class="o">=</span> <span class="n">z_standardization</span><span class="p">(</span>
<a id="__codelineno-0-3063" name="__codelineno-0-3063" href="#__codelineno-0-3063"></a>            <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-3064" name="__codelineno-0-3064" href="#__codelineno-0-3064"></a>            <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-3065" name="__codelineno-0-3065" href="#__codelineno-0-3065"></a>            <span class="n">list_of_cols</span><span class="o">=</span><span class="n">list_of_cols</span><span class="p">,</span>
<a id="__codelineno-0-3066" name="__codelineno-0-3066" href="#__codelineno-0-3066"></a>            <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3067" name="__codelineno-0-3067" href="#__codelineno-0-3067"></a>            <span class="o">**</span><span class="n">standardization_configs</span><span class="p">,</span>
<a id="__codelineno-0-3068" name="__codelineno-0-3068" href="#__codelineno-0-3068"></a>        <span class="p">)</span>
<a id="__codelineno-0-3069" name="__codelineno-0-3069" href="#__codelineno-0-3069"></a>        <span class="n">list_of_cols_scaled</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-3070" name="__codelineno-0-3070" href="#__codelineno-0-3070"></a>            <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span>
<a id="__codelineno-0-3071" name="__codelineno-0-3071" href="#__codelineno-0-3071"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span>
<a id="__codelineno-0-3072" name="__codelineno-0-3072" href="#__codelineno-0-3072"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">idf_standardized</span><span class="o">.</span><span class="n">columns</span>
<a id="__codelineno-0-3073" name="__codelineno-0-3073" href="#__codelineno-0-3073"></a>        <span class="p">]</span>
<a id="__codelineno-0-3074" name="__codelineno-0-3074" href="#__codelineno-0-3074"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-3075" name="__codelineno-0-3075" href="#__codelineno-0-3075"></a>        <span class="n">idf_standardized</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-3076" name="__codelineno-0-3076" href="#__codelineno-0-3076"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-3077" name="__codelineno-0-3077" href="#__codelineno-0-3077"></a>            <span class="n">idf_standardized</span> <span class="o">=</span> <span class="n">idf_standardized</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a id="__codelineno-0-3078" name="__codelineno-0-3078" href="#__codelineno-0-3078"></a>            <span class="n">list_of_cols_scaled</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">]</span>
<a id="__codelineno-0-3079" name="__codelineno-0-3079" href="#__codelineno-0-3079"></a>
<a id="__codelineno-0-3080" name="__codelineno-0-3080" href="#__codelineno-0-3080"></a>    <span class="k">if</span> <span class="n">imputation</span><span class="p">:</span>
<a id="__codelineno-0-3081" name="__codelineno-0-3081" href="#__codelineno-0-3081"></a>        <span class="n">all_functions</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-3082" name="__codelineno-0-3082" href="#__codelineno-0-3082"></a>        <span class="n">all_functions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">locals</span><span class="p">())</span>
<a id="__codelineno-0-3083" name="__codelineno-0-3083" href="#__codelineno-0-3083"></a>        <span class="n">f</span> <span class="o">=</span> <span class="n">all_functions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">imputation_configs</span><span class="p">[</span><span class="s2">&quot;imputation_function&quot;</span><span class="p">])</span>
<a id="__codelineno-0-3084" name="__codelineno-0-3084" href="#__codelineno-0-3084"></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">imputation_configs</span><span class="p">)</span>
<a id="__codelineno-0-3085" name="__codelineno-0-3085" href="#__codelineno-0-3085"></a>        <span class="n">args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;imputation_function&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-3086" name="__codelineno-0-3086" href="#__codelineno-0-3086"></a>        <span class="n">missing_df_scaled</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-3087" name="__codelineno-0-3087" href="#__codelineno-0-3087"></a>            <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_missing</span><span class="p">)</span>
<a id="__codelineno-0-3088" name="__codelineno-0-3088" href="#__codelineno-0-3088"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_count&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3089" name="__codelineno-0-3089" href="#__codelineno-0-3089"></a>            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&quot;_scaled&quot;</span><span class="p">)))</span>
<a id="__codelineno-0-3090" name="__codelineno-0-3090" href="#__codelineno-0-3090"></a>        <span class="p">)</span>
<a id="__codelineno-0-3091" name="__codelineno-0-3091" href="#__codelineno-0-3091"></a>        <span class="n">missing_df_scaled</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span>
<a id="__codelineno-0-3092" name="__codelineno-0-3092" href="#__codelineno-0-3092"></a>            <span class="n">root_path</span>
<a id="__codelineno-0-3093" name="__codelineno-0-3093" href="#__codelineno-0-3093"></a>            <span class="o">+</span> <span class="s2">&quot;intermediate_data/PCA_latentFeatures/missingCount_computation_scaled&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3094" name="__codelineno-0-3094" href="#__codelineno-0-3094"></a>            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3095" name="__codelineno-0-3095" href="#__codelineno-0-3095"></a>        <span class="p">)</span>
<a id="__codelineno-0-3096" name="__codelineno-0-3096" href="#__codelineno-0-3096"></a>        <span class="n">stats_missing_scaled</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-3097" name="__codelineno-0-3097" href="#__codelineno-0-3097"></a>            <span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="n">root_path</span>
<a id="__codelineno-0-3098" name="__codelineno-0-3098" href="#__codelineno-0-3098"></a>            <span class="o">+</span> <span class="s2">&quot;intermediate_data/PCA_latentFeatures/missingCount_computation_scaled&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3099" name="__codelineno-0-3099" href="#__codelineno-0-3099"></a>            <span class="s2">&quot;file_type&quot;</span><span class="p">:</span> <span class="s2">&quot;parquet&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3100" name="__codelineno-0-3100" href="#__codelineno-0-3100"></a>        <span class="p">}</span>
<a id="__codelineno-0-3101" name="__codelineno-0-3101" href="#__codelineno-0-3101"></a>        <span class="n">idf_imputed</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span>
<a id="__codelineno-0-3102" name="__codelineno-0-3102" href="#__codelineno-0-3102"></a>            <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-3103" name="__codelineno-0-3103" href="#__codelineno-0-3103"></a>            <span class="n">idf_standardized</span><span class="p">,</span>
<a id="__codelineno-0-3104" name="__codelineno-0-3104" href="#__codelineno-0-3104"></a>            <span class="n">list_of_cols_scaled</span><span class="p">,</span>
<a id="__codelineno-0-3105" name="__codelineno-0-3105" href="#__codelineno-0-3105"></a>            <span class="n">stats_missing</span><span class="o">=</span><span class="n">stats_missing_scaled</span><span class="p">,</span>
<a id="__codelineno-0-3106" name="__codelineno-0-3106" href="#__codelineno-0-3106"></a>            <span class="o">**</span><span class="n">args</span><span class="p">,</span>
<a id="__codelineno-0-3107" name="__codelineno-0-3107" href="#__codelineno-0-3107"></a>        <span class="p">)</span>
<a id="__codelineno-0-3108" name="__codelineno-0-3108" href="#__codelineno-0-3108"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-3109" name="__codelineno-0-3109" href="#__codelineno-0-3109"></a>        <span class="n">idf_imputed</span> <span class="o">=</span> <span class="n">idf_standardized</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">list_of_cols_scaled</span><span class="p">)</span>
<a id="__codelineno-0-3110" name="__codelineno-0-3110" href="#__codelineno-0-3110"></a>
<a id="__codelineno-0-3111" name="__codelineno-0-3111" href="#__codelineno-0-3111"></a>    <span class="n">idf_imputed</span><span class="o">.</span><span class="n">persist</span><span class="p">(</span><span class="n">pyspark</span><span class="o">.</span><span class="n">StorageLevel</span><span class="o">.</span><span class="n">MEMORY_AND_DISK</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-0-3112" name="__codelineno-0-3112" href="#__codelineno-0-3112"></a>
<a id="__codelineno-0-3113" name="__codelineno-0-3113" href="#__codelineno-0-3113"></a>    <span class="n">assembler</span> <span class="o">=</span> <span class="n">VectorAssembler</span><span class="p">(</span><span class="n">inputCols</span><span class="o">=</span><span class="n">list_of_cols_scaled</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3114" name="__codelineno-0-3114" href="#__codelineno-0-3114"></a>    <span class="n">assembled_data</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">idf_imputed</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_cols_scaled</span><span class="p">)</span>
<a id="__codelineno-0-3115" name="__codelineno-0-3115" href="#__codelineno-0-3115"></a>
<a id="__codelineno-0-3116" name="__codelineno-0-3116" href="#__codelineno-0-3116"></a>    <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-0-3117" name="__codelineno-0-3117" href="#__codelineno-0-3117"></a>        <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/PCA_latentFeatures/pca_path&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3118" name="__codelineno-0-3118" href="#__codelineno-0-3118"></a>        <span class="n">pcaModel</span> <span class="o">=</span> <span class="n">PCAModel</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/PCA_latentFeatures/pcaModel_path&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3119" name="__codelineno-0-3119" href="#__codelineno-0-3119"></a>        <span class="n">n</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">getK</span><span class="p">()</span>
<a id="__codelineno-0-3120" name="__codelineno-0-3120" href="#__codelineno-0-3120"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-3121" name="__codelineno-0-3121" href="#__codelineno-0-3121"></a>        <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span>
<a id="__codelineno-0-3122" name="__codelineno-0-3122" href="#__codelineno-0-3122"></a>            <span class="n">k</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols_scaled</span><span class="p">),</span> <span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;features_pca&quot;</span>
<a id="__codelineno-0-3123" name="__codelineno-0-3123" href="#__codelineno-0-3123"></a>        <span class="p">)</span>
<a id="__codelineno-0-3124" name="__codelineno-0-3124" href="#__codelineno-0-3124"></a>        <span class="n">pcaModel</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">assembled_data</span><span class="p">)</span>
<a id="__codelineno-0-3125" name="__codelineno-0-3125" href="#__codelineno-0-3125"></a>        <span class="n">explained_variance</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-3126" name="__codelineno-0-3126" href="#__codelineno-0-3126"></a>        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-3127" name="__codelineno-0-3127" href="#__codelineno-0-3127"></a>            <span class="n">explained_variance</span> <span class="o">+=</span> <span class="n">pcaModel</span><span class="o">.</span><span class="n">explainedVariance</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-3128" name="__codelineno-0-3128" href="#__codelineno-0-3128"></a>            <span class="k">if</span> <span class="n">explained_variance</span> <span class="o">&gt;</span> <span class="n">explained_variance_cutoff</span><span class="p">:</span>
<a id="__codelineno-0-3129" name="__codelineno-0-3129" href="#__codelineno-0-3129"></a>                <span class="k">break</span>
<a id="__codelineno-0-3130" name="__codelineno-0-3130" href="#__codelineno-0-3130"></a>
<a id="__codelineno-0-3131" name="__codelineno-0-3131" href="#__codelineno-0-3131"></a>        <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;features_pca&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3132" name="__codelineno-0-3132" href="#__codelineno-0-3132"></a>        <span class="n">pcaModel</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">assembled_data</span><span class="p">)</span>
<a id="__codelineno-0-3133" name="__codelineno-0-3133" href="#__codelineno-0-3133"></a>        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pre_existing_model</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">):</span>
<a id="__codelineno-0-3134" name="__codelineno-0-3134" href="#__codelineno-0-3134"></a>            <span class="n">pcaModel</span><span class="o">.</span><span class="n">write</span><span class="p">()</span><span class="o">.</span><span class="n">overwrite</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
<a id="__codelineno-0-3135" name="__codelineno-0-3135" href="#__codelineno-0-3135"></a>                <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/PCA_latentFeatures/pcaModel_path&quot;</span>
<a id="__codelineno-0-3136" name="__codelineno-0-3136" href="#__codelineno-0-3136"></a>            <span class="p">)</span>
<a id="__codelineno-0-3137" name="__codelineno-0-3137" href="#__codelineno-0-3137"></a>            <span class="n">pca</span><span class="o">.</span><span class="n">write</span><span class="p">()</span><span class="o">.</span><span class="n">overwrite</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/PCA_latentFeatures/pca_path&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3138" name="__codelineno-0-3138" href="#__codelineno-0-3138"></a>
<a id="__codelineno-0-3139" name="__codelineno-0-3139" href="#__codelineno-0-3139"></a>    <span class="k">def</span> <span class="nf">vector_to_array</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
<a id="__codelineno-0-3140" name="__codelineno-0-3140" href="#__codelineno-0-3140"></a>        <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">toArray</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-3141" name="__codelineno-0-3141" href="#__codelineno-0-3141"></a>
<a id="__codelineno-0-3142" name="__codelineno-0-3142" href="#__codelineno-0-3142"></a>    <span class="n">f_vector_to_array</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">udf</span><span class="p">(</span><span class="n">vector_to_array</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">ArrayType</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">FloatType</span><span class="p">()))</span>
<a id="__codelineno-0-3143" name="__codelineno-0-3143" href="#__codelineno-0-3143"></a>
<a id="__codelineno-0-3144" name="__codelineno-0-3144" href="#__codelineno-0-3144"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-3145" name="__codelineno-0-3145" href="#__codelineno-0-3145"></a>        <span class="n">pcaModel</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">assembled_data</span><span class="p">)</span>
<a id="__codelineno-0-3146" name="__codelineno-0-3146" href="#__codelineno-0-3146"></a>        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;features_pca_array&quot;</span><span class="p">,</span> <span class="n">f_vector_to_array</span><span class="p">(</span><span class="s2">&quot;features_pca&quot;</span><span class="p">))</span>
<a id="__codelineno-0-3147" name="__codelineno-0-3147" href="#__codelineno-0-3147"></a>        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="s2">&quot;features_pca&quot;</span><span class="p">])</span>
<a id="__codelineno-0-3148" name="__codelineno-0-3148" href="#__codelineno-0-3148"></a>    <span class="p">)</span>
<a id="__codelineno-0-3149" name="__codelineno-0-3149" href="#__codelineno-0-3149"></a>
<a id="__codelineno-0-3150" name="__codelineno-0-3150" href="#__codelineno-0-3150"></a>    <span class="n">odf_schema</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">schema</span>
<a id="__codelineno-0-3151" name="__codelineno-0-3151" href="#__codelineno-0-3151"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<a id="__codelineno-0-3152" name="__codelineno-0-3152" href="#__codelineno-0-3152"></a>        <span class="n">odf_schema</span> <span class="o">=</span> <span class="n">odf_schema</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;latent_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">T</span><span class="o">.</span><span class="n">FloatType</span><span class="p">()))</span>
<a id="__codelineno-0-3153" name="__codelineno-0-3153" href="#__codelineno-0-3153"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-3154" name="__codelineno-0-3154" href="#__codelineno-0-3154"></a>        <span class="n">odf</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;features_pca_array&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-3155" name="__codelineno-0-3155" href="#__codelineno-0-3155"></a>        <span class="o">.</span><span class="n">toDF</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">odf_schema</span><span class="p">)</span>
<a id="__codelineno-0-3156" name="__codelineno-0-3156" href="#__codelineno-0-3156"></a>        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;features_pca_array&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3157" name="__codelineno-0-3157" href="#__codelineno-0-3157"></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span> <span class="kc">None</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;latent_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)])</span>
<a id="__codelineno-0-3158" name="__codelineno-0-3158" href="#__codelineno-0-3158"></a>    <span class="p">)</span>
<a id="__codelineno-0-3159" name="__codelineno-0-3159" href="#__codelineno-0-3159"></a>
<a id="__codelineno-0-3160" name="__codelineno-0-3160" href="#__codelineno-0-3160"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-3161" name="__codelineno-0-3161" href="#__codelineno-0-3161"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-0-3162" name="__codelineno-0-3162" href="#__codelineno-0-3162"></a>
<a id="__codelineno-0-3163" name="__codelineno-0-3163" href="#__codelineno-0-3163"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-3164" name="__codelineno-0-3164" href="#__codelineno-0-3164"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Explained Variance: &quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pcaModel</span><span class="o">.</span><span class="n">explainedVariance</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">]),</span> <span class="mi">4</span><span class="p">))</span>
<a id="__codelineno-0-3165" name="__codelineno-0-3165" href="#__codelineno-0-3165"></a>        <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;latent_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)]</span>
<a id="__codelineno-0-3166" name="__codelineno-0-3166" href="#__codelineno-0-3166"></a>        <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">output_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-3167" name="__codelineno-0-3167" href="#__codelineno-0-3167"></a>
<a id="__codelineno-0-3168" name="__codelineno-0-3168" href="#__codelineno-0-3168"></a>    <span class="k">return</span> <span class="n">odf</span>
<a id="__codelineno-0-3169" name="__codelineno-0-3169" href="#__codelineno-0-3169"></a>
<a id="__codelineno-0-3170" name="__codelineno-0-3170" href="#__codelineno-0-3170"></a>
<a id="__codelineno-0-3171" name="__codelineno-0-3171" href="#__codelineno-0-3171"></a><span class="k">def</span> <span class="nf">feature_transformation</span><span class="p">(</span>
<a id="__codelineno-0-3172" name="__codelineno-0-3172" href="#__codelineno-0-3172"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-3173" name="__codelineno-0-3173" href="#__codelineno-0-3173"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3174" name="__codelineno-0-3174" href="#__codelineno-0-3174"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-3175" name="__codelineno-0-3175" href="#__codelineno-0-3175"></a>    <span class="n">method_type</span><span class="o">=</span><span class="s2">&quot;sqrt&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3176" name="__codelineno-0-3176" href="#__codelineno-0-3176"></a>    <span class="n">N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-3177" name="__codelineno-0-3177" href="#__codelineno-0-3177"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3178" name="__codelineno-0-3178" href="#__codelineno-0-3178"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-3179" name="__codelineno-0-3179" href="#__codelineno-0-3179"></a><span class="p">):</span>
<a id="__codelineno-0-3180" name="__codelineno-0-3180" href="#__codelineno-0-3180"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-3181" name="__codelineno-0-3181" href="#__codelineno-0-3181"></a><span class="sd">    As the name indicates, feature_transformation performs mathematical transformation over selected attributes.</span>
<a id="__codelineno-0-3182" name="__codelineno-0-3182" href="#__codelineno-0-3182"></a><span class="sd">    The following methods are supported for an input attribute x: ln(x), log10(x), log2(x), e^x, 2^x, 10^x, N^x,</span>
<a id="__codelineno-0-3183" name="__codelineno-0-3183" href="#__codelineno-0-3183"></a><span class="sd">    square and cube root of x, x^2, x^3, x^N, trigonometric transformations of x (sin, cos, tan, asin, acos, atan),</span>
<a id="__codelineno-0-3184" name="__codelineno-0-3184" href="#__codelineno-0-3184"></a><span class="sd">    radians, x%N, x!, 1/x, floor and ceiling of x and x rounded to N decimal places. Some transformations only work</span>
<a id="__codelineno-0-3185" name="__codelineno-0-3185" href="#__codelineno-0-3185"></a><span class="sd">    with positive or non-negative input values such as log and square root and an error will be returned if violated.</span>
<a id="__codelineno-0-3186" name="__codelineno-0-3186" href="#__codelineno-0-3186"></a>
<a id="__codelineno-0-3187" name="__codelineno-0-3187" href="#__codelineno-0-3187"></a>
<a id="__codelineno-0-3188" name="__codelineno-0-3188" href="#__codelineno-0-3188"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-3189" name="__codelineno-0-3189" href="#__codelineno-0-3189"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-3190" name="__codelineno-0-3190" href="#__codelineno-0-3190"></a><span class="sd">    idf</span>
<a id="__codelineno-0-3191" name="__codelineno-0-3191" href="#__codelineno-0-3191"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-3192" name="__codelineno-0-3192" href="#__codelineno-0-3192"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-0-3193" name="__codelineno-0-3193" href="#__codelineno-0-3193"></a><span class="sd">        List of numerical columns to transform e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-3194" name="__codelineno-0-3194" href="#__codelineno-0-3194"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-3195" name="__codelineno-0-3195" href="#__codelineno-0-3195"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-3196" name="__codelineno-0-3196" href="#__codelineno-0-3196"></a><span class="sd">        &quot;all&quot; can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-0-3197" name="__codelineno-0-3197" href="#__codelineno-0-3197"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-0-3198" name="__codelineno-0-3198" href="#__codelineno-0-3198"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-0-3199" name="__codelineno-0-3199" href="#__codelineno-0-3199"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-0-3200" name="__codelineno-0-3200" href="#__codelineno-0-3200"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-3201" name="__codelineno-0-3201" href="#__codelineno-0-3201"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-3202" name="__codelineno-0-3202" href="#__codelineno-0-3202"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-3203" name="__codelineno-0-3203" href="#__codelineno-0-3203"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-0-3204" name="__codelineno-0-3204" href="#__codelineno-0-3204"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-0-3205" name="__codelineno-0-3205" href="#__codelineno-0-3205"></a><span class="sd">    method_type</span>
<a id="__codelineno-0-3206" name="__codelineno-0-3206" href="#__codelineno-0-3206"></a><span class="sd">        &quot;ln&quot;, &quot;log10&quot;, &quot;log2&quot;, &quot;exp&quot;, &quot;powOf2&quot; (2^x), &quot;powOf10&quot; (10^x), &quot;powOfN&quot; (N^x),</span>
<a id="__codelineno-0-3207" name="__codelineno-0-3207" href="#__codelineno-0-3207"></a><span class="sd">        &quot;sqrt&quot; (square root), &quot;cbrt&quot; (cube root), &quot;sq&quot; (square), &quot;cb&quot; (cube), &quot;toPowerN&quot; (x^N),</span>
<a id="__codelineno-0-3208" name="__codelineno-0-3208" href="#__codelineno-0-3208"></a><span class="sd">        &quot;sin&quot;, &quot;cos&quot;, &quot;tan&quot;, &quot;asin&quot;, &quot;acos&quot;, &quot;atan&quot;, &quot;radians&quot;,</span>
<a id="__codelineno-0-3209" name="__codelineno-0-3209" href="#__codelineno-0-3209"></a><span class="sd">        &quot;remainderDivByN&quot; (x%N), &quot;factorial&quot; (x!), &quot;mul_inv&quot; (1/x),</span>
<a id="__codelineno-0-3210" name="__codelineno-0-3210" href="#__codelineno-0-3210"></a><span class="sd">        &quot;floor&quot;, &quot;ceil&quot;, &quot;roundN&quot; (round to N decimal places) (Default value = &quot;sqrt&quot;)</span>
<a id="__codelineno-0-3211" name="__codelineno-0-3211" href="#__codelineno-0-3211"></a><span class="sd">    N</span>
<a id="__codelineno-0-3212" name="__codelineno-0-3212" href="#__codelineno-0-3212"></a><span class="sd">        None by default. If method_type is &quot;powOfN&quot;, &quot;toPowerN&quot;, &quot;remainderDivByN&quot; or &quot;roundN&quot;, N will</span>
<a id="__codelineno-0-3213" name="__codelineno-0-3213" href="#__codelineno-0-3213"></a><span class="sd">        be used as the required constant.</span>
<a id="__codelineno-0-3214" name="__codelineno-0-3214" href="#__codelineno-0-3214"></a><span class="sd">    output_mode</span>
<a id="__codelineno-0-3215" name="__codelineno-0-3215" href="#__codelineno-0-3215"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-0-3216" name="__codelineno-0-3216" href="#__codelineno-0-3216"></a><span class="sd">        “replace” option replaces original columns with transformed columns.</span>
<a id="__codelineno-0-3217" name="__codelineno-0-3217" href="#__codelineno-0-3217"></a><span class="sd">        “append” option append transformed columns with a postfix (E.g. &quot;_ln&quot;, &quot;_powOf&lt;N&gt;&quot;)</span>
<a id="__codelineno-0-3218" name="__codelineno-0-3218" href="#__codelineno-0-3218"></a><span class="sd">        to the input dataset. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-0-3219" name="__codelineno-0-3219" href="#__codelineno-0-3219"></a><span class="sd">    print_impact</span>
<a id="__codelineno-0-3220" name="__codelineno-0-3220" href="#__codelineno-0-3220"></a><span class="sd">        True, False</span>
<a id="__codelineno-0-3221" name="__codelineno-0-3221" href="#__codelineno-0-3221"></a><span class="sd">        This argument is to print before and after descriptive statistics of the transformed features (Default value = False)</span>
<a id="__codelineno-0-3222" name="__codelineno-0-3222" href="#__codelineno-0-3222"></a>
<a id="__codelineno-0-3223" name="__codelineno-0-3223" href="#__codelineno-0-3223"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-3224" name="__codelineno-0-3224" href="#__codelineno-0-3224"></a><span class="sd">    -------</span>
<a id="__codelineno-0-3225" name="__codelineno-0-3225" href="#__codelineno-0-3225"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-0-3226" name="__codelineno-0-3226" href="#__codelineno-0-3226"></a><span class="sd">        Transformed Dataframe</span>
<a id="__codelineno-0-3227" name="__codelineno-0-3227" href="#__codelineno-0-3227"></a>
<a id="__codelineno-0-3228" name="__codelineno-0-3228" href="#__codelineno-0-3228"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-3229" name="__codelineno-0-3229" href="#__codelineno-0-3229"></a>
<a id="__codelineno-0-3230" name="__codelineno-0-3230" href="#__codelineno-0-3230"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-3231" name="__codelineno-0-3231" href="#__codelineno-0-3231"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-3232" name="__codelineno-0-3232" href="#__codelineno-0-3232"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-0-3233" name="__codelineno-0-3233" href="#__codelineno-0-3233"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-3234" name="__codelineno-0-3234" href="#__codelineno-0-3234"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-3235" name="__codelineno-0-3235" href="#__codelineno-0-3235"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-3236" name="__codelineno-0-3236" href="#__codelineno-0-3236"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-3237" name="__codelineno-0-3237" href="#__codelineno-0-3237"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-0-3238" name="__codelineno-0-3238" href="#__codelineno-0-3238"></a>
<a id="__codelineno-0-3239" name="__codelineno-0-3239" href="#__codelineno-0-3239"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">)):</span>
<a id="__codelineno-0-3240" name="__codelineno-0-3240" href="#__codelineno-0-3240"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3241" name="__codelineno-0-3241" href="#__codelineno-0-3241"></a>
<a id="__codelineno-0-3242" name="__codelineno-0-3242" href="#__codelineno-0-3242"></a>    <span class="k">if</span> <span class="n">method_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-3243" name="__codelineno-0-3243" href="#__codelineno-0-3243"></a>        <span class="s2">&quot;ln&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3244" name="__codelineno-0-3244" href="#__codelineno-0-3244"></a>        <span class="s2">&quot;log10&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3245" name="__codelineno-0-3245" href="#__codelineno-0-3245"></a>        <span class="s2">&quot;log2&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3246" name="__codelineno-0-3246" href="#__codelineno-0-3246"></a>        <span class="s2">&quot;exp&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3247" name="__codelineno-0-3247" href="#__codelineno-0-3247"></a>        <span class="s2">&quot;powOf2&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3248" name="__codelineno-0-3248" href="#__codelineno-0-3248"></a>        <span class="s2">&quot;powOf10&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3249" name="__codelineno-0-3249" href="#__codelineno-0-3249"></a>        <span class="s2">&quot;powOfN&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3250" name="__codelineno-0-3250" href="#__codelineno-0-3250"></a>        <span class="s2">&quot;sqrt&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3251" name="__codelineno-0-3251" href="#__codelineno-0-3251"></a>        <span class="s2">&quot;cbrt&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3252" name="__codelineno-0-3252" href="#__codelineno-0-3252"></a>        <span class="s2">&quot;sq&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3253" name="__codelineno-0-3253" href="#__codelineno-0-3253"></a>        <span class="s2">&quot;cb&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3254" name="__codelineno-0-3254" href="#__codelineno-0-3254"></a>        <span class="s2">&quot;toPowerN&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3255" name="__codelineno-0-3255" href="#__codelineno-0-3255"></a>        <span class="s2">&quot;sin&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3256" name="__codelineno-0-3256" href="#__codelineno-0-3256"></a>        <span class="s2">&quot;cos&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3257" name="__codelineno-0-3257" href="#__codelineno-0-3257"></a>        <span class="s2">&quot;tan&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3258" name="__codelineno-0-3258" href="#__codelineno-0-3258"></a>        <span class="s2">&quot;asin&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3259" name="__codelineno-0-3259" href="#__codelineno-0-3259"></a>        <span class="s2">&quot;acos&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3260" name="__codelineno-0-3260" href="#__codelineno-0-3260"></a>        <span class="s2">&quot;atan&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3261" name="__codelineno-0-3261" href="#__codelineno-0-3261"></a>        <span class="s2">&quot;radians&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3262" name="__codelineno-0-3262" href="#__codelineno-0-3262"></a>        <span class="s2">&quot;remainderDivByN&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3263" name="__codelineno-0-3263" href="#__codelineno-0-3263"></a>        <span class="s2">&quot;factorial&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3264" name="__codelineno-0-3264" href="#__codelineno-0-3264"></a>        <span class="s2">&quot;mul_inv&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3265" name="__codelineno-0-3265" href="#__codelineno-0-3265"></a>        <span class="s2">&quot;floor&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3266" name="__codelineno-0-3266" href="#__codelineno-0-3266"></a>        <span class="s2">&quot;ceil&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3267" name="__codelineno-0-3267" href="#__codelineno-0-3267"></a>        <span class="s2">&quot;roundN&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3268" name="__codelineno-0-3268" href="#__codelineno-0-3268"></a>    <span class="p">]:</span>
<a id="__codelineno-0-3269" name="__codelineno-0-3269" href="#__codelineno-0-3269"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input method_type&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3270" name="__codelineno-0-3270" href="#__codelineno-0-3270"></a>
<a id="__codelineno-0-3271" name="__codelineno-0-3271" href="#__codelineno-0-3271"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-3272" name="__codelineno-0-3272" href="#__codelineno-0-3272"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-0-3273" name="__codelineno-0-3273" href="#__codelineno-0-3273"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-3274" name="__codelineno-0-3274" href="#__codelineno-0-3274"></a>
<a id="__codelineno-0-3275" name="__codelineno-0-3275" href="#__codelineno-0-3275"></a>    <span class="n">transformation_function</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-3276" name="__codelineno-0-3276" href="#__codelineno-0-3276"></a>        <span class="s2">&quot;ln&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
<a id="__codelineno-0-3277" name="__codelineno-0-3277" href="#__codelineno-0-3277"></a>        <span class="s2">&quot;log10&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">log10</span><span class="p">,</span>
<a id="__codelineno-0-3278" name="__codelineno-0-3278" href="#__codelineno-0-3278"></a>        <span class="s2">&quot;log2&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">log2</span><span class="p">,</span>
<a id="__codelineno-0-3279" name="__codelineno-0-3279" href="#__codelineno-0-3279"></a>        <span class="s2">&quot;exp&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">exp</span><span class="p">,</span>
<a id="__codelineno-0-3280" name="__codelineno-0-3280" href="#__codelineno-0-3280"></a>        <span class="s2">&quot;powOf2&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">x</span><span class="p">)),</span>
<a id="__codelineno-0-3281" name="__codelineno-0-3281" href="#__codelineno-0-3281"></a>        <span class="s2">&quot;powOf10&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">x</span><span class="p">)),</span>
<a id="__codelineno-0-3282" name="__codelineno-0-3282" href="#__codelineno-0-3282"></a>        <span class="s2">&quot;powOfN&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">x</span><span class="p">)),</span>
<a id="__codelineno-0-3283" name="__codelineno-0-3283" href="#__codelineno-0-3283"></a>        <span class="s2">&quot;sqrt&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">sqrt</span><span class="p">,</span>
<a id="__codelineno-0-3284" name="__codelineno-0-3284" href="#__codelineno-0-3284"></a>        <span class="s2">&quot;cbrt&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">cbrt</span><span class="p">,</span>
<a id="__codelineno-0-3285" name="__codelineno-0-3285" href="#__codelineno-0-3285"></a>        <span class="s2">&quot;sq&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-0-3286" name="__codelineno-0-3286" href="#__codelineno-0-3286"></a>        <span class="s2">&quot;cb&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span>
<a id="__codelineno-0-3287" name="__codelineno-0-3287" href="#__codelineno-0-3287"></a>        <span class="s2">&quot;toPowerN&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="n">N</span><span class="p">),</span>
<a id="__codelineno-0-3288" name="__codelineno-0-3288" href="#__codelineno-0-3288"></a>        <span class="s2">&quot;sin&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">sin</span><span class="p">,</span>
<a id="__codelineno-0-3289" name="__codelineno-0-3289" href="#__codelineno-0-3289"></a>        <span class="s2">&quot;cos&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">cos</span><span class="p">,</span>
<a id="__codelineno-0-3290" name="__codelineno-0-3290" href="#__codelineno-0-3290"></a>        <span class="s2">&quot;tan&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">tan</span><span class="p">,</span>
<a id="__codelineno-0-3291" name="__codelineno-0-3291" href="#__codelineno-0-3291"></a>        <span class="s2">&quot;asin&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">asin</span><span class="p">,</span>
<a id="__codelineno-0-3292" name="__codelineno-0-3292" href="#__codelineno-0-3292"></a>        <span class="s2">&quot;acos&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">acos</span><span class="p">,</span>
<a id="__codelineno-0-3293" name="__codelineno-0-3293" href="#__codelineno-0-3293"></a>        <span class="s2">&quot;atan&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">atan</span><span class="p">,</span>
<a id="__codelineno-0-3294" name="__codelineno-0-3294" href="#__codelineno-0-3294"></a>        <span class="s2">&quot;radians&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">radians</span><span class="p">,</span>
<a id="__codelineno-0-3295" name="__codelineno-0-3295" href="#__codelineno-0-3295"></a>        <span class="s2">&quot;remainderDivByN&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">N</span><span class="p">)),</span>
<a id="__codelineno-0-3296" name="__codelineno-0-3296" href="#__codelineno-0-3296"></a>        <span class="s2">&quot;factorial&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">factorial</span><span class="p">,</span>
<a id="__codelineno-0-3297" name="__codelineno-0-3297" href="#__codelineno-0-3297"></a>        <span class="s2">&quot;mul_inv&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">x</span><span class="p">),</span>
<a id="__codelineno-0-3298" name="__codelineno-0-3298" href="#__codelineno-0-3298"></a>        <span class="s2">&quot;floor&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">floor</span><span class="p">,</span>
<a id="__codelineno-0-3299" name="__codelineno-0-3299" href="#__codelineno-0-3299"></a>        <span class="s2">&quot;ceil&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">ceil</span><span class="p">,</span>
<a id="__codelineno-0-3300" name="__codelineno-0-3300" href="#__codelineno-0-3300"></a>        <span class="s2">&quot;roundN&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">N</span><span class="p">)),</span>
<a id="__codelineno-0-3301" name="__codelineno-0-3301" href="#__codelineno-0-3301"></a>    <span class="p">}</span>
<a id="__codelineno-0-3302" name="__codelineno-0-3302" href="#__codelineno-0-3302"></a>
<a id="__codelineno-0-3303" name="__codelineno-0-3303" href="#__codelineno-0-3303"></a>    <span class="k">def</span> <span class="nf">get_col_name</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
<a id="__codelineno-0-3304" name="__codelineno-0-3304" href="#__codelineno-0-3304"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-3305" name="__codelineno-0-3305" href="#__codelineno-0-3305"></a>            <span class="k">return</span> <span class="n">i</span>
<a id="__codelineno-0-3306" name="__codelineno-0-3306" href="#__codelineno-0-3306"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-3307" name="__codelineno-0-3307" href="#__codelineno-0-3307"></a>            <span class="k">if</span> <span class="n">method_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;powOfN&quot;</span><span class="p">,</span> <span class="s2">&quot;toPowerN&quot;</span><span class="p">,</span> <span class="s2">&quot;remainderDivByN&quot;</span><span class="p">,</span> <span class="s2">&quot;roundN&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-3308" name="__codelineno-0-3308" href="#__codelineno-0-3308"></a>                <span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">method_type</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a id="__codelineno-0-3309" name="__codelineno-0-3309" href="#__codelineno-0-3309"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-3310" name="__codelineno-0-3310" href="#__codelineno-0-3310"></a>                <span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">method_type</span>
<a id="__codelineno-0-3311" name="__codelineno-0-3311" href="#__codelineno-0-3311"></a>
<a id="__codelineno-0-3312" name="__codelineno-0-3312" href="#__codelineno-0-3312"></a>    <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-3313" name="__codelineno-0-3313" href="#__codelineno-0-3313"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-3314" name="__codelineno-0-3314" href="#__codelineno-0-3314"></a>        <span class="n">modify_col</span> <span class="o">=</span> <span class="n">get_col_name</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-3315" name="__codelineno-0-3315" href="#__codelineno-0-3315"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">modify_col</span><span class="p">,</span> <span class="n">transformation_function</span><span class="p">[</span><span class="n">method_type</span><span class="p">](</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
<a id="__codelineno-0-3316" name="__codelineno-0-3316" href="#__codelineno-0-3316"></a>        <span class="n">output_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modify_col</span><span class="p">)</span>
<a id="__codelineno-0-3317" name="__codelineno-0-3317" href="#__codelineno-0-3317"></a>
<a id="__codelineno-0-3318" name="__codelineno-0-3318" href="#__codelineno-0-3318"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-3319" name="__codelineno-0-3319" href="#__codelineno-0-3319"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3320" name="__codelineno-0-3320" href="#__codelineno-0-3320"></a>        <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-3321" name="__codelineno-0-3321" href="#__codelineno-0-3321"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3322" name="__codelineno-0-3322" href="#__codelineno-0-3322"></a>        <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">output_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-3323" name="__codelineno-0-3323" href="#__codelineno-0-3323"></a>
<a id="__codelineno-0-3324" name="__codelineno-0-3324" href="#__codelineno-0-3324"></a>    <span class="k">return</span> <span class="n">odf</span>
<a id="__codelineno-0-3325" name="__codelineno-0-3325" href="#__codelineno-0-3325"></a>
<a id="__codelineno-0-3326" name="__codelineno-0-3326" href="#__codelineno-0-3326"></a>
<a id="__codelineno-0-3327" name="__codelineno-0-3327" href="#__codelineno-0-3327"></a><span class="k">def</span> <span class="nf">boxcox_transformation</span><span class="p">(</span>
<a id="__codelineno-0-3328" name="__codelineno-0-3328" href="#__codelineno-0-3328"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-3329" name="__codelineno-0-3329" href="#__codelineno-0-3329"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3330" name="__codelineno-0-3330" href="#__codelineno-0-3330"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-3331" name="__codelineno-0-3331" href="#__codelineno-0-3331"></a>    <span class="n">boxcox_lambda</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-3332" name="__codelineno-0-3332" href="#__codelineno-0-3332"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3333" name="__codelineno-0-3333" href="#__codelineno-0-3333"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-3334" name="__codelineno-0-3334" href="#__codelineno-0-3334"></a><span class="p">):</span>
<a id="__codelineno-0-3335" name="__codelineno-0-3335" href="#__codelineno-0-3335"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-3336" name="__codelineno-0-3336" href="#__codelineno-0-3336"></a><span class="sd">    Some machine learning algorithms require the input data to follow normal distributions. Thus, when the input</span>
<a id="__codelineno-0-3337" name="__codelineno-0-3337" href="#__codelineno-0-3337"></a><span class="sd">    data is too skewed, boxcox_transformation can be used to transform it into a more normal-like distribution. The</span>
<a id="__codelineno-0-3338" name="__codelineno-0-3338" href="#__codelineno-0-3338"></a><span class="sd">    transformed value of a sample x depends on a coefficient lambda:</span>
<a id="__codelineno-0-3339" name="__codelineno-0-3339" href="#__codelineno-0-3339"></a><span class="sd">    (1) if lambda = 0, x is transformed into log(x);</span>
<a id="__codelineno-0-3340" name="__codelineno-0-3340" href="#__codelineno-0-3340"></a><span class="sd">    (2) if lambda !=0, x is transformed into (x^lambda-1)/lambda.</span>
<a id="__codelineno-0-3341" name="__codelineno-0-3341" href="#__codelineno-0-3341"></a>
<a id="__codelineno-0-3342" name="__codelineno-0-3342" href="#__codelineno-0-3342"></a><span class="sd">    The value of lambda can be either specified by the user or automatically selected within the function.</span>
<a id="__codelineno-0-3343" name="__codelineno-0-3343" href="#__codelineno-0-3343"></a><span class="sd">    If lambda needs to be selected within the function, a range of values (0, 1, -1, 0.5, -0.5, 2, -2, 0.25, -0.25, 3, -3, 4, -4, 5, -5)</span>
<a id="__codelineno-0-3344" name="__codelineno-0-3344" href="#__codelineno-0-3344"></a><span class="sd">    will be tested and the lambda, which optimizes the KolmogorovSmirnovTest by PySpark with the theoretical distribution being normal,</span>
<a id="__codelineno-0-3345" name="__codelineno-0-3345" href="#__codelineno-0-3345"></a><span class="sd">    will be used to perform the transformation. Different lambda values can be assigned to different attributes but one attribute</span>
<a id="__codelineno-0-3346" name="__codelineno-0-3346" href="#__codelineno-0-3346"></a><span class="sd">    can only be assigned one lambda value.</span>
<a id="__codelineno-0-3347" name="__codelineno-0-3347" href="#__codelineno-0-3347"></a>
<a id="__codelineno-0-3348" name="__codelineno-0-3348" href="#__codelineno-0-3348"></a>
<a id="__codelineno-0-3349" name="__codelineno-0-3349" href="#__codelineno-0-3349"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-3350" name="__codelineno-0-3350" href="#__codelineno-0-3350"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-3351" name="__codelineno-0-3351" href="#__codelineno-0-3351"></a><span class="sd">    idf</span>
<a id="__codelineno-0-3352" name="__codelineno-0-3352" href="#__codelineno-0-3352"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-3353" name="__codelineno-0-3353" href="#__codelineno-0-3353"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-0-3354" name="__codelineno-0-3354" href="#__codelineno-0-3354"></a><span class="sd">        List of numerical columns to transform e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-3355" name="__codelineno-0-3355" href="#__codelineno-0-3355"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-3356" name="__codelineno-0-3356" href="#__codelineno-0-3356"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-3357" name="__codelineno-0-3357" href="#__codelineno-0-3357"></a><span class="sd">        &quot;all&quot; can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-0-3358" name="__codelineno-0-3358" href="#__codelineno-0-3358"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-0-3359" name="__codelineno-0-3359" href="#__codelineno-0-3359"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-0-3360" name="__codelineno-0-3360" href="#__codelineno-0-3360"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-0-3361" name="__codelineno-0-3361" href="#__codelineno-0-3361"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-3362" name="__codelineno-0-3362" href="#__codelineno-0-3362"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-3363" name="__codelineno-0-3363" href="#__codelineno-0-3363"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-3364" name="__codelineno-0-3364" href="#__codelineno-0-3364"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-0-3365" name="__codelineno-0-3365" href="#__codelineno-0-3365"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-0-3366" name="__codelineno-0-3366" href="#__codelineno-0-3366"></a><span class="sd">    boxcox_lambda</span>
<a id="__codelineno-0-3367" name="__codelineno-0-3367" href="#__codelineno-0-3367"></a><span class="sd">        Lambda value for box_cox transormation.</span>
<a id="__codelineno-0-3368" name="__codelineno-0-3368" href="#__codelineno-0-3368"></a><span class="sd">        If boxcox_lambda is not None, it will be directly used for the transformation. It can be a</span>
<a id="__codelineno-0-3369" name="__codelineno-0-3369" href="#__codelineno-0-3369"></a><span class="sd">        (1) list: each element represents a lambda value for an attribute and the length of the list</span>
<a id="__codelineno-0-3370" name="__codelineno-0-3370" href="#__codelineno-0-3370"></a><span class="sd">        must be the same as the number of columns to transform.</span>
<a id="__codelineno-0-3371" name="__codelineno-0-3371" href="#__codelineno-0-3371"></a><span class="sd">        (2) int/float: all attributes will be assigned the same lambda value.</span>
<a id="__codelineno-0-3372" name="__codelineno-0-3372" href="#__codelineno-0-3372"></a><span class="sd">        Else, search for the best lambda among [1,-1,0.5,-0.5,2,-2,0.25,-0.25,3,-3,4,-4,5,-5]</span>
<a id="__codelineno-0-3373" name="__codelineno-0-3373" href="#__codelineno-0-3373"></a><span class="sd">        for each column and apply the transformation (Default value = None)</span>
<a id="__codelineno-0-3374" name="__codelineno-0-3374" href="#__codelineno-0-3374"></a><span class="sd">    output_mode</span>
<a id="__codelineno-0-3375" name="__codelineno-0-3375" href="#__codelineno-0-3375"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-0-3376" name="__codelineno-0-3376" href="#__codelineno-0-3376"></a><span class="sd">        “replace” option replaces original columns with transformed columns.</span>
<a id="__codelineno-0-3377" name="__codelineno-0-3377" href="#__codelineno-0-3377"></a><span class="sd">        “append” option append transformed columns with a postfix &quot;_bxcx_&lt;lambda&gt;&quot;</span>
<a id="__codelineno-0-3378" name="__codelineno-0-3378" href="#__codelineno-0-3378"></a><span class="sd">        to the input dataset. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-0-3379" name="__codelineno-0-3379" href="#__codelineno-0-3379"></a><span class="sd">    print_impact</span>
<a id="__codelineno-0-3380" name="__codelineno-0-3380" href="#__codelineno-0-3380"></a><span class="sd">        True, False</span>
<a id="__codelineno-0-3381" name="__codelineno-0-3381" href="#__codelineno-0-3381"></a><span class="sd">        This argument is to print before and after descriptive statistics of the transformed features (Default value = False)</span>
<a id="__codelineno-0-3382" name="__codelineno-0-3382" href="#__codelineno-0-3382"></a>
<a id="__codelineno-0-3383" name="__codelineno-0-3383" href="#__codelineno-0-3383"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-3384" name="__codelineno-0-3384" href="#__codelineno-0-3384"></a><span class="sd">    -------</span>
<a id="__codelineno-0-3385" name="__codelineno-0-3385" href="#__codelineno-0-3385"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-0-3386" name="__codelineno-0-3386" href="#__codelineno-0-3386"></a><span class="sd">        Transformed Dataframe</span>
<a id="__codelineno-0-3387" name="__codelineno-0-3387" href="#__codelineno-0-3387"></a>
<a id="__codelineno-0-3388" name="__codelineno-0-3388" href="#__codelineno-0-3388"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-3389" name="__codelineno-0-3389" href="#__codelineno-0-3389"></a>
<a id="__codelineno-0-3390" name="__codelineno-0-3390" href="#__codelineno-0-3390"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-3391" name="__codelineno-0-3391" href="#__codelineno-0-3391"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-3392" name="__codelineno-0-3392" href="#__codelineno-0-3392"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-0-3393" name="__codelineno-0-3393" href="#__codelineno-0-3393"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-3394" name="__codelineno-0-3394" href="#__codelineno-0-3394"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-3395" name="__codelineno-0-3395" href="#__codelineno-0-3395"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-3396" name="__codelineno-0-3396" href="#__codelineno-0-3396"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-3397" name="__codelineno-0-3397" href="#__codelineno-0-3397"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-0-3398" name="__codelineno-0-3398" href="#__codelineno-0-3398"></a>
<a id="__codelineno-0-3399" name="__codelineno-0-3399" href="#__codelineno-0-3399"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">)):</span>
<a id="__codelineno-0-3400" name="__codelineno-0-3400" href="#__codelineno-0-3400"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3401" name="__codelineno-0-3401" href="#__codelineno-0-3401"></a>
<a id="__codelineno-0-3402" name="__codelineno-0-3402" href="#__codelineno-0-3402"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-3403" name="__codelineno-0-3403" href="#__codelineno-0-3403"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-0-3404" name="__codelineno-0-3404" href="#__codelineno-0-3404"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-3405" name="__codelineno-0-3405" href="#__codelineno-0-3405"></a>    <span class="n">col_mins</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">F</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">])</span>
<a id="__codelineno-0-3406" name="__codelineno-0-3406" href="#__codelineno-0-3406"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">col_mins</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()]):</span>
<a id="__codelineno-0-3407" name="__codelineno-0-3407" href="#__codelineno-0-3407"></a>        <span class="n">col_mins</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-3408" name="__codelineno-0-3408" href="#__codelineno-0-3408"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Data must be positive&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3409" name="__codelineno-0-3409" href="#__codelineno-0-3409"></a>
<a id="__codelineno-0-3410" name="__codelineno-0-3410" href="#__codelineno-0-3410"></a>    <span class="k">if</span> <span class="n">boxcox_lambda</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-3411" name="__codelineno-0-3411" href="#__codelineno-0-3411"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">boxcox_lambda</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
<a id="__codelineno-0-3412" name="__codelineno-0-3412" href="#__codelineno-0-3412"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">boxcox_lambda</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-3413" name="__codelineno-0-3413" href="#__codelineno-0-3413"></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for boxcox_lambda&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3414" name="__codelineno-0-3414" href="#__codelineno-0-3414"></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">boxcox_lambda</span><span class="p">]):</span>
<a id="__codelineno-0-3415" name="__codelineno-0-3415" href="#__codelineno-0-3415"></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for boxcox_lambda&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3416" name="__codelineno-0-3416" href="#__codelineno-0-3416"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-3417" name="__codelineno-0-3417" href="#__codelineno-0-3417"></a>                <span class="n">boxcox_lambda_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">boxcox_lambda</span><span class="p">)</span>
<a id="__codelineno-0-3418" name="__codelineno-0-3418" href="#__codelineno-0-3418"></a>
<a id="__codelineno-0-3419" name="__codelineno-0-3419" href="#__codelineno-0-3419"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">boxcox_lambda</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
<a id="__codelineno-0-3420" name="__codelineno-0-3420" href="#__codelineno-0-3420"></a>            <span class="n">boxcox_lambda_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">boxcox_lambda</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-0-3421" name="__codelineno-0-3421" href="#__codelineno-0-3421"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-3422" name="__codelineno-0-3422" href="#__codelineno-0-3422"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for boxcox_lambda&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3423" name="__codelineno-0-3423" href="#__codelineno-0-3423"></a>
<a id="__codelineno-0-3424" name="__codelineno-0-3424" href="#__codelineno-0-3424"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-3425" name="__codelineno-0-3425" href="#__codelineno-0-3425"></a>        <span class="n">boxcox_lambda_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-3426" name="__codelineno-0-3426" href="#__codelineno-0-3426"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-3427" name="__codelineno-0-3427" href="#__codelineno-0-3427"></a>            <span class="n">lambdaVal</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">]</span>
<a id="__codelineno-0-3428" name="__codelineno-0-3428" href="#__codelineno-0-3428"></a>            <span class="n">best_pVal</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-3429" name="__codelineno-0-3429" href="#__codelineno-0-3429"></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">lambdaVal</span><span class="p">:</span>
<a id="__codelineno-0-3430" name="__codelineno-0-3430" href="#__codelineno-0-3430"></a>                <span class="n">pVal</span> <span class="o">=</span> <span class="n">Statistics</span><span class="o">.</span><span class="n">kolmogorovSmirnovTest</span><span class="p">(</span>
<a id="__codelineno-0-3431" name="__codelineno-0-3431" href="#__codelineno-0-3431"></a>                    <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">j</span><span class="p">))</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">),</span> <span class="s2">&quot;norm&quot;</span>
<a id="__codelineno-0-3432" name="__codelineno-0-3432" href="#__codelineno-0-3432"></a>                <span class="p">)</span><span class="o">.</span><span class="n">pValue</span>
<a id="__codelineno-0-3433" name="__codelineno-0-3433" href="#__codelineno-0-3433"></a>                <span class="k">if</span> <span class="n">pVal</span> <span class="o">&gt;</span> <span class="n">best_pVal</span><span class="p">:</span>
<a id="__codelineno-0-3434" name="__codelineno-0-3434" href="#__codelineno-0-3434"></a>                    <span class="n">best_pVal</span> <span class="o">=</span> <span class="n">pVal</span>
<a id="__codelineno-0-3435" name="__codelineno-0-3435" href="#__codelineno-0-3435"></a>                    <span class="n">best_lambdaVal</span> <span class="o">=</span> <span class="n">j</span>
<a id="__codelineno-0-3436" name="__codelineno-0-3436" href="#__codelineno-0-3436"></a>
<a id="__codelineno-0-3437" name="__codelineno-0-3437" href="#__codelineno-0-3437"></a>            <span class="n">pVal</span> <span class="o">=</span> <span class="n">Statistics</span><span class="o">.</span><span class="n">kolmogorovSmirnovTest</span><span class="p">(</span>
<a id="__codelineno-0-3438" name="__codelineno-0-3438" href="#__codelineno-0-3438"></a>                <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">),</span> <span class="s2">&quot;norm&quot;</span>
<a id="__codelineno-0-3439" name="__codelineno-0-3439" href="#__codelineno-0-3439"></a>            <span class="p">)</span><span class="o">.</span><span class="n">pValue</span>
<a id="__codelineno-0-3440" name="__codelineno-0-3440" href="#__codelineno-0-3440"></a>            <span class="k">if</span> <span class="n">pVal</span> <span class="o">&gt;</span> <span class="n">best_pVal</span><span class="p">:</span>
<a id="__codelineno-0-3441" name="__codelineno-0-3441" href="#__codelineno-0-3441"></a>                <span class="n">best_pVal</span> <span class="o">=</span> <span class="n">pVal</span>
<a id="__codelineno-0-3442" name="__codelineno-0-3442" href="#__codelineno-0-3442"></a>                <span class="n">best_lambdaVal</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-3443" name="__codelineno-0-3443" href="#__codelineno-0-3443"></a>            <span class="n">boxcox_lambda_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_lambdaVal</span><span class="p">)</span>
<a id="__codelineno-0-3444" name="__codelineno-0-3444" href="#__codelineno-0-3444"></a>
<a id="__codelineno-0-3445" name="__codelineno-0-3445" href="#__codelineno-0-3445"></a>    <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-3446" name="__codelineno-0-3446" href="#__codelineno-0-3446"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">curr_lambdaVal</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="n">boxcox_lambda_list</span><span class="p">):</span>
<a id="__codelineno-0-3447" name="__codelineno-0-3447" href="#__codelineno-0-3447"></a>        <span class="k">if</span> <span class="n">curr_lambdaVal</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-3448" name="__codelineno-0-3448" href="#__codelineno-0-3448"></a>            <span class="n">modify_col</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-3449" name="__codelineno-0-3449" href="#__codelineno-0-3449"></a>                <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_bxcx_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">curr_lambdaVal</span><span class="p">))</span> <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;append&quot;</span> <span class="k">else</span> <span class="n">i</span>
<a id="__codelineno-0-3450" name="__codelineno-0-3450" href="#__codelineno-0-3450"></a>            <span class="p">)</span>
<a id="__codelineno-0-3451" name="__codelineno-0-3451" href="#__codelineno-0-3451"></a>            <span class="n">output_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modify_col</span><span class="p">)</span>
<a id="__codelineno-0-3452" name="__codelineno-0-3452" href="#__codelineno-0-3452"></a>            <span class="k">if</span> <span class="n">curr_lambdaVal</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-3453" name="__codelineno-0-3453" href="#__codelineno-0-3453"></a>                <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">modify_col</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
<a id="__codelineno-0-3454" name="__codelineno-0-3454" href="#__codelineno-0-3454"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-3455" name="__codelineno-0-3455" href="#__codelineno-0-3455"></a>                <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">modify_col</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">curr_lambdaVal</span><span class="p">))</span>
<a id="__codelineno-0-3456" name="__codelineno-0-3456" href="#__codelineno-0-3456"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-3457" name="__codelineno-0-3457" href="#__codelineno-0-3457"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-3458" name="__codelineno-0-3458" href="#__codelineno-0-3458"></a>            <span class="s2">&quot;lambdaVal for all columns are 1 so no transformation is performed and idf is returned&quot;</span>
<a id="__codelineno-0-3459" name="__codelineno-0-3459" href="#__codelineno-0-3459"></a>        <span class="p">)</span>
<a id="__codelineno-0-3460" name="__codelineno-0-3460" href="#__codelineno-0-3460"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-0-3461" name="__codelineno-0-3461" href="#__codelineno-0-3461"></a>
<a id="__codelineno-0-3462" name="__codelineno-0-3462" href="#__codelineno-0-3462"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-3463" name="__codelineno-0-3463" href="#__codelineno-0-3463"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Transformed Columns: &quot;</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-0-3464" name="__codelineno-0-3464" href="#__codelineno-0-3464"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best BoxCox Parameter(s): &quot;</span><span class="p">,</span> <span class="n">boxcox_lambda_list</span><span class="p">)</span>
<a id="__codelineno-0-3465" name="__codelineno-0-3465" href="#__codelineno-0-3465"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3466" name="__codelineno-0-3466" href="#__codelineno-0-3466"></a>        <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">unionByName</span><span class="p">(</span>
<a id="__codelineno-0-3467" name="__codelineno-0-3467" href="#__codelineno-0-3467"></a>            <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">F</span><span class="o">.</span><span class="n">skewness</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">])</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-3468" name="__codelineno-0-3468" href="#__codelineno-0-3468"></a>                <span class="s2">&quot;summary&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&quot;skewness&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3469" name="__codelineno-0-3469" href="#__codelineno-0-3469"></a>            <span class="p">)</span>
<a id="__codelineno-0-3470" name="__codelineno-0-3470" href="#__codelineno-0-3470"></a>        <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-3471" name="__codelineno-0-3471" href="#__codelineno-0-3471"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3472" name="__codelineno-0-3472" href="#__codelineno-0-3472"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-3473" name="__codelineno-0-3473" href="#__codelineno-0-3473"></a>            <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">unionByName</span><span class="p">(</span>
<a id="__codelineno-0-3474" name="__codelineno-0-3474" href="#__codelineno-0-3474"></a>                <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">F</span><span class="o">.</span><span class="n">skewness</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">])</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-3475" name="__codelineno-0-3475" href="#__codelineno-0-3475"></a>                    <span class="s2">&quot;summary&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&quot;skewness&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3476" name="__codelineno-0-3476" href="#__codelineno-0-3476"></a>                <span class="p">)</span>
<a id="__codelineno-0-3477" name="__codelineno-0-3477" href="#__codelineno-0-3477"></a>            <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-3478" name="__codelineno-0-3478" href="#__codelineno-0-3478"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-3479" name="__codelineno-0-3479" href="#__codelineno-0-3479"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;`&quot;</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;`&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">output_cols</span><span class="p">]</span>
<a id="__codelineno-0-3480" name="__codelineno-0-3480" href="#__codelineno-0-3480"></a>            <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">output_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">unionByName</span><span class="p">(</span>
<a id="__codelineno-0-3481" name="__codelineno-0-3481" href="#__codelineno-0-3481"></a>                <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-0-3482" name="__codelineno-0-3482" href="#__codelineno-0-3482"></a>                    <span class="p">[</span><span class="n">F</span><span class="o">.</span><span class="n">skewness</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">output_cols</span><span class="p">]</span>
<a id="__codelineno-0-3483" name="__codelineno-0-3483" href="#__codelineno-0-3483"></a>                <span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;summary&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&quot;skewness&quot;</span><span class="p">))</span>
<a id="__codelineno-0-3484" name="__codelineno-0-3484" href="#__codelineno-0-3484"></a>            <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-3485" name="__codelineno-0-3485" href="#__codelineno-0-3485"></a>
<a id="__codelineno-0-3486" name="__codelineno-0-3486" href="#__codelineno-0-3486"></a>    <span class="k">return</span> <span class="n">odf</span>
<a id="__codelineno-0-3487" name="__codelineno-0-3487" href="#__codelineno-0-3487"></a>
<a id="__codelineno-0-3488" name="__codelineno-0-3488" href="#__codelineno-0-3488"></a>
<a id="__codelineno-0-3489" name="__codelineno-0-3489" href="#__codelineno-0-3489"></a><span class="k">def</span> <span class="nf">outlier_categories</span><span class="p">(</span>
<a id="__codelineno-0-3490" name="__codelineno-0-3490" href="#__codelineno-0-3490"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-0-3491" name="__codelineno-0-3491" href="#__codelineno-0-3491"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-0-3492" name="__codelineno-0-3492" href="#__codelineno-0-3492"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3493" name="__codelineno-0-3493" href="#__codelineno-0-3493"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-3494" name="__codelineno-0-3494" href="#__codelineno-0-3494"></a>    <span class="n">coverage</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-3495" name="__codelineno-0-3495" href="#__codelineno-0-3495"></a>    <span class="n">max_category</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-0-3496" name="__codelineno-0-3496" href="#__codelineno-0-3496"></a>    <span class="n">pre_existing_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-3497" name="__codelineno-0-3497" href="#__codelineno-0-3497"></a>    <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3498" name="__codelineno-0-3498" href="#__codelineno-0-3498"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3499" name="__codelineno-0-3499" href="#__codelineno-0-3499"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-3500" name="__codelineno-0-3500" href="#__codelineno-0-3500"></a><span class="p">):</span>
<a id="__codelineno-0-3501" name="__codelineno-0-3501" href="#__codelineno-0-3501"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-3502" name="__codelineno-0-3502" href="#__codelineno-0-3502"></a><span class="sd">    This function replaces less frequently seen values (called as outlier values in the current context) in a</span>
<a id="__codelineno-0-3503" name="__codelineno-0-3503" href="#__codelineno-0-3503"></a><span class="sd">    categorical column by &#39;outlier_categories&#39;. Outlier values can be defined in two ways –</span>
<a id="__codelineno-0-3504" name="__codelineno-0-3504" href="#__codelineno-0-3504"></a><span class="sd">    a) Max N categories, where N is user defined value. In this method, top N-1 frequently seen categories are considered</span>
<a id="__codelineno-0-3505" name="__codelineno-0-3505" href="#__codelineno-0-3505"></a><span class="sd">    and rest are clubbed under single category &#39;outlier_categories&#39;. or Alternatively,</span>
<a id="__codelineno-0-3506" name="__codelineno-0-3506" href="#__codelineno-0-3506"></a><span class="sd">    b) Coverage – top frequently seen categories are considered till it covers minimum N% of rows and rest lesser seen values</span>
<a id="__codelineno-0-3507" name="__codelineno-0-3507" href="#__codelineno-0-3507"></a><span class="sd">    are mapped to &#39;outlier_categories&#39;. Even if the Coverage is less, maximum category constraint is given priority. Further,</span>
<a id="__codelineno-0-3508" name="__codelineno-0-3508" href="#__codelineno-0-3508"></a><span class="sd">    there is a caveat that when multiple categories have same rank. Then, number of categorical values can be more than</span>
<a id="__codelineno-0-3509" name="__codelineno-0-3509" href="#__codelineno-0-3509"></a><span class="sd">    max_category defined by the user.</span>
<a id="__codelineno-0-3510" name="__codelineno-0-3510" href="#__codelineno-0-3510"></a>
<a id="__codelineno-0-3511" name="__codelineno-0-3511" href="#__codelineno-0-3511"></a><span class="sd">    This function performs better when distinct values, in any column, are not more than 100. It is recommended that to drop those</span>
<a id="__codelineno-0-3512" name="__codelineno-0-3512" href="#__codelineno-0-3512"></a><span class="sd">    columns from the computation which has more than 100 distinct values, to get better performance out of this function.</span>
<a id="__codelineno-0-3513" name="__codelineno-0-3513" href="#__codelineno-0-3513"></a>
<a id="__codelineno-0-3514" name="__codelineno-0-3514" href="#__codelineno-0-3514"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-3515" name="__codelineno-0-3515" href="#__codelineno-0-3515"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-3516" name="__codelineno-0-3516" href="#__codelineno-0-3516"></a><span class="sd">    spark</span>
<a id="__codelineno-0-3517" name="__codelineno-0-3517" href="#__codelineno-0-3517"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-0-3518" name="__codelineno-0-3518" href="#__codelineno-0-3518"></a><span class="sd">    idf</span>
<a id="__codelineno-0-3519" name="__codelineno-0-3519" href="#__codelineno-0-3519"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-3520" name="__codelineno-0-3520" href="#__codelineno-0-3520"></a><span class="sd">        list_of_cols</span>
<a id="__codelineno-0-3521" name="__codelineno-0-3521" href="#__codelineno-0-3521"></a><span class="sd">        List of categorical columns to transform e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-3522" name="__codelineno-0-3522" href="#__codelineno-0-3522"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-3523" name="__codelineno-0-3523" href="#__codelineno-0-3523"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-3524" name="__codelineno-0-3524" href="#__codelineno-0-3524"></a><span class="sd">        &quot;all&quot; can be passed to include all categorical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-0-3525" name="__codelineno-0-3525" href="#__codelineno-0-3525"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-0-3526" name="__codelineno-0-3526" href="#__codelineno-0-3526"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-0-3527" name="__codelineno-0-3527" href="#__codelineno-0-3527"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-0-3528" name="__codelineno-0-3528" href="#__codelineno-0-3528"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-0-3529" name="__codelineno-0-3529" href="#__codelineno-0-3529"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-0-3530" name="__codelineno-0-3530" href="#__codelineno-0-3530"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-0-3531" name="__codelineno-0-3531" href="#__codelineno-0-3531"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-0-3532" name="__codelineno-0-3532" href="#__codelineno-0-3532"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-0-3533" name="__codelineno-0-3533" href="#__codelineno-0-3533"></a><span class="sd">    coverage</span>
<a id="__codelineno-0-3534" name="__codelineno-0-3534" href="#__codelineno-0-3534"></a><span class="sd">        Defines the minimum % of rows that will be mapped to actual category name and the rest to be mapped</span>
<a id="__codelineno-0-3535" name="__codelineno-0-3535" href="#__codelineno-0-3535"></a><span class="sd">        to &#39;outlier_categories&#39; and takes value between 0 to 1. Coverage of 0.8 can be interpreted as top frequently seen</span>
<a id="__codelineno-0-3536" name="__codelineno-0-3536" href="#__codelineno-0-3536"></a><span class="sd">        categories are considered till it covers minimum 80% of rows and rest lesser seen values are mapped to &#39;outlier_categories&#39;. (Default value = 1.0)</span>
<a id="__codelineno-0-3537" name="__codelineno-0-3537" href="#__codelineno-0-3537"></a><span class="sd">    max_category</span>
<a id="__codelineno-0-3538" name="__codelineno-0-3538" href="#__codelineno-0-3538"></a><span class="sd">        Even if coverage is less, only (max_category - 1) categories will be mapped to actual name and rest to &#39;outlier_categories&#39;.</span>
<a id="__codelineno-0-3539" name="__codelineno-0-3539" href="#__codelineno-0-3539"></a><span class="sd">        Caveat is when multiple categories have same rank, then #categories can be more than max_category. (Default value = 50)</span>
<a id="__codelineno-0-3540" name="__codelineno-0-3540" href="#__codelineno-0-3540"></a><span class="sd">    pre_existing_model</span>
<a id="__codelineno-0-3541" name="__codelineno-0-3541" href="#__codelineno-0-3541"></a><span class="sd">        Boolean argument – True or False. True if the model with the outlier/other values</span>
<a id="__codelineno-0-3542" name="__codelineno-0-3542" href="#__codelineno-0-3542"></a><span class="sd">        for each attribute exists already to be used, False Otherwise. (Default value = False)</span>
<a id="__codelineno-0-3543" name="__codelineno-0-3543" href="#__codelineno-0-3543"></a><span class="sd">    model_path</span>
<a id="__codelineno-0-3544" name="__codelineno-0-3544" href="#__codelineno-0-3544"></a><span class="sd">        If pre_existing_model is True, this argument is path for the pre-saved model.</span>
<a id="__codelineno-0-3545" name="__codelineno-0-3545" href="#__codelineno-0-3545"></a><span class="sd">        If pre_existing_model is False, this field can be used for saving the model.</span>
<a id="__codelineno-0-3546" name="__codelineno-0-3546" href="#__codelineno-0-3546"></a><span class="sd">        Default &quot;NA&quot; means there is neither pre-existing model nor there is a need to save one.</span>
<a id="__codelineno-0-3547" name="__codelineno-0-3547" href="#__codelineno-0-3547"></a><span class="sd">    output_mode</span>
<a id="__codelineno-0-3548" name="__codelineno-0-3548" href="#__codelineno-0-3548"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-0-3549" name="__codelineno-0-3549" href="#__codelineno-0-3549"></a><span class="sd">        “replace” option replaces original columns with transformed column. “append” option append transformed</span>
<a id="__codelineno-0-3550" name="__codelineno-0-3550" href="#__codelineno-0-3550"></a><span class="sd">        column to the input dataset with a postfix &quot;_outliered&quot; e.g. column X is appended as X_outliered. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-0-3551" name="__codelineno-0-3551" href="#__codelineno-0-3551"></a><span class="sd">    print_impact</span>
<a id="__codelineno-0-3552" name="__codelineno-0-3552" href="#__codelineno-0-3552"></a><span class="sd">        True, False</span>
<a id="__codelineno-0-3553" name="__codelineno-0-3553" href="#__codelineno-0-3553"></a><span class="sd">        This argument is to print before and after unique count of the transformed features (Default value = False)</span>
<a id="__codelineno-0-3554" name="__codelineno-0-3554" href="#__codelineno-0-3554"></a>
<a id="__codelineno-0-3555" name="__codelineno-0-3555" href="#__codelineno-0-3555"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-3556" name="__codelineno-0-3556" href="#__codelineno-0-3556"></a><span class="sd">    -------</span>
<a id="__codelineno-0-3557" name="__codelineno-0-3557" href="#__codelineno-0-3557"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-0-3558" name="__codelineno-0-3558" href="#__codelineno-0-3558"></a><span class="sd">        Transformed Dataframe</span>
<a id="__codelineno-0-3559" name="__codelineno-0-3559" href="#__codelineno-0-3559"></a>
<a id="__codelineno-0-3560" name="__codelineno-0-3560" href="#__codelineno-0-3560"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-3561" name="__codelineno-0-3561" href="#__codelineno-0-3561"></a>    <span class="n">cat_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-3562" name="__codelineno-0-3562" href="#__codelineno-0-3562"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-3563" name="__codelineno-0-3563" href="#__codelineno-0-3563"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">cat_cols</span>
<a id="__codelineno-0-3564" name="__codelineno-0-3564" href="#__codelineno-0-3564"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-3565" name="__codelineno-0-3565" href="#__codelineno-0-3565"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-3566" name="__codelineno-0-3566" href="#__codelineno-0-3566"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-3567" name="__codelineno-0-3567" href="#__codelineno-0-3567"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-3568" name="__codelineno-0-3568" href="#__codelineno-0-3568"></a>
<a id="__codelineno-0-3569" name="__codelineno-0-3569" href="#__codelineno-0-3569"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-0-3570" name="__codelineno-0-3570" href="#__codelineno-0-3570"></a>
<a id="__codelineno-0-3571" name="__codelineno-0-3571" href="#__codelineno-0-3571"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cat_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-3572" name="__codelineno-0-3572" href="#__codelineno-0-3572"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3573" name="__codelineno-0-3573" href="#__codelineno-0-3573"></a>
<a id="__codelineno-0-3574" name="__codelineno-0-3574" href="#__codelineno-0-3574"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-3575" name="__codelineno-0-3575" href="#__codelineno-0-3575"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-3576" name="__codelineno-0-3576" href="#__codelineno-0-3576"></a>            <span class="s2">&quot;No Outlier Categories Computation - No categorical column(s) to transform&quot;</span>
<a id="__codelineno-0-3577" name="__codelineno-0-3577" href="#__codelineno-0-3577"></a>        <span class="p">)</span>
<a id="__codelineno-0-3578" name="__codelineno-0-3578" href="#__codelineno-0-3578"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-0-3579" name="__codelineno-0-3579" href="#__codelineno-0-3579"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">coverage</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">coverage</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-3580" name="__codelineno-0-3580" href="#__codelineno-0-3580"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Coverage Value&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3581" name="__codelineno-0-3581" href="#__codelineno-0-3581"></a>    <span class="k">if</span> <span class="n">max_category</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-3582" name="__codelineno-0-3582" href="#__codelineno-0-3582"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Maximum No. of Categories Allowed&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3583" name="__codelineno-0-3583" href="#__codelineno-0-3583"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">):</span>
<a id="__codelineno-0-3584" name="__codelineno-0-3584" href="#__codelineno-0-3584"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for output_mode&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3585" name="__codelineno-0-3585" href="#__codelineno-0-3585"></a>
<a id="__codelineno-0-3586" name="__codelineno-0-3586" href="#__codelineno-0-3586"></a>    <span class="n">idf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">persist</span><span class="p">(</span><span class="n">pyspark</span><span class="o">.</span><span class="n">StorageLevel</span><span class="o">.</span><span class="n">MEMORY_AND_DISK</span><span class="p">)</span>
<a id="__codelineno-0-3587" name="__codelineno-0-3587" href="#__codelineno-0-3587"></a>
<a id="__codelineno-0-3588" name="__codelineno-0-3588" href="#__codelineno-0-3588"></a>    <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-0-3589" name="__codelineno-0-3589" href="#__codelineno-0-3589"></a>        <span class="n">df_model</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span>
<a id="__codelineno-0-3590" name="__codelineno-0-3590" href="#__codelineno-0-3590"></a>            <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/outlier_categories&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-3591" name="__codelineno-0-3591" href="#__codelineno-0-3591"></a>        <span class="p">)</span>
<a id="__codelineno-0-3592" name="__codelineno-0-3592" href="#__codelineno-0-3592"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-3593" name="__codelineno-0-3593" href="#__codelineno-0-3593"></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-0-3594" name="__codelineno-0-3594" href="#__codelineno-0-3594"></a>            <span class="n">window</span> <span class="o">=</span> <span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">()</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">desc</span><span class="p">(</span><span class="s2">&quot;count_pct&quot;</span><span class="p">))</span>
<a id="__codelineno-0-3595" name="__codelineno-0-3595" href="#__codelineno-0-3595"></a>            <span class="n">df_cats</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-3596" name="__codelineno-0-3596" href="#__codelineno-0-3596"></a>                <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-3597" name="__codelineno-0-3597" href="#__codelineno-0-3597"></a>                <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-3598" name="__codelineno-0-3598" href="#__codelineno-0-3598"></a>                <span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-0-3599" name="__codelineno-0-3599" href="#__codelineno-0-3599"></a>                <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<a id="__codelineno-0-3600" name="__codelineno-0-3600" href="#__codelineno-0-3600"></a>                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-3601" name="__codelineno-0-3601" href="#__codelineno-0-3601"></a>                    <span class="s2">&quot;count_pct&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3602" name="__codelineno-0-3602" href="#__codelineno-0-3602"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">F</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">()),</span>
<a id="__codelineno-0-3603" name="__codelineno-0-3603" href="#__codelineno-0-3603"></a>                <span class="p">)</span>
<a id="__codelineno-0-3604" name="__codelineno-0-3604" href="#__codelineno-0-3604"></a>                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;rank&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="p">))</span>
<a id="__codelineno-0-3605" name="__codelineno-0-3605" href="#__codelineno-0-3605"></a>                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-3606" name="__codelineno-0-3606" href="#__codelineno-0-3606"></a>                    <span class="s2">&quot;cumu&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3607" name="__codelineno-0-3607" href="#__codelineno-0-3607"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;count_pct&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span>
<a id="__codelineno-0-3608" name="__codelineno-0-3608" href="#__codelineno-0-3608"></a>                        <span class="n">window</span><span class="o">.</span><span class="n">rowsBetween</span><span class="p">(</span><span class="n">Window</span><span class="o">.</span><span class="n">unboundedPreceding</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-3609" name="__codelineno-0-3609" href="#__codelineno-0-3609"></a>                    <span class="p">),</span>
<a id="__codelineno-0-3610" name="__codelineno-0-3610" href="#__codelineno-0-3610"></a>                <span class="p">)</span>
<a id="__codelineno-0-3611" name="__codelineno-0-3611" href="#__codelineno-0-3611"></a>                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;lag_cumu&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lag</span><span class="p">(</span><span class="s2">&quot;cumu&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="p">))</span>
<a id="__codelineno-0-3612" name="__codelineno-0-3612" href="#__codelineno-0-3612"></a>                <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-3613" name="__codelineno-0-3613" href="#__codelineno-0-3613"></a>                <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="p">((</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;cumu&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">coverage</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;lag_cumu&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">coverage</span><span class="p">)))</span>
<a id="__codelineno-0-3614" name="__codelineno-0-3614" href="#__codelineno-0-3614"></a>                <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;rank&quot;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">max_category</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-3615" name="__codelineno-0-3615" href="#__codelineno-0-3615"></a>                <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;parameters&quot;</span><span class="p">))</span>
<a id="__codelineno-0-3616" name="__codelineno-0-3616" href="#__codelineno-0-3616"></a>            <span class="p">)</span>
<a id="__codelineno-0-3617" name="__codelineno-0-3617" href="#__codelineno-0-3617"></a>            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-3618" name="__codelineno-0-3618" href="#__codelineno-0-3618"></a>                <span class="n">df_model</span> <span class="o">=</span> <span class="n">df_cats</span>
<a id="__codelineno-0-3619" name="__codelineno-0-3619" href="#__codelineno-0-3619"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-3620" name="__codelineno-0-3620" href="#__codelineno-0-3620"></a>                <span class="n">df_model</span> <span class="o">=</span> <span class="n">df_model</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">df_cats</span><span class="p">)</span>
<a id="__codelineno-0-3621" name="__codelineno-0-3621" href="#__codelineno-0-3621"></a>
<a id="__codelineno-0-3622" name="__codelineno-0-3622" href="#__codelineno-0-3622"></a>    <span class="n">df_params</span> <span class="o">=</span> <span class="n">df_model</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">groupByKey</span><span class="p">()</span><span class="o">.</span><span class="n">mapValues</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-0-3623" name="__codelineno-0-3623" href="#__codelineno-0-3623"></a>    <span class="n">dict_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">df_params</span><span class="p">)</span>
<a id="__codelineno-0-3624" name="__codelineno-0-3624" href="#__codelineno-0-3624"></a>    <span class="n">broadcast_params</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="n">dict_params</span><span class="p">)</span>
<a id="__codelineno-0-3625" name="__codelineno-0-3625" href="#__codelineno-0-3625"></a>
<a id="__codelineno-0-3626" name="__codelineno-0-3626" href="#__codelineno-0-3626"></a>    <span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
<a id="__codelineno-0-3627" name="__codelineno-0-3627" href="#__codelineno-0-3627"></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-0-3628" name="__codelineno-0-3628" href="#__codelineno-0-3628"></a>        <span class="n">dict_params</span> <span class="o">=</span> <span class="n">broadcast_params</span><span class="o">.</span><span class="n">value</span>
<a id="__codelineno-0-3629" name="__codelineno-0-3629" href="#__codelineno-0-3629"></a>        <span class="n">params</span> <span class="o">=</span> <span class="n">dict_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<a id="__codelineno-0-3630" name="__codelineno-0-3630" href="#__codelineno-0-3630"></a>        <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-0-3631" name="__codelineno-0-3631" href="#__codelineno-0-3631"></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="n">params</span>
<a id="__codelineno-0-3632" name="__codelineno-0-3632" href="#__codelineno-0-3632"></a>        <span class="k">return</span> <span class="n">parameters</span>
<a id="__codelineno-0-3633" name="__codelineno-0-3633" href="#__codelineno-0-3633"></a>
<a id="__codelineno-0-3634" name="__codelineno-0-3634" href="#__codelineno-0-3634"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-3635" name="__codelineno-0-3635" href="#__codelineno-0-3635"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-0-3636" name="__codelineno-0-3636" href="#__codelineno-0-3636"></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-3637" name="__codelineno-0-3637" href="#__codelineno-0-3637"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-3638" name="__codelineno-0-3638" href="#__codelineno-0-3638"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-3639" name="__codelineno-0-3639" href="#__codelineno-0-3639"></a>                <span class="n">i</span><span class="p">,</span>
<a id="__codelineno-0-3640" name="__codelineno-0-3640" href="#__codelineno-0-3640"></a>                <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
<a id="__codelineno-0-3641" name="__codelineno-0-3641" href="#__codelineno-0-3641"></a>                    <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">()),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-3642" name="__codelineno-0-3642" href="#__codelineno-0-3642"></a>                <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="s2">&quot;outlier_categories&quot;</span><span class="p">),</span>
<a id="__codelineno-0-3643" name="__codelineno-0-3643" href="#__codelineno-0-3643"></a>            <span class="p">)</span>
<a id="__codelineno-0-3644" name="__codelineno-0-3644" href="#__codelineno-0-3644"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-3645" name="__codelineno-0-3645" href="#__codelineno-0-3645"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-0-3646" name="__codelineno-0-3646" href="#__codelineno-0-3646"></a>                <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_outliered&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3647" name="__codelineno-0-3647" href="#__codelineno-0-3647"></a>                <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
<a id="__codelineno-0-3648" name="__codelineno-0-3648" href="#__codelineno-0-3648"></a>                    <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">()),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-3649" name="__codelineno-0-3649" href="#__codelineno-0-3649"></a>                <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="s2">&quot;outlier_categories&quot;</span><span class="p">),</span>
<a id="__codelineno-0-3650" name="__codelineno-0-3650" href="#__codelineno-0-3650"></a>            <span class="p">)</span>
<a id="__codelineno-0-3651" name="__codelineno-0-3651" href="#__codelineno-0-3651"></a>
<a id="__codelineno-0-3652" name="__codelineno-0-3652" href="#__codelineno-0-3652"></a>    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pre_existing_model</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">):</span>
<a id="__codelineno-0-3653" name="__codelineno-0-3653" href="#__codelineno-0-3653"></a>        <span class="n">df_model</span><span class="o">.</span><span class="n">repartition</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span>
<a id="__codelineno-0-3654" name="__codelineno-0-3654" href="#__codelineno-0-3654"></a>            <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/outlier_categories&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span>
<a id="__codelineno-0-3655" name="__codelineno-0-3655" href="#__codelineno-0-3655"></a>        <span class="p">)</span>
<a id="__codelineno-0-3656" name="__codelineno-0-3656" href="#__codelineno-0-3656"></a>
<a id="__codelineno-0-3657" name="__codelineno-0-3657" href="#__codelineno-0-3657"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-3658" name="__codelineno-0-3658" href="#__codelineno-0-3658"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-0-3659" name="__codelineno-0-3659" href="#__codelineno-0-3659"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="n">list_of_cols</span>
<a id="__codelineno-0-3660" name="__codelineno-0-3660" href="#__codelineno-0-3660"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-3661" name="__codelineno-0-3661" href="#__codelineno-0-3661"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_outliered&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">]</span>
<a id="__codelineno-0-3662" name="__codelineno-0-3662" href="#__codelineno-0-3662"></a>        <span class="n">uniqueCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-0-3663" name="__codelineno-0-3663" href="#__codelineno-0-3663"></a>            <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;unique_values&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;uniqueValues_before&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3664" name="__codelineno-0-3664" href="#__codelineno-0-3664"></a>        <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">),</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-3665" name="__codelineno-0-3665" href="#__codelineno-0-3665"></a>        <span class="n">uniqueCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">odf</span><span class="p">,</span> <span class="n">output_cols</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-0-3666" name="__codelineno-0-3666" href="#__codelineno-0-3666"></a>            <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;unique_values&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;uniqueValues_after&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3667" name="__codelineno-0-3667" href="#__codelineno-0-3667"></a>        <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">),</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-3668" name="__codelineno-0-3668" href="#__codelineno-0-3668"></a>
<a id="__codelineno-0-3669" name="__codelineno-0-3669" href="#__codelineno-0-3669"></a>    <span class="n">idf</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
<a id="__codelineno-0-3670" name="__codelineno-0-3670" href="#__codelineno-0-3670"></a>
<a id="__codelineno-0-3671" name="__codelineno-0-3671" href="#__codelineno-0-3671"></a>    <span class="k">return</span> <span class="n">odf</span>
<a id="__codelineno-0-3672" name="__codelineno-0-3672" href="#__codelineno-0-3672"></a>
<a id="__codelineno-0-3673" name="__codelineno-0-3673" href="#__codelineno-0-3673"></a>
<a id="__codelineno-0-3674" name="__codelineno-0-3674" href="#__codelineno-0-3674"></a><span class="k">def</span> <span class="nf">expression_parser</span><span class="p">(</span><span class="n">idf</span><span class="p">,</span> <span class="n">list_of_expr</span><span class="p">,</span> <span class="n">postfix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-3675" name="__codelineno-0-3675" href="#__codelineno-0-3675"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-3676" name="__codelineno-0-3676" href="#__codelineno-0-3676"></a><span class="sd">    expression_parser can be used to evaluate a list of SQL expressions and output the result as new features. It</span>
<a id="__codelineno-0-3677" name="__codelineno-0-3677" href="#__codelineno-0-3677"></a><span class="sd">    is able to handle column names containing special characters such as “.”, “-”, “@”, “^”, etc, by converting them</span>
<a id="__codelineno-0-3678" name="__codelineno-0-3678" href="#__codelineno-0-3678"></a><span class="sd">    to “_” first before the evaluation and convert them back to the original names before returning the output</span>
<a id="__codelineno-0-3679" name="__codelineno-0-3679" href="#__codelineno-0-3679"></a><span class="sd">    dataframe.</span>
<a id="__codelineno-0-3680" name="__codelineno-0-3680" href="#__codelineno-0-3680"></a>
<a id="__codelineno-0-3681" name="__codelineno-0-3681" href="#__codelineno-0-3681"></a>
<a id="__codelineno-0-3682" name="__codelineno-0-3682" href="#__codelineno-0-3682"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-3683" name="__codelineno-0-3683" href="#__codelineno-0-3683"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-3684" name="__codelineno-0-3684" href="#__codelineno-0-3684"></a><span class="sd">    idf</span>
<a id="__codelineno-0-3685" name="__codelineno-0-3685" href="#__codelineno-0-3685"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-0-3686" name="__codelineno-0-3686" href="#__codelineno-0-3686"></a><span class="sd">    list_of_expr</span>
<a id="__codelineno-0-3687" name="__codelineno-0-3687" href="#__codelineno-0-3687"></a><span class="sd">        List of expressions to evaluate as new features e.g., [&quot;expr1&quot;,&quot;expr2&quot;].</span>
<a id="__codelineno-0-3688" name="__codelineno-0-3688" href="#__codelineno-0-3688"></a><span class="sd">        Alternatively, expressions can be specified in a string format,</span>
<a id="__codelineno-0-3689" name="__codelineno-0-3689" href="#__codelineno-0-3689"></a><span class="sd">        where different expressions are separated by pipe delimiter “|” e.g., &quot;expr1|expr2&quot;.</span>
<a id="__codelineno-0-3690" name="__codelineno-0-3690" href="#__codelineno-0-3690"></a><span class="sd">    postfix</span>
<a id="__codelineno-0-3691" name="__codelineno-0-3691" href="#__codelineno-0-3691"></a><span class="sd">        postfix for new feature name.Naming convention &quot;f&quot; + expression_index + postfix</span>
<a id="__codelineno-0-3692" name="__codelineno-0-3692" href="#__codelineno-0-3692"></a><span class="sd">        e.g. with postfix of &quot;new&quot;, new added features are named as f0new, f1new etc. (Default value = &quot;&quot;)</span>
<a id="__codelineno-0-3693" name="__codelineno-0-3693" href="#__codelineno-0-3693"></a><span class="sd">    print_impact</span>
<a id="__codelineno-0-3694" name="__codelineno-0-3694" href="#__codelineno-0-3694"></a><span class="sd">        True, False</span>
<a id="__codelineno-0-3695" name="__codelineno-0-3695" href="#__codelineno-0-3695"></a><span class="sd">        This argument is to print the descriptive statistics of the parsed features (Default value = False)</span>
<a id="__codelineno-0-3696" name="__codelineno-0-3696" href="#__codelineno-0-3696"></a>
<a id="__codelineno-0-3697" name="__codelineno-0-3697" href="#__codelineno-0-3697"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-3698" name="__codelineno-0-3698" href="#__codelineno-0-3698"></a><span class="sd">    -------</span>
<a id="__codelineno-0-3699" name="__codelineno-0-3699" href="#__codelineno-0-3699"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-0-3700" name="__codelineno-0-3700" href="#__codelineno-0-3700"></a><span class="sd">        Parsed Dataframe</span>
<a id="__codelineno-0-3701" name="__codelineno-0-3701" href="#__codelineno-0-3701"></a>
<a id="__codelineno-0-3702" name="__codelineno-0-3702" href="#__codelineno-0-3702"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-3703" name="__codelineno-0-3703" href="#__codelineno-0-3703"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_expr</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-3704" name="__codelineno-0-3704" href="#__codelineno-0-3704"></a>        <span class="n">list_of_expr</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_expr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-3705" name="__codelineno-0-3705" href="#__codelineno-0-3705"></a>
<a id="__codelineno-0-3706" name="__codelineno-0-3706" href="#__codelineno-0-3706"></a>    <span class="n">special_chars</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-3707" name="__codelineno-0-3707" href="#__codelineno-0-3707"></a>        <span class="s2">&quot;&amp;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3708" name="__codelineno-0-3708" href="#__codelineno-0-3708"></a>        <span class="s2">&quot;$&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3709" name="__codelineno-0-3709" href="#__codelineno-0-3709"></a>        <span class="s2">&quot;;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3710" name="__codelineno-0-3710" href="#__codelineno-0-3710"></a>        <span class="s2">&quot;:&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3711" name="__codelineno-0-3711" href="#__codelineno-0-3711"></a>        <span class="s2">&quot;,&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3712" name="__codelineno-0-3712" href="#__codelineno-0-3712"></a>        <span class="s2">&quot;*&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3713" name="__codelineno-0-3713" href="#__codelineno-0-3713"></a>        <span class="s2">&quot;#&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3714" name="__codelineno-0-3714" href="#__codelineno-0-3714"></a>        <span class="s2">&quot;@&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3715" name="__codelineno-0-3715" href="#__codelineno-0-3715"></a>        <span class="s2">&quot;?&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3716" name="__codelineno-0-3716" href="#__codelineno-0-3716"></a>        <span class="s2">&quot;%&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3717" name="__codelineno-0-3717" href="#__codelineno-0-3717"></a>        <span class="s2">&quot;!&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3718" name="__codelineno-0-3718" href="#__codelineno-0-3718"></a>        <span class="s2">&quot;^&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3719" name="__codelineno-0-3719" href="#__codelineno-0-3719"></a>        <span class="s2">&quot;(&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3720" name="__codelineno-0-3720" href="#__codelineno-0-3720"></a>        <span class="s2">&quot;)&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3721" name="__codelineno-0-3721" href="#__codelineno-0-3721"></a>        <span class="s2">&quot;-&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3722" name="__codelineno-0-3722" href="#__codelineno-0-3722"></a>        <span class="s2">&quot;/&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3723" name="__codelineno-0-3723" href="#__codelineno-0-3723"></a>        <span class="s2">&quot;&#39;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3724" name="__codelineno-0-3724" href="#__codelineno-0-3724"></a>        <span class="s2">&quot;.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-3725" name="__codelineno-0-3725" href="#__codelineno-0-3725"></a>        <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span>
<a id="__codelineno-0-3726" name="__codelineno-0-3726" href="#__codelineno-0-3726"></a>    <span class="p">]</span>
<a id="__codelineno-0-3727" name="__codelineno-0-3727" href="#__codelineno-0-3727"></a>    <span class="n">rename_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-3728" name="__codelineno-0-3728" href="#__codelineno-0-3728"></a>    <span class="n">replace_chars</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-3729" name="__codelineno-0-3729" href="#__codelineno-0-3729"></a>    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">special_chars</span><span class="p">:</span>
<a id="__codelineno-0-3730" name="__codelineno-0-3730" href="#__codelineno-0-3730"></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-3731" name="__codelineno-0-3731" href="#__codelineno-0-3731"></a>            <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
<a id="__codelineno-0-3732" name="__codelineno-0-3732" href="#__codelineno-0-3732"></a>                <span class="n">rename_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<a id="__codelineno-0-3733" name="__codelineno-0-3733" href="#__codelineno-0-3733"></a>                <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">replace_chars</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-3734" name="__codelineno-0-3734" href="#__codelineno-0-3734"></a>                    <span class="p">(</span><span class="n">replace_chars</span><span class="p">[</span><span class="n">col</span><span class="p">])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
<a id="__codelineno-0-3735" name="__codelineno-0-3735" href="#__codelineno-0-3735"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-3736" name="__codelineno-0-3736" href="#__codelineno-0-3736"></a>                    <span class="n">replace_chars</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">char</span><span class="p">]</span>
<a id="__codelineno-0-3737" name="__codelineno-0-3737" href="#__codelineno-0-3737"></a>
<a id="__codelineno-0-3738" name="__codelineno-0-3738" href="#__codelineno-0-3738"></a>    <span class="n">rename_mapping_to_new</span><span class="p">,</span> <span class="n">rename_mapping_to_old</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
<a id="__codelineno-0-3739" name="__codelineno-0-3739" href="#__codelineno-0-3739"></a>    <span class="n">idf_renamed</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-0-3740" name="__codelineno-0-3740" href="#__codelineno-0-3740"></a>    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">rename_cols</span><span class="p">:</span>
<a id="__codelineno-0-3741" name="__codelineno-0-3741" href="#__codelineno-0-3741"></a>        <span class="n">new_col</span> <span class="o">=</span> <span class="n">col</span>
<a id="__codelineno-0-3742" name="__codelineno-0-3742" href="#__codelineno-0-3742"></a>        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">replace_chars</span><span class="p">[</span><span class="n">col</span><span class="p">]:</span>
<a id="__codelineno-0-3743" name="__codelineno-0-3743" href="#__codelineno-0-3743"></a>            <span class="n">new_col</span> <span class="o">=</span> <span class="n">new_col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3744" name="__codelineno-0-3744" href="#__codelineno-0-3744"></a>        <span class="n">rename_mapping_to_old</span><span class="p">[</span><span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span>
<a id="__codelineno-0-3745" name="__codelineno-0-3745" href="#__codelineno-0-3745"></a>        <span class="n">rename_mapping_to_new</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_col</span>
<a id="__codelineno-0-3746" name="__codelineno-0-3746" href="#__codelineno-0-3746"></a>
<a id="__codelineno-0-3747" name="__codelineno-0-3747" href="#__codelineno-0-3747"></a>        <span class="n">idf_renamed</span> <span class="o">=</span> <span class="n">idf_renamed</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">new_col</span><span class="p">)</span>
<a id="__codelineno-0-3748" name="__codelineno-0-3748" href="#__codelineno-0-3748"></a>
<a id="__codelineno-0-3749" name="__codelineno-0-3749" href="#__codelineno-0-3749"></a>    <span class="n">list_of_expr_</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-3750" name="__codelineno-0-3750" href="#__codelineno-0-3750"></a>    <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">list_of_expr</span><span class="p">:</span>
<a id="__codelineno-0-3751" name="__codelineno-0-3751" href="#__codelineno-0-3751"></a>        <span class="n">new_expr</span> <span class="o">=</span> <span class="n">expr</span>
<a id="__codelineno-0-3752" name="__codelineno-0-3752" href="#__codelineno-0-3752"></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">rename_cols</span><span class="p">:</span>
<a id="__codelineno-0-3753" name="__codelineno-0-3753" href="#__codelineno-0-3753"></a>            <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">expr</span><span class="p">:</span>
<a id="__codelineno-0-3754" name="__codelineno-0-3754" href="#__codelineno-0-3754"></a>                <span class="n">new_expr</span> <span class="o">=</span> <span class="n">new_expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">rename_mapping_to_new</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
<a id="__codelineno-0-3755" name="__codelineno-0-3755" href="#__codelineno-0-3755"></a>        <span class="n">list_of_expr_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_expr</span><span class="p">)</span>
<a id="__codelineno-0-3756" name="__codelineno-0-3756" href="#__codelineno-0-3756"></a>
<a id="__codelineno-0-3757" name="__codelineno-0-3757" href="#__codelineno-0-3757"></a>    <span class="n">list_of_expr</span> <span class="o">=</span> <span class="n">list_of_expr_</span>
<a id="__codelineno-0-3758" name="__codelineno-0-3758" href="#__codelineno-0-3758"></a>
<a id="__codelineno-0-3759" name="__codelineno-0-3759" href="#__codelineno-0-3759"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf_renamed</span>
<a id="__codelineno-0-3760" name="__codelineno-0-3760" href="#__codelineno-0-3760"></a>    <span class="n">new_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-3761" name="__codelineno-0-3761" href="#__codelineno-0-3761"></a>    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">exp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_expr</span><span class="p">):</span>
<a id="__codelineno-0-3762" name="__codelineno-0-3762" href="#__codelineno-0-3762"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="n">postfix</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">expr</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
<a id="__codelineno-0-3763" name="__codelineno-0-3763" href="#__codelineno-0-3763"></a>        <span class="n">new_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="n">postfix</span><span class="p">)</span>
<a id="__codelineno-0-3764" name="__codelineno-0-3764" href="#__codelineno-0-3764"></a>
<a id="__codelineno-0-3765" name="__codelineno-0-3765" href="#__codelineno-0-3765"></a>    <span class="k">for</span> <span class="n">new_col</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">rename_mapping_to_old</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-3766" name="__codelineno-0-3766" href="#__codelineno-0-3766"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">new_col</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
<a id="__codelineno-0-3767" name="__codelineno-0-3767" href="#__codelineno-0-3767"></a>
<a id="__codelineno-0-3768" name="__codelineno-0-3768" href="#__codelineno-0-3768"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-0-3769" name="__codelineno-0-3769" href="#__codelineno-0-3769"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Columns Added: &quot;</span><span class="p">,</span> <span class="n">new_cols</span><span class="p">)</span>
<a id="__codelineno-0-3770" name="__codelineno-0-3770" href="#__codelineno-0-3770"></a>        <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">new_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-3771" name="__codelineno-0-3771" href="#__codelineno-0-3771"></a>
<a id="__codelineno-0-3772" name="__codelineno-0-3772" href="#__codelineno-0-3772"></a>    <span class="k">return</span> <span class="n">odf</span>
</code></pre></div>
</pre>
</details>
<h2 id="functions">Functions</h2>
<dl>
<dt id="anovos.data_transformer.transformers.IQR_standardization"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">IQR_standardization</span></span>(<span class="n">spark, idf, list_of_cols='all', drop_cols=[], pre_existing_model=False, model_path='NA', output_mode='replace', print_impact=False)</span>
</code></dt>
<dd>
<div class="desc"><h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>spark</code></strong></dt>
<dd>Spark Session</dd>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe</dd>
<dt><strong><code>list_of_cols</code></strong></dt>
<dd>List of numerical columns to transform e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
"all" can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.
Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in
drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = "all")</dd>
<dt><strong><code>drop_cols</code></strong></dt>
<dd>List of columns to be dropped e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except
a few handful of them. (Default value = [])</dd>
<dt><strong><code>pre_existing_model</code></strong></dt>
<dd>Boolean argument – True or False. True if model files (25/50/75 percentile for each feature) exists already, False Otherwise (Default value = False)</dd>
<dt><strong><code>model_path</code></strong></dt>
<dd>If pre_existing_model is True, this argument is path for referring the pre-saved model.
If pre_existing_model is False, this argument can be used for saving the model.
Default "NA" means there is neither pre-existing model nor there is a need to save one.</dd>
<dt><strong><code>output_mode</code></strong></dt>
<dd>"replace", "append".
“replace” option replaces original columns with transformed column. “append” option append transformed
column to the input dataset with a postfix "_scaled" e.g. column X is appended as X_scaled. (Default value = "replace")</dd>
<dt><strong><code>print_impact</code></strong></dt>
<dd>True, False (Default value = False)
This argument is to print out the before and after descriptive statistics of rescaled columns.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>DataFrame</code></dt>
<dd>Rescaled Dataframe</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">def</span> <span class="nf">IQR_standardization</span><span class="p">(</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    <span class="n">pre_existing_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="p">):</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="sd">    Parameters</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="sd">    ----------</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="sd">    spark</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="sd">    idf</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="sd">        List of numerical columns to transform e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="sd">        &quot;all&quot; can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="sd">    pre_existing_model</span>
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a><span class="sd">        Boolean argument – True or False. True if model files (25/50/75 percentile for each feature) exists already, False Otherwise (Default value = False)</span>
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a><span class="sd">    model_path</span>
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a><span class="sd">        If pre_existing_model is True, this argument is path for referring the pre-saved model.</span>
<a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a><span class="sd">        If pre_existing_model is False, this argument can be used for saving the model.</span>
<a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a><span class="sd">        Default &quot;NA&quot; means there is neither pre-existing model nor there is a need to save one.</span>
<a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a><span class="sd">    output_mode</span>
<a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a><span class="sd">        “replace” option replaces original columns with transformed column. “append” option append transformed</span>
<a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a><span class="sd">        column to the input dataset with a postfix &quot;_scaled&quot; e.g. column X is appended as X_scaled. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a><span class="sd">    print_impact</span>
<a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a><span class="sd">        True, False (Default value = False)</span>
<a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a><span class="sd">        This argument is to print out the before and after descriptive statistics of rescaled columns.</span>
<a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a>
<a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a><span class="sd">    Returns</span>
<a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a><span class="sd">    -------</span>
<a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a><span class="sd">        Rescaled Dataframe</span>
<a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-1-58" name="__codelineno-1-58" href="#__codelineno-1-58"></a>
<a id="__codelineno-1-59" name="__codelineno-1-59" href="#__codelineno-1-59"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-1-60" name="__codelineno-1-60" href="#__codelineno-1-60"></a>
<a id="__codelineno-1-61" name="__codelineno-1-61" href="#__codelineno-1-61"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-1-62" name="__codelineno-1-62" href="#__codelineno-1-62"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-1-63" name="__codelineno-1-63" href="#__codelineno-1-63"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-1-64" name="__codelineno-1-64" href="#__codelineno-1-64"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-1-65" name="__codelineno-1-65" href="#__codelineno-1-65"></a>            <span class="s2">&quot;No Standardization Performed - No numerical column(s) to transform&quot;</span>
<a id="__codelineno-1-66" name="__codelineno-1-66" href="#__codelineno-1-66"></a>        <span class="p">)</span>
<a id="__codelineno-1-67" name="__codelineno-1-67" href="#__codelineno-1-67"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-1-68" name="__codelineno-1-68" href="#__codelineno-1-68"></a>
<a id="__codelineno-1-69" name="__codelineno-1-69" href="#__codelineno-1-69"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">):</span>
<a id="__codelineno-1-70" name="__codelineno-1-70" href="#__codelineno-1-70"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for output_mode&quot;</span><span class="p">)</span>
<a id="__codelineno-1-71" name="__codelineno-1-71" href="#__codelineno-1-71"></a>
<a id="__codelineno-1-72" name="__codelineno-1-72" href="#__codelineno-1-72"></a>    <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-1-73" name="__codelineno-1-73" href="#__codelineno-1-73"></a>        <span class="n">df_model</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/IQR_standardization&quot;</span><span class="p">)</span>
<a id="__codelineno-1-74" name="__codelineno-1-74" href="#__codelineno-1-74"></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-1-75" name="__codelineno-1-75" href="#__codelineno-1-75"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-1-76" name="__codelineno-1-76" href="#__codelineno-1-76"></a>            <span class="n">mapped_value</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-1-77" name="__codelineno-1-77" href="#__codelineno-1-77"></a>                <span class="n">df_model</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-1-78" name="__codelineno-1-78" href="#__codelineno-1-78"></a>                <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;parameters&quot;</span><span class="p">)</span>
<a id="__codelineno-1-79" name="__codelineno-1-79" href="#__codelineno-1-79"></a>                <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-1-80" name="__codelineno-1-80" href="#__codelineno-1-80"></a>                <span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-1-81" name="__codelineno-1-81" href="#__codelineno-1-81"></a>            <span class="p">)</span>
<a id="__codelineno-1-82" name="__codelineno-1-82" href="#__codelineno-1-82"></a>            <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapped_value</span><span class="p">)</span>
<a id="__codelineno-1-83" name="__codelineno-1-83" href="#__codelineno-1-83"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-1-84" name="__codelineno-1-84" href="#__codelineno-1-84"></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">approxQuantile</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">],</span> <span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-1-85" name="__codelineno-1-85" href="#__codelineno-1-85"></a>
<a id="__codelineno-1-86" name="__codelineno-1-86" href="#__codelineno-1-86"></a>    <span class="n">excluded_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-1-87" name="__codelineno-1-87" href="#__codelineno-1-87"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
<a id="__codelineno-1-88" name="__codelineno-1-88" href="#__codelineno-1-88"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-1-89" name="__codelineno-1-89" href="#__codelineno-1-89"></a>            <span class="k">if</span> <span class="nb">round</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="nb">round</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">5</span><span class="p">):</span>
<a id="__codelineno-1-90" name="__codelineno-1-90" href="#__codelineno-1-90"></a>                <span class="n">excluded_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-1-91" name="__codelineno-1-91" href="#__codelineno-1-91"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-1-92" name="__codelineno-1-92" href="#__codelineno-1-92"></a>            <span class="n">excluded_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-1-93" name="__codelineno-1-93" href="#__codelineno-1-93"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">excluded_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-1-94" name="__codelineno-1-94" href="#__codelineno-1-94"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-1-95" name="__codelineno-1-95" href="#__codelineno-1-95"></a>            <span class="s2">&quot;The following column(s) are excluded from standardization because the 75th and 25th percentiles are the same:&quot;</span>
<a id="__codelineno-1-96" name="__codelineno-1-96" href="#__codelineno-1-96"></a>            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">excluded_cols</span><span class="p">)</span>
<a id="__codelineno-1-97" name="__codelineno-1-97" href="#__codelineno-1-97"></a>        <span class="p">)</span>
<a id="__codelineno-1-98" name="__codelineno-1-98" href="#__codelineno-1-98"></a>
<a id="__codelineno-1-99" name="__codelineno-1-99" href="#__codelineno-1-99"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-1-100" name="__codelineno-1-100" href="#__codelineno-1-100"></a>    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-1-101" name="__codelineno-1-101" href="#__codelineno-1-101"></a>        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">excluded_cols</span><span class="p">:</span>
<a id="__codelineno-1-102" name="__codelineno-1-102" href="#__codelineno-1-102"></a>            <span class="n">modify_col</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;append&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">i</span>
<a id="__codelineno-1-103" name="__codelineno-1-103" href="#__codelineno-1-103"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-1-104" name="__codelineno-1-104" href="#__codelineno-1-104"></a>                <span class="n">modify_col</span><span class="p">,</span>
<a id="__codelineno-1-105" name="__codelineno-1-105" href="#__codelineno-1-105"></a>                <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">parameters</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-1-106" name="__codelineno-1-106" href="#__codelineno-1-106"></a>                <span class="o">/</span> <span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">parameters</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-1-107" name="__codelineno-1-107" href="#__codelineno-1-107"></a>            <span class="p">)</span>
<a id="__codelineno-1-108" name="__codelineno-1-108" href="#__codelineno-1-108"></a>
<a id="__codelineno-1-109" name="__codelineno-1-109" href="#__codelineno-1-109"></a>    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pre_existing_model</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">):</span>
<a id="__codelineno-1-110" name="__codelineno-1-110" href="#__codelineno-1-110"></a>        <span class="n">df_model</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
<a id="__codelineno-1-111" name="__codelineno-1-111" href="#__codelineno-1-111"></a>            <span class="nb">zip</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="n">parameters</span><span class="p">),</span> <span class="n">schema</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="s2">&quot;parameters&quot;</span><span class="p">]</span>
<a id="__codelineno-1-112" name="__codelineno-1-112" href="#__codelineno-1-112"></a>        <span class="p">)</span>
<a id="__codelineno-1-113" name="__codelineno-1-113" href="#__codelineno-1-113"></a>        <span class="n">df_model</span><span class="o">.</span><span class="n">coalesce</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span>
<a id="__codelineno-1-114" name="__codelineno-1-114" href="#__codelineno-1-114"></a>            <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/IQR_standardization&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span>
<a id="__codelineno-1-115" name="__codelineno-1-115" href="#__codelineno-1-115"></a>        <span class="p">)</span>
<a id="__codelineno-1-116" name="__codelineno-1-116" href="#__codelineno-1-116"></a>
<a id="__codelineno-1-117" name="__codelineno-1-117" href="#__codelineno-1-117"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-1-118" name="__codelineno-1-118" href="#__codelineno-1-118"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-1-119" name="__codelineno-1-119" href="#__codelineno-1-119"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="n">list_of_cols</span>
<a id="__codelineno-1-120" name="__codelineno-1-120" href="#__codelineno-1-120"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-1-121" name="__codelineno-1-121" href="#__codelineno-1-121"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-1-122" name="__codelineno-1-122" href="#__codelineno-1-122"></a>                <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">excluded_cols</span>
<a id="__codelineno-1-123" name="__codelineno-1-123" href="#__codelineno-1-123"></a>            <span class="p">]</span>
<a id="__codelineno-1-124" name="__codelineno-1-124" href="#__codelineno-1-124"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before: &quot;</span><span class="p">)</span>
<a id="__codelineno-1-125" name="__codelineno-1-125" href="#__codelineno-1-125"></a>        <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-1-126" name="__codelineno-1-126" href="#__codelineno-1-126"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After: &quot;</span><span class="p">)</span>
<a id="__codelineno-1-127" name="__codelineno-1-127" href="#__codelineno-1-127"></a>        <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">output_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-1-128" name="__codelineno-1-128" href="#__codelineno-1-128"></a>
<a id="__codelineno-1-129" name="__codelineno-1-129" href="#__codelineno-1-129"></a>    <span class="k">return</span> <span class="n">odf</span>
</code></pre></div>
</pre>
</details>
</dd>
<dt id="anovos.data_transformer.transformers.PCA_latentFeatures"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">PCA_latentFeatures</span></span>(<span class="n">spark, idf, list_of_cols='all', drop_cols=[], explained_variance_cutoff=0.95, pre_existing_model=False, model_path='NA', standardization=True, standardization_configs={'pre_existing_model': False, 'model_path': 'NA'}, imputation=False, imputation_configs={'imputation_function': 'imputation_MMM'}, stats_missing={}, output_mode='replace', run_type='local', root_path='', auth_key='NA', print_impact=False)</span>
</code></dt>
<dd>
<div class="desc"><p>Similar to autoencoder_latentFeatures, PCA_latentFeatures also generates latent features which reduces the
dimensionality of the input dataframe but through a different technique: Principal Component Analysis (PCA). PCA
algorithm produces principal components such that it can describe most of the remaining variance and all the
principal components are orthogonal to each other. The final number of generated principal components is
controlled by the input <em>explained_variance_cutoff</em>. In other words, the number of selected principal components,
k, is the minimum value such that top k components (latent features) can explain at least
<em>explained_variance_cutoff</em> of the total variance.</p>
<p>Standardization is highly recommended if the input attributes are not of the same scale. Otherwise the generated
latent features might be dominated by the attributes with larger variance. Inputs <em>standardization</em> and
<em>standardization_configs</em> can be set accordingly to perform standardization within the function. In addition,
data imputation is also recommended if missing values exist, which can be done within the function by setting
inputs <em>imputation</em> and <em>imputation_configs</em>.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>spark</code></strong></dt>
<dd>Spark Session</dd>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe</dd>
<dt><strong><code>list_of_cols</code></strong></dt>
<dd>List of numerical columns to encode e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
"all" can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.
Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in
drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = "all")</dd>
<dt><strong><code>drop_cols</code></strong></dt>
<dd>List of columns to be dropped e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except
a few handful of them. (Default value = [])</dd>
<dt><strong><code>explained_variance_cutoff</code></strong></dt>
<dd>Determines the number of latent columns in the output. If N is the smallest
integer such that top N latent columns explain more than explained_variance_cutoff
variance, these N columns will be selected. (Default value = 0.95)</dd>
<dt><strong><code>pre_existing_model</code></strong></dt>
<dd>Boolean argument – True or False. True if model exists already, False Otherwise (Default value = False)</dd>
<dt><strong><code>model_path</code></strong></dt>
<dd>If pre_existing_model is True, this argument is path for referring the pre-saved model.
If pre_existing_model is False, this argument can be used for saving the model.
Default "NA" means there is neither pre-existing model nor there is a need to save one.</dd>
<dt><strong><code>standardization</code></strong></dt>
<dd>Boolean argument – True or False. True, if the standardization required. (Default value = True)</dd>
<dt><strong><code>standardization_configs</code></strong></dt>
<dd>z_standardization function arguments in dictionary format. (Default value = {"pre_existing_model": False)</dd>
<dt><strong><code>imputation</code></strong></dt>
<dd>Boolean argument – True or False. True, if the imputation required. (Default value = False)</dd>
<dt><strong><code>imputation_configs</code></strong></dt>
<dd>Takes input in dictionary format.
Imputation function name is provided with key "imputation_name".
optional arguments pertaining to that imputation function can be provided with argument name as key. (Default value = {"imputation_function": "imputation_MMM"})</dd>
<dt><strong><code>stats_missing</code></strong></dt>
<dd>Takes arguments for read_dataset (data_ingest module) function in a dictionary format
to read pre-saved statistics on missing count/pct i.e. if measures_of_counts or
missingCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</dd>
<dt><strong><code>output_mode</code></strong></dt>
<dd>"replace", "append".
“replace” option replaces original columns with transformed columns: latent_<col_index>.
“append” option append transformed columns with format latent_<col_index> to the input dataset,
e.g. latent_0, latent_1. (Default value = "replace")</dd>
<dt><strong><code>run_type</code></strong></dt>
<dd>"local", "emr", "databricks", "ak8s" (Default value = "local")</dd>
<dt><strong><code>root_path</code></strong></dt>
<dd>This argument takes in a base folder path for writing out intermediate_data/ folder to. Default value is ""</dd>
<dt><strong><code>auth_key</code></strong></dt>
<dd>Option to pass an authorization key to write to filesystems. Currently applicable only for ak8s run_type. Default value is kept as "NA"</dd>
<dt><strong><code>print_impact</code></strong></dt>
<dd>True, False
This argument is to print descriptive statistics of the latest features (Default value = False)</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>DataFrame</code></dt>
<dd>Dataframe with Latent Features</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">def</span> <span class="nf">PCA_latentFeatures</span><span class="p">(</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="n">explained_variance_cutoff</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>    <span class="n">pre_existing_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>    <span class="n">standardization</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>    <span class="n">standardization_configs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pre_existing_model&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;model_path&quot;</span><span class="p">:</span> <span class="s2">&quot;NA&quot;</span><span class="p">},</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>    <span class="n">imputation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>    <span class="n">imputation_configs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;imputation_function&quot;</span><span class="p">:</span> <span class="s2">&quot;imputation_MMM&quot;</span><span class="p">},</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>    <span class="n">stats_missing</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>    <span class="n">run_type</span><span class="o">=</span><span class="s2">&quot;local&quot;</span><span class="p">,</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>    <span class="n">root_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>    <span class="n">auth_key</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="p">):</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="sd">    Similar to autoencoder_latentFeatures, PCA_latentFeatures also generates latent features which reduces the</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="sd">    dimensionality of the input dataframe but through a different technique: Principal Component Analysis (PCA). PCA</span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="sd">    algorithm produces principal components such that it can describe most of the remaining variance and all the</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="sd">    principal components are orthogonal to each other. The final number of generated principal components is</span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="sd">    controlled by the input *explained_variance_cutoff*. In other words, the number of selected principal components,</span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a><span class="sd">    k, is the minimum value such that top k components (latent features) can explain at least</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="sd">    *explained_variance_cutoff* of the total variance.</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a><span class="sd">    Standardization is highly recommended if the input attributes are not of the same scale. Otherwise the generated</span>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a><span class="sd">    latent features might be dominated by the attributes with larger variance. Inputs *standardization* and</span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a><span class="sd">    *standardization_configs* can be set accordingly to perform standardization within the function. In addition,</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a><span class="sd">    data imputation is also recommended if missing values exist, which can be done within the function by setting</span>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a><span class="sd">    inputs *imputation* and *imputation_configs*.</span>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a>
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a><span class="sd">    Parameters</span>
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a><span class="sd">    ----------</span>
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a><span class="sd">    spark</span>
<a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a><span class="sd">    idf</span>
<a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a><span class="sd">        List of numerical columns to encode e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-2-44" name="__codelineno-2-44" href="#__codelineno-2-44"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-2-45" name="__codelineno-2-45" href="#__codelineno-2-45"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-2-46" name="__codelineno-2-46" href="#__codelineno-2-46"></a><span class="sd">        &quot;all&quot; can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-2-47" name="__codelineno-2-47" href="#__codelineno-2-47"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-2-48" name="__codelineno-2-48" href="#__codelineno-2-48"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-2-49" name="__codelineno-2-49" href="#__codelineno-2-49"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-2-50" name="__codelineno-2-50" href="#__codelineno-2-50"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-2-51" name="__codelineno-2-51" href="#__codelineno-2-51"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-2-52" name="__codelineno-2-52" href="#__codelineno-2-52"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-2-53" name="__codelineno-2-53" href="#__codelineno-2-53"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-2-54" name="__codelineno-2-54" href="#__codelineno-2-54"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-2-55" name="__codelineno-2-55" href="#__codelineno-2-55"></a><span class="sd">    explained_variance_cutoff</span>
<a id="__codelineno-2-56" name="__codelineno-2-56" href="#__codelineno-2-56"></a><span class="sd">        Determines the number of latent columns in the output. If N is the smallest</span>
<a id="__codelineno-2-57" name="__codelineno-2-57" href="#__codelineno-2-57"></a><span class="sd">        integer such that top N latent columns explain more than explained_variance_cutoff</span>
<a id="__codelineno-2-58" name="__codelineno-2-58" href="#__codelineno-2-58"></a><span class="sd">        variance, these N columns will be selected. (Default value = 0.95)</span>
<a id="__codelineno-2-59" name="__codelineno-2-59" href="#__codelineno-2-59"></a><span class="sd">    pre_existing_model</span>
<a id="__codelineno-2-60" name="__codelineno-2-60" href="#__codelineno-2-60"></a><span class="sd">        Boolean argument – True or False. True if model exists already, False Otherwise (Default value = False)</span>
<a id="__codelineno-2-61" name="__codelineno-2-61" href="#__codelineno-2-61"></a><span class="sd">    model_path</span>
<a id="__codelineno-2-62" name="__codelineno-2-62" href="#__codelineno-2-62"></a><span class="sd">        If pre_existing_model is True, this argument is path for referring the pre-saved model.</span>
<a id="__codelineno-2-63" name="__codelineno-2-63" href="#__codelineno-2-63"></a><span class="sd">        If pre_existing_model is False, this argument can be used for saving the model.</span>
<a id="__codelineno-2-64" name="__codelineno-2-64" href="#__codelineno-2-64"></a><span class="sd">        Default &quot;NA&quot; means there is neither pre-existing model nor there is a need to save one.</span>
<a id="__codelineno-2-65" name="__codelineno-2-65" href="#__codelineno-2-65"></a><span class="sd">    standardization</span>
<a id="__codelineno-2-66" name="__codelineno-2-66" href="#__codelineno-2-66"></a><span class="sd">        Boolean argument – True or False. True, if the standardization required. (Default value = True)</span>
<a id="__codelineno-2-67" name="__codelineno-2-67" href="#__codelineno-2-67"></a><span class="sd">    standardization_configs</span>
<a id="__codelineno-2-68" name="__codelineno-2-68" href="#__codelineno-2-68"></a><span class="sd">        z_standardization function arguments in dictionary format. (Default value = {&quot;pre_existing_model&quot;: False)</span>
<a id="__codelineno-2-69" name="__codelineno-2-69" href="#__codelineno-2-69"></a><span class="sd">    imputation</span>
<a id="__codelineno-2-70" name="__codelineno-2-70" href="#__codelineno-2-70"></a><span class="sd">        Boolean argument – True or False. True, if the imputation required. (Default value = False)</span>
<a id="__codelineno-2-71" name="__codelineno-2-71" href="#__codelineno-2-71"></a><span class="sd">    imputation_configs</span>
<a id="__codelineno-2-72" name="__codelineno-2-72" href="#__codelineno-2-72"></a><span class="sd">        Takes input in dictionary format.</span>
<a id="__codelineno-2-73" name="__codelineno-2-73" href="#__codelineno-2-73"></a><span class="sd">        Imputation function name is provided with key &quot;imputation_name&quot;.</span>
<a id="__codelineno-2-74" name="__codelineno-2-74" href="#__codelineno-2-74"></a><span class="sd">        optional arguments pertaining to that imputation function can be provided with argument name as key. (Default value = {&quot;imputation_function&quot;: &quot;imputation_MMM&quot;})</span>
<a id="__codelineno-2-75" name="__codelineno-2-75" href="#__codelineno-2-75"></a><span class="sd">    stats_missing</span>
<a id="__codelineno-2-76" name="__codelineno-2-76" href="#__codelineno-2-76"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-2-77" name="__codelineno-2-77" href="#__codelineno-2-77"></a><span class="sd">        to read pre-saved statistics on missing count/pct i.e. if measures_of_counts or</span>
<a id="__codelineno-2-78" name="__codelineno-2-78" href="#__codelineno-2-78"></a><span class="sd">        missingCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-2-79" name="__codelineno-2-79" href="#__codelineno-2-79"></a><span class="sd">    output_mode</span>
<a id="__codelineno-2-80" name="__codelineno-2-80" href="#__codelineno-2-80"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-2-81" name="__codelineno-2-81" href="#__codelineno-2-81"></a><span class="sd">        “replace” option replaces original columns with transformed columns: latent_&lt;col_index&gt;.</span>
<a id="__codelineno-2-82" name="__codelineno-2-82" href="#__codelineno-2-82"></a><span class="sd">        “append” option append transformed columns with format latent_&lt;col_index&gt; to the input dataset,</span>
<a id="__codelineno-2-83" name="__codelineno-2-83" href="#__codelineno-2-83"></a><span class="sd">        e.g. latent_0, latent_1. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-2-84" name="__codelineno-2-84" href="#__codelineno-2-84"></a><span class="sd">    run_type</span>
<a id="__codelineno-2-85" name="__codelineno-2-85" href="#__codelineno-2-85"></a><span class="sd">        &quot;local&quot;, &quot;emr&quot;, &quot;databricks&quot;, &quot;ak8s&quot; (Default value = &quot;local&quot;)</span>
<a id="__codelineno-2-86" name="__codelineno-2-86" href="#__codelineno-2-86"></a><span class="sd">    root_path</span>
<a id="__codelineno-2-87" name="__codelineno-2-87" href="#__codelineno-2-87"></a><span class="sd">        This argument takes in a base folder path for writing out intermediate_data/ folder to. Default value is &quot;&quot;</span>
<a id="__codelineno-2-88" name="__codelineno-2-88" href="#__codelineno-2-88"></a><span class="sd">    auth_key</span>
<a id="__codelineno-2-89" name="__codelineno-2-89" href="#__codelineno-2-89"></a><span class="sd">        Option to pass an authorization key to write to filesystems. Currently applicable only for ak8s run_type. Default value is kept as &quot;NA&quot;</span>
<a id="__codelineno-2-90" name="__codelineno-2-90" href="#__codelineno-2-90"></a><span class="sd">    print_impact</span>
<a id="__codelineno-2-91" name="__codelineno-2-91" href="#__codelineno-2-91"></a><span class="sd">        True, False</span>
<a id="__codelineno-2-92" name="__codelineno-2-92" href="#__codelineno-2-92"></a><span class="sd">        This argument is to print descriptive statistics of the latest features (Default value = False)</span>
<a id="__codelineno-2-93" name="__codelineno-2-93" href="#__codelineno-2-93"></a>
<a id="__codelineno-2-94" name="__codelineno-2-94" href="#__codelineno-2-94"></a><span class="sd">    Returns</span>
<a id="__codelineno-2-95" name="__codelineno-2-95" href="#__codelineno-2-95"></a><span class="sd">    -------</span>
<a id="__codelineno-2-96" name="__codelineno-2-96" href="#__codelineno-2-96"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-2-97" name="__codelineno-2-97" href="#__codelineno-2-97"></a><span class="sd">        Dataframe with Latent Features</span>
<a id="__codelineno-2-98" name="__codelineno-2-98" href="#__codelineno-2-98"></a>
<a id="__codelineno-2-99" name="__codelineno-2-99" href="#__codelineno-2-99"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-2-100" name="__codelineno-2-100" href="#__codelineno-2-100"></a>
<a id="__codelineno-2-101" name="__codelineno-2-101" href="#__codelineno-2-101"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-2-102" name="__codelineno-2-102" href="#__codelineno-2-102"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-2-103" name="__codelineno-2-103" href="#__codelineno-2-103"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-2-104" name="__codelineno-2-104" href="#__codelineno-2-104"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-2-105" name="__codelineno-2-105" href="#__codelineno-2-105"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-2-106" name="__codelineno-2-106" href="#__codelineno-2-106"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-2-107" name="__codelineno-2-107" href="#__codelineno-2-107"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-2-108" name="__codelineno-2-108" href="#__codelineno-2-108"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-2-109" name="__codelineno-2-109" href="#__codelineno-2-109"></a>
<a id="__codelineno-2-110" name="__codelineno-2-110" href="#__codelineno-2-110"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-2-111" name="__codelineno-2-111" href="#__codelineno-2-111"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-2-112" name="__codelineno-2-112" href="#__codelineno-2-112"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-2-113" name="__codelineno-2-113" href="#__codelineno-2-113"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No Latent Features Generated - No Column(s) to Transform&quot;</span><span class="p">)</span>
<a id="__codelineno-2-114" name="__codelineno-2-114" href="#__codelineno-2-114"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-2-115" name="__codelineno-2-115" href="#__codelineno-2-115"></a>
<a id="__codelineno-2-116" name="__codelineno-2-116" href="#__codelineno-2-116"></a>    <span class="k">if</span> <span class="n">stats_missing</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-2-117" name="__codelineno-2-117" href="#__codelineno-2-117"></a>        <span class="n">missing_df</span> <span class="o">=</span> <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-2-118" name="__codelineno-2-118" href="#__codelineno-2-118"></a>        <span class="n">missing_df</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span>
<a id="__codelineno-2-119" name="__codelineno-2-119" href="#__codelineno-2-119"></a>            <span class="n">root_path</span> <span class="o">+</span> <span class="s2">&quot;intermediate_data/PCA_latentFeatures/missingCount_computation&quot;</span><span class="p">,</span>
<a id="__codelineno-2-120" name="__codelineno-2-120" href="#__codelineno-2-120"></a>            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span><span class="p">,</span>
<a id="__codelineno-2-121" name="__codelineno-2-121" href="#__codelineno-2-121"></a>        <span class="p">)</span>
<a id="__codelineno-2-122" name="__codelineno-2-122" href="#__codelineno-2-122"></a>        <span class="n">stats_missing</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-2-123" name="__codelineno-2-123" href="#__codelineno-2-123"></a>            <span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="n">root_path</span>
<a id="__codelineno-2-124" name="__codelineno-2-124" href="#__codelineno-2-124"></a>            <span class="o">+</span> <span class="s2">&quot;intermediate_data/PCA_latentFeatures/missingCount_computation&quot;</span><span class="p">,</span>
<a id="__codelineno-2-125" name="__codelineno-2-125" href="#__codelineno-2-125"></a>            <span class="s2">&quot;file_type&quot;</span><span class="p">:</span> <span class="s2">&quot;parquet&quot;</span><span class="p">,</span>
<a id="__codelineno-2-126" name="__codelineno-2-126" href="#__codelineno-2-126"></a>        <span class="p">}</span>
<a id="__codelineno-2-127" name="__codelineno-2-127" href="#__codelineno-2-127"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-2-128" name="__codelineno-2-128" href="#__codelineno-2-128"></a>        <span class="n">missing_df</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-2-129" name="__codelineno-2-129" href="#__codelineno-2-129"></a>            <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_missing</span><span class="p">)</span>
<a id="__codelineno-2-130" name="__codelineno-2-130" href="#__codelineno-2-130"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_count&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span>
<a id="__codelineno-2-131" name="__codelineno-2-131" href="#__codelineno-2-131"></a>            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-2-132" name="__codelineno-2-132" href="#__codelineno-2-132"></a>        <span class="p">)</span>
<a id="__codelineno-2-133" name="__codelineno-2-133" href="#__codelineno-2-133"></a>
<a id="__codelineno-2-134" name="__codelineno-2-134" href="#__codelineno-2-134"></a>    <span class="n">empty_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-2-135" name="__codelineno-2-135" href="#__codelineno-2-135"></a>        <span class="n">missing_df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-2-136" name="__codelineno-2-136" href="#__codelineno-2-136"></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-2-137" name="__codelineno-2-137" href="#__codelineno-2-137"></a>        <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-2-138" name="__codelineno-2-138" href="#__codelineno-2-138"></a>        <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-2-139" name="__codelineno-2-139" href="#__codelineno-2-139"></a>    <span class="p">)</span>
<a id="__codelineno-2-140" name="__codelineno-2-140" href="#__codelineno-2-140"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">empty_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-2-141" name="__codelineno-2-141" href="#__codelineno-2-141"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-2-142" name="__codelineno-2-142" href="#__codelineno-2-142"></a>            <span class="s2">&quot;The following column(s) are excluded from dimensionality reduction as all values are null: &quot;</span>
<a id="__codelineno-2-143" name="__codelineno-2-143" href="#__codelineno-2-143"></a>            <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">empty_cols</span><span class="p">)</span>
<a id="__codelineno-2-144" name="__codelineno-2-144" href="#__codelineno-2-144"></a>        <span class="p">)</span>
<a id="__codelineno-2-145" name="__codelineno-2-145" href="#__codelineno-2-145"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">empty_cols</span><span class="p">]</span>
<a id="__codelineno-2-146" name="__codelineno-2-146" href="#__codelineno-2-146"></a>
<a id="__codelineno-2-147" name="__codelineno-2-147" href="#__codelineno-2-147"></a>    <span class="k">if</span> <span class="n">standardization</span><span class="p">:</span>
<a id="__codelineno-2-148" name="__codelineno-2-148" href="#__codelineno-2-148"></a>        <span class="n">idf_standardized</span> <span class="o">=</span> <span class="n">z_standardization</span><span class="p">(</span>
<a id="__codelineno-2-149" name="__codelineno-2-149" href="#__codelineno-2-149"></a>            <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-2-150" name="__codelineno-2-150" href="#__codelineno-2-150"></a>            <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-2-151" name="__codelineno-2-151" href="#__codelineno-2-151"></a>            <span class="n">list_of_cols</span><span class="o">=</span><span class="n">list_of_cols</span><span class="p">,</span>
<a id="__codelineno-2-152" name="__codelineno-2-152" href="#__codelineno-2-152"></a>            <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
<a id="__codelineno-2-153" name="__codelineno-2-153" href="#__codelineno-2-153"></a>            <span class="o">**</span><span class="n">standardization_configs</span><span class="p">,</span>
<a id="__codelineno-2-154" name="__codelineno-2-154" href="#__codelineno-2-154"></a>        <span class="p">)</span>
<a id="__codelineno-2-155" name="__codelineno-2-155" href="#__codelineno-2-155"></a>        <span class="n">list_of_cols_scaled</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-2-156" name="__codelineno-2-156" href="#__codelineno-2-156"></a>            <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span>
<a id="__codelineno-2-157" name="__codelineno-2-157" href="#__codelineno-2-157"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span>
<a id="__codelineno-2-158" name="__codelineno-2-158" href="#__codelineno-2-158"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">idf_standardized</span><span class="o">.</span><span class="n">columns</span>
<a id="__codelineno-2-159" name="__codelineno-2-159" href="#__codelineno-2-159"></a>        <span class="p">]</span>
<a id="__codelineno-2-160" name="__codelineno-2-160" href="#__codelineno-2-160"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-2-161" name="__codelineno-2-161" href="#__codelineno-2-161"></a>        <span class="n">idf_standardized</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-2-162" name="__codelineno-2-162" href="#__codelineno-2-162"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-2-163" name="__codelineno-2-163" href="#__codelineno-2-163"></a>            <span class="n">idf_standardized</span> <span class="o">=</span> <span class="n">idf_standardized</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a id="__codelineno-2-164" name="__codelineno-2-164" href="#__codelineno-2-164"></a>            <span class="n">list_of_cols_scaled</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">]</span>
<a id="__codelineno-2-165" name="__codelineno-2-165" href="#__codelineno-2-165"></a>
<a id="__codelineno-2-166" name="__codelineno-2-166" href="#__codelineno-2-166"></a>    <span class="k">if</span> <span class="n">imputation</span><span class="p">:</span>
<a id="__codelineno-2-167" name="__codelineno-2-167" href="#__codelineno-2-167"></a>        <span class="n">all_functions</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-2-168" name="__codelineno-2-168" href="#__codelineno-2-168"></a>        <span class="n">all_functions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">locals</span><span class="p">())</span>
<a id="__codelineno-2-169" name="__codelineno-2-169" href="#__codelineno-2-169"></a>        <span class="n">f</span> <span class="o">=</span> <span class="n">all_functions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">imputation_configs</span><span class="p">[</span><span class="s2">&quot;imputation_function&quot;</span><span class="p">])</span>
<a id="__codelineno-2-170" name="__codelineno-2-170" href="#__codelineno-2-170"></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">imputation_configs</span><span class="p">)</span>
<a id="__codelineno-2-171" name="__codelineno-2-171" href="#__codelineno-2-171"></a>        <span class="n">args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;imputation_function&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-2-172" name="__codelineno-2-172" href="#__codelineno-2-172"></a>        <span class="n">missing_df_scaled</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-2-173" name="__codelineno-2-173" href="#__codelineno-2-173"></a>            <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_missing</span><span class="p">)</span>
<a id="__codelineno-2-174" name="__codelineno-2-174" href="#__codelineno-2-174"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_count&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span>
<a id="__codelineno-2-175" name="__codelineno-2-175" href="#__codelineno-2-175"></a>            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&quot;_scaled&quot;</span><span class="p">)))</span>
<a id="__codelineno-2-176" name="__codelineno-2-176" href="#__codelineno-2-176"></a>        <span class="p">)</span>
<a id="__codelineno-2-177" name="__codelineno-2-177" href="#__codelineno-2-177"></a>        <span class="n">missing_df_scaled</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span>
<a id="__codelineno-2-178" name="__codelineno-2-178" href="#__codelineno-2-178"></a>            <span class="n">root_path</span>
<a id="__codelineno-2-179" name="__codelineno-2-179" href="#__codelineno-2-179"></a>            <span class="o">+</span> <span class="s2">&quot;intermediate_data/PCA_latentFeatures/missingCount_computation_scaled&quot;</span><span class="p">,</span>
<a id="__codelineno-2-180" name="__codelineno-2-180" href="#__codelineno-2-180"></a>            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span><span class="p">,</span>
<a id="__codelineno-2-181" name="__codelineno-2-181" href="#__codelineno-2-181"></a>        <span class="p">)</span>
<a id="__codelineno-2-182" name="__codelineno-2-182" href="#__codelineno-2-182"></a>        <span class="n">stats_missing_scaled</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-2-183" name="__codelineno-2-183" href="#__codelineno-2-183"></a>            <span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="n">root_path</span>
<a id="__codelineno-2-184" name="__codelineno-2-184" href="#__codelineno-2-184"></a>            <span class="o">+</span> <span class="s2">&quot;intermediate_data/PCA_latentFeatures/missingCount_computation_scaled&quot;</span><span class="p">,</span>
<a id="__codelineno-2-185" name="__codelineno-2-185" href="#__codelineno-2-185"></a>            <span class="s2">&quot;file_type&quot;</span><span class="p">:</span> <span class="s2">&quot;parquet&quot;</span><span class="p">,</span>
<a id="__codelineno-2-186" name="__codelineno-2-186" href="#__codelineno-2-186"></a>        <span class="p">}</span>
<a id="__codelineno-2-187" name="__codelineno-2-187" href="#__codelineno-2-187"></a>        <span class="n">idf_imputed</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span>
<a id="__codelineno-2-188" name="__codelineno-2-188" href="#__codelineno-2-188"></a>            <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-2-189" name="__codelineno-2-189" href="#__codelineno-2-189"></a>            <span class="n">idf_standardized</span><span class="p">,</span>
<a id="__codelineno-2-190" name="__codelineno-2-190" href="#__codelineno-2-190"></a>            <span class="n">list_of_cols_scaled</span><span class="p">,</span>
<a id="__codelineno-2-191" name="__codelineno-2-191" href="#__codelineno-2-191"></a>            <span class="n">stats_missing</span><span class="o">=</span><span class="n">stats_missing_scaled</span><span class="p">,</span>
<a id="__codelineno-2-192" name="__codelineno-2-192" href="#__codelineno-2-192"></a>            <span class="o">**</span><span class="n">args</span><span class="p">,</span>
<a id="__codelineno-2-193" name="__codelineno-2-193" href="#__codelineno-2-193"></a>        <span class="p">)</span>
<a id="__codelineno-2-194" name="__codelineno-2-194" href="#__codelineno-2-194"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-2-195" name="__codelineno-2-195" href="#__codelineno-2-195"></a>        <span class="n">idf_imputed</span> <span class="o">=</span> <span class="n">idf_standardized</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">list_of_cols_scaled</span><span class="p">)</span>
<a id="__codelineno-2-196" name="__codelineno-2-196" href="#__codelineno-2-196"></a>
<a id="__codelineno-2-197" name="__codelineno-2-197" href="#__codelineno-2-197"></a>    <span class="n">idf_imputed</span><span class="o">.</span><span class="n">persist</span><span class="p">(</span><span class="n">pyspark</span><span class="o">.</span><span class="n">StorageLevel</span><span class="o">.</span><span class="n">MEMORY_AND_DISK</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-2-198" name="__codelineno-2-198" href="#__codelineno-2-198"></a>
<a id="__codelineno-2-199" name="__codelineno-2-199" href="#__codelineno-2-199"></a>    <span class="n">assembler</span> <span class="o">=</span> <span class="n">VectorAssembler</span><span class="p">(</span><span class="n">inputCols</span><span class="o">=</span><span class="n">list_of_cols_scaled</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">)</span>
<a id="__codelineno-2-200" name="__codelineno-2-200" href="#__codelineno-2-200"></a>    <span class="n">assembled_data</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">idf_imputed</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_cols_scaled</span><span class="p">)</span>
<a id="__codelineno-2-201" name="__codelineno-2-201" href="#__codelineno-2-201"></a>
<a id="__codelineno-2-202" name="__codelineno-2-202" href="#__codelineno-2-202"></a>    <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-2-203" name="__codelineno-2-203" href="#__codelineno-2-203"></a>        <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/PCA_latentFeatures/pca_path&quot;</span><span class="p">)</span>
<a id="__codelineno-2-204" name="__codelineno-2-204" href="#__codelineno-2-204"></a>        <span class="n">pcaModel</span> <span class="o">=</span> <span class="n">PCAModel</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/PCA_latentFeatures/pcaModel_path&quot;</span><span class="p">)</span>
<a id="__codelineno-2-205" name="__codelineno-2-205" href="#__codelineno-2-205"></a>        <span class="n">n</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">getK</span><span class="p">()</span>
<a id="__codelineno-2-206" name="__codelineno-2-206" href="#__codelineno-2-206"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-2-207" name="__codelineno-2-207" href="#__codelineno-2-207"></a>        <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span>
<a id="__codelineno-2-208" name="__codelineno-2-208" href="#__codelineno-2-208"></a>            <span class="n">k</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols_scaled</span><span class="p">),</span> <span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;features_pca&quot;</span>
<a id="__codelineno-2-209" name="__codelineno-2-209" href="#__codelineno-2-209"></a>        <span class="p">)</span>
<a id="__codelineno-2-210" name="__codelineno-2-210" href="#__codelineno-2-210"></a>        <span class="n">pcaModel</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">assembled_data</span><span class="p">)</span>
<a id="__codelineno-2-211" name="__codelineno-2-211" href="#__codelineno-2-211"></a>        <span class="n">explained_variance</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-2-212" name="__codelineno-2-212" href="#__codelineno-2-212"></a>        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-2-213" name="__codelineno-2-213" href="#__codelineno-2-213"></a>            <span class="n">explained_variance</span> <span class="o">+=</span> <span class="n">pcaModel</span><span class="o">.</span><span class="n">explainedVariance</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-2-214" name="__codelineno-2-214" href="#__codelineno-2-214"></a>            <span class="k">if</span> <span class="n">explained_variance</span> <span class="o">&gt;</span> <span class="n">explained_variance_cutoff</span><span class="p">:</span>
<a id="__codelineno-2-215" name="__codelineno-2-215" href="#__codelineno-2-215"></a>                <span class="k">break</span>
<a id="__codelineno-2-216" name="__codelineno-2-216" href="#__codelineno-2-216"></a>
<a id="__codelineno-2-217" name="__codelineno-2-217" href="#__codelineno-2-217"></a>        <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;features_pca&quot;</span><span class="p">)</span>
<a id="__codelineno-2-218" name="__codelineno-2-218" href="#__codelineno-2-218"></a>        <span class="n">pcaModel</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">assembled_data</span><span class="p">)</span>
<a id="__codelineno-2-219" name="__codelineno-2-219" href="#__codelineno-2-219"></a>        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pre_existing_model</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">):</span>
<a id="__codelineno-2-220" name="__codelineno-2-220" href="#__codelineno-2-220"></a>            <span class="n">pcaModel</span><span class="o">.</span><span class="n">write</span><span class="p">()</span><span class="o">.</span><span class="n">overwrite</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
<a id="__codelineno-2-221" name="__codelineno-2-221" href="#__codelineno-2-221"></a>                <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/PCA_latentFeatures/pcaModel_path&quot;</span>
<a id="__codelineno-2-222" name="__codelineno-2-222" href="#__codelineno-2-222"></a>            <span class="p">)</span>
<a id="__codelineno-2-223" name="__codelineno-2-223" href="#__codelineno-2-223"></a>            <span class="n">pca</span><span class="o">.</span><span class="n">write</span><span class="p">()</span><span class="o">.</span><span class="n">overwrite</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/PCA_latentFeatures/pca_path&quot;</span><span class="p">)</span>
<a id="__codelineno-2-224" name="__codelineno-2-224" href="#__codelineno-2-224"></a>
<a id="__codelineno-2-225" name="__codelineno-2-225" href="#__codelineno-2-225"></a>    <span class="k">def</span> <span class="nf">vector_to_array</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
<a id="__codelineno-2-226" name="__codelineno-2-226" href="#__codelineno-2-226"></a>        <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">toArray</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-2-227" name="__codelineno-2-227" href="#__codelineno-2-227"></a>
<a id="__codelineno-2-228" name="__codelineno-2-228" href="#__codelineno-2-228"></a>    <span class="n">f_vector_to_array</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">udf</span><span class="p">(</span><span class="n">vector_to_array</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">ArrayType</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">FloatType</span><span class="p">()))</span>
<a id="__codelineno-2-229" name="__codelineno-2-229" href="#__codelineno-2-229"></a>
<a id="__codelineno-2-230" name="__codelineno-2-230" href="#__codelineno-2-230"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-2-231" name="__codelineno-2-231" href="#__codelineno-2-231"></a>        <span class="n">pcaModel</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">assembled_data</span><span class="p">)</span>
<a id="__codelineno-2-232" name="__codelineno-2-232" href="#__codelineno-2-232"></a>        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;features_pca_array&quot;</span><span class="p">,</span> <span class="n">f_vector_to_array</span><span class="p">(</span><span class="s2">&quot;features_pca&quot;</span><span class="p">))</span>
<a id="__codelineno-2-233" name="__codelineno-2-233" href="#__codelineno-2-233"></a>        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="s2">&quot;features_pca&quot;</span><span class="p">])</span>
<a id="__codelineno-2-234" name="__codelineno-2-234" href="#__codelineno-2-234"></a>    <span class="p">)</span>
<a id="__codelineno-2-235" name="__codelineno-2-235" href="#__codelineno-2-235"></a>
<a id="__codelineno-2-236" name="__codelineno-2-236" href="#__codelineno-2-236"></a>    <span class="n">odf_schema</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">schema</span>
<a id="__codelineno-2-237" name="__codelineno-2-237" href="#__codelineno-2-237"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<a id="__codelineno-2-238" name="__codelineno-2-238" href="#__codelineno-2-238"></a>        <span class="n">odf_schema</span> <span class="o">=</span> <span class="n">odf_schema</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;latent_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">T</span><span class="o">.</span><span class="n">FloatType</span><span class="p">()))</span>
<a id="__codelineno-2-239" name="__codelineno-2-239" href="#__codelineno-2-239"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-2-240" name="__codelineno-2-240" href="#__codelineno-2-240"></a>        <span class="n">odf</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;features_pca_array&quot;</span><span class="p">]))</span>
<a id="__codelineno-2-241" name="__codelineno-2-241" href="#__codelineno-2-241"></a>        <span class="o">.</span><span class="n">toDF</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">odf_schema</span><span class="p">)</span>
<a id="__codelineno-2-242" name="__codelineno-2-242" href="#__codelineno-2-242"></a>        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;features_pca_array&quot;</span><span class="p">)</span>
<a id="__codelineno-2-243" name="__codelineno-2-243" href="#__codelineno-2-243"></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span> <span class="kc">None</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;latent_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)])</span>
<a id="__codelineno-2-244" name="__codelineno-2-244" href="#__codelineno-2-244"></a>    <span class="p">)</span>
<a id="__codelineno-2-245" name="__codelineno-2-245" href="#__codelineno-2-245"></a>
<a id="__codelineno-2-246" name="__codelineno-2-246" href="#__codelineno-2-246"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-2-247" name="__codelineno-2-247" href="#__codelineno-2-247"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-2-248" name="__codelineno-2-248" href="#__codelineno-2-248"></a>
<a id="__codelineno-2-249" name="__codelineno-2-249" href="#__codelineno-2-249"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-2-250" name="__codelineno-2-250" href="#__codelineno-2-250"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Explained Variance: &quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pcaModel</span><span class="o">.</span><span class="n">explainedVariance</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">]),</span> <span class="mi">4</span><span class="p">))</span>
<a id="__codelineno-2-251" name="__codelineno-2-251" href="#__codelineno-2-251"></a>        <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;latent_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)]</span>
<a id="__codelineno-2-252" name="__codelineno-2-252" href="#__codelineno-2-252"></a>        <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">output_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-2-253" name="__codelineno-2-253" href="#__codelineno-2-253"></a>
<a id="__codelineno-2-254" name="__codelineno-2-254" href="#__codelineno-2-254"></a>    <span class="k">return</span> <span class="n">odf</span>
</code></pre></div>
</pre>
</details>
</dd>
<dt id="anovos.data_transformer.transformers.attribute_binning"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">attribute_binning</span></span>(<span class="n">spark, idf, list_of_cols='all', drop_cols=[], method_type='equal_range', bin_size=10, bin_dtype='numerical', pre_existing_model=False, model_path='NA', output_mode='replace', print_impact=False)</span>
</code></dt>
<dd>
<div class="desc"><p>Attribute binning (or discretization) is a method of numerical attribute into discrete (integer or categorical
values) using pre-defined number of bins. This data pre-processing technique is used to reduce the effects of
minor observation errors. Also, Binning introduces non-linearity and tends to improve the performance of the
model. In this function, we are focussing on unsupervised way of binning i.e. without taking the target
variable into account - Equal Range Binning, Equal Frequency Binning. In Equal Range method, each bin is of equal
size/width and computed as:</p>
<p>w = max- min / no. of bins</p>
<p><em>bins cutoff=[min, min+w,min+2w…..,max-w,max]</em></p>
<p>whereas in Equal Frequency binning method, bins are created in such a way that each bin has equal no. of rows,
though the width of bins may vary from each other.</p>
<p>w = 1 / no. of bins</p>
<p><em>bins cutoff=[min, wthpctile, 2wthpctile….,max ]</em></p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>spark</code></strong></dt>
<dd>Spark Session</dd>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe</dd>
<dt><strong><code>list_of_cols</code></strong></dt>
<dd>List of numerical columns to transform e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
"all" can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.
Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in
drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = "all")</dd>
<dt><strong><code>drop_cols</code></strong></dt>
<dd>List of columns to be dropped e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except
a few handful of them. (Default value = [])</dd>
<dt><strong><code>method_type</code></strong></dt>
<dd>"equal_frequency", "equal_range".
In "equal_range" method, each bin is of equal size/width and in "equal_frequency", each bin has
equal no. of rows, though the width of bins may vary. (Default value = "equal_range")</dd>
<dt><strong><code>bin_size</code></strong></dt>
<dd>Number of bins. (Default value = 10)</dd>
<dt><strong><code>bin_dtype</code></strong></dt>
<dd>"numerical", "categorical".
With "numerical" option, original value is replaced with an Integer (1,2,…) and
with "categorical" option, original replaced with a string describing min and max value allowed
in the bin ("minval-maxval"). (Default value = "numerical")</dd>
<dt><strong><code>pre_existing_model</code></strong></dt>
<dd>Boolean argument – True or False. True if binning model exists already, False Otherwise. (Default value = False)</dd>
<dt><strong><code>model_path</code></strong></dt>
<dd>If pre_existing_model is True, this argument is path for referring the pre-saved model.
If pre_existing_model is False, this argument can be used for saving the model.
Default "NA" means there is neither pre-existing model nor there is a need to save one.</dd>
<dt><strong><code>output_mode</code></strong></dt>
<dd>"replace", "append".
“replace” option replaces original columns with transformed column. “append” option append transformed
column to the input dataset with a postfix "_binned" e.g. column X is appended as X_binned. (Default value = "replace")</dd>
<dt><strong><code>print_impact</code></strong></dt>
<dd>True, False (Default value = False)
This argument is to print the number of categories generated for each attribute (may or may be not same as bin_size)</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>DataFrame</code></dt>
<dd>Binned Dataframe</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">def</span> <span class="nf">attribute_binning</span><span class="p">(</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>    <span class="n">method_type</span><span class="o">=</span><span class="s2">&quot;equal_range&quot;</span><span class="p">,</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>    <span class="n">bin_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>    <span class="n">bin_dtype</span><span class="o">=</span><span class="s2">&quot;numerical&quot;</span><span class="p">,</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>    <span class="n">pre_existing_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>    <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="p">):</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="sd">    Attribute binning (or discretization) is a method of numerical attribute into discrete (integer or categorical</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="sd">    values) using pre-defined number of bins. This data pre-processing technique is used to reduce the effects of</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="sd">    minor observation errors. Also, Binning introduces non-linearity and tends to improve the performance of the</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="sd">    model. In this function, we are focussing on unsupervised way of binning i.e. without taking the target</span>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="sd">    variable into account - Equal Range Binning, Equal Frequency Binning. In Equal Range method, each bin is of equal</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="sd">    size/width and computed as:</span>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="sd">    w = max- min / no. of bins</span>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a><span class="sd">    *bins cutoff=[min, min+w,min+2w…..,max-w,max]*</span>
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a><span class="sd">    whereas in Equal Frequency binning method, bins are created in such a way that each bin has equal no. of rows,</span>
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a><span class="sd">    though the width of bins may vary from each other.</span>
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a>
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a><span class="sd">    w = 1 / no. of bins</span>
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a>
<a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a><span class="sd">    *bins cutoff=[min, wthpctile, 2wthpctile….,max ]*</span>
<a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a>
<a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a>
<a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a><span class="sd">    Parameters</span>
<a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a><span class="sd">    ----------</span>
<a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a><span class="sd">    spark</span>
<a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-3-38" name="__codelineno-3-38" href="#__codelineno-3-38"></a><span class="sd">    idf</span>
<a id="__codelineno-3-39" name="__codelineno-3-39" href="#__codelineno-3-39"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-3-40" name="__codelineno-3-40" href="#__codelineno-3-40"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-3-41" name="__codelineno-3-41" href="#__codelineno-3-41"></a><span class="sd">        List of numerical columns to transform e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-3-42" name="__codelineno-3-42" href="#__codelineno-3-42"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-3-43" name="__codelineno-3-43" href="#__codelineno-3-43"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-3-44" name="__codelineno-3-44" href="#__codelineno-3-44"></a><span class="sd">        &quot;all&quot; can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-3-45" name="__codelineno-3-45" href="#__codelineno-3-45"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-3-46" name="__codelineno-3-46" href="#__codelineno-3-46"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-3-47" name="__codelineno-3-47" href="#__codelineno-3-47"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-3-48" name="__codelineno-3-48" href="#__codelineno-3-48"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-3-49" name="__codelineno-3-49" href="#__codelineno-3-49"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-3-50" name="__codelineno-3-50" href="#__codelineno-3-50"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-3-51" name="__codelineno-3-51" href="#__codelineno-3-51"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-3-52" name="__codelineno-3-52" href="#__codelineno-3-52"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-3-53" name="__codelineno-3-53" href="#__codelineno-3-53"></a><span class="sd">    method_type</span>
<a id="__codelineno-3-54" name="__codelineno-3-54" href="#__codelineno-3-54"></a><span class="sd">        &quot;equal_frequency&quot;, &quot;equal_range&quot;.</span>
<a id="__codelineno-3-55" name="__codelineno-3-55" href="#__codelineno-3-55"></a><span class="sd">        In &quot;equal_range&quot; method, each bin is of equal size/width and in &quot;equal_frequency&quot;, each bin has</span>
<a id="__codelineno-3-56" name="__codelineno-3-56" href="#__codelineno-3-56"></a><span class="sd">        equal no. of rows, though the width of bins may vary. (Default value = &quot;equal_range&quot;)</span>
<a id="__codelineno-3-57" name="__codelineno-3-57" href="#__codelineno-3-57"></a><span class="sd">    bin_size</span>
<a id="__codelineno-3-58" name="__codelineno-3-58" href="#__codelineno-3-58"></a><span class="sd">        Number of bins. (Default value = 10)</span>
<a id="__codelineno-3-59" name="__codelineno-3-59" href="#__codelineno-3-59"></a><span class="sd">    bin_dtype</span>
<a id="__codelineno-3-60" name="__codelineno-3-60" href="#__codelineno-3-60"></a><span class="sd">        &quot;numerical&quot;, &quot;categorical&quot;.</span>
<a id="__codelineno-3-61" name="__codelineno-3-61" href="#__codelineno-3-61"></a><span class="sd">        With &quot;numerical&quot; option, original value is replaced with an Integer (1,2,…) and</span>
<a id="__codelineno-3-62" name="__codelineno-3-62" href="#__codelineno-3-62"></a><span class="sd">        with &quot;categorical&quot; option, original replaced with a string describing min and max value allowed</span>
<a id="__codelineno-3-63" name="__codelineno-3-63" href="#__codelineno-3-63"></a><span class="sd">        in the bin (&quot;minval-maxval&quot;). (Default value = &quot;numerical&quot;)</span>
<a id="__codelineno-3-64" name="__codelineno-3-64" href="#__codelineno-3-64"></a><span class="sd">    pre_existing_model</span>
<a id="__codelineno-3-65" name="__codelineno-3-65" href="#__codelineno-3-65"></a><span class="sd">        Boolean argument – True or False. True if binning model exists already, False Otherwise. (Default value = False)</span>
<a id="__codelineno-3-66" name="__codelineno-3-66" href="#__codelineno-3-66"></a><span class="sd">    model_path</span>
<a id="__codelineno-3-67" name="__codelineno-3-67" href="#__codelineno-3-67"></a><span class="sd">        If pre_existing_model is True, this argument is path for referring the pre-saved model.</span>
<a id="__codelineno-3-68" name="__codelineno-3-68" href="#__codelineno-3-68"></a><span class="sd">        If pre_existing_model is False, this argument can be used for saving the model.</span>
<a id="__codelineno-3-69" name="__codelineno-3-69" href="#__codelineno-3-69"></a><span class="sd">        Default &quot;NA&quot; means there is neither pre-existing model nor there is a need to save one.</span>
<a id="__codelineno-3-70" name="__codelineno-3-70" href="#__codelineno-3-70"></a><span class="sd">    output_mode</span>
<a id="__codelineno-3-71" name="__codelineno-3-71" href="#__codelineno-3-71"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-3-72" name="__codelineno-3-72" href="#__codelineno-3-72"></a><span class="sd">        “replace” option replaces original columns with transformed column. “append” option append transformed</span>
<a id="__codelineno-3-73" name="__codelineno-3-73" href="#__codelineno-3-73"></a><span class="sd">        column to the input dataset with a postfix &quot;_binned&quot; e.g. column X is appended as X_binned. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-3-74" name="__codelineno-3-74" href="#__codelineno-3-74"></a><span class="sd">    print_impact</span>
<a id="__codelineno-3-75" name="__codelineno-3-75" href="#__codelineno-3-75"></a><span class="sd">        True, False (Default value = False)</span>
<a id="__codelineno-3-76" name="__codelineno-3-76" href="#__codelineno-3-76"></a><span class="sd">        This argument is to print the number of categories generated for each attribute (may or may be not same as bin_size)</span>
<a id="__codelineno-3-77" name="__codelineno-3-77" href="#__codelineno-3-77"></a>
<a id="__codelineno-3-78" name="__codelineno-3-78" href="#__codelineno-3-78"></a><span class="sd">    Returns</span>
<a id="__codelineno-3-79" name="__codelineno-3-79" href="#__codelineno-3-79"></a><span class="sd">    -------</span>
<a id="__codelineno-3-80" name="__codelineno-3-80" href="#__codelineno-3-80"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-3-81" name="__codelineno-3-81" href="#__codelineno-3-81"></a><span class="sd">        Binned Dataframe</span>
<a id="__codelineno-3-82" name="__codelineno-3-82" href="#__codelineno-3-82"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-3-83" name="__codelineno-3-83" href="#__codelineno-3-83"></a>
<a id="__codelineno-3-84" name="__codelineno-3-84" href="#__codelineno-3-84"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-3-85" name="__codelineno-3-85" href="#__codelineno-3-85"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-3-86" name="__codelineno-3-86" href="#__codelineno-3-86"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-3-87" name="__codelineno-3-87" href="#__codelineno-3-87"></a>
<a id="__codelineno-3-88" name="__codelineno-3-88" href="#__codelineno-3-88"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-3-89" name="__codelineno-3-89" href="#__codelineno-3-89"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-3-90" name="__codelineno-3-90" href="#__codelineno-3-90"></a>
<a id="__codelineno-3-91" name="__codelineno-3-91" href="#__codelineno-3-91"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-3-92" name="__codelineno-3-92" href="#__codelineno-3-92"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-3-93" name="__codelineno-3-93" href="#__codelineno-3-93"></a>
<a id="__codelineno-3-94" name="__codelineno-3-94" href="#__codelineno-3-94"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-3-95" name="__codelineno-3-95" href="#__codelineno-3-95"></a>
<a id="__codelineno-3-96" name="__codelineno-3-96" href="#__codelineno-3-96"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-3-97" name="__codelineno-3-97" href="#__codelineno-3-97"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-3-98" name="__codelineno-3-98" href="#__codelineno-3-98"></a>
<a id="__codelineno-3-99" name="__codelineno-3-99" href="#__codelineno-3-99"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-3-100" name="__codelineno-3-100" href="#__codelineno-3-100"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No Binning Performed - No numerical column(s) to transform&quot;</span><span class="p">)</span>
<a id="__codelineno-3-101" name="__codelineno-3-101" href="#__codelineno-3-101"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-3-102" name="__codelineno-3-102" href="#__codelineno-3-102"></a>
<a id="__codelineno-3-103" name="__codelineno-3-103" href="#__codelineno-3-103"></a>    <span class="k">if</span> <span class="n">method_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;equal_frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;equal_range&quot;</span><span class="p">):</span>
<a id="__codelineno-3-104" name="__codelineno-3-104" href="#__codelineno-3-104"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for method_type&quot;</span><span class="p">)</span>
<a id="__codelineno-3-105" name="__codelineno-3-105" href="#__codelineno-3-105"></a>
<a id="__codelineno-3-106" name="__codelineno-3-106" href="#__codelineno-3-106"></a>    <span class="k">if</span> <span class="n">bin_size</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-3-107" name="__codelineno-3-107" href="#__codelineno-3-107"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for bin_size&quot;</span><span class="p">)</span>
<a id="__codelineno-3-108" name="__codelineno-3-108" href="#__codelineno-3-108"></a>
<a id="__codelineno-3-109" name="__codelineno-3-109" href="#__codelineno-3-109"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">):</span>
<a id="__codelineno-3-110" name="__codelineno-3-110" href="#__codelineno-3-110"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for output_mode&quot;</span><span class="p">)</span>
<a id="__codelineno-3-111" name="__codelineno-3-111" href="#__codelineno-3-111"></a>
<a id="__codelineno-3-112" name="__codelineno-3-112" href="#__codelineno-3-112"></a>    <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-3-113" name="__codelineno-3-113" href="#__codelineno-3-113"></a>        <span class="n">df_model</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/attribute_binning&quot;</span><span class="p">)</span>
<a id="__codelineno-3-114" name="__codelineno-3-114" href="#__codelineno-3-114"></a>        <span class="n">bin_cutoffs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-3-115" name="__codelineno-3-115" href="#__codelineno-3-115"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-3-116" name="__codelineno-3-116" href="#__codelineno-3-116"></a>            <span class="n">mapped_value</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-3-117" name="__codelineno-3-117" href="#__codelineno-3-117"></a>                <span class="n">df_model</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-3-118" name="__codelineno-3-118" href="#__codelineno-3-118"></a>                <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;parameters&quot;</span><span class="p">)</span>
<a id="__codelineno-3-119" name="__codelineno-3-119" href="#__codelineno-3-119"></a>                <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-3-120" name="__codelineno-3-120" href="#__codelineno-3-120"></a>                <span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-3-121" name="__codelineno-3-121" href="#__codelineno-3-121"></a>            <span class="p">)</span>
<a id="__codelineno-3-122" name="__codelineno-3-122" href="#__codelineno-3-122"></a>            <span class="n">bin_cutoffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapped_value</span><span class="p">)</span>
<a id="__codelineno-3-123" name="__codelineno-3-123" href="#__codelineno-3-123"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-3-124" name="__codelineno-3-124" href="#__codelineno-3-124"></a>        <span class="k">if</span> <span class="n">method_type</span> <span class="o">==</span> <span class="s2">&quot;equal_frequency&quot;</span><span class="p">:</span>
<a id="__codelineno-3-125" name="__codelineno-3-125" href="#__codelineno-3-125"></a>            <span class="n">pctile_width</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">bin_size</span>
<a id="__codelineno-3-126" name="__codelineno-3-126" href="#__codelineno-3-126"></a>            <span class="n">pctile_cutoff</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-3-127" name="__codelineno-3-127" href="#__codelineno-3-127"></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bin_size</span><span class="p">):</span>
<a id="__codelineno-3-128" name="__codelineno-3-128" href="#__codelineno-3-128"></a>                <span class="n">pctile_cutoff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="n">pctile_width</span><span class="p">)</span>
<a id="__codelineno-3-129" name="__codelineno-3-129" href="#__codelineno-3-129"></a>            <span class="n">bin_cutoffs</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">approxQuantile</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="n">pctile_cutoff</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-3-130" name="__codelineno-3-130" href="#__codelineno-3-130"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-3-131" name="__codelineno-3-131" href="#__codelineno-3-131"></a>            <span class="n">funs</span> <span class="o">=</span> <span class="p">[</span><span class="n">F</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">min</span><span class="p">]</span>
<a id="__codelineno-3-132" name="__codelineno-3-132" href="#__codelineno-3-132"></a>            <span class="n">exprs</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">funs</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">]</span>
<a id="__codelineno-3-133" name="__codelineno-3-133" href="#__codelineno-3-133"></a>            <span class="n">list_result</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">groupby</span><span class="p">()</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="o">*</span><span class="n">exprs</span><span class="p">)</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-3-134" name="__codelineno-3-134" href="#__codelineno-3-134"></a>            <span class="n">bin_cutoffs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-3-135" name="__codelineno-3-135" href="#__codelineno-3-135"></a>            <span class="n">drop_col_process</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-3-136" name="__codelineno-3-136" href="#__codelineno-3-136"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_result</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)):</span>
<a id="__codelineno-3-137" name="__codelineno-3-137" href="#__codelineno-3-137"></a>                <span class="n">bin_cutoff</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-3-138" name="__codelineno-3-138" href="#__codelineno-3-138"></a>                <span class="n">max_val</span> <span class="o">=</span> <span class="n">list_result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-3-139" name="__codelineno-3-139" href="#__codelineno-3-139"></a>                <span class="n">min_val</span> <span class="o">=</span> <span class="n">list_result</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_result</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
<a id="__codelineno-3-140" name="__codelineno-3-140" href="#__codelineno-3-140"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">max_val</span> <span class="ow">and</span> <span class="n">max_val</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-3-141" name="__codelineno-3-141" href="#__codelineno-3-141"></a>                    <span class="n">drop_col_process</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-3-142" name="__codelineno-3-142" href="#__codelineno-3-142"></a>                    <span class="k">continue</span>
<a id="__codelineno-3-143" name="__codelineno-3-143" href="#__codelineno-3-143"></a>                <span class="n">bin_width</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_val</span> <span class="o">-</span> <span class="n">min_val</span><span class="p">)</span> <span class="o">/</span> <span class="n">bin_size</span>
<a id="__codelineno-3-144" name="__codelineno-3-144" href="#__codelineno-3-144"></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bin_size</span><span class="p">):</span>
<a id="__codelineno-3-145" name="__codelineno-3-145" href="#__codelineno-3-145"></a>                    <span class="n">bin_cutoff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">min_val</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="n">bin_width</span><span class="p">)</span>
<a id="__codelineno-3-146" name="__codelineno-3-146" href="#__codelineno-3-146"></a>                <span class="n">bin_cutoffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bin_cutoff</span><span class="p">)</span>
<a id="__codelineno-3-147" name="__codelineno-3-147" href="#__codelineno-3-147"></a>            <span class="k">if</span> <span class="n">drop_col_process</span><span class="p">:</span>
<a id="__codelineno-3-148" name="__codelineno-3-148" href="#__codelineno-3-148"></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-3-149" name="__codelineno-3-149" href="#__codelineno-3-149"></a>                    <span class="s2">&quot;Columns contains too much null values. Dropping &quot;</span>
<a id="__codelineno-3-150" name="__codelineno-3-150" href="#__codelineno-3-150"></a>                    <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">drop_col_process</span><span class="p">)</span>
<a id="__codelineno-3-151" name="__codelineno-3-151" href="#__codelineno-3-151"></a>                <span class="p">)</span>
<a id="__codelineno-3-152" name="__codelineno-3-152" href="#__codelineno-3-152"></a>                <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
<a id="__codelineno-3-153" name="__codelineno-3-153" href="#__codelineno-3-153"></a>                    <span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_col_process</span><span class="p">])</span>
<a id="__codelineno-3-154" name="__codelineno-3-154" href="#__codelineno-3-154"></a>                <span class="p">)</span>
<a id="__codelineno-3-155" name="__codelineno-3-155" href="#__codelineno-3-155"></a>        <span class="k">if</span> <span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span>
<a id="__codelineno-3-156" name="__codelineno-3-156" href="#__codelineno-3-156"></a>            <span class="n">df_model</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
<a id="__codelineno-3-157" name="__codelineno-3-157" href="#__codelineno-3-157"></a>                <span class="nb">zip</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="n">bin_cutoffs</span><span class="p">),</span> <span class="n">schema</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;parameters&quot;</span><span class="p">]</span>
<a id="__codelineno-3-158" name="__codelineno-3-158" href="#__codelineno-3-158"></a>            <span class="p">)</span>
<a id="__codelineno-3-159" name="__codelineno-3-159" href="#__codelineno-3-159"></a>
<a id="__codelineno-3-160" name="__codelineno-3-160" href="#__codelineno-3-160"></a>            <span class="n">df_model</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/attribute_binning&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span><span class="p">)</span>
<a id="__codelineno-3-161" name="__codelineno-3-161" href="#__codelineno-3-161"></a>
<a id="__codelineno-3-162" name="__codelineno-3-162" href="#__codelineno-3-162"></a>    <span class="k">def</span> <span class="nf">bucket_label</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<a id="__codelineno-3-163" name="__codelineno-3-163" href="#__codelineno-3-163"></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-3-164" name="__codelineno-3-164" href="#__codelineno-3-164"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-3-165" name="__codelineno-3-165" href="#__codelineno-3-165"></a>
<a id="__codelineno-3-166" name="__codelineno-3-166" href="#__codelineno-3-166"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bin_cutoffs</span><span class="p">[</span><span class="n">index</span><span class="p">])):</span>
<a id="__codelineno-3-167" name="__codelineno-3-167" href="#__codelineno-3-167"></a>            <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">bin_cutoffs</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
<a id="__codelineno-3-168" name="__codelineno-3-168" href="#__codelineno-3-168"></a>                <span class="k">if</span> <span class="n">bin_dtype</span> <span class="o">==</span> <span class="s2">&quot;numerical&quot;</span><span class="p">:</span>
<a id="__codelineno-3-169" name="__codelineno-3-169" href="#__codelineno-3-169"></a>                    <span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-3-170" name="__codelineno-3-170" href="#__codelineno-3-170"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-3-171" name="__codelineno-3-171" href="#__codelineno-3-171"></a>                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-3-172" name="__codelineno-3-172" href="#__codelineno-3-172"></a>                        <span class="k">return</span> <span class="s2">&quot;&lt;= &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">bin_cutoffs</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
<a id="__codelineno-3-173" name="__codelineno-3-173" href="#__codelineno-3-173"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-3-174" name="__codelineno-3-174" href="#__codelineno-3-174"></a>                        <span class="k">return</span> <span class="p">(</span>
<a id="__codelineno-3-175" name="__codelineno-3-175" href="#__codelineno-3-175"></a>                            <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">bin_cutoffs</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
<a id="__codelineno-3-176" name="__codelineno-3-176" href="#__codelineno-3-176"></a>                            <span class="o">+</span> <span class="s2">&quot;-&quot;</span>
<a id="__codelineno-3-177" name="__codelineno-3-177" href="#__codelineno-3-177"></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">bin_cutoffs</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
<a id="__codelineno-3-178" name="__codelineno-3-178" href="#__codelineno-3-178"></a>                        <span class="p">)</span>
<a id="__codelineno-3-179" name="__codelineno-3-179" href="#__codelineno-3-179"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-3-180" name="__codelineno-3-180" href="#__codelineno-3-180"></a>                <span class="nb">next</span>
<a id="__codelineno-3-181" name="__codelineno-3-181" href="#__codelineno-3-181"></a>
<a id="__codelineno-3-182" name="__codelineno-3-182" href="#__codelineno-3-182"></a>        <span class="k">if</span> <span class="n">bin_dtype</span> <span class="o">==</span> <span class="s2">&quot;numerical&quot;</span><span class="p">:</span>
<a id="__codelineno-3-183" name="__codelineno-3-183" href="#__codelineno-3-183"></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">bin_cutoffs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-3-184" name="__codelineno-3-184" href="#__codelineno-3-184"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-3-185" name="__codelineno-3-185" href="#__codelineno-3-185"></a>            <span class="k">return</span> <span class="s2">&quot;&gt; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">bin_cutoffs</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">bin_cutoffs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
<a id="__codelineno-3-186" name="__codelineno-3-186" href="#__codelineno-3-186"></a>
<a id="__codelineno-3-187" name="__codelineno-3-187" href="#__codelineno-3-187"></a>    <span class="k">if</span> <span class="n">bin_dtype</span> <span class="o">==</span> <span class="s2">&quot;numerical&quot;</span><span class="p">:</span>
<a id="__codelineno-3-188" name="__codelineno-3-188" href="#__codelineno-3-188"></a>        <span class="n">f_bucket_label</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">udf</span><span class="p">(</span><span class="n">bucket_label</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">IntegerType</span><span class="p">())</span>
<a id="__codelineno-3-189" name="__codelineno-3-189" href="#__codelineno-3-189"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-3-190" name="__codelineno-3-190" href="#__codelineno-3-190"></a>        <span class="n">f_bucket_label</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">udf</span><span class="p">(</span><span class="n">bucket_label</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">StringType</span><span class="p">())</span>
<a id="__codelineno-3-191" name="__codelineno-3-191" href="#__codelineno-3-191"></a>
<a id="__codelineno-3-192" name="__codelineno-3-192" href="#__codelineno-3-192"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-3-193" name="__codelineno-3-193" href="#__codelineno-3-193"></a>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-3-194" name="__codelineno-3-194" href="#__codelineno-3-194"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_binned&quot;</span><span class="p">,</span> <span class="n">f_bucket_label</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">idx</span><span class="p">)))</span>
<a id="__codelineno-3-195" name="__codelineno-3-195" href="#__codelineno-3-195"></a>
<a id="__codelineno-3-196" name="__codelineno-3-196" href="#__codelineno-3-196"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-3-197" name="__codelineno-3-197" href="#__codelineno-3-197"></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-3-198" name="__codelineno-3-198" href="#__codelineno-3-198"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">col</span> <span class="o">+</span> <span class="s2">&quot;_binned&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
<a id="__codelineno-3-199" name="__codelineno-3-199" href="#__codelineno-3-199"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-3-200" name="__codelineno-3-200" href="#__codelineno-3-200"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-3-201" name="__codelineno-3-201" href="#__codelineno-3-201"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="n">list_of_cols</span>
<a id="__codelineno-3-202" name="__codelineno-3-202" href="#__codelineno-3-202"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-3-203" name="__codelineno-3-203" href="#__codelineno-3-203"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_binned&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">]</span>
<a id="__codelineno-3-204" name="__codelineno-3-204" href="#__codelineno-3-204"></a>        <span class="n">uniqueCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">odf</span><span class="p">,</span> <span class="n">output_cols</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">output_cols</span><span class="p">),</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-3-205" name="__codelineno-3-205" href="#__codelineno-3-205"></a>    <span class="k">return</span> <span class="n">odf</span>
</code></pre></div>
</pre>
</details>
</dd>
<dt id="anovos.data_transformer.transformers.auto_imputation"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">auto_imputation</span></span>(<span class="n">spark, idf, list_of_cols='missing', drop_cols=[], id_col='', null_pct=0.1, stats_missing={}, output_mode='replace', run_type='local', root_path='', auth_key='NA', print_impact=True)</span>
</code></dt>
<dd>
<div class="desc"><p>auto_imputation tests for 5 imputation methods using the other imputation functions provided in this module
and returns the one with the best performance. The 5 methods are: (1) imputation_MMM with method_type="mean" (2)
imputation_MMM with method_type="median" (3) imputation_sklearn with method_type="KNN" (4) imputation_sklearn
with method_type="regression" (5) imputation_matrixFactorization</p>
<p>Samples without missing values in attributes to impute are used for testing by removing some % of values and impute
them again using the above 5 methods. RMSE/attribute_mean is used as the evaluation metric for each attribute to
reduce the effect of unit difference among attributes. The final error of a method is calculated by the sum of (
RMSE/attribute_mean) for all numerical attributes to impute and the method with the least error will be selected.</p>
<p>The above testing is only applicable for numerical attributes. If categorical attributes are included,
they will be automatically imputed using imputation_MMM. In addition, if there is only one numerical attribute to
impute, only method (1) and (2) will be tested because the rest of the methods require more than one column.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>spark</code></strong></dt>
<dd>Spark Session</dd>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe</dd>
<dt><strong><code>list_of_cols</code></strong></dt>
<dd>List of columns to impute e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
"all" can be passed to include all (non-array) columns for analysis.
This is super useful instead of specifying all column names manually.
"missing" (default) can be passed to include only those columns with missing values.
One of the usecases where "all" may be preferable over "missing" is when the user wants to save
the imputation model for the future use e.g. a column may not have missing value in the training
dataset but missing values may possibly appear in the prediction dataset.
Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in
drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols.</dd>
<dt><strong><code>drop_cols</code></strong></dt>
<dd>List of columns to be dropped e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except
a few handful of them. (Default value = [])</dd>
<dt><strong><code>id_col</code></strong></dt>
<dd>ID column (Default value = "")</dd>
<dt><strong><code>null_pct</code></strong></dt>
<dd>proportion of the valid input data to be replaced by None to form the test data (Default value = 0.1)</dd>
<dt><strong><code>stats_missing</code></strong></dt>
<dd>Takes arguments for read_dataset (data_ingest module) function in a dictionary format
to read pre-saved statistics on missing count/pct i.e. if measures_of_counts or
missingCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</dd>
<dt><strong><code>output_mode</code></strong></dt>
<dd>"replace", "append".
“replace” option replaces original columns with transformed column. “append” option append transformed
column to the input dataset with a postfix "_imputed" e.g. column X is appended as X_imputed. (Default value = "replace")</dd>
<dt><strong><code>run_type</code></strong></dt>
<dd>"local", "emr", "databricks", "ak8s" (Default value = "local")</dd>
<dt><strong><code>root_path</code></strong></dt>
<dd>This argument takes in a base folder path for writing out intermediate_data/ folder to. Default value is ""</dd>
<dt><strong><code>auth_key</code></strong></dt>
<dd>Option to pass an authorization key to write to filesystems. Currently applicable only for ak8s run_type. Default value is kept as "NA"</dd>
<dt><strong><code>print_impact</code></strong></dt>
<dd>True, False (Default value = False)
This argument is to print out before and after missing counts of imputed columns. It also print the name of best
performing imputation method along with RMSE details.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>DataFrame</code></dt>
<dd>Imputed Dataframe</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">def</span> <span class="nf">auto_imputation</span><span class="p">(</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">,</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>    <span class="n">id_col</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>    <span class="n">null_pct</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>    <span class="n">stats_missing</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>    <span class="n">run_type</span><span class="o">=</span><span class="s2">&quot;local&quot;</span><span class="p">,</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>    <span class="n">root_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>    <span class="n">auth_key</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="p">):</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="sd">    auto_imputation tests for 5 imputation methods using the other imputation functions provided in this module</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="sd">    and returns the one with the best performance. The 5 methods are: (1) imputation_MMM with method_type=&quot;mean&quot; (2)</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="sd">    imputation_MMM with method_type=&quot;median&quot; (3) imputation_sklearn with method_type=&quot;KNN&quot; (4) imputation_sklearn</span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="sd">    with method_type=&quot;regression&quot; (5) imputation_matrixFactorization</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="sd">    Samples without missing values in attributes to impute are used for testing by removing some % of values and impute</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="sd">    them again using the above 5 methods. RMSE/attribute_mean is used as the evaluation metric for each attribute to</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="sd">    reduce the effect of unit difference among attributes. The final error of a method is calculated by the sum of (</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="sd">    RMSE/attribute_mean) for all numerical attributes to impute and the method with the least error will be selected.</span>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="sd">    The above testing is only applicable for numerical attributes. If categorical attributes are included,</span>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="sd">    they will be automatically imputed using imputation_MMM. In addition, if there is only one numerical attribute to</span>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="sd">    impute, only method (1) and (2) will be tested because the rest of the methods require more than one column.</span>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="sd">    Parameters</span>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="sd">    ----------</span>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="sd">    spark</span>
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="sd">    idf</span>
<a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a><span class="sd">        List of columns to impute e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a><span class="sd">        &quot;all&quot; can be passed to include all (non-array) columns for analysis.</span>
<a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a><span class="sd">        This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a><span class="sd">        &quot;missing&quot; (default) can be passed to include only those columns with missing values.</span>
<a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a><span class="sd">        One of the usecases where &quot;all&quot; may be preferable over &quot;missing&quot; is when the user wants to save</span>
<a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a><span class="sd">        the imputation model for the future use e.g. a column may not have missing value in the training</span>
<a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a><span class="sd">        dataset but missing values may possibly appear in the prediction dataset.</span>
<a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols.</span>
<a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-4-54" name="__codelineno-4-54" href="#__codelineno-4-54"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-4-55" name="__codelineno-4-55" href="#__codelineno-4-55"></a><span class="sd">    id_col</span>
<a id="__codelineno-4-56" name="__codelineno-4-56" href="#__codelineno-4-56"></a><span class="sd">        ID column (Default value = &quot;&quot;)</span>
<a id="__codelineno-4-57" name="__codelineno-4-57" href="#__codelineno-4-57"></a><span class="sd">    null_pct</span>
<a id="__codelineno-4-58" name="__codelineno-4-58" href="#__codelineno-4-58"></a><span class="sd">        proportion of the valid input data to be replaced by None to form the test data (Default value = 0.1)</span>
<a id="__codelineno-4-59" name="__codelineno-4-59" href="#__codelineno-4-59"></a><span class="sd">    stats_missing</span>
<a id="__codelineno-4-60" name="__codelineno-4-60" href="#__codelineno-4-60"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-4-61" name="__codelineno-4-61" href="#__codelineno-4-61"></a><span class="sd">        to read pre-saved statistics on missing count/pct i.e. if measures_of_counts or</span>
<a id="__codelineno-4-62" name="__codelineno-4-62" href="#__codelineno-4-62"></a><span class="sd">        missingCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-4-63" name="__codelineno-4-63" href="#__codelineno-4-63"></a><span class="sd">    output_mode</span>
<a id="__codelineno-4-64" name="__codelineno-4-64" href="#__codelineno-4-64"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-4-65" name="__codelineno-4-65" href="#__codelineno-4-65"></a><span class="sd">        “replace” option replaces original columns with transformed column. “append” option append transformed</span>
<a id="__codelineno-4-66" name="__codelineno-4-66" href="#__codelineno-4-66"></a><span class="sd">        column to the input dataset with a postfix &quot;_imputed&quot; e.g. column X is appended as X_imputed. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-4-67" name="__codelineno-4-67" href="#__codelineno-4-67"></a><span class="sd">    run_type</span>
<a id="__codelineno-4-68" name="__codelineno-4-68" href="#__codelineno-4-68"></a><span class="sd">        &quot;local&quot;, &quot;emr&quot;, &quot;databricks&quot;, &quot;ak8s&quot; (Default value = &quot;local&quot;)</span>
<a id="__codelineno-4-69" name="__codelineno-4-69" href="#__codelineno-4-69"></a><span class="sd">    root_path</span>
<a id="__codelineno-4-70" name="__codelineno-4-70" href="#__codelineno-4-70"></a><span class="sd">        This argument takes in a base folder path for writing out intermediate_data/ folder to. Default value is &quot;&quot;</span>
<a id="__codelineno-4-71" name="__codelineno-4-71" href="#__codelineno-4-71"></a><span class="sd">    auth_key</span>
<a id="__codelineno-4-72" name="__codelineno-4-72" href="#__codelineno-4-72"></a><span class="sd">        Option to pass an authorization key to write to filesystems. Currently applicable only for ak8s run_type. Default value is kept as &quot;NA&quot;</span>
<a id="__codelineno-4-73" name="__codelineno-4-73" href="#__codelineno-4-73"></a><span class="sd">    print_impact</span>
<a id="__codelineno-4-74" name="__codelineno-4-74" href="#__codelineno-4-74"></a><span class="sd">        True, False (Default value = False)</span>
<a id="__codelineno-4-75" name="__codelineno-4-75" href="#__codelineno-4-75"></a><span class="sd">        This argument is to print out before and after missing counts of imputed columns. It also print the name of best</span>
<a id="__codelineno-4-76" name="__codelineno-4-76" href="#__codelineno-4-76"></a><span class="sd">        performing imputation method along with RMSE details.</span>
<a id="__codelineno-4-77" name="__codelineno-4-77" href="#__codelineno-4-77"></a>
<a id="__codelineno-4-78" name="__codelineno-4-78" href="#__codelineno-4-78"></a><span class="sd">    Returns</span>
<a id="__codelineno-4-79" name="__codelineno-4-79" href="#__codelineno-4-79"></a><span class="sd">    -------</span>
<a id="__codelineno-4-80" name="__codelineno-4-80" href="#__codelineno-4-80"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-4-81" name="__codelineno-4-81" href="#__codelineno-4-81"></a><span class="sd">        Imputed Dataframe</span>
<a id="__codelineno-4-82" name="__codelineno-4-82" href="#__codelineno-4-82"></a>
<a id="__codelineno-4-83" name="__codelineno-4-83" href="#__codelineno-4-83"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-4-84" name="__codelineno-4-84" href="#__codelineno-4-84"></a>
<a id="__codelineno-4-85" name="__codelineno-4-85" href="#__codelineno-4-85"></a>    <span class="k">if</span> <span class="n">stats_missing</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-4-86" name="__codelineno-4-86" href="#__codelineno-4-86"></a>        <span class="n">missing_df</span> <span class="o">=</span> <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">)</span>
<a id="__codelineno-4-87" name="__codelineno-4-87" href="#__codelineno-4-87"></a>        <span class="n">missing_df</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span>
<a id="__codelineno-4-88" name="__codelineno-4-88" href="#__codelineno-4-88"></a>            <span class="n">root_path</span>
<a id="__codelineno-4-89" name="__codelineno-4-89" href="#__codelineno-4-89"></a>            <span class="o">+</span> <span class="s2">&quot;intermediate_data/imputation_comparison/missingCount_computation&quot;</span><span class="p">,</span>
<a id="__codelineno-4-90" name="__codelineno-4-90" href="#__codelineno-4-90"></a>            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span><span class="p">,</span>
<a id="__codelineno-4-91" name="__codelineno-4-91" href="#__codelineno-4-91"></a>        <span class="p">)</span>
<a id="__codelineno-4-92" name="__codelineno-4-92" href="#__codelineno-4-92"></a>        <span class="n">stats_missing</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-4-93" name="__codelineno-4-93" href="#__codelineno-4-93"></a>            <span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="n">root_path</span>
<a id="__codelineno-4-94" name="__codelineno-4-94" href="#__codelineno-4-94"></a>            <span class="o">+</span> <span class="s2">&quot;intermediate_data/imputation_comparison/missingCount_computation&quot;</span><span class="p">,</span>
<a id="__codelineno-4-95" name="__codelineno-4-95" href="#__codelineno-4-95"></a>            <span class="s2">&quot;file_type&quot;</span><span class="p">:</span> <span class="s2">&quot;parquet&quot;</span><span class="p">,</span>
<a id="__codelineno-4-96" name="__codelineno-4-96" href="#__codelineno-4-96"></a>        <span class="p">}</span>
<a id="__codelineno-4-97" name="__codelineno-4-97" href="#__codelineno-4-97"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-4-98" name="__codelineno-4-98" href="#__codelineno-4-98"></a>        <span class="n">missing_df</span> <span class="o">=</span> <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_missing</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-4-99" name="__codelineno-4-99" href="#__codelineno-4-99"></a>            <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_count&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_pct&quot;</span>
<a id="__codelineno-4-100" name="__codelineno-4-100" href="#__codelineno-4-100"></a>        <span class="p">)</span>
<a id="__codelineno-4-101" name="__codelineno-4-101" href="#__codelineno-4-101"></a>
<a id="__codelineno-4-102" name="__codelineno-4-102" href="#__codelineno-4-102"></a>    <span class="n">empty_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-4-103" name="__codelineno-4-103" href="#__codelineno-4-103"></a>        <span class="n">missing_df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-4-104" name="__codelineno-4-104" href="#__codelineno-4-104"></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-4-105" name="__codelineno-4-105" href="#__codelineno-4-105"></a>        <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-4-106" name="__codelineno-4-106" href="#__codelineno-4-106"></a>        <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-4-107" name="__codelineno-4-107" href="#__codelineno-4-107"></a>    <span class="p">)</span>
<a id="__codelineno-4-108" name="__codelineno-4-108" href="#__codelineno-4-108"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">empty_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-4-109" name="__codelineno-4-109" href="#__codelineno-4-109"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Following columns have all null values: &quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">empty_cols</span><span class="p">))</span>
<a id="__codelineno-4-110" name="__codelineno-4-110" href="#__codelineno-4-110"></a>
<a id="__codelineno-4-111" name="__codelineno-4-111" href="#__codelineno-4-111"></a>    <span class="n">missing_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-4-112" name="__codelineno-4-112" href="#__codelineno-4-112"></a>        <span class="n">missing_df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-4-113" name="__codelineno-4-113" href="#__codelineno-4-113"></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-4-114" name="__codelineno-4-114" href="#__codelineno-4-114"></a>        <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-4-115" name="__codelineno-4-115" href="#__codelineno-4-115"></a>        <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-4-116" name="__codelineno-4-116" href="#__codelineno-4-116"></a>    <span class="p">)</span>
<a id="__codelineno-4-117" name="__codelineno-4-117" href="#__codelineno-4-117"></a>
<a id="__codelineno-4-118" name="__codelineno-4-118" href="#__codelineno-4-118"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-4-119" name="__codelineno-4-119" href="#__codelineno-4-119"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">columns</span>
<a id="__codelineno-4-120" name="__codelineno-4-120" href="#__codelineno-4-120"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;missing&quot;</span><span class="p">:</span>
<a id="__codelineno-4-121" name="__codelineno-4-121" href="#__codelineno-4-121"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">missing_cols</span>
<a id="__codelineno-4-122" name="__codelineno-4-122" href="#__codelineno-4-122"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-4-123" name="__codelineno-4-123" href="#__codelineno-4-123"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-4-124" name="__codelineno-4-124" href="#__codelineno-4-124"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-4-125" name="__codelineno-4-125" href="#__codelineno-4-125"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-4-126" name="__codelineno-4-126" href="#__codelineno-4-126"></a>
<a id="__codelineno-4-127" name="__codelineno-4-127" href="#__codelineno-4-127"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
<a id="__codelineno-4-128" name="__codelineno-4-128" href="#__codelineno-4-128"></a>        <span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">e</span> <span class="o">!=</span> <span class="n">id_col</span><span class="p">)])</span>
<a id="__codelineno-4-129" name="__codelineno-4-129" href="#__codelineno-4-129"></a>    <span class="p">)</span>
<a id="__codelineno-4-130" name="__codelineno-4-130" href="#__codelineno-4-130"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-4-131" name="__codelineno-4-131" href="#__codelineno-4-131"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-4-132" name="__codelineno-4-132" href="#__codelineno-4-132"></a>
<a id="__codelineno-4-133" name="__codelineno-4-133" href="#__codelineno-4-133"></a>    <span class="n">del_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">empty_cols</span><span class="p">]</span>
<a id="__codelineno-4-134" name="__codelineno-4-134" href="#__codelineno-4-134"></a>    <span class="n">odf_del</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="n">del_cols</span><span class="p">)</span>
<a id="__codelineno-4-135" name="__codelineno-4-135" href="#__codelineno-4-135"></a>
<a id="__codelineno-4-136" name="__codelineno-4-136" href="#__codelineno-4-136"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">empty_cols</span><span class="p">]</span>
<a id="__codelineno-4-137" name="__codelineno-4-137" href="#__codelineno-4-137"></a>    <span class="n">num_cols</span><span class="p">,</span> <span class="n">cat_cols</span><span class="p">,</span> <span class="n">other_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span>
<a id="__codelineno-4-138" name="__codelineno-4-138" href="#__codelineno-4-138"></a>        <span class="n">odf_del</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-4-139" name="__codelineno-4-139" href="#__codelineno-4-139"></a>    <span class="p">)</span>
<a id="__codelineno-4-140" name="__codelineno-4-140" href="#__codelineno-4-140"></a>    <span class="n">missing_catcols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">cat_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">missing_cols</span><span class="p">]</span>
<a id="__codelineno-4-141" name="__codelineno-4-141" href="#__codelineno-4-141"></a>    <span class="n">missing_numcols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">missing_cols</span><span class="p">]</span>
<a id="__codelineno-4-142" name="__codelineno-4-142" href="#__codelineno-4-142"></a>
<a id="__codelineno-4-143" name="__codelineno-4-143" href="#__codelineno-4-143"></a>    <span class="k">if</span> <span class="n">missing_catcols</span><span class="p">:</span>
<a id="__codelineno-4-144" name="__codelineno-4-144" href="#__codelineno-4-144"></a>        <span class="n">odf_imputed_cat</span> <span class="o">=</span> <span class="n">imputation_MMM</span><span class="p">(</span>
<a id="__codelineno-4-145" name="__codelineno-4-145" href="#__codelineno-4-145"></a>            <span class="n">spark</span><span class="p">,</span> <span class="n">odf_del</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="o">=</span><span class="n">missing_catcols</span><span class="p">,</span> <span class="n">stats_missing</span><span class="o">=</span><span class="n">stats_missing</span>
<a id="__codelineno-4-146" name="__codelineno-4-146" href="#__codelineno-4-146"></a>        <span class="p">)</span>
<a id="__codelineno-4-147" name="__codelineno-4-147" href="#__codelineno-4-147"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-4-148" name="__codelineno-4-148" href="#__codelineno-4-148"></a>        <span class="n">odf_imputed_cat</span> <span class="o">=</span> <span class="n">odf_del</span>
<a id="__codelineno-4-149" name="__codelineno-4-149" href="#__codelineno-4-149"></a>
<a id="__codelineno-4-150" name="__codelineno-4-150" href="#__codelineno-4-150"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_numcols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-4-151" name="__codelineno-4-151" href="#__codelineno-4-151"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-4-152" name="__codelineno-4-152" href="#__codelineno-4-152"></a>            <span class="s2">&quot;No Imputation Performed for numerical columns - No Column(s) to Impute&quot;</span>
<a id="__codelineno-4-153" name="__codelineno-4-153" href="#__codelineno-4-153"></a>        <span class="p">)</span>
<a id="__codelineno-4-154" name="__codelineno-4-154" href="#__codelineno-4-154"></a>        <span class="k">return</span> <span class="n">odf_imputed_cat</span>
<a id="__codelineno-4-155" name="__codelineno-4-155" href="#__codelineno-4-155"></a>
<a id="__codelineno-4-156" name="__codelineno-4-156" href="#__codelineno-4-156"></a>    <span class="n">idf_test</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-4-157" name="__codelineno-4-157" href="#__codelineno-4-157"></a>        <span class="n">odf_imputed_cat</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">missing_numcols</span><span class="p">)</span>
<a id="__codelineno-4-158" name="__codelineno-4-158" href="#__codelineno-4-158"></a>        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">monotonically_increasing_id</span><span class="p">())</span>
<a id="__codelineno-4-159" name="__codelineno-4-159" href="#__codelineno-4-159"></a>        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">row_number</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">Window</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)))</span>
<a id="__codelineno-4-160" name="__codelineno-4-160" href="#__codelineno-4-160"></a>    <span class="p">)</span>
<a id="__codelineno-4-161" name="__codelineno-4-161" href="#__codelineno-4-161"></a>    <span class="n">null_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">null_pct</span> <span class="o">*</span> <span class="n">idf_test</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
<a id="__codelineno-4-162" name="__codelineno-4-162" href="#__codelineno-4-162"></a>    <span class="n">idf_null</span> <span class="o">=</span> <span class="n">idf_test</span>
<a id="__codelineno-4-163" name="__codelineno-4-163" href="#__codelineno-4-163"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">missing_numcols</span><span class="p">:</span>
<a id="__codelineno-4-164" name="__codelineno-4-164" href="#__codelineno-4-164"></a>        <span class="n">null_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">idf_test</span><span class="o">.</span><span class="n">count</span><span class="p">()),</span> <span class="n">null_count</span><span class="p">)</span>
<a id="__codelineno-4-165" name="__codelineno-4-165" href="#__codelineno-4-165"></a>        <span class="n">idf_null</span> <span class="o">=</span> <span class="n">idf_null</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-4-166" name="__codelineno-4-166" href="#__codelineno-4-166"></a>            <span class="n">i</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">null_index</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a id="__codelineno-4-167" name="__codelineno-4-167" href="#__codelineno-4-167"></a>        <span class="p">)</span>
<a id="__codelineno-4-168" name="__codelineno-4-168" href="#__codelineno-4-168"></a>
<a id="__codelineno-4-169" name="__codelineno-4-169" href="#__codelineno-4-169"></a>    <span class="n">idf_null</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span>
<a id="__codelineno-4-170" name="__codelineno-4-170" href="#__codelineno-4-170"></a>        <span class="n">root_path</span> <span class="o">+</span> <span class="s2">&quot;intermediate_data/imputation_comparison/test_dataset&quot;</span><span class="p">,</span>
<a id="__codelineno-4-171" name="__codelineno-4-171" href="#__codelineno-4-171"></a>        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span><span class="p">,</span>
<a id="__codelineno-4-172" name="__codelineno-4-172" href="#__codelineno-4-172"></a>    <span class="p">)</span>
<a id="__codelineno-4-173" name="__codelineno-4-173" href="#__codelineno-4-173"></a>    <span class="n">idf_null</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span>
<a id="__codelineno-4-174" name="__codelineno-4-174" href="#__codelineno-4-174"></a>        <span class="n">root_path</span> <span class="o">+</span> <span class="s2">&quot;intermediate_data/imputation_comparison/test_dataset&quot;</span>
<a id="__codelineno-4-175" name="__codelineno-4-175" href="#__codelineno-4-175"></a>    <span class="p">)</span>
<a id="__codelineno-4-176" name="__codelineno-4-176" href="#__codelineno-4-176"></a>
<a id="__codelineno-4-177" name="__codelineno-4-177" href="#__codelineno-4-177"></a>    <span class="n">method1</span> <span class="o">=</span> <span class="n">imputation_MMM</span><span class="p">(</span>
<a id="__codelineno-4-178" name="__codelineno-4-178" href="#__codelineno-4-178"></a>        <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-4-179" name="__codelineno-4-179" href="#__codelineno-4-179"></a>        <span class="n">idf_null</span><span class="p">,</span>
<a id="__codelineno-4-180" name="__codelineno-4-180" href="#__codelineno-4-180"></a>        <span class="n">list_of_cols</span><span class="o">=</span><span class="n">missing_numcols</span><span class="p">,</span>
<a id="__codelineno-4-181" name="__codelineno-4-181" href="#__codelineno-4-181"></a>        <span class="n">method_type</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
<a id="__codelineno-4-182" name="__codelineno-4-182" href="#__codelineno-4-182"></a>        <span class="n">stats_missing</span><span class="o">=</span><span class="n">stats_missing</span><span class="p">,</span>
<a id="__codelineno-4-183" name="__codelineno-4-183" href="#__codelineno-4-183"></a>        <span class="n">output_mode</span><span class="o">=</span><span class="n">output_mode</span><span class="p">,</span>
<a id="__codelineno-4-184" name="__codelineno-4-184" href="#__codelineno-4-184"></a>    <span class="p">)</span>
<a id="__codelineno-4-185" name="__codelineno-4-185" href="#__codelineno-4-185"></a>    <span class="n">method2</span> <span class="o">=</span> <span class="n">imputation_MMM</span><span class="p">(</span>
<a id="__codelineno-4-186" name="__codelineno-4-186" href="#__codelineno-4-186"></a>        <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-4-187" name="__codelineno-4-187" href="#__codelineno-4-187"></a>        <span class="n">idf_null</span><span class="p">,</span>
<a id="__codelineno-4-188" name="__codelineno-4-188" href="#__codelineno-4-188"></a>        <span class="n">list_of_cols</span><span class="o">=</span><span class="n">missing_numcols</span><span class="p">,</span>
<a id="__codelineno-4-189" name="__codelineno-4-189" href="#__codelineno-4-189"></a>        <span class="n">method_type</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">,</span>
<a id="__codelineno-4-190" name="__codelineno-4-190" href="#__codelineno-4-190"></a>        <span class="n">stats_missing</span><span class="o">=</span><span class="n">stats_missing</span><span class="p">,</span>
<a id="__codelineno-4-191" name="__codelineno-4-191" href="#__codelineno-4-191"></a>        <span class="n">output_mode</span><span class="o">=</span><span class="n">output_mode</span><span class="p">,</span>
<a id="__codelineno-4-192" name="__codelineno-4-192" href="#__codelineno-4-192"></a>    <span class="p">)</span>
<a id="__codelineno-4-193" name="__codelineno-4-193" href="#__codelineno-4-193"></a>    <span class="n">valid_methods</span> <span class="o">=</span> <span class="p">[</span><span class="n">method1</span><span class="p">,</span> <span class="n">method2</span><span class="p">]</span>
<a id="__codelineno-4-194" name="__codelineno-4-194" href="#__codelineno-4-194"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">num_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-4-195" name="__codelineno-4-195" href="#__codelineno-4-195"></a>        <span class="n">method3</span> <span class="o">=</span> <span class="n">imputation_sklearn</span><span class="p">(</span>
<a id="__codelineno-4-196" name="__codelineno-4-196" href="#__codelineno-4-196"></a>            <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-4-197" name="__codelineno-4-197" href="#__codelineno-4-197"></a>            <span class="n">idf_null</span><span class="p">,</span>
<a id="__codelineno-4-198" name="__codelineno-4-198" href="#__codelineno-4-198"></a>            <span class="n">list_of_cols</span><span class="o">=</span><span class="n">num_cols</span><span class="p">,</span>
<a id="__codelineno-4-199" name="__codelineno-4-199" href="#__codelineno-4-199"></a>            <span class="n">method_type</span><span class="o">=</span><span class="s2">&quot;KNN&quot;</span><span class="p">,</span>
<a id="__codelineno-4-200" name="__codelineno-4-200" href="#__codelineno-4-200"></a>            <span class="n">stats_missing</span><span class="o">=</span><span class="n">stats_missing</span><span class="p">,</span>
<a id="__codelineno-4-201" name="__codelineno-4-201" href="#__codelineno-4-201"></a>            <span class="n">output_mode</span><span class="o">=</span><span class="n">output_mode</span><span class="p">,</span>
<a id="__codelineno-4-202" name="__codelineno-4-202" href="#__codelineno-4-202"></a>            <span class="n">auth_key</span><span class="o">=</span><span class="n">auth_key</span><span class="p">,</span>
<a id="__codelineno-4-203" name="__codelineno-4-203" href="#__codelineno-4-203"></a>        <span class="p">)</span>
<a id="__codelineno-4-204" name="__codelineno-4-204" href="#__codelineno-4-204"></a>        <span class="n">method4</span> <span class="o">=</span> <span class="n">imputation_sklearn</span><span class="p">(</span>
<a id="__codelineno-4-205" name="__codelineno-4-205" href="#__codelineno-4-205"></a>            <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-4-206" name="__codelineno-4-206" href="#__codelineno-4-206"></a>            <span class="n">idf_null</span><span class="p">,</span>
<a id="__codelineno-4-207" name="__codelineno-4-207" href="#__codelineno-4-207"></a>            <span class="n">list_of_cols</span><span class="o">=</span><span class="n">num_cols</span><span class="p">,</span>
<a id="__codelineno-4-208" name="__codelineno-4-208" href="#__codelineno-4-208"></a>            <span class="n">method_type</span><span class="o">=</span><span class="s2">&quot;regression&quot;</span><span class="p">,</span>
<a id="__codelineno-4-209" name="__codelineno-4-209" href="#__codelineno-4-209"></a>            <span class="n">stats_missing</span><span class="o">=</span><span class="n">stats_missing</span><span class="p">,</span>
<a id="__codelineno-4-210" name="__codelineno-4-210" href="#__codelineno-4-210"></a>            <span class="n">output_mode</span><span class="o">=</span><span class="n">output_mode</span><span class="p">,</span>
<a id="__codelineno-4-211" name="__codelineno-4-211" href="#__codelineno-4-211"></a>            <span class="n">auth_key</span><span class="o">=</span><span class="n">auth_key</span><span class="p">,</span>
<a id="__codelineno-4-212" name="__codelineno-4-212" href="#__codelineno-4-212"></a>        <span class="p">)</span>
<a id="__codelineno-4-213" name="__codelineno-4-213" href="#__codelineno-4-213"></a>        <span class="n">method5</span> <span class="o">=</span> <span class="n">imputation_matrixFactorization</span><span class="p">(</span>
<a id="__codelineno-4-214" name="__codelineno-4-214" href="#__codelineno-4-214"></a>            <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-4-215" name="__codelineno-4-215" href="#__codelineno-4-215"></a>            <span class="n">idf_null</span><span class="p">,</span>
<a id="__codelineno-4-216" name="__codelineno-4-216" href="#__codelineno-4-216"></a>            <span class="n">list_of_cols</span><span class="o">=</span><span class="n">num_cols</span><span class="p">,</span>
<a id="__codelineno-4-217" name="__codelineno-4-217" href="#__codelineno-4-217"></a>            <span class="n">id_col</span><span class="o">=</span><span class="n">id_col</span><span class="p">,</span>
<a id="__codelineno-4-218" name="__codelineno-4-218" href="#__codelineno-4-218"></a>            <span class="n">stats_missing</span><span class="o">=</span><span class="n">stats_missing</span><span class="p">,</span>
<a id="__codelineno-4-219" name="__codelineno-4-219" href="#__codelineno-4-219"></a>            <span class="n">output_mode</span><span class="o">=</span><span class="n">output_mode</span><span class="p">,</span>
<a id="__codelineno-4-220" name="__codelineno-4-220" href="#__codelineno-4-220"></a>        <span class="p">)</span>
<a id="__codelineno-4-221" name="__codelineno-4-221" href="#__codelineno-4-221"></a>        <span class="n">valid_methods</span> <span class="o">=</span> <span class="p">[</span><span class="n">method1</span><span class="p">,</span> <span class="n">method2</span><span class="p">,</span> <span class="n">method3</span><span class="p">,</span> <span class="n">method4</span><span class="p">,</span> <span class="n">method5</span><span class="p">]</span>
<a id="__codelineno-4-222" name="__codelineno-4-222" href="#__codelineno-4-222"></a>
<a id="__codelineno-4-223" name="__codelineno-4-223" href="#__codelineno-4-223"></a>    <span class="n">nrmse_all</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-4-224" name="__codelineno-4-224" href="#__codelineno-4-224"></a>    <span class="n">method_all</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MMM-mean&quot;</span><span class="p">,</span> <span class="s2">&quot;MMM-median&quot;</span><span class="p">,</span> <span class="s2">&quot;KNN&quot;</span><span class="p">,</span> <span class="s2">&quot;regression&quot;</span><span class="p">,</span> <span class="s2">&quot;matrix_factorization&quot;</span><span class="p">]</span>
<a id="__codelineno-4-225" name="__codelineno-4-225" href="#__codelineno-4-225"></a>
<a id="__codelineno-4-226" name="__codelineno-4-226" href="#__codelineno-4-226"></a>    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">valid_methods</span><span class="p">):</span>
<a id="__codelineno-4-227" name="__codelineno-4-227" href="#__codelineno-4-227"></a>        <span class="n">nrmse</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-4-228" name="__codelineno-4-228" href="#__codelineno-4-228"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">missing_numcols</span><span class="p">:</span>
<a id="__codelineno-4-229" name="__codelineno-4-229" href="#__codelineno-4-229"></a>            <span class="n">pred_col</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;append&quot;</span> <span class="k">else</span> <span class="n">i</span>
<a id="__codelineno-4-230" name="__codelineno-4-230" href="#__codelineno-4-230"></a>            <span class="n">idf_joined</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-4-231" name="__codelineno-4-231" href="#__codelineno-4-231"></a>                <span class="n">idf_test</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;val&quot;</span><span class="p">))</span>
<a id="__codelineno-4-232" name="__codelineno-4-232" href="#__codelineno-4-232"></a>                <span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-4-233" name="__codelineno-4-233" href="#__codelineno-4-233"></a>                    <span class="n">method</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">pred_col</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;pred&quot;</span><span class="p">)),</span>
<a id="__codelineno-4-234" name="__codelineno-4-234" href="#__codelineno-4-234"></a>                    <span class="s2">&quot;index&quot;</span><span class="p">,</span>
<a id="__codelineno-4-235" name="__codelineno-4-235" href="#__codelineno-4-235"></a>                    <span class="s2">&quot;left_outer&quot;</span><span class="p">,</span>
<a id="__codelineno-4-236" name="__codelineno-4-236" href="#__codelineno-4-236"></a>                <span class="p">)</span>
<a id="__codelineno-4-237" name="__codelineno-4-237" href="#__codelineno-4-237"></a>                <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<a id="__codelineno-4-238" name="__codelineno-4-238" href="#__codelineno-4-238"></a>            <span class="p">)</span>
<a id="__codelineno-4-239" name="__codelineno-4-239" href="#__codelineno-4-239"></a>            <span class="n">idf_joined</span> <span class="o">=</span> <span class="n">recast_column</span><span class="p">(</span>
<a id="__codelineno-4-240" name="__codelineno-4-240" href="#__codelineno-4-240"></a>                <span class="n">idf</span><span class="o">=</span><span class="n">idf_joined</span><span class="p">,</span>
<a id="__codelineno-4-241" name="__codelineno-4-241" href="#__codelineno-4-241"></a>                <span class="n">list_of_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;val&quot;</span><span class="p">,</span> <span class="s2">&quot;pred&quot;</span><span class="p">],</span>
<a id="__codelineno-4-242" name="__codelineno-4-242" href="#__codelineno-4-242"></a>                <span class="n">list_of_dtypes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="s2">&quot;double&quot;</span><span class="p">],</span>
<a id="__codelineno-4-243" name="__codelineno-4-243" href="#__codelineno-4-243"></a>            <span class="p">)</span>
<a id="__codelineno-4-244" name="__codelineno-4-244" href="#__codelineno-4-244"></a>            <span class="n">pred_mean</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
<a id="__codelineno-4-245" name="__codelineno-4-245" href="#__codelineno-4-245"></a>                <span class="n">method</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pred_col</span><span class="p">))</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-4-246" name="__codelineno-4-246" href="#__codelineno-4-246"></a>            <span class="p">)</span>
<a id="__codelineno-4-247" name="__codelineno-4-247" href="#__codelineno-4-247"></a>            <span class="n">i_nrmse</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-4-248" name="__codelineno-4-248" href="#__codelineno-4-248"></a>                <span class="n">RegressionEvaluator</span><span class="p">(</span>
<a id="__codelineno-4-249" name="__codelineno-4-249" href="#__codelineno-4-249"></a>                    <span class="n">metricName</span><span class="o">=</span><span class="s2">&quot;rmse&quot;</span><span class="p">,</span> <span class="n">labelCol</span><span class="o">=</span><span class="s2">&quot;val&quot;</span><span class="p">,</span> <span class="n">predictionCol</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span>
<a id="__codelineno-4-250" name="__codelineno-4-250" href="#__codelineno-4-250"></a>                <span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">idf_joined</span><span class="p">)</span>
<a id="__codelineno-4-251" name="__codelineno-4-251" href="#__codelineno-4-251"></a>            <span class="p">)</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pred_mean</span><span class="p">)</span>
<a id="__codelineno-4-252" name="__codelineno-4-252" href="#__codelineno-4-252"></a>            <span class="n">nrmse</span> <span class="o">+=</span> <span class="n">i_nrmse</span>
<a id="__codelineno-4-253" name="__codelineno-4-253" href="#__codelineno-4-253"></a>        <span class="n">nrmse_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nrmse</span><span class="p">)</span>
<a id="__codelineno-4-254" name="__codelineno-4-254" href="#__codelineno-4-254"></a>
<a id="__codelineno-4-255" name="__codelineno-4-255" href="#__codelineno-4-255"></a>    <span class="n">min_index</span> <span class="o">=</span> <span class="n">nrmse_all</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">nrmse_all</span><span class="p">))</span>
<a id="__codelineno-4-256" name="__codelineno-4-256" href="#__codelineno-4-256"></a>    <span class="n">best_method</span> <span class="o">=</span> <span class="n">method_all</span><span class="p">[</span><span class="n">min_index</span><span class="p">]</span>
<a id="__codelineno-4-257" name="__codelineno-4-257" href="#__codelineno-4-257"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">valid_methods</span><span class="p">[</span><span class="n">min_index</span><span class="p">]</span>
<a id="__codelineno-4-258" name="__codelineno-4-258" href="#__codelineno-4-258"></a>
<a id="__codelineno-4-259" name="__codelineno-4-259" href="#__codelineno-4-259"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-4-260" name="__codelineno-4-260" href="#__codelineno-4-260"></a>        <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">method_all</span><span class="p">,</span> <span class="n">nrmse_all</span><span class="p">)))</span>
<a id="__codelineno-4-261" name="__codelineno-4-261" href="#__codelineno-4-261"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best Imputation Method: &quot;</span><span class="p">,</span> <span class="n">best_method</span><span class="p">)</span>
<a id="__codelineno-4-262" name="__codelineno-4-262" href="#__codelineno-4-262"></a>    <span class="k">return</span> <span class="n">odf</span>
</code></pre></div>
</pre>
</details>
</dd>
<dt id="anovos.data_transformer.transformers.autoencoder_latentFeatures"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">autoencoder_latentFeatures</span></span>(<span class="n">spark, idf, list_of_cols='all', drop_cols=[], reduction_params=0.5, sample_size=500000, epochs=100, batch_size=256, pre_existing_model=False, model_path='NA', standardization=True, standardization_configs={'pre_existing_model': False, 'model_path': 'NA'}, imputation=False, imputation_configs={'imputation_function': 'imputation_MMM'}, stats_missing={}, output_mode='replace', run_type='local', root_path='', auth_key='NA', print_impact=False)</span>
</code></dt>
<dd>
<div class="desc"><p>Many machine learning models suffer from "the curse of dimensionality" when the number of features is too
large. autoencoder_latentFeatures is able to reduce the dimensionality by compressing input attributes to a
smaller number of latent features.</p>
<p>To be more specific, it trains a neural network model using TensorFlow library. The neural network contains an
encoder and a decoder, where the encoder learns to represent the input using smaller number of latent features
controlled by the input <em>reduction_params</em> and the decoder learns to reproduce the input using the latent
features. In the end, only the encoder will be kept and the latent features generated by the encoder will be
added to the output dataframe.</p>
<p>However, the neural network model is not trained in a scalable manner, which might not be able to handle large
input dataframe. Thus, an input <em>sample_size</em> (the default value is 500,000) can be set to control the number of
samples to be used to train the model. If the total number of samples exceeds <em>sample_size</em>, the rest of the
samples will be predicted using the fitted encoder.</p>
<p>Standardization is highly recommended if the input attributes are not of the same scale. Otherwise, the model
might not converge smoothly. Inputs <em>standardization</em> and <em>standardization_configs</em> can be set accordingly to
perform standardization within the function. In addition, if a sample contains missing values in the model input,
the output values for its latent features will all be None. Thus data imputation is also recommended if missing
values exist, which can be done within the function by setting inputs <em>imputation</em> and <em>imputation_configs</em>.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>spark</code></strong></dt>
<dd>Spark Session</dd>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe</dd>
<dt><strong><code>list_of_cols</code></strong></dt>
<dd>List of numerical columns to encode e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
"all" can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.
Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in
drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = "all")</dd>
<dt><strong><code>drop_cols</code></strong></dt>
<dd>List of columns to be dropped e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except
a few handful of them. (Default value = [])</dd>
<dt><strong><code>reduction_params</code></strong></dt>
<dd>Determines the number of encoded features in the result.
If reduction_params &lt; 1, int(reduction_params * <number of columns>)
columns will be generated. Else, reduction_params columns will be generated. (Default value = 0.5)</dd>
<dt><strong><code>sample_size</code></strong></dt>
<dd>Maximum rows for training the autoencoder model using tensorflow. (Default value = 500000)</dd>
<dt><strong><code>epochs</code></strong></dt>
<dd>Number of epochs to train the tensorflow model. (Default value = 100)</dd>
<dt><strong><code>batch_size</code></strong></dt>
<dd>Number of samples per gradient update when fitting the tensorflow model. (Default value = 256)</dd>
<dt><strong><code>pre_existing_model</code></strong></dt>
<dd>Boolean argument – True or False. True if model exists already, False Otherwise (Default value = False)</dd>
<dt><strong><code>model_path</code></strong></dt>
<dd>If pre_existing_model is True, this argument is path for referring the pre-saved model.
If pre_existing_model is False, this argument can be used for saving the model.
Default "NA" means there is neither pre-existing model nor there is a need to save one.</dd>
<dt><strong><code>standardization</code></strong></dt>
<dd>Boolean argument – True or False. True, if the standardization required. (Default value = True)</dd>
<dt><strong><code>standardization_configs</code></strong></dt>
<dd>z_standardization function arguments in dictionary format. (Default value = {"pre_existing_model": False)</dd>
<dt><strong><code>imputation</code></strong></dt>
<dd>Boolean argument – True or False. True, if the imputation required. (Default value = False)</dd>
<dt><strong><code>imputation_configs</code></strong></dt>
<dd>Takes input in dictionary format.
Imputation function name is provided with key "imputation_name".
optional arguments pertaining to that imputation function can be provided with argument name as key. (Default value = {"imputation_function": "imputation_MMM"})</dd>
<dt><strong><code>stats_missing</code></strong></dt>
<dd>Takes arguments for read_dataset (data_ingest module) function in a dictionary format
to read pre-saved statistics on missing count/pct i.e. if measures_of_counts or
missingCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</dd>
<dt><strong><code>output_mode</code></strong></dt>
<dd>"replace", "append".
“replace” option replaces original columns with transformed columns: latent_<col_index>.
“append” option append transformed columns with format latent_<col_index> to the input dataset,
e.g. latent_0, latent_1 will be appended if reduction_params=2. (Default value = "replace")</dd>
<dt><strong><code>run_type</code></strong></dt>
<dd>"local", "emr", "databricks", "ak8s" (Default value = "local")</dd>
<dt><strong><code>root_path</code></strong></dt>
<dd>This argument takes in a base folder path for writing out intermediate_data/ folder to. Default value is ""</dd>
<dt><strong><code>auth_key</code></strong></dt>
<dd>Option to pass an authorization key to write to filesystems. Currently applicable only for ak8s run_type. Default value is kept as "NA"</dd>
<dt><strong><code>print_impact</code></strong></dt>
<dd>True, False
This argument is to print descriptive statistics of the latest features (Default value = False)</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>DataFrame</code></dt>
<dd>Dataframe with Latent Features</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">def</span> <span class="nf">autoencoder_latentFeatures</span><span class="p">(</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>    <span class="n">reduction_params</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>    <span class="n">sample_size</span><span class="o">=</span><span class="mi">500000</span><span class="p">,</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>    <span class="n">batch_size</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>    <span class="n">pre_existing_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>    <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>    <span class="n">standardization</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>    <span class="n">standardization_configs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pre_existing_model&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;model_path&quot;</span><span class="p">:</span> <span class="s2">&quot;NA&quot;</span><span class="p">},</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>    <span class="n">imputation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>    <span class="n">imputation_configs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;imputation_function&quot;</span><span class="p">:</span> <span class="s2">&quot;imputation_MMM&quot;</span><span class="p">},</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>    <span class="n">stats_missing</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>    <span class="n">run_type</span><span class="o">=</span><span class="s2">&quot;local&quot;</span><span class="p">,</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>    <span class="n">root_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>    <span class="n">auth_key</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="p">):</span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="sd">    Many machine learning models suffer from &quot;the curse of dimensionality&quot; when the number of features is too</span>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="sd">    large. autoencoder_latentFeatures is able to reduce the dimensionality by compressing input attributes to a</span>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a><span class="sd">    smaller number of latent features.</span>
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a>
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a><span class="sd">    To be more specific, it trains a neural network model using TensorFlow library. The neural network contains an</span>
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a><span class="sd">    encoder and a decoder, where the encoder learns to represent the input using smaller number of latent features</span>
<a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a><span class="sd">    controlled by the input *reduction_params* and the decoder learns to reproduce the input using the latent</span>
<a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a><span class="sd">    features. In the end, only the encoder will be kept and the latent features generated by the encoder will be</span>
<a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a><span class="sd">    added to the output dataframe.</span>
<a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a>
<a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a><span class="sd">    However, the neural network model is not trained in a scalable manner, which might not be able to handle large</span>
<a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a><span class="sd">    input dataframe. Thus, an input *sample_size* (the default value is 500,000) can be set to control the number of</span>
<a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a><span class="sd">    samples to be used to train the model. If the total number of samples exceeds *sample_size*, the rest of the</span>
<a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a><span class="sd">    samples will be predicted using the fitted encoder.</span>
<a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a>
<a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a><span class="sd">    Standardization is highly recommended if the input attributes are not of the same scale. Otherwise, the model</span>
<a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a><span class="sd">    might not converge smoothly. Inputs *standardization* and *standardization_configs* can be set accordingly to</span>
<a id="__codelineno-5-41" name="__codelineno-5-41" href="#__codelineno-5-41"></a><span class="sd">    perform standardization within the function. In addition, if a sample contains missing values in the model input,</span>
<a id="__codelineno-5-42" name="__codelineno-5-42" href="#__codelineno-5-42"></a><span class="sd">    the output values for its latent features will all be None. Thus data imputation is also recommended if missing</span>
<a id="__codelineno-5-43" name="__codelineno-5-43" href="#__codelineno-5-43"></a><span class="sd">    values exist, which can be done within the function by setting inputs *imputation* and *imputation_configs*.</span>
<a id="__codelineno-5-44" name="__codelineno-5-44" href="#__codelineno-5-44"></a>
<a id="__codelineno-5-45" name="__codelineno-5-45" href="#__codelineno-5-45"></a>
<a id="__codelineno-5-46" name="__codelineno-5-46" href="#__codelineno-5-46"></a><span class="sd">    Parameters</span>
<a id="__codelineno-5-47" name="__codelineno-5-47" href="#__codelineno-5-47"></a><span class="sd">    ----------</span>
<a id="__codelineno-5-48" name="__codelineno-5-48" href="#__codelineno-5-48"></a><span class="sd">    spark</span>
<a id="__codelineno-5-49" name="__codelineno-5-49" href="#__codelineno-5-49"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-5-50" name="__codelineno-5-50" href="#__codelineno-5-50"></a><span class="sd">    idf</span>
<a id="__codelineno-5-51" name="__codelineno-5-51" href="#__codelineno-5-51"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-5-52" name="__codelineno-5-52" href="#__codelineno-5-52"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-5-53" name="__codelineno-5-53" href="#__codelineno-5-53"></a><span class="sd">        List of numerical columns to encode e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-5-54" name="__codelineno-5-54" href="#__codelineno-5-54"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-5-55" name="__codelineno-5-55" href="#__codelineno-5-55"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-5-56" name="__codelineno-5-56" href="#__codelineno-5-56"></a><span class="sd">        &quot;all&quot; can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-5-57" name="__codelineno-5-57" href="#__codelineno-5-57"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-5-58" name="__codelineno-5-58" href="#__codelineno-5-58"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-5-59" name="__codelineno-5-59" href="#__codelineno-5-59"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-5-60" name="__codelineno-5-60" href="#__codelineno-5-60"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-5-61" name="__codelineno-5-61" href="#__codelineno-5-61"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-5-62" name="__codelineno-5-62" href="#__codelineno-5-62"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-5-63" name="__codelineno-5-63" href="#__codelineno-5-63"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-5-64" name="__codelineno-5-64" href="#__codelineno-5-64"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-5-65" name="__codelineno-5-65" href="#__codelineno-5-65"></a><span class="sd">    reduction_params</span>
<a id="__codelineno-5-66" name="__codelineno-5-66" href="#__codelineno-5-66"></a><span class="sd">        Determines the number of encoded features in the result.</span>
<a id="__codelineno-5-67" name="__codelineno-5-67" href="#__codelineno-5-67"></a><span class="sd">        If reduction_params &lt; 1, int(reduction_params * &lt;number of columns&gt;)</span>
<a id="__codelineno-5-68" name="__codelineno-5-68" href="#__codelineno-5-68"></a><span class="sd">        columns will be generated. Else, reduction_params columns will be generated. (Default value = 0.5)</span>
<a id="__codelineno-5-69" name="__codelineno-5-69" href="#__codelineno-5-69"></a><span class="sd">    sample_size</span>
<a id="__codelineno-5-70" name="__codelineno-5-70" href="#__codelineno-5-70"></a><span class="sd">        Maximum rows for training the autoencoder model using tensorflow. (Default value = 500000)</span>
<a id="__codelineno-5-71" name="__codelineno-5-71" href="#__codelineno-5-71"></a><span class="sd">    epochs</span>
<a id="__codelineno-5-72" name="__codelineno-5-72" href="#__codelineno-5-72"></a><span class="sd">        Number of epochs to train the tensorflow model. (Default value = 100)</span>
<a id="__codelineno-5-73" name="__codelineno-5-73" href="#__codelineno-5-73"></a><span class="sd">    batch_size</span>
<a id="__codelineno-5-74" name="__codelineno-5-74" href="#__codelineno-5-74"></a><span class="sd">        Number of samples per gradient update when fitting the tensorflow model. (Default value = 256)</span>
<a id="__codelineno-5-75" name="__codelineno-5-75" href="#__codelineno-5-75"></a><span class="sd">    pre_existing_model</span>
<a id="__codelineno-5-76" name="__codelineno-5-76" href="#__codelineno-5-76"></a><span class="sd">        Boolean argument – True or False. True if model exists already, False Otherwise (Default value = False)</span>
<a id="__codelineno-5-77" name="__codelineno-5-77" href="#__codelineno-5-77"></a><span class="sd">    model_path</span>
<a id="__codelineno-5-78" name="__codelineno-5-78" href="#__codelineno-5-78"></a><span class="sd">        If pre_existing_model is True, this argument is path for referring the pre-saved model.</span>
<a id="__codelineno-5-79" name="__codelineno-5-79" href="#__codelineno-5-79"></a><span class="sd">        If pre_existing_model is False, this argument can be used for saving the model.</span>
<a id="__codelineno-5-80" name="__codelineno-5-80" href="#__codelineno-5-80"></a><span class="sd">        Default &quot;NA&quot; means there is neither pre-existing model nor there is a need to save one.</span>
<a id="__codelineno-5-81" name="__codelineno-5-81" href="#__codelineno-5-81"></a><span class="sd">    standardization</span>
<a id="__codelineno-5-82" name="__codelineno-5-82" href="#__codelineno-5-82"></a><span class="sd">        Boolean argument – True or False. True, if the standardization required. (Default value = True)</span>
<a id="__codelineno-5-83" name="__codelineno-5-83" href="#__codelineno-5-83"></a><span class="sd">    standardization_configs</span>
<a id="__codelineno-5-84" name="__codelineno-5-84" href="#__codelineno-5-84"></a><span class="sd">        z_standardization function arguments in dictionary format. (Default value = {&quot;pre_existing_model&quot;: False)</span>
<a id="__codelineno-5-85" name="__codelineno-5-85" href="#__codelineno-5-85"></a><span class="sd">    imputation</span>
<a id="__codelineno-5-86" name="__codelineno-5-86" href="#__codelineno-5-86"></a><span class="sd">        Boolean argument – True or False. True, if the imputation required. (Default value = False)</span>
<a id="__codelineno-5-87" name="__codelineno-5-87" href="#__codelineno-5-87"></a><span class="sd">    imputation_configs</span>
<a id="__codelineno-5-88" name="__codelineno-5-88" href="#__codelineno-5-88"></a><span class="sd">        Takes input in dictionary format.</span>
<a id="__codelineno-5-89" name="__codelineno-5-89" href="#__codelineno-5-89"></a><span class="sd">        Imputation function name is provided with key &quot;imputation_name&quot;.</span>
<a id="__codelineno-5-90" name="__codelineno-5-90" href="#__codelineno-5-90"></a><span class="sd">        optional arguments pertaining to that imputation function can be provided with argument name as key. (Default value = {&quot;imputation_function&quot;: &quot;imputation_MMM&quot;})</span>
<a id="__codelineno-5-91" name="__codelineno-5-91" href="#__codelineno-5-91"></a><span class="sd">    stats_missing</span>
<a id="__codelineno-5-92" name="__codelineno-5-92" href="#__codelineno-5-92"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-5-93" name="__codelineno-5-93" href="#__codelineno-5-93"></a><span class="sd">        to read pre-saved statistics on missing count/pct i.e. if measures_of_counts or</span>
<a id="__codelineno-5-94" name="__codelineno-5-94" href="#__codelineno-5-94"></a><span class="sd">        missingCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-5-95" name="__codelineno-5-95" href="#__codelineno-5-95"></a><span class="sd">    output_mode</span>
<a id="__codelineno-5-96" name="__codelineno-5-96" href="#__codelineno-5-96"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-5-97" name="__codelineno-5-97" href="#__codelineno-5-97"></a><span class="sd">        “replace” option replaces original columns with transformed columns: latent_&lt;col_index&gt;.</span>
<a id="__codelineno-5-98" name="__codelineno-5-98" href="#__codelineno-5-98"></a><span class="sd">        “append” option append transformed columns with format latent_&lt;col_index&gt; to the input dataset,</span>
<a id="__codelineno-5-99" name="__codelineno-5-99" href="#__codelineno-5-99"></a><span class="sd">        e.g. latent_0, latent_1 will be appended if reduction_params=2. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-5-100" name="__codelineno-5-100" href="#__codelineno-5-100"></a><span class="sd">    run_type</span>
<a id="__codelineno-5-101" name="__codelineno-5-101" href="#__codelineno-5-101"></a><span class="sd">        &quot;local&quot;, &quot;emr&quot;, &quot;databricks&quot;, &quot;ak8s&quot; (Default value = &quot;local&quot;)</span>
<a id="__codelineno-5-102" name="__codelineno-5-102" href="#__codelineno-5-102"></a><span class="sd">    root_path</span>
<a id="__codelineno-5-103" name="__codelineno-5-103" href="#__codelineno-5-103"></a><span class="sd">        This argument takes in a base folder path for writing out intermediate_data/ folder to. Default value is &quot;&quot;</span>
<a id="__codelineno-5-104" name="__codelineno-5-104" href="#__codelineno-5-104"></a><span class="sd">    auth_key</span>
<a id="__codelineno-5-105" name="__codelineno-5-105" href="#__codelineno-5-105"></a><span class="sd">        Option to pass an authorization key to write to filesystems. Currently applicable only for ak8s run_type. Default value is kept as &quot;NA&quot;</span>
<a id="__codelineno-5-106" name="__codelineno-5-106" href="#__codelineno-5-106"></a><span class="sd">    print_impact</span>
<a id="__codelineno-5-107" name="__codelineno-5-107" href="#__codelineno-5-107"></a><span class="sd">        True, False</span>
<a id="__codelineno-5-108" name="__codelineno-5-108" href="#__codelineno-5-108"></a><span class="sd">        This argument is to print descriptive statistics of the latest features (Default value = False)</span>
<a id="__codelineno-5-109" name="__codelineno-5-109" href="#__codelineno-5-109"></a>
<a id="__codelineno-5-110" name="__codelineno-5-110" href="#__codelineno-5-110"></a><span class="sd">    Returns</span>
<a id="__codelineno-5-111" name="__codelineno-5-111" href="#__codelineno-5-111"></a><span class="sd">    -------</span>
<a id="__codelineno-5-112" name="__codelineno-5-112" href="#__codelineno-5-112"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-5-113" name="__codelineno-5-113" href="#__codelineno-5-113"></a><span class="sd">        Dataframe with Latent Features</span>
<a id="__codelineno-5-114" name="__codelineno-5-114" href="#__codelineno-5-114"></a>
<a id="__codelineno-5-115" name="__codelineno-5-115" href="#__codelineno-5-115"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-5-116" name="__codelineno-5-116" href="#__codelineno-5-116"></a>    <span class="k">if</span> <span class="s2">&quot;arm64&quot;</span> <span class="ow">in</span> <span class="n">platform</span><span class="o">.</span><span class="n">version</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
<a id="__codelineno-5-117" name="__codelineno-5-117" href="#__codelineno-5-117"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-5-118" name="__codelineno-5-118" href="#__codelineno-5-118"></a>            <span class="s2">&quot;This function is currently not supported for ARM64 - Mac M1 Machine&quot;</span>
<a id="__codelineno-5-119" name="__codelineno-5-119" href="#__codelineno-5-119"></a>        <span class="p">)</span>
<a id="__codelineno-5-120" name="__codelineno-5-120" href="#__codelineno-5-120"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-5-121" name="__codelineno-5-121" href="#__codelineno-5-121"></a>
<a id="__codelineno-5-122" name="__codelineno-5-122" href="#__codelineno-5-122"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-5-123" name="__codelineno-5-123" href="#__codelineno-5-123"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-5-124" name="__codelineno-5-124" href="#__codelineno-5-124"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-5-125" name="__codelineno-5-125" href="#__codelineno-5-125"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-5-126" name="__codelineno-5-126" href="#__codelineno-5-126"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-5-127" name="__codelineno-5-127" href="#__codelineno-5-127"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-5-128" name="__codelineno-5-128" href="#__codelineno-5-128"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-5-129" name="__codelineno-5-129" href="#__codelineno-5-129"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-5-130" name="__codelineno-5-130" href="#__codelineno-5-130"></a>
<a id="__codelineno-5-131" name="__codelineno-5-131" href="#__codelineno-5-131"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-5-132" name="__codelineno-5-132" href="#__codelineno-5-132"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-5-133" name="__codelineno-5-133" href="#__codelineno-5-133"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-5-134" name="__codelineno-5-134" href="#__codelineno-5-134"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No Latent Features Generated - No Column(s) to Transform&quot;</span><span class="p">)</span>
<a id="__codelineno-5-135" name="__codelineno-5-135" href="#__codelineno-5-135"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-5-136" name="__codelineno-5-136" href="#__codelineno-5-136"></a>
<a id="__codelineno-5-137" name="__codelineno-5-137" href="#__codelineno-5-137"></a>    <span class="k">if</span> <span class="n">stats_missing</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-5-138" name="__codelineno-5-138" href="#__codelineno-5-138"></a>        <span class="n">missing_df</span> <span class="o">=</span> <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-5-139" name="__codelineno-5-139" href="#__codelineno-5-139"></a>        <span class="n">missing_df</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span>
<a id="__codelineno-5-140" name="__codelineno-5-140" href="#__codelineno-5-140"></a>            <span class="n">root_path</span>
<a id="__codelineno-5-141" name="__codelineno-5-141" href="#__codelineno-5-141"></a>            <span class="o">+</span> <span class="s2">&quot;intermediate_data/autoencoder_latentFeatures/missingCount_computation&quot;</span><span class="p">,</span>
<a id="__codelineno-5-142" name="__codelineno-5-142" href="#__codelineno-5-142"></a>            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span><span class="p">,</span>
<a id="__codelineno-5-143" name="__codelineno-5-143" href="#__codelineno-5-143"></a>        <span class="p">)</span>
<a id="__codelineno-5-144" name="__codelineno-5-144" href="#__codelineno-5-144"></a>        <span class="n">stats_missing</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-5-145" name="__codelineno-5-145" href="#__codelineno-5-145"></a>            <span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="n">root_path</span>
<a id="__codelineno-5-146" name="__codelineno-5-146" href="#__codelineno-5-146"></a>            <span class="o">+</span> <span class="s2">&quot;intermediate_data/autoencoder_latentFeatures/missingCount_computation&quot;</span><span class="p">,</span>
<a id="__codelineno-5-147" name="__codelineno-5-147" href="#__codelineno-5-147"></a>            <span class="s2">&quot;file_type&quot;</span><span class="p">:</span> <span class="s2">&quot;parquet&quot;</span><span class="p">,</span>
<a id="__codelineno-5-148" name="__codelineno-5-148" href="#__codelineno-5-148"></a>        <span class="p">}</span>
<a id="__codelineno-5-149" name="__codelineno-5-149" href="#__codelineno-5-149"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-5-150" name="__codelineno-5-150" href="#__codelineno-5-150"></a>        <span class="n">missing_df</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-5-151" name="__codelineno-5-151" href="#__codelineno-5-151"></a>            <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_missing</span><span class="p">)</span>
<a id="__codelineno-5-152" name="__codelineno-5-152" href="#__codelineno-5-152"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_count&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span>
<a id="__codelineno-5-153" name="__codelineno-5-153" href="#__codelineno-5-153"></a>            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-5-154" name="__codelineno-5-154" href="#__codelineno-5-154"></a>        <span class="p">)</span>
<a id="__codelineno-5-155" name="__codelineno-5-155" href="#__codelineno-5-155"></a>
<a id="__codelineno-5-156" name="__codelineno-5-156" href="#__codelineno-5-156"></a>    <span class="n">empty_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-5-157" name="__codelineno-5-157" href="#__codelineno-5-157"></a>        <span class="n">missing_df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-5-158" name="__codelineno-5-158" href="#__codelineno-5-158"></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-5-159" name="__codelineno-5-159" href="#__codelineno-5-159"></a>        <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-5-160" name="__codelineno-5-160" href="#__codelineno-5-160"></a>        <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-5-161" name="__codelineno-5-161" href="#__codelineno-5-161"></a>    <span class="p">)</span>
<a id="__codelineno-5-162" name="__codelineno-5-162" href="#__codelineno-5-162"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">empty_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-5-163" name="__codelineno-5-163" href="#__codelineno-5-163"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-5-164" name="__codelineno-5-164" href="#__codelineno-5-164"></a>            <span class="s2">&quot;The following column(s) are excluded from dimensionality reduction as all values are null: &quot;</span>
<a id="__codelineno-5-165" name="__codelineno-5-165" href="#__codelineno-5-165"></a>            <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">empty_cols</span><span class="p">)</span>
<a id="__codelineno-5-166" name="__codelineno-5-166" href="#__codelineno-5-166"></a>        <span class="p">)</span>
<a id="__codelineno-5-167" name="__codelineno-5-167" href="#__codelineno-5-167"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">empty_cols</span><span class="p">]</span>
<a id="__codelineno-5-168" name="__codelineno-5-168" href="#__codelineno-5-168"></a>
<a id="__codelineno-5-169" name="__codelineno-5-169" href="#__codelineno-5-169"></a>    <span class="k">if</span> <span class="n">standardization</span><span class="p">:</span>
<a id="__codelineno-5-170" name="__codelineno-5-170" href="#__codelineno-5-170"></a>        <span class="n">idf_standardized</span> <span class="o">=</span> <span class="n">z_standardization</span><span class="p">(</span>
<a id="__codelineno-5-171" name="__codelineno-5-171" href="#__codelineno-5-171"></a>            <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-5-172" name="__codelineno-5-172" href="#__codelineno-5-172"></a>            <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-5-173" name="__codelineno-5-173" href="#__codelineno-5-173"></a>            <span class="n">list_of_cols</span><span class="o">=</span><span class="n">list_of_cols</span><span class="p">,</span>
<a id="__codelineno-5-174" name="__codelineno-5-174" href="#__codelineno-5-174"></a>            <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
<a id="__codelineno-5-175" name="__codelineno-5-175" href="#__codelineno-5-175"></a>            <span class="o">**</span><span class="n">standardization_configs</span><span class="p">,</span>
<a id="__codelineno-5-176" name="__codelineno-5-176" href="#__codelineno-5-176"></a>        <span class="p">)</span>
<a id="__codelineno-5-177" name="__codelineno-5-177" href="#__codelineno-5-177"></a>        <span class="n">list_of_cols_scaled</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-5-178" name="__codelineno-5-178" href="#__codelineno-5-178"></a>            <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span>
<a id="__codelineno-5-179" name="__codelineno-5-179" href="#__codelineno-5-179"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span>
<a id="__codelineno-5-180" name="__codelineno-5-180" href="#__codelineno-5-180"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">idf_standardized</span><span class="o">.</span><span class="n">columns</span>
<a id="__codelineno-5-181" name="__codelineno-5-181" href="#__codelineno-5-181"></a>        <span class="p">]</span>
<a id="__codelineno-5-182" name="__codelineno-5-182" href="#__codelineno-5-182"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-5-183" name="__codelineno-5-183" href="#__codelineno-5-183"></a>        <span class="n">idf_standardized</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-5-184" name="__codelineno-5-184" href="#__codelineno-5-184"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-5-185" name="__codelineno-5-185" href="#__codelineno-5-185"></a>            <span class="n">idf_standardized</span> <span class="o">=</span> <span class="n">idf_standardized</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a id="__codelineno-5-186" name="__codelineno-5-186" href="#__codelineno-5-186"></a>            <span class="n">list_of_cols_scaled</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">]</span>
<a id="__codelineno-5-187" name="__codelineno-5-187" href="#__codelineno-5-187"></a>
<a id="__codelineno-5-188" name="__codelineno-5-188" href="#__codelineno-5-188"></a>    <span class="k">if</span> <span class="n">imputation</span><span class="p">:</span>
<a id="__codelineno-5-189" name="__codelineno-5-189" href="#__codelineno-5-189"></a>        <span class="n">all_functions</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-5-190" name="__codelineno-5-190" href="#__codelineno-5-190"></a>        <span class="n">all_functions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">locals</span><span class="p">())</span>
<a id="__codelineno-5-191" name="__codelineno-5-191" href="#__codelineno-5-191"></a>        <span class="n">f</span> <span class="o">=</span> <span class="n">all_functions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">imputation_configs</span><span class="p">[</span><span class="s2">&quot;imputation_function&quot;</span><span class="p">])</span>
<a id="__codelineno-5-192" name="__codelineno-5-192" href="#__codelineno-5-192"></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">imputation_configs</span><span class="p">)</span>
<a id="__codelineno-5-193" name="__codelineno-5-193" href="#__codelineno-5-193"></a>        <span class="n">args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;imputation_function&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-5-194" name="__codelineno-5-194" href="#__codelineno-5-194"></a>        <span class="n">missing_df_scaled</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-5-195" name="__codelineno-5-195" href="#__codelineno-5-195"></a>            <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_missing</span><span class="p">)</span>
<a id="__codelineno-5-196" name="__codelineno-5-196" href="#__codelineno-5-196"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_count&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span>
<a id="__codelineno-5-197" name="__codelineno-5-197" href="#__codelineno-5-197"></a>            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&quot;_scaled&quot;</span><span class="p">)))</span>
<a id="__codelineno-5-198" name="__codelineno-5-198" href="#__codelineno-5-198"></a>        <span class="p">)</span>
<a id="__codelineno-5-199" name="__codelineno-5-199" href="#__codelineno-5-199"></a>        <span class="n">missing_df_scaled</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span>
<a id="__codelineno-5-200" name="__codelineno-5-200" href="#__codelineno-5-200"></a>            <span class="n">root_path</span>
<a id="__codelineno-5-201" name="__codelineno-5-201" href="#__codelineno-5-201"></a>            <span class="o">+</span> <span class="s2">&quot;intermediate_data/autoencoder_latentFeatures/missingCount_computation_scaled&quot;</span><span class="p">,</span>
<a id="__codelineno-5-202" name="__codelineno-5-202" href="#__codelineno-5-202"></a>            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span><span class="p">,</span>
<a id="__codelineno-5-203" name="__codelineno-5-203" href="#__codelineno-5-203"></a>        <span class="p">)</span>
<a id="__codelineno-5-204" name="__codelineno-5-204" href="#__codelineno-5-204"></a>        <span class="n">stats_missing_scaled</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-5-205" name="__codelineno-5-205" href="#__codelineno-5-205"></a>            <span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="n">root_path</span>
<a id="__codelineno-5-206" name="__codelineno-5-206" href="#__codelineno-5-206"></a>            <span class="o">+</span> <span class="s2">&quot;intermediate_data/autoencoder_latentFeatures/missingCount_computation_scaled&quot;</span><span class="p">,</span>
<a id="__codelineno-5-207" name="__codelineno-5-207" href="#__codelineno-5-207"></a>            <span class="s2">&quot;file_type&quot;</span><span class="p">:</span> <span class="s2">&quot;parquet&quot;</span><span class="p">,</span>
<a id="__codelineno-5-208" name="__codelineno-5-208" href="#__codelineno-5-208"></a>        <span class="p">}</span>
<a id="__codelineno-5-209" name="__codelineno-5-209" href="#__codelineno-5-209"></a>        <span class="n">idf_imputed</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span>
<a id="__codelineno-5-210" name="__codelineno-5-210" href="#__codelineno-5-210"></a>            <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-5-211" name="__codelineno-5-211" href="#__codelineno-5-211"></a>            <span class="n">idf_standardized</span><span class="p">,</span>
<a id="__codelineno-5-212" name="__codelineno-5-212" href="#__codelineno-5-212"></a>            <span class="n">list_of_cols_scaled</span><span class="p">,</span>
<a id="__codelineno-5-213" name="__codelineno-5-213" href="#__codelineno-5-213"></a>            <span class="n">stats_missing</span><span class="o">=</span><span class="n">stats_missing_scaled</span><span class="p">,</span>
<a id="__codelineno-5-214" name="__codelineno-5-214" href="#__codelineno-5-214"></a>            <span class="o">**</span><span class="n">args</span><span class="p">,</span>
<a id="__codelineno-5-215" name="__codelineno-5-215" href="#__codelineno-5-215"></a>        <span class="p">)</span>
<a id="__codelineno-5-216" name="__codelineno-5-216" href="#__codelineno-5-216"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-5-217" name="__codelineno-5-217" href="#__codelineno-5-217"></a>        <span class="n">idf_imputed</span> <span class="o">=</span> <span class="n">idf_standardized</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">list_of_cols_scaled</span><span class="p">)</span>
<a id="__codelineno-5-218" name="__codelineno-5-218" href="#__codelineno-5-218"></a>
<a id="__codelineno-5-219" name="__codelineno-5-219" href="#__codelineno-5-219"></a>    <span class="n">n_inputs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols_scaled</span><span class="p">)</span>
<a id="__codelineno-5-220" name="__codelineno-5-220" href="#__codelineno-5-220"></a>    <span class="k">if</span> <span class="n">reduction_params</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-5-221" name="__codelineno-5-221" href="#__codelineno-5-221"></a>        <span class="n">n_bottleneck</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">reduction_params</span> <span class="o">*</span> <span class="n">n_inputs</span><span class="p">)</span>
<a id="__codelineno-5-222" name="__codelineno-5-222" href="#__codelineno-5-222"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-5-223" name="__codelineno-5-223" href="#__codelineno-5-223"></a>        <span class="n">n_bottleneck</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">reduction_params</span><span class="p">)</span>
<a id="__codelineno-5-224" name="__codelineno-5-224" href="#__codelineno-5-224"></a>
<a id="__codelineno-5-225" name="__codelineno-5-225" href="#__codelineno-5-225"></a>    <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-5-226" name="__codelineno-5-226" href="#__codelineno-5-226"></a>        <span class="k">if</span> <span class="n">run_type</span> <span class="o">==</span> <span class="s2">&quot;emr&quot;</span><span class="p">:</span>
<a id="__codelineno-5-227" name="__codelineno-5-227" href="#__codelineno-5-227"></a>            <span class="n">bash_cmd</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-5-228" name="__codelineno-5-228" href="#__codelineno-5-228"></a>                <span class="s2">&quot;aws s3 cp &quot;</span> <span class="o">+</span> <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/encoder.h5 .&quot;</span>
<a id="__codelineno-5-229" name="__codelineno-5-229" href="#__codelineno-5-229"></a>            <span class="p">)</span>
<a id="__codelineno-5-230" name="__codelineno-5-230" href="#__codelineno-5-230"></a>            <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">bash_cmd</span><span class="p">])</span>
<a id="__codelineno-5-231" name="__codelineno-5-231" href="#__codelineno-5-231"></a>            <span class="n">bash_cmd</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-5-232" name="__codelineno-5-232" href="#__codelineno-5-232"></a>                <span class="s2">&quot;aws s3 cp &quot;</span> <span class="o">+</span> <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/model.h5 .&quot;</span>
<a id="__codelineno-5-233" name="__codelineno-5-233" href="#__codelineno-5-233"></a>            <span class="p">)</span>
<a id="__codelineno-5-234" name="__codelineno-5-234" href="#__codelineno-5-234"></a>            <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">bash_cmd</span><span class="p">])</span>
<a id="__codelineno-5-235" name="__codelineno-5-235" href="#__codelineno-5-235"></a>            <span class="n">encoder</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;encoder.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-5-236" name="__codelineno-5-236" href="#__codelineno-5-236"></a>            <span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;model.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-5-237" name="__codelineno-5-237" href="#__codelineno-5-237"></a>        <span class="k">elif</span> <span class="n">run_type</span> <span class="o">==</span> <span class="s2">&quot;ak8s&quot;</span><span class="p">:</span>
<a id="__codelineno-5-238" name="__codelineno-5-238" href="#__codelineno-5-238"></a>            <span class="n">bash_cmd</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-5-239" name="__codelineno-5-239" href="#__codelineno-5-239"></a>                <span class="s1">&#39;azcopy cp &quot;&#39;</span>
<a id="__codelineno-5-240" name="__codelineno-5-240" href="#__codelineno-5-240"></a>                <span class="o">+</span> <span class="n">model_path</span>
<a id="__codelineno-5-241" name="__codelineno-5-241" href="#__codelineno-5-241"></a>                <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/encoder.h5&quot;</span>
<a id="__codelineno-5-242" name="__codelineno-5-242" href="#__codelineno-5-242"></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">auth_key</span><span class="p">)</span>
<a id="__codelineno-5-243" name="__codelineno-5-243" href="#__codelineno-5-243"></a>                <span class="o">+</span> <span class="s1">&#39;&quot; .&#39;</span>
<a id="__codelineno-5-244" name="__codelineno-5-244" href="#__codelineno-5-244"></a>            <span class="p">)</span>
<a id="__codelineno-5-245" name="__codelineno-5-245" href="#__codelineno-5-245"></a>            <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">bash_cmd</span><span class="p">])</span>
<a id="__codelineno-5-246" name="__codelineno-5-246" href="#__codelineno-5-246"></a>            <span class="n">bash_cmd</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-5-247" name="__codelineno-5-247" href="#__codelineno-5-247"></a>                <span class="s1">&#39;azcopy cp &quot;&#39;</span>
<a id="__codelineno-5-248" name="__codelineno-5-248" href="#__codelineno-5-248"></a>                <span class="o">+</span> <span class="n">model_path</span>
<a id="__codelineno-5-249" name="__codelineno-5-249" href="#__codelineno-5-249"></a>                <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/model.h5&quot;</span>
<a id="__codelineno-5-250" name="__codelineno-5-250" href="#__codelineno-5-250"></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">auth_key</span><span class="p">)</span>
<a id="__codelineno-5-251" name="__codelineno-5-251" href="#__codelineno-5-251"></a>                <span class="o">+</span> <span class="s1">&#39;&quot; .&#39;</span>
<a id="__codelineno-5-252" name="__codelineno-5-252" href="#__codelineno-5-252"></a>            <span class="p">)</span>
<a id="__codelineno-5-253" name="__codelineno-5-253" href="#__codelineno-5-253"></a>            <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">bash_cmd</span><span class="p">])</span>
<a id="__codelineno-5-254" name="__codelineno-5-254" href="#__codelineno-5-254"></a>            <span class="n">encoder</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;encoder.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-5-255" name="__codelineno-5-255" href="#__codelineno-5-255"></a>            <span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;model.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-5-256" name="__codelineno-5-256" href="#__codelineno-5-256"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-5-257" name="__codelineno-5-257" href="#__codelineno-5-257"></a>            <span class="n">encoder</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/encoder.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-5-258" name="__codelineno-5-258" href="#__codelineno-5-258"></a>            <span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/model.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-5-259" name="__codelineno-5-259" href="#__codelineno-5-259"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-5-260" name="__codelineno-5-260" href="#__codelineno-5-260"></a>        <span class="n">idf_valid</span> <span class="o">=</span> <span class="n">idf_imputed</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols_scaled</span><span class="p">)</span>
<a id="__codelineno-5-261" name="__codelineno-5-261" href="#__codelineno-5-261"></a>        <span class="n">idf_model</span> <span class="o">=</span> <span class="n">idf_valid</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
<a id="__codelineno-5-262" name="__codelineno-5-262" href="#__codelineno-5-262"></a>            <span class="kc">False</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">sample_size</span><span class="p">)</span> <span class="o">/</span> <span class="n">idf_valid</span><span class="o">.</span><span class="n">count</span><span class="p">()),</span> <span class="mi">0</span>
<a id="__codelineno-5-263" name="__codelineno-5-263" href="#__codelineno-5-263"></a>        <span class="p">)</span>
<a id="__codelineno-5-264" name="__codelineno-5-264" href="#__codelineno-5-264"></a>
<a id="__codelineno-5-265" name="__codelineno-5-265" href="#__codelineno-5-265"></a>        <span class="n">idf_train</span> <span class="o">=</span> <span class="n">idf_model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-5-266" name="__codelineno-5-266" href="#__codelineno-5-266"></a>        <span class="n">idf_test</span> <span class="o">=</span> <span class="n">idf_model</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">idf_train</span><span class="p">)</span>
<a id="__codelineno-5-267" name="__codelineno-5-267" href="#__codelineno-5-267"></a>        <span class="n">X_train</span> <span class="o">=</span> <span class="n">idf_train</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<a id="__codelineno-5-268" name="__codelineno-5-268" href="#__codelineno-5-268"></a>        <span class="n">X_test</span> <span class="o">=</span> <span class="n">idf_test</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<a id="__codelineno-5-269" name="__codelineno-5-269" href="#__codelineno-5-269"></a>
<a id="__codelineno-5-270" name="__codelineno-5-270" href="#__codelineno-5-270"></a>        <span class="n">visible</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_inputs</span><span class="p">,))</span>
<a id="__codelineno-5-271" name="__codelineno-5-271" href="#__codelineno-5-271"></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">n_inputs</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)(</span><span class="n">visible</span><span class="p">)</span>
<a id="__codelineno-5-272" name="__codelineno-5-272" href="#__codelineno-5-272"></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">()(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-5-273" name="__codelineno-5-273" href="#__codelineno-5-273"></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">LeakyReLU</span><span class="p">()(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-5-274" name="__codelineno-5-274" href="#__codelineno-5-274"></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">n_inputs</span><span class="p">)(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-5-275" name="__codelineno-5-275" href="#__codelineno-5-275"></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">()(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-5-276" name="__codelineno-5-276" href="#__codelineno-5-276"></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">LeakyReLU</span><span class="p">()(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-5-277" name="__codelineno-5-277" href="#__codelineno-5-277"></a>        <span class="n">bottleneck</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">n_bottleneck</span><span class="p">)(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-5-278" name="__codelineno-5-278" href="#__codelineno-5-278"></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">n_inputs</span><span class="p">)(</span><span class="n">bottleneck</span><span class="p">)</span>
<a id="__codelineno-5-279" name="__codelineno-5-279" href="#__codelineno-5-279"></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">()(</span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-5-280" name="__codelineno-5-280" href="#__codelineno-5-280"></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">LeakyReLU</span><span class="p">()(</span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-5-281" name="__codelineno-5-281" href="#__codelineno-5-281"></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">n_inputs</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)(</span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-5-282" name="__codelineno-5-282" href="#__codelineno-5-282"></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">BatchNormalization</span><span class="p">()(</span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-5-283" name="__codelineno-5-283" href="#__codelineno-5-283"></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">LeakyReLU</span><span class="p">()(</span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-5-284" name="__codelineno-5-284" href="#__codelineno-5-284"></a>        <span class="n">output</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">n_inputs</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)(</span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-5-285" name="__codelineno-5-285" href="#__codelineno-5-285"></a>
<a id="__codelineno-5-286" name="__codelineno-5-286" href="#__codelineno-5-286"></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">visible</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
<a id="__codelineno-5-287" name="__codelineno-5-287" href="#__codelineno-5-287"></a>        <span class="n">encoder</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">visible</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">bottleneck</span><span class="p">)</span>
<a id="__codelineno-5-288" name="__codelineno-5-288" href="#__codelineno-5-288"></a>        <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;adam&quot;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s2">&quot;mse&quot;</span><span class="p">)</span>
<a id="__codelineno-5-289" name="__codelineno-5-289" href="#__codelineno-5-289"></a>        <span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
<a id="__codelineno-5-290" name="__codelineno-5-290" href="#__codelineno-5-290"></a>            <span class="n">X_train</span><span class="p">,</span>
<a id="__codelineno-5-291" name="__codelineno-5-291" href="#__codelineno-5-291"></a>            <span class="n">X_train</span><span class="p">,</span>
<a id="__codelineno-5-292" name="__codelineno-5-292" href="#__codelineno-5-292"></a>            <span class="n">epochs</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">epochs</span><span class="p">),</span>
<a id="__codelineno-5-293" name="__codelineno-5-293" href="#__codelineno-5-293"></a>            <span class="n">batch_size</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">batch_size</span><span class="p">),</span>
<a id="__codelineno-5-294" name="__codelineno-5-294" href="#__codelineno-5-294"></a>            <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-5-295" name="__codelineno-5-295" href="#__codelineno-5-295"></a>            <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">X_test</span><span class="p">),</span>
<a id="__codelineno-5-296" name="__codelineno-5-296" href="#__codelineno-5-296"></a>        <span class="p">)</span>
<a id="__codelineno-5-297" name="__codelineno-5-297" href="#__codelineno-5-297"></a>
<a id="__codelineno-5-298" name="__codelineno-5-298" href="#__codelineno-5-298"></a>        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pre_existing_model</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">):</span>
<a id="__codelineno-5-299" name="__codelineno-5-299" href="#__codelineno-5-299"></a>            <span class="k">if</span> <span class="n">run_type</span> <span class="o">==</span> <span class="s2">&quot;emr&quot;</span><span class="p">:</span>
<a id="__codelineno-5-300" name="__codelineno-5-300" href="#__codelineno-5-300"></a>                <span class="n">encoder</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;encoder.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-5-301" name="__codelineno-5-301" href="#__codelineno-5-301"></a>                <span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;model.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-5-302" name="__codelineno-5-302" href="#__codelineno-5-302"></a>                <span class="n">bash_cmd</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-5-303" name="__codelineno-5-303" href="#__codelineno-5-303"></a>                    <span class="s2">&quot;aws s3 cp encoder.h5 &quot;</span>
<a id="__codelineno-5-304" name="__codelineno-5-304" href="#__codelineno-5-304"></a>                    <span class="o">+</span> <span class="n">model_path</span>
<a id="__codelineno-5-305" name="__codelineno-5-305" href="#__codelineno-5-305"></a>                    <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/encoder.h5&quot;</span>
<a id="__codelineno-5-306" name="__codelineno-5-306" href="#__codelineno-5-306"></a>                <span class="p">)</span>
<a id="__codelineno-5-307" name="__codelineno-5-307" href="#__codelineno-5-307"></a>                <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">bash_cmd</span><span class="p">])</span>
<a id="__codelineno-5-308" name="__codelineno-5-308" href="#__codelineno-5-308"></a>                <span class="n">bash_cmd</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-5-309" name="__codelineno-5-309" href="#__codelineno-5-309"></a>                    <span class="s2">&quot;aws s3 cp model.h5 &quot;</span>
<a id="__codelineno-5-310" name="__codelineno-5-310" href="#__codelineno-5-310"></a>                    <span class="o">+</span> <span class="n">model_path</span>
<a id="__codelineno-5-311" name="__codelineno-5-311" href="#__codelineno-5-311"></a>                    <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/model.h5&quot;</span>
<a id="__codelineno-5-312" name="__codelineno-5-312" href="#__codelineno-5-312"></a>                <span class="p">)</span>
<a id="__codelineno-5-313" name="__codelineno-5-313" href="#__codelineno-5-313"></a>                <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">bash_cmd</span><span class="p">])</span>
<a id="__codelineno-5-314" name="__codelineno-5-314" href="#__codelineno-5-314"></a>            <span class="k">elif</span> <span class="n">run_type</span> <span class="o">==</span> <span class="s2">&quot;ak8s&quot;</span><span class="p">:</span>
<a id="__codelineno-5-315" name="__codelineno-5-315" href="#__codelineno-5-315"></a>                <span class="n">encoder</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;encoder.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-5-316" name="__codelineno-5-316" href="#__codelineno-5-316"></a>                <span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;model.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-5-317" name="__codelineno-5-317" href="#__codelineno-5-317"></a>                <span class="n">bash_cmd</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-5-318" name="__codelineno-5-318" href="#__codelineno-5-318"></a>                    <span class="s1">&#39;azcopy cp &quot;encoder.h5&quot; &quot;&#39;</span>
<a id="__codelineno-5-319" name="__codelineno-5-319" href="#__codelineno-5-319"></a>                    <span class="o">+</span> <span class="n">model_path</span>
<a id="__codelineno-5-320" name="__codelineno-5-320" href="#__codelineno-5-320"></a>                    <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/encoder.h5&quot;</span>
<a id="__codelineno-5-321" name="__codelineno-5-321" href="#__codelineno-5-321"></a>                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">auth_key</span><span class="p">)</span>
<a id="__codelineno-5-322" name="__codelineno-5-322" href="#__codelineno-5-322"></a>                    <span class="o">+</span> <span class="s1">&#39;&quot; &#39;</span>
<a id="__codelineno-5-323" name="__codelineno-5-323" href="#__codelineno-5-323"></a>                <span class="p">)</span>
<a id="__codelineno-5-324" name="__codelineno-5-324" href="#__codelineno-5-324"></a>                <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">bash_cmd</span><span class="p">])</span>
<a id="__codelineno-5-325" name="__codelineno-5-325" href="#__codelineno-5-325"></a>                <span class="n">bash_cmd</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-5-326" name="__codelineno-5-326" href="#__codelineno-5-326"></a>                    <span class="s1">&#39;azcopy cp &quot;model.h5&quot; &quot;&#39;</span>
<a id="__codelineno-5-327" name="__codelineno-5-327" href="#__codelineno-5-327"></a>                    <span class="o">+</span> <span class="n">model_path</span>
<a id="__codelineno-5-328" name="__codelineno-5-328" href="#__codelineno-5-328"></a>                    <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/model.h5&quot;</span>
<a id="__codelineno-5-329" name="__codelineno-5-329" href="#__codelineno-5-329"></a>                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">auth_key</span><span class="p">)</span>
<a id="__codelineno-5-330" name="__codelineno-5-330" href="#__codelineno-5-330"></a>                    <span class="o">+</span> <span class="s1">&#39;&quot; &#39;</span>
<a id="__codelineno-5-331" name="__codelineno-5-331" href="#__codelineno-5-331"></a>                <span class="p">)</span>
<a id="__codelineno-5-332" name="__codelineno-5-332" href="#__codelineno-5-332"></a>                <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">bash_cmd</span><span class="p">])</span>
<a id="__codelineno-5-333" name="__codelineno-5-333" href="#__codelineno-5-333"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-5-334" name="__codelineno-5-334" href="#__codelineno-5-334"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/&quot;</span><span class="p">):</span>
<a id="__codelineno-5-335" name="__codelineno-5-335" href="#__codelineno-5-335"></a>                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/&quot;</span><span class="p">)</span>
<a id="__codelineno-5-336" name="__codelineno-5-336" href="#__codelineno-5-336"></a>                <span class="n">encoder</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/encoder.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-5-337" name="__codelineno-5-337" href="#__codelineno-5-337"></a>                <span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/autoencoders_latentFeatures/model.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-5-338" name="__codelineno-5-338" href="#__codelineno-5-338"></a>
<a id="__codelineno-5-339" name="__codelineno-5-339" href="#__codelineno-5-339"></a>    <span class="k">class</span> <span class="nc">ModelWrapperPickable</span><span class="p">:</span>
<a id="__codelineno-5-340" name="__codelineno-5-340" href="#__codelineno-5-340"></a>        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
<a id="__codelineno-5-341" name="__codelineno-5-341" href="#__codelineno-5-341"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
<a id="__codelineno-5-342" name="__codelineno-5-342" href="#__codelineno-5-342"></a>
<a id="__codelineno-5-343" name="__codelineno-5-343" href="#__codelineno-5-343"></a>        <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-5-344" name="__codelineno-5-344" href="#__codelineno-5-344"></a>            <span class="n">model_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-5-345" name="__codelineno-5-345" href="#__codelineno-5-345"></a>            <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.hdf5&quot;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
<a id="__codelineno-5-346" name="__codelineno-5-346" href="#__codelineno-5-346"></a>                <span class="n">tensorflow</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">fd</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-5-347" name="__codelineno-5-347" href="#__codelineno-5-347"></a>                <span class="n">model_str</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-5-348" name="__codelineno-5-348" href="#__codelineno-5-348"></a>            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;model_str&quot;</span><span class="p">:</span> <span class="n">model_str</span><span class="p">}</span>
<a id="__codelineno-5-349" name="__codelineno-5-349" href="#__codelineno-5-349"></a>            <span class="k">return</span> <span class="n">d</span>
<a id="__codelineno-5-350" name="__codelineno-5-350" href="#__codelineno-5-350"></a>
<a id="__codelineno-5-351" name="__codelineno-5-351" href="#__codelineno-5-351"></a>        <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
<a id="__codelineno-5-352" name="__codelineno-5-352" href="#__codelineno-5-352"></a>            <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.hdf5&quot;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
<a id="__codelineno-5-353" name="__codelineno-5-353" href="#__codelineno-5-353"></a>                <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;model_str&quot;</span><span class="p">])</span>
<a id="__codelineno-5-354" name="__codelineno-5-354" href="#__codelineno-5-354"></a>                <span class="n">fd</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
<a id="__codelineno-5-355" name="__codelineno-5-355" href="#__codelineno-5-355"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">tensorflow</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-5-356" name="__codelineno-5-356" href="#__codelineno-5-356"></a>
<a id="__codelineno-5-357" name="__codelineno-5-357" href="#__codelineno-5-357"></a>    <span class="n">model_wrapper</span> <span class="o">=</span> <span class="n">ModelWrapperPickable</span><span class="p">(</span><span class="n">encoder</span><span class="p">)</span>
<a id="__codelineno-5-358" name="__codelineno-5-358" href="#__codelineno-5-358"></a>
<a id="__codelineno-5-359" name="__codelineno-5-359" href="#__codelineno-5-359"></a>    <span class="k">def</span> <span class="nf">compute_output_pandas_udf</span><span class="p">(</span><span class="n">model_wrapper</span><span class="p">):</span>
<a id="__codelineno-5-360" name="__codelineno-5-360" href="#__codelineno-5-360"></a>        <span class="nd">@F</span><span class="o">.</span><span class="n">pandas_udf</span><span class="p">(</span><span class="n">returnType</span><span class="o">=</span><span class="n">T</span><span class="o">.</span><span class="n">ArrayType</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">DoubleType</span><span class="p">()))</span>
<a id="__codelineno-5-361" name="__codelineno-5-361" href="#__codelineno-5-361"></a>        <span class="k">def</span> <span class="nf">predict_pandas_udf</span><span class="p">(</span><span class="o">*</span><span class="n">cols</span><span class="p">):</span>
<a id="__codelineno-5-362" name="__codelineno-5-362" href="#__codelineno-5-362"></a>            <span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-5-363" name="__codelineno-5-363" href="#__codelineno-5-363"></a>            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">model_wrapper</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
<a id="__codelineno-5-364" name="__codelineno-5-364" href="#__codelineno-5-364"></a>
<a id="__codelineno-5-365" name="__codelineno-5-365" href="#__codelineno-5-365"></a>        <span class="k">return</span> <span class="n">predict_pandas_udf</span>
<a id="__codelineno-5-366" name="__codelineno-5-366" href="#__codelineno-5-366"></a>
<a id="__codelineno-5-367" name="__codelineno-5-367" href="#__codelineno-5-367"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf_imputed</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-5-368" name="__codelineno-5-368" href="#__codelineno-5-368"></a>        <span class="s2">&quot;predicted_output&quot;</span><span class="p">,</span>
<a id="__codelineno-5-369" name="__codelineno-5-369" href="#__codelineno-5-369"></a>        <span class="n">compute_output_pandas_udf</span><span class="p">(</span><span class="n">model_wrapper</span><span class="p">)(</span><span class="o">*</span><span class="n">list_of_cols_scaled</span><span class="p">),</span>
<a id="__codelineno-5-370" name="__codelineno-5-370" href="#__codelineno-5-370"></a>    <span class="p">)</span>
<a id="__codelineno-5-371" name="__codelineno-5-371" href="#__codelineno-5-371"></a>    <span class="n">odf_schema</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">schema</span>
<a id="__codelineno-5-372" name="__codelineno-5-372" href="#__codelineno-5-372"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_bottleneck</span><span class="p">):</span>
<a id="__codelineno-5-373" name="__codelineno-5-373" href="#__codelineno-5-373"></a>        <span class="n">odf_schema</span> <span class="o">=</span> <span class="n">odf_schema</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;latent_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">T</span><span class="o">.</span><span class="n">FloatType</span><span class="p">()))</span>
<a id="__codelineno-5-374" name="__codelineno-5-374" href="#__codelineno-5-374"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-5-375" name="__codelineno-5-375" href="#__codelineno-5-375"></a>        <span class="n">odf</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;predicted_output&quot;</span><span class="p">]))</span>
<a id="__codelineno-5-376" name="__codelineno-5-376" href="#__codelineno-5-376"></a>        <span class="o">.</span><span class="n">toDF</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">odf_schema</span><span class="p">)</span>
<a id="__codelineno-5-377" name="__codelineno-5-377" href="#__codelineno-5-377"></a>        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;predicted_output&quot;</span><span class="p">)</span>
<a id="__codelineno-5-378" name="__codelineno-5-378" href="#__codelineno-5-378"></a>    <span class="p">)</span>
<a id="__codelineno-5-379" name="__codelineno-5-379" href="#__codelineno-5-379"></a>
<a id="__codelineno-5-380" name="__codelineno-5-380" href="#__codelineno-5-380"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_cols_scaled</span><span class="p">)</span>
<a id="__codelineno-5-381" name="__codelineno-5-381" href="#__codelineno-5-381"></a>
<a id="__codelineno-5-382" name="__codelineno-5-382" href="#__codelineno-5-382"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-5-383" name="__codelineno-5-383" href="#__codelineno-5-383"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-5-384" name="__codelineno-5-384" href="#__codelineno-5-384"></a>
<a id="__codelineno-5-385" name="__codelineno-5-385" href="#__codelineno-5-385"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-5-386" name="__codelineno-5-386" href="#__codelineno-5-386"></a>        <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;latent_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_bottleneck</span><span class="p">)]</span>
<a id="__codelineno-5-387" name="__codelineno-5-387" href="#__codelineno-5-387"></a>        <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">output_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-5-388" name="__codelineno-5-388" href="#__codelineno-5-388"></a>
<a id="__codelineno-5-389" name="__codelineno-5-389" href="#__codelineno-5-389"></a>    <span class="k">return</span> <span class="n">odf</span>
</code></pre></div>
</pre>
</details>
</dd>
<dt id="anovos.data_transformer.transformers.boxcox_transformation"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">boxcox_transformation</span></span>(<span class="n">idf, list_of_cols='all', drop_cols=[], boxcox_lambda=None, output_mode='replace', print_impact=False)</span>
</code></dt>
<dd>
<div class="desc"><p>Some machine learning algorithms require the input data to follow normal distributions. Thus, when the input
data is too skewed, boxcox_transformation can be used to transform it into a more normal-like distribution. The
transformed value of a sample x depends on a coefficient lambda:
(1) if lambda = 0, x is transformed into log(x);
(2) if lambda !=0, x is transformed into (x^lambda-1)/lambda.</p>
<p>The value of lambda can be either specified by the user or automatically selected within the function.
If lambda needs to be selected within the function, a range of values (0, 1, -1, 0.5, -0.5, 2, -2, 0.25, -0.25, 3, -3, 4, -4, 5, -5)
will be tested and the lambda, which optimizes the KolmogorovSmirnovTest by PySpark with the theoretical distribution being normal,
will be used to perform the transformation. Different lambda values can be assigned to different attributes but one attribute
can only be assigned one lambda value.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe</dd>
<dt><strong><code>list_of_cols</code></strong></dt>
<dd>List of numerical columns to transform e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
"all" can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.
Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in
drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = "all")</dd>
<dt><strong><code>drop_cols</code></strong></dt>
<dd>List of columns to be dropped e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except
a few handful of them. (Default value = [])</dd>
<dt><strong><code>boxcox_lambda</code></strong></dt>
<dd>Lambda value for box_cox transormation.
If boxcox_lambda is not None, it will be directly used for the transformation. It can be a
(1) list: each element represents a lambda value for an attribute and the length of the list
must be the same as the number of columns to transform.
(2) int/float: all attributes will be assigned the same lambda value.
Else, search for the best lambda among [1,-1,0.5,-0.5,2,-2,0.25,-0.25,3,-3,4,-4,5,-5]
for each column and apply the transformation (Default value = None)</dd>
<dt><strong><code>output_mode</code></strong></dt>
<dd>"replace", "append".
“replace” option replaces original columns with transformed columns.
“append” option append transformed columns with a postfix "<em>bxcx</em><lambda>"
to the input dataset. (Default value = "replace")</dd>
<dt><strong><code>print_impact</code></strong></dt>
<dd>True, False
This argument is to print before and after descriptive statistics of the transformed features (Default value = False)</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>DataFrame</code></dt>
<dd>Transformed Dataframe</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">def</span> <span class="nf">boxcox_transformation</span><span class="p">(</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    <span class="n">boxcox_lambda</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="p">):</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="sd">    Some machine learning algorithms require the input data to follow normal distributions. Thus, when the input</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="sd">    data is too skewed, boxcox_transformation can be used to transform it into a more normal-like distribution. The</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="sd">    transformed value of a sample x depends on a coefficient lambda:</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="sd">    (1) if lambda = 0, x is transformed into log(x);</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="sd">    (2) if lambda !=0, x is transformed into (x^lambda-1)/lambda.</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="sd">    The value of lambda can be either specified by the user or automatically selected within the function.</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="sd">    If lambda needs to be selected within the function, a range of values (0, 1, -1, 0.5, -0.5, 2, -2, 0.25, -0.25, 3, -3, 4, -4, 5, -5)</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="sd">    will be tested and the lambda, which optimizes the KolmogorovSmirnovTest by PySpark with the theoretical distribution being normal,</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="sd">    will be used to perform the transformation. Different lambda values can be assigned to different attributes but one attribute</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="sd">    can only be assigned one lambda value.</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="sd">    Parameters</span>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="sd">    ----------</span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="sd">    idf</span>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="sd">        List of numerical columns to transform e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="sd">        &quot;all&quot; can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a><span class="sd">    boxcox_lambda</span>
<a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a><span class="sd">        Lambda value for box_cox transormation.</span>
<a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a><span class="sd">        If boxcox_lambda is not None, it will be directly used for the transformation. It can be a</span>
<a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a><span class="sd">        (1) list: each element represents a lambda value for an attribute and the length of the list</span>
<a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a><span class="sd">        must be the same as the number of columns to transform.</span>
<a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a><span class="sd">        (2) int/float: all attributes will be assigned the same lambda value.</span>
<a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a><span class="sd">        Else, search for the best lambda among [1,-1,0.5,-0.5,2,-2,0.25,-0.25,3,-3,4,-4,5,-5]</span>
<a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a><span class="sd">        for each column and apply the transformation (Default value = None)</span>
<a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a><span class="sd">    output_mode</span>
<a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a><span class="sd">        “replace” option replaces original columns with transformed columns.</span>
<a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a><span class="sd">        “append” option append transformed columns with a postfix &quot;_bxcx_&lt;lambda&gt;&quot;</span>
<a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a><span class="sd">        to the input dataset. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a><span class="sd">    print_impact</span>
<a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a><span class="sd">        True, False</span>
<a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a><span class="sd">        This argument is to print before and after descriptive statistics of the transformed features (Default value = False)</span>
<a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a>
<a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a><span class="sd">    Returns</span>
<a id="__codelineno-6-58" name="__codelineno-6-58" href="#__codelineno-6-58"></a><span class="sd">    -------</span>
<a id="__codelineno-6-59" name="__codelineno-6-59" href="#__codelineno-6-59"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-6-60" name="__codelineno-6-60" href="#__codelineno-6-60"></a><span class="sd">        Transformed Dataframe</span>
<a id="__codelineno-6-61" name="__codelineno-6-61" href="#__codelineno-6-61"></a>
<a id="__codelineno-6-62" name="__codelineno-6-62" href="#__codelineno-6-62"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-6-63" name="__codelineno-6-63" href="#__codelineno-6-63"></a>
<a id="__codelineno-6-64" name="__codelineno-6-64" href="#__codelineno-6-64"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-6-65" name="__codelineno-6-65" href="#__codelineno-6-65"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-6-66" name="__codelineno-6-66" href="#__codelineno-6-66"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-6-67" name="__codelineno-6-67" href="#__codelineno-6-67"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-6-68" name="__codelineno-6-68" href="#__codelineno-6-68"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-6-69" name="__codelineno-6-69" href="#__codelineno-6-69"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-6-70" name="__codelineno-6-70" href="#__codelineno-6-70"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-6-71" name="__codelineno-6-71" href="#__codelineno-6-71"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-6-72" name="__codelineno-6-72" href="#__codelineno-6-72"></a>
<a id="__codelineno-6-73" name="__codelineno-6-73" href="#__codelineno-6-73"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">)):</span>
<a id="__codelineno-6-74" name="__codelineno-6-74" href="#__codelineno-6-74"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-6-75" name="__codelineno-6-75" href="#__codelineno-6-75"></a>
<a id="__codelineno-6-76" name="__codelineno-6-76" href="#__codelineno-6-76"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-6-77" name="__codelineno-6-77" href="#__codelineno-6-77"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-6-78" name="__codelineno-6-78" href="#__codelineno-6-78"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-6-79" name="__codelineno-6-79" href="#__codelineno-6-79"></a>    <span class="n">col_mins</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">F</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">])</span>
<a id="__codelineno-6-80" name="__codelineno-6-80" href="#__codelineno-6-80"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">col_mins</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()]):</span>
<a id="__codelineno-6-81" name="__codelineno-6-81" href="#__codelineno-6-81"></a>        <span class="n">col_mins</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-6-82" name="__codelineno-6-82" href="#__codelineno-6-82"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Data must be positive&quot;</span><span class="p">)</span>
<a id="__codelineno-6-83" name="__codelineno-6-83" href="#__codelineno-6-83"></a>
<a id="__codelineno-6-84" name="__codelineno-6-84" href="#__codelineno-6-84"></a>    <span class="k">if</span> <span class="n">boxcox_lambda</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-6-85" name="__codelineno-6-85" href="#__codelineno-6-85"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">boxcox_lambda</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
<a id="__codelineno-6-86" name="__codelineno-6-86" href="#__codelineno-6-86"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">boxcox_lambda</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-6-87" name="__codelineno-6-87" href="#__codelineno-6-87"></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for boxcox_lambda&quot;</span><span class="p">)</span>
<a id="__codelineno-6-88" name="__codelineno-6-88" href="#__codelineno-6-88"></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">boxcox_lambda</span><span class="p">]):</span>
<a id="__codelineno-6-89" name="__codelineno-6-89" href="#__codelineno-6-89"></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for boxcox_lambda&quot;</span><span class="p">)</span>
<a id="__codelineno-6-90" name="__codelineno-6-90" href="#__codelineno-6-90"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-6-91" name="__codelineno-6-91" href="#__codelineno-6-91"></a>                <span class="n">boxcox_lambda_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">boxcox_lambda</span><span class="p">)</span>
<a id="__codelineno-6-92" name="__codelineno-6-92" href="#__codelineno-6-92"></a>
<a id="__codelineno-6-93" name="__codelineno-6-93" href="#__codelineno-6-93"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">boxcox_lambda</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
<a id="__codelineno-6-94" name="__codelineno-6-94" href="#__codelineno-6-94"></a>            <span class="n">boxcox_lambda_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">boxcox_lambda</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-6-95" name="__codelineno-6-95" href="#__codelineno-6-95"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-6-96" name="__codelineno-6-96" href="#__codelineno-6-96"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for boxcox_lambda&quot;</span><span class="p">)</span>
<a id="__codelineno-6-97" name="__codelineno-6-97" href="#__codelineno-6-97"></a>
<a id="__codelineno-6-98" name="__codelineno-6-98" href="#__codelineno-6-98"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-6-99" name="__codelineno-6-99" href="#__codelineno-6-99"></a>        <span class="n">boxcox_lambda_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-6-100" name="__codelineno-6-100" href="#__codelineno-6-100"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-6-101" name="__codelineno-6-101" href="#__codelineno-6-101"></a>            <span class="n">lambdaVal</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">]</span>
<a id="__codelineno-6-102" name="__codelineno-6-102" href="#__codelineno-6-102"></a>            <span class="n">best_pVal</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-6-103" name="__codelineno-6-103" href="#__codelineno-6-103"></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">lambdaVal</span><span class="p">:</span>
<a id="__codelineno-6-104" name="__codelineno-6-104" href="#__codelineno-6-104"></a>                <span class="n">pVal</span> <span class="o">=</span> <span class="n">Statistics</span><span class="o">.</span><span class="n">kolmogorovSmirnovTest</span><span class="p">(</span>
<a id="__codelineno-6-105" name="__codelineno-6-105" href="#__codelineno-6-105"></a>                    <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">j</span><span class="p">))</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">),</span> <span class="s2">&quot;norm&quot;</span>
<a id="__codelineno-6-106" name="__codelineno-6-106" href="#__codelineno-6-106"></a>                <span class="p">)</span><span class="o">.</span><span class="n">pValue</span>
<a id="__codelineno-6-107" name="__codelineno-6-107" href="#__codelineno-6-107"></a>                <span class="k">if</span> <span class="n">pVal</span> <span class="o">&gt;</span> <span class="n">best_pVal</span><span class="p">:</span>
<a id="__codelineno-6-108" name="__codelineno-6-108" href="#__codelineno-6-108"></a>                    <span class="n">best_pVal</span> <span class="o">=</span> <span class="n">pVal</span>
<a id="__codelineno-6-109" name="__codelineno-6-109" href="#__codelineno-6-109"></a>                    <span class="n">best_lambdaVal</span> <span class="o">=</span> <span class="n">j</span>
<a id="__codelineno-6-110" name="__codelineno-6-110" href="#__codelineno-6-110"></a>
<a id="__codelineno-6-111" name="__codelineno-6-111" href="#__codelineno-6-111"></a>            <span class="n">pVal</span> <span class="o">=</span> <span class="n">Statistics</span><span class="o">.</span><span class="n">kolmogorovSmirnovTest</span><span class="p">(</span>
<a id="__codelineno-6-112" name="__codelineno-6-112" href="#__codelineno-6-112"></a>                <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">),</span> <span class="s2">&quot;norm&quot;</span>
<a id="__codelineno-6-113" name="__codelineno-6-113" href="#__codelineno-6-113"></a>            <span class="p">)</span><span class="o">.</span><span class="n">pValue</span>
<a id="__codelineno-6-114" name="__codelineno-6-114" href="#__codelineno-6-114"></a>            <span class="k">if</span> <span class="n">pVal</span> <span class="o">&gt;</span> <span class="n">best_pVal</span><span class="p">:</span>
<a id="__codelineno-6-115" name="__codelineno-6-115" href="#__codelineno-6-115"></a>                <span class="n">best_pVal</span> <span class="o">=</span> <span class="n">pVal</span>
<a id="__codelineno-6-116" name="__codelineno-6-116" href="#__codelineno-6-116"></a>                <span class="n">best_lambdaVal</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-6-117" name="__codelineno-6-117" href="#__codelineno-6-117"></a>            <span class="n">boxcox_lambda_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_lambdaVal</span><span class="p">)</span>
<a id="__codelineno-6-118" name="__codelineno-6-118" href="#__codelineno-6-118"></a>
<a id="__codelineno-6-119" name="__codelineno-6-119" href="#__codelineno-6-119"></a>    <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-6-120" name="__codelineno-6-120" href="#__codelineno-6-120"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">curr_lambdaVal</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="n">boxcox_lambda_list</span><span class="p">):</span>
<a id="__codelineno-6-121" name="__codelineno-6-121" href="#__codelineno-6-121"></a>        <span class="k">if</span> <span class="n">curr_lambdaVal</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-6-122" name="__codelineno-6-122" href="#__codelineno-6-122"></a>            <span class="n">modify_col</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-6-123" name="__codelineno-6-123" href="#__codelineno-6-123"></a>                <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_bxcx_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">curr_lambdaVal</span><span class="p">))</span> <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;append&quot;</span> <span class="k">else</span> <span class="n">i</span>
<a id="__codelineno-6-124" name="__codelineno-6-124" href="#__codelineno-6-124"></a>            <span class="p">)</span>
<a id="__codelineno-6-125" name="__codelineno-6-125" href="#__codelineno-6-125"></a>            <span class="n">output_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modify_col</span><span class="p">)</span>
<a id="__codelineno-6-126" name="__codelineno-6-126" href="#__codelineno-6-126"></a>            <span class="k">if</span> <span class="n">curr_lambdaVal</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-6-127" name="__codelineno-6-127" href="#__codelineno-6-127"></a>                <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">modify_col</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
<a id="__codelineno-6-128" name="__codelineno-6-128" href="#__codelineno-6-128"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-6-129" name="__codelineno-6-129" href="#__codelineno-6-129"></a>                <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">modify_col</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">curr_lambdaVal</span><span class="p">))</span>
<a id="__codelineno-6-130" name="__codelineno-6-130" href="#__codelineno-6-130"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-6-131" name="__codelineno-6-131" href="#__codelineno-6-131"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-6-132" name="__codelineno-6-132" href="#__codelineno-6-132"></a>            <span class="s2">&quot;lambdaVal for all columns are 1 so no transformation is performed and idf is returned&quot;</span>
<a id="__codelineno-6-133" name="__codelineno-6-133" href="#__codelineno-6-133"></a>        <span class="p">)</span>
<a id="__codelineno-6-134" name="__codelineno-6-134" href="#__codelineno-6-134"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-6-135" name="__codelineno-6-135" href="#__codelineno-6-135"></a>
<a id="__codelineno-6-136" name="__codelineno-6-136" href="#__codelineno-6-136"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-6-137" name="__codelineno-6-137" href="#__codelineno-6-137"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Transformed Columns: &quot;</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-6-138" name="__codelineno-6-138" href="#__codelineno-6-138"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best BoxCox Parameter(s): &quot;</span><span class="p">,</span> <span class="n">boxcox_lambda_list</span><span class="p">)</span>
<a id="__codelineno-6-139" name="__codelineno-6-139" href="#__codelineno-6-139"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before:&quot;</span><span class="p">)</span>
<a id="__codelineno-6-140" name="__codelineno-6-140" href="#__codelineno-6-140"></a>        <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">unionByName</span><span class="p">(</span>
<a id="__codelineno-6-141" name="__codelineno-6-141" href="#__codelineno-6-141"></a>            <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">F</span><span class="o">.</span><span class="n">skewness</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">])</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-6-142" name="__codelineno-6-142" href="#__codelineno-6-142"></a>                <span class="s2">&quot;summary&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&quot;skewness&quot;</span><span class="p">)</span>
<a id="__codelineno-6-143" name="__codelineno-6-143" href="#__codelineno-6-143"></a>            <span class="p">)</span>
<a id="__codelineno-6-144" name="__codelineno-6-144" href="#__codelineno-6-144"></a>        <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-6-145" name="__codelineno-6-145" href="#__codelineno-6-145"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After:&quot;</span><span class="p">)</span>
<a id="__codelineno-6-146" name="__codelineno-6-146" href="#__codelineno-6-146"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-6-147" name="__codelineno-6-147" href="#__codelineno-6-147"></a>            <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">unionByName</span><span class="p">(</span>
<a id="__codelineno-6-148" name="__codelineno-6-148" href="#__codelineno-6-148"></a>                <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">F</span><span class="o">.</span><span class="n">skewness</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">])</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-6-149" name="__codelineno-6-149" href="#__codelineno-6-149"></a>                    <span class="s2">&quot;summary&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&quot;skewness&quot;</span><span class="p">)</span>
<a id="__codelineno-6-150" name="__codelineno-6-150" href="#__codelineno-6-150"></a>                <span class="p">)</span>
<a id="__codelineno-6-151" name="__codelineno-6-151" href="#__codelineno-6-151"></a>            <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-6-152" name="__codelineno-6-152" href="#__codelineno-6-152"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-6-153" name="__codelineno-6-153" href="#__codelineno-6-153"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;`&quot;</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;`&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">output_cols</span><span class="p">]</span>
<a id="__codelineno-6-154" name="__codelineno-6-154" href="#__codelineno-6-154"></a>            <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">output_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">unionByName</span><span class="p">(</span>
<a id="__codelineno-6-155" name="__codelineno-6-155" href="#__codelineno-6-155"></a>                <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-6-156" name="__codelineno-6-156" href="#__codelineno-6-156"></a>                    <span class="p">[</span><span class="n">F</span><span class="o">.</span><span class="n">skewness</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">output_cols</span><span class="p">]</span>
<a id="__codelineno-6-157" name="__codelineno-6-157" href="#__codelineno-6-157"></a>                <span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;summary&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&quot;skewness&quot;</span><span class="p">))</span>
<a id="__codelineno-6-158" name="__codelineno-6-158" href="#__codelineno-6-158"></a>            <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-6-159" name="__codelineno-6-159" href="#__codelineno-6-159"></a>
<a id="__codelineno-6-160" name="__codelineno-6-160" href="#__codelineno-6-160"></a>    <span class="k">return</span> <span class="n">odf</span>
</code></pre></div>
</pre>
</details>
</dd>
<dt id="anovos.data_transformer.transformers.cat_to_num_supervised"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">cat_to_num_supervised</span></span>(<span class="n">spark, idf, list_of_cols='all', drop_cols=[], label_col='label', event_label=1, pre_existing_model=False, model_path='NA', output_mode='replace', persist=False, persist_option=StorageLevel(True, True, False, False, 1), print_impact=False)</span>
</code></dt>
<dd>
<div class="desc"><p>This is a supervised method to convert a categorical attribute into a numerical attribute. It takes a
label/target column to indicate whether the event is positive or negative. For each column, the positive event
rate for each categorical value is used as the encoded numerical value.</p>
<p>For example, there are 3 distinct values in a categorical attribute X: X1, X2 and X3. Within the input dataframe, there are
- 15 positive events and 5 negative events with X==X1;
- 10 positive events and 40 negative events with X==X2;
- 20 positive events and 20 negative events with X==X3.</p>
<p>Thus, value X1 is mapped to 15/(15+5) = 0.75, value X2 is mapped to 10/(10+40) = 0.2 and value X3 is mapped to
20/(20+20) = 0.5. This mapping will be applied to all values in attribute X. This encoding method can be helpful
in avoiding creating too many dummy variables which may cause dimensionality issue and it also works with
categorical attributes without an order or rank.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>spark</code></strong></dt>
<dd>Spark Session</dd>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe</dd>
<dt><strong><code>list_of_cols</code></strong></dt>
<dd>List of categorical columns to transform e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
"all" can be passed to include all categorical columns for analysis. This is super useful instead of specifying all column names manually.
Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in
drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = "all")</dd>
<dt><strong><code>drop_cols</code></strong></dt>
<dd>List of columns to be dropped e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except
a few handful of them. (Default value = [])</dd>
<dt><strong><code>label_col</code></strong></dt>
<dd>Label/Target column (Default value = "label")</dd>
<dt><strong><code>event_label</code></strong></dt>
<dd>Value of (positive) event (i.e label 1) (Default value = 1)</dd>
<dt><strong><code>pre_existing_model</code></strong></dt>
<dd>Boolean argument – True or False. True if model (original and mapped numerical value
for each column) exists already, False Otherwise. (Default value = False)</dd>
<dt><strong><code>model_path</code></strong></dt>
<dd>If pre_existing_model is True, this argument is path for referring the pre-saved model.
If pre_existing_model is False, this argument can be used for saving the model.
Default "NA" is used to save the model in "intermediate_data/" folder for optimization purpose.</dd>
<dt><strong><code>output_mode</code></strong></dt>
<dd>"replace", "append".
“replace” option replaces original columns with transformed column. “append” option append transformed
column to the input dataset with a postfix "_encoded" e.g. column X is appended as X_encoded. (Default value = "replace")</dd>
<dt><strong><code>persist</code></strong></dt>
<dd>Boolean argument - True or False. This parameter is for optimization purpose. If True, repeatedly used dataframe
will be persisted (StorageLevel can be specified in persist_option). We recommend setting this parameter as True
if at least one of the following criteria is True:
(1) The underlying data source is in csv format
(2) The transformation will be applicable to most columns. (Default value = False)</dd>
<dt><strong><code>persist_option</code></strong></dt>
<dd>A pyspark.StorageLevel instance. This parameter is useful only when persist is True.
(Default value = pyspark.StorageLevel.MEMORY_AND_DISK)</dd>
<dt><strong><code>print_impact</code></strong></dt>
<dd>True, False (Default value = False)
This argument is to print out the descriptive statistics of encoded columns.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>DataFrame</code></dt>
<dd>Encoded Dataframe</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">def</span> <span class="nf">cat_to_num_supervised</span><span class="p">(</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    <span class="n">label_col</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    <span class="n">event_label</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>    <span class="n">pre_existing_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>    <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>    <span class="n">persist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>    <span class="n">persist_option</span><span class="o">=</span><span class="n">pyspark</span><span class="o">.</span><span class="n">StorageLevel</span><span class="o">.</span><span class="n">MEMORY_AND_DISK</span><span class="p">,</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="p">):</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="sd">    This is a supervised method to convert a categorical attribute into a numerical attribute. It takes a</span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="sd">    label/target column to indicate whether the event is positive or negative. For each column, the positive event</span>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="sd">    rate for each categorical value is used as the encoded numerical value.</span>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a><span class="sd">    For example, there are 3 distinct values in a categorical attribute X: X1, X2 and X3. Within the input dataframe, there are</span>
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a><span class="sd">    - 15 positive events and 5 negative events with X==X1;</span>
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a><span class="sd">    - 10 positive events and 40 negative events with X==X2;</span>
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a><span class="sd">    - 20 positive events and 20 negative events with X==X3.</span>
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a><span class="sd">    Thus, value X1 is mapped to 15/(15+5) = 0.75, value X2 is mapped to 10/(10+40) = 0.2 and value X3 is mapped to</span>
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a><span class="sd">    20/(20+20) = 0.5. This mapping will be applied to all values in attribute X. This encoding method can be helpful</span>
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a><span class="sd">    in avoiding creating too many dummy variables which may cause dimensionality issue and it also works with</span>
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a><span class="sd">    categorical attributes without an order or rank.</span>
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a>
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a><span class="sd">    Parameters</span>
<a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a><span class="sd">    ----------</span>
<a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a><span class="sd">    spark</span>
<a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a><span class="sd">    idf</span>
<a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a><span class="sd">        List of categorical columns to transform e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-7-39" name="__codelineno-7-39" href="#__codelineno-7-39"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-7-40" name="__codelineno-7-40" href="#__codelineno-7-40"></a><span class="sd">        &quot;all&quot; can be passed to include all categorical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-7-41" name="__codelineno-7-41" href="#__codelineno-7-41"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-7-42" name="__codelineno-7-42" href="#__codelineno-7-42"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-7-43" name="__codelineno-7-43" href="#__codelineno-7-43"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-7-44" name="__codelineno-7-44" href="#__codelineno-7-44"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-7-45" name="__codelineno-7-45" href="#__codelineno-7-45"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-7-46" name="__codelineno-7-46" href="#__codelineno-7-46"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-7-47" name="__codelineno-7-47" href="#__codelineno-7-47"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-7-48" name="__codelineno-7-48" href="#__codelineno-7-48"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-7-49" name="__codelineno-7-49" href="#__codelineno-7-49"></a><span class="sd">    label_col</span>
<a id="__codelineno-7-50" name="__codelineno-7-50" href="#__codelineno-7-50"></a><span class="sd">        Label/Target column (Default value = &quot;label&quot;)</span>
<a id="__codelineno-7-51" name="__codelineno-7-51" href="#__codelineno-7-51"></a><span class="sd">    event_label</span>
<a id="__codelineno-7-52" name="__codelineno-7-52" href="#__codelineno-7-52"></a><span class="sd">        Value of (positive) event (i.e label 1) (Default value = 1)</span>
<a id="__codelineno-7-53" name="__codelineno-7-53" href="#__codelineno-7-53"></a><span class="sd">    pre_existing_model</span>
<a id="__codelineno-7-54" name="__codelineno-7-54" href="#__codelineno-7-54"></a><span class="sd">        Boolean argument – True or False. True if model (original and mapped numerical value</span>
<a id="__codelineno-7-55" name="__codelineno-7-55" href="#__codelineno-7-55"></a><span class="sd">        for each column) exists already, False Otherwise. (Default value = False)</span>
<a id="__codelineno-7-56" name="__codelineno-7-56" href="#__codelineno-7-56"></a><span class="sd">    model_path</span>
<a id="__codelineno-7-57" name="__codelineno-7-57" href="#__codelineno-7-57"></a><span class="sd">        If pre_existing_model is True, this argument is path for referring the pre-saved model.</span>
<a id="__codelineno-7-58" name="__codelineno-7-58" href="#__codelineno-7-58"></a><span class="sd">        If pre_existing_model is False, this argument can be used for saving the model.</span>
<a id="__codelineno-7-59" name="__codelineno-7-59" href="#__codelineno-7-59"></a><span class="sd">        Default &quot;NA&quot; is used to save the model in &quot;intermediate_data/&quot; folder for optimization purpose.</span>
<a id="__codelineno-7-60" name="__codelineno-7-60" href="#__codelineno-7-60"></a><span class="sd">    output_mode</span>
<a id="__codelineno-7-61" name="__codelineno-7-61" href="#__codelineno-7-61"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-7-62" name="__codelineno-7-62" href="#__codelineno-7-62"></a><span class="sd">        “replace” option replaces original columns with transformed column. “append” option append transformed</span>
<a id="__codelineno-7-63" name="__codelineno-7-63" href="#__codelineno-7-63"></a><span class="sd">        column to the input dataset with a postfix &quot;_encoded&quot; e.g. column X is appended as X_encoded. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-7-64" name="__codelineno-7-64" href="#__codelineno-7-64"></a><span class="sd">    persist</span>
<a id="__codelineno-7-65" name="__codelineno-7-65" href="#__codelineno-7-65"></a><span class="sd">        Boolean argument - True or False. This parameter is for optimization purpose. If True, repeatedly used dataframe</span>
<a id="__codelineno-7-66" name="__codelineno-7-66" href="#__codelineno-7-66"></a><span class="sd">        will be persisted (StorageLevel can be specified in persist_option). We recommend setting this parameter as True</span>
<a id="__codelineno-7-67" name="__codelineno-7-67" href="#__codelineno-7-67"></a><span class="sd">        if at least one of the following criteria is True:</span>
<a id="__codelineno-7-68" name="__codelineno-7-68" href="#__codelineno-7-68"></a><span class="sd">        (1) The underlying data source is in csv format</span>
<a id="__codelineno-7-69" name="__codelineno-7-69" href="#__codelineno-7-69"></a><span class="sd">        (2) The transformation will be applicable to most columns. (Default value = False)</span>
<a id="__codelineno-7-70" name="__codelineno-7-70" href="#__codelineno-7-70"></a><span class="sd">    persist_option</span>
<a id="__codelineno-7-71" name="__codelineno-7-71" href="#__codelineno-7-71"></a><span class="sd">        A pyspark.StorageLevel instance. This parameter is useful only when persist is True.</span>
<a id="__codelineno-7-72" name="__codelineno-7-72" href="#__codelineno-7-72"></a><span class="sd">        (Default value = pyspark.StorageLevel.MEMORY_AND_DISK)</span>
<a id="__codelineno-7-73" name="__codelineno-7-73" href="#__codelineno-7-73"></a><span class="sd">    print_impact</span>
<a id="__codelineno-7-74" name="__codelineno-7-74" href="#__codelineno-7-74"></a><span class="sd">        True, False (Default value = False)</span>
<a id="__codelineno-7-75" name="__codelineno-7-75" href="#__codelineno-7-75"></a><span class="sd">        This argument is to print out the descriptive statistics of encoded columns.</span>
<a id="__codelineno-7-76" name="__codelineno-7-76" href="#__codelineno-7-76"></a>
<a id="__codelineno-7-77" name="__codelineno-7-77" href="#__codelineno-7-77"></a><span class="sd">    Returns</span>
<a id="__codelineno-7-78" name="__codelineno-7-78" href="#__codelineno-7-78"></a><span class="sd">    -------</span>
<a id="__codelineno-7-79" name="__codelineno-7-79" href="#__codelineno-7-79"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-7-80" name="__codelineno-7-80" href="#__codelineno-7-80"></a><span class="sd">        Encoded Dataframe</span>
<a id="__codelineno-7-81" name="__codelineno-7-81" href="#__codelineno-7-81"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-7-82" name="__codelineno-7-82" href="#__codelineno-7-82"></a>
<a id="__codelineno-7-83" name="__codelineno-7-83" href="#__codelineno-7-83"></a>    <span class="n">cat_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-7-84" name="__codelineno-7-84" href="#__codelineno-7-84"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-7-85" name="__codelineno-7-85" href="#__codelineno-7-85"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">cat_cols</span>
<a id="__codelineno-7-86" name="__codelineno-7-86" href="#__codelineno-7-86"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-7-87" name="__codelineno-7-87" href="#__codelineno-7-87"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-7-88" name="__codelineno-7-88" href="#__codelineno-7-88"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-7-89" name="__codelineno-7-89" href="#__codelineno-7-89"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-7-90" name="__codelineno-7-90" href="#__codelineno-7-90"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
<a id="__codelineno-7-91" name="__codelineno-7-91" href="#__codelineno-7-91"></a>        <span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">e</span> <span class="o">!=</span> <span class="n">label_col</span><span class="p">)])</span>
<a id="__codelineno-7-92" name="__codelineno-7-92" href="#__codelineno-7-92"></a>    <span class="p">)</span>
<a id="__codelineno-7-93" name="__codelineno-7-93" href="#__codelineno-7-93"></a>
<a id="__codelineno-7-94" name="__codelineno-7-94" href="#__codelineno-7-94"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cat_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-7-95" name="__codelineno-7-95" href="#__codelineno-7-95"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-7-96" name="__codelineno-7-96" href="#__codelineno-7-96"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-7-97" name="__codelineno-7-97" href="#__codelineno-7-97"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No Categorical Encoding - No categorical column(s) to transform&quot;</span><span class="p">)</span>
<a id="__codelineno-7-98" name="__codelineno-7-98" href="#__codelineno-7-98"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-7-99" name="__codelineno-7-99" href="#__codelineno-7-99"></a>    <span class="k">if</span> <span class="n">label_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-7-100" name="__codelineno-7-100" href="#__codelineno-7-100"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Label Column&quot;</span><span class="p">)</span>
<a id="__codelineno-7-101" name="__codelineno-7-101" href="#__codelineno-7-101"></a>
<a id="__codelineno-7-102" name="__codelineno-7-102" href="#__codelineno-7-102"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-7-103" name="__codelineno-7-103" href="#__codelineno-7-103"></a>    <span class="n">label_col_bool</span> <span class="o">=</span> <span class="n">label_col</span> <span class="o">+</span> <span class="s2">&quot;_cat_to_num_sup_temp&quot;</span>
<a id="__codelineno-7-104" name="__codelineno-7-104" href="#__codelineno-7-104"></a>    <span class="n">idf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-7-105" name="__codelineno-7-105" href="#__codelineno-7-105"></a>        <span class="n">label_col_bool</span><span class="p">,</span>
<a id="__codelineno-7-106" name="__codelineno-7-106" href="#__codelineno-7-106"></a>        <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">label_col</span><span class="p">)</span> <span class="o">==</span> <span class="n">event_label</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">),</span>
<a id="__codelineno-7-107" name="__codelineno-7-107" href="#__codelineno-7-107"></a>    <span class="p">)</span>
<a id="__codelineno-7-108" name="__codelineno-7-108" href="#__codelineno-7-108"></a>
<a id="__codelineno-7-109" name="__codelineno-7-109" href="#__codelineno-7-109"></a>    <span class="k">if</span> <span class="n">model_path</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span>
<a id="__codelineno-7-110" name="__codelineno-7-110" href="#__codelineno-7-110"></a>        <span class="n">skip_if_error</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-7-111" name="__codelineno-7-111" href="#__codelineno-7-111"></a>        <span class="n">model_path</span> <span class="o">=</span> <span class="s2">&quot;intermediate_data&quot;</span>
<a id="__codelineno-7-112" name="__codelineno-7-112" href="#__codelineno-7-112"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-113" name="__codelineno-7-113" href="#__codelineno-7-113"></a>        <span class="n">skip_if_error</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-7-114" name="__codelineno-7-114" href="#__codelineno-7-114"></a>    <span class="n">save_model</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-7-115" name="__codelineno-7-115" href="#__codelineno-7-115"></a>
<a id="__codelineno-7-116" name="__codelineno-7-116" href="#__codelineno-7-116"></a>    <span class="k">if</span> <span class="n">persist</span><span class="p">:</span>
<a id="__codelineno-7-117" name="__codelineno-7-117" href="#__codelineno-7-117"></a>        <span class="n">idf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">persist</span><span class="p">(</span><span class="n">persist_option</span><span class="p">)</span>
<a id="__codelineno-7-118" name="__codelineno-7-118" href="#__codelineno-7-118"></a>    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-7-119" name="__codelineno-7-119" href="#__codelineno-7-119"></a>        <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-7-120" name="__codelineno-7-120" href="#__codelineno-7-120"></a>            <span class="n">df_tmp</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span>
<a id="__codelineno-7-121" name="__codelineno-7-121" href="#__codelineno-7-121"></a>                <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/cat_to_num_supervised/&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span>
<a id="__codelineno-7-122" name="__codelineno-7-122" href="#__codelineno-7-122"></a>                <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-7-123" name="__codelineno-7-123" href="#__codelineno-7-123"></a>                <span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-7-124" name="__codelineno-7-124" href="#__codelineno-7-124"></a>            <span class="p">)</span>
<a id="__codelineno-7-125" name="__codelineno-7-125" href="#__codelineno-7-125"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-126" name="__codelineno-7-126" href="#__codelineno-7-126"></a>            <span class="n">df_tmp</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-7-127" name="__codelineno-7-127" href="#__codelineno-7-127"></a>                <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">label_col_bool</span><span class="p">)</span>
<a id="__codelineno-7-128" name="__codelineno-7-128" href="#__codelineno-7-128"></a>                <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-7-129" name="__codelineno-7-129" href="#__codelineno-7-129"></a>                <span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">label_col_bool</span><span class="p">)</span>
<a id="__codelineno-7-130" name="__codelineno-7-130" href="#__codelineno-7-130"></a>                <span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-7-131" name="__codelineno-7-131" href="#__codelineno-7-131"></a>                <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-7-132" name="__codelineno-7-132" href="#__codelineno-7-132"></a>                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-7-133" name="__codelineno-7-133" href="#__codelineno-7-133"></a>                    <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_encoded&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)),</span> <span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-7-134" name="__codelineno-7-134" href="#__codelineno-7-134"></a>                <span class="p">)</span>
<a id="__codelineno-7-135" name="__codelineno-7-135" href="#__codelineno-7-135"></a>                <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">])</span>
<a id="__codelineno-7-136" name="__codelineno-7-136" href="#__codelineno-7-136"></a>            <span class="p">)</span>
<a id="__codelineno-7-137" name="__codelineno-7-137" href="#__codelineno-7-137"></a>
<a id="__codelineno-7-138" name="__codelineno-7-138" href="#__codelineno-7-138"></a>            <span class="k">if</span> <span class="n">save_model</span><span class="p">:</span>
<a id="__codelineno-7-139" name="__codelineno-7-139" href="#__codelineno-7-139"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-7-140" name="__codelineno-7-140" href="#__codelineno-7-140"></a>                    <span class="n">df_tmp</span><span class="o">.</span><span class="n">coalesce</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span>
<a id="__codelineno-7-141" name="__codelineno-7-141" href="#__codelineno-7-141"></a>                        <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/cat_to_num_supervised/&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span>
<a id="__codelineno-7-142" name="__codelineno-7-142" href="#__codelineno-7-142"></a>                        <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-7-143" name="__codelineno-7-143" href="#__codelineno-7-143"></a>                        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span><span class="p">,</span>
<a id="__codelineno-7-144" name="__codelineno-7-144" href="#__codelineno-7-144"></a>                        <span class="n">ignoreLeadingWhiteSpace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-7-145" name="__codelineno-7-145" href="#__codelineno-7-145"></a>                        <span class="n">ignoreTrailingWhiteSpace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-7-146" name="__codelineno-7-146" href="#__codelineno-7-146"></a>                    <span class="p">)</span>
<a id="__codelineno-7-147" name="__codelineno-7-147" href="#__codelineno-7-147"></a>                    <span class="n">df_tmp</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span>
<a id="__codelineno-7-148" name="__codelineno-7-148" href="#__codelineno-7-148"></a>                        <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/cat_to_num_supervised/&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span>
<a id="__codelineno-7-149" name="__codelineno-7-149" href="#__codelineno-7-149"></a>                        <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-7-150" name="__codelineno-7-150" href="#__codelineno-7-150"></a>                        <span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-7-151" name="__codelineno-7-151" href="#__codelineno-7-151"></a>                    <span class="p">)</span>
<a id="__codelineno-7-152" name="__codelineno-7-152" href="#__codelineno-7-152"></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
<a id="__codelineno-7-153" name="__codelineno-7-153" href="#__codelineno-7-153"></a>                    <span class="k">if</span> <span class="n">skip_if_error</span><span class="p">:</span>
<a id="__codelineno-7-154" name="__codelineno-7-154" href="#__codelineno-7-154"></a>                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-7-155" name="__codelineno-7-155" href="#__codelineno-7-155"></a>                            <span class="s2">&quot;For optimization purpose, we recommend specifying a valid model_path value to save the intermediate data. Saving to the default path - &#39;&quot;</span>
<a id="__codelineno-7-156" name="__codelineno-7-156" href="#__codelineno-7-156"></a>                            <span class="o">+</span> <span class="n">model_path</span>
<a id="__codelineno-7-157" name="__codelineno-7-157" href="#__codelineno-7-157"></a>                            <span class="o">+</span> <span class="s2">&quot;/cat_to_num_supervised/&quot;</span>
<a id="__codelineno-7-158" name="__codelineno-7-158" href="#__codelineno-7-158"></a>                            <span class="o">+</span> <span class="n">i</span>
<a id="__codelineno-7-159" name="__codelineno-7-159" href="#__codelineno-7-159"></a>                            <span class="o">+</span> <span class="s2">&quot;&#39; faced an error.&quot;</span>
<a id="__codelineno-7-160" name="__codelineno-7-160" href="#__codelineno-7-160"></a>                        <span class="p">)</span>
<a id="__codelineno-7-161" name="__codelineno-7-161" href="#__codelineno-7-161"></a>                        <span class="n">save_model</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-7-162" name="__codelineno-7-162" href="#__codelineno-7-162"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-163" name="__codelineno-7-163" href="#__codelineno-7-163"></a>                        <span class="k">raise</span> <span class="n">error</span>
<a id="__codelineno-7-164" name="__codelineno-7-164" href="#__codelineno-7-164"></a>
<a id="__codelineno-7-165" name="__codelineno-7-165" href="#__codelineno-7-165"></a>        <span class="k">if</span> <span class="n">df_tmp</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-7-166" name="__codelineno-7-166" href="#__codelineno-7-166"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;left_outer&quot;</span><span class="p">)</span>
<a id="__codelineno-7-167" name="__codelineno-7-167" href="#__codelineno-7-167"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-168" name="__codelineno-7-168" href="#__codelineno-7-168"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">crossJoin</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">)</span>
<a id="__codelineno-7-169" name="__codelineno-7-169" href="#__codelineno-7-169"></a>
<a id="__codelineno-7-170" name="__codelineno-7-170" href="#__codelineno-7-170"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-7-171" name="__codelineno-7-171" href="#__codelineno-7-171"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-7-172" name="__codelineno-7-172" href="#__codelineno-7-172"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_encoded&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-7-173" name="__codelineno-7-173" href="#__codelineno-7-173"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">label_col_bool</span><span class="p">])</span>
<a id="__codelineno-7-174" name="__codelineno-7-174" href="#__codelineno-7-174"></a>
<a id="__codelineno-7-175" name="__codelineno-7-175" href="#__codelineno-7-175"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-7-176" name="__codelineno-7-176" href="#__codelineno-7-176"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-7-177" name="__codelineno-7-177" href="#__codelineno-7-177"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="n">list_of_cols</span>
<a id="__codelineno-7-178" name="__codelineno-7-178" href="#__codelineno-7-178"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-179" name="__codelineno-7-179" href="#__codelineno-7-179"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_encoded&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">]</span>
<a id="__codelineno-7-180" name="__codelineno-7-180" href="#__codelineno-7-180"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before: &quot;</span><span class="p">)</span>
<a id="__codelineno-7-181" name="__codelineno-7-181" href="#__codelineno-7-181"></a>        <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-7-182" name="__codelineno-7-182" href="#__codelineno-7-182"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After: &quot;</span><span class="p">)</span>
<a id="__codelineno-7-183" name="__codelineno-7-183" href="#__codelineno-7-183"></a>        <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">output_cols</span><span class="p">)</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-7-184" name="__codelineno-7-184" href="#__codelineno-7-184"></a>
<a id="__codelineno-7-185" name="__codelineno-7-185" href="#__codelineno-7-185"></a>    <span class="k">if</span> <span class="n">persist</span><span class="p">:</span>
<a id="__codelineno-7-186" name="__codelineno-7-186" href="#__codelineno-7-186"></a>        <span class="n">idf</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
<a id="__codelineno-7-187" name="__codelineno-7-187" href="#__codelineno-7-187"></a>    <span class="k">return</span> <span class="n">odf</span>
</code></pre></div>
</pre>
</details>
</dd>
<dt id="anovos.data_transformer.transformers.cat_to_num_transformer"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">cat_to_num_transformer</span></span>(<span class="n">spark, idf, list_of_cols, drop_cols, method_type, encoding, label_col, event_label)</span>
</code></dt>
<dd>
<div class="desc"><p>This is method which helps converting a categorical attribute into numerical attribute(s) based on the analysis dataset. If there's a presence of label column then the relevant processing would happen through cat_to_num_supervised. However, for unsupervised scenario, the processing would happen through cat_to_num_unsupervised. Computation details can be referred from the respective functions.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>spark</code></strong></dt>
<dd>Spark Session</dd>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe</dd>
<dt><strong><code>list_of_cols</code></strong></dt>
<dd>List of categorical columns to transform e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
"all" can be passed to include all categorical columns for analysis. This is super useful instead of specifying all column names manually.
Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in
drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols.</dd>
<dt><strong><code>drop_cols</code></strong></dt>
<dd>List of columns to be dropped e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except
a few handful of them.</dd>
<dt><strong><code>method_type</code></strong></dt>
<dd>Depending upon the use case the method type can be either Supervised or Unsupervised. For Supervised use case, label_col is mandatory.</dd>
<dt><strong><code>encoding</code></strong></dt>
<dd>"label_encoding" or "onehot_encoding"
In label encoding, each categorical value is assigned a unique integer based on alphabetical
or frequency ordering (both ascending &amp; descending options are available that can be selected by index_order argument).
In one-hot encoding, every unique value in the column will be added in a form of dummy/binary column.</dd>
<dt><strong><code>label_col</code></strong></dt>
<dd>Label/Target column</dd>
<dt><strong><code>event_label</code></strong></dt>
<dd>Value of (positive) event</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">def</span> <span class="nf">cat_to_num_transformer</span><span class="p">(</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>    <span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">,</span> <span class="n">drop_cols</span><span class="p">,</span> <span class="n">method_type</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">label_col</span><span class="p">,</span> <span class="n">event_label</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="p">):</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="sd">    This is method which helps converting a categorical attribute into numerical attribute(s) based on the analysis dataset. If there&#39;s a presence of label column then the relevant processing would happen through cat_to_num_supervised. However, for unsupervised scenario, the processing would happen through cat_to_num_unsupervised. Computation details can be referred from the respective functions.</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="sd">    Parameters</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="sd">    ----------</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="sd">    spark</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="sd">    idf</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="sd">        List of categorical columns to transform e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="sd">        &quot;all&quot; can be passed to include all categorical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols.</span>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="sd">        a few handful of them.</span>
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="sd">    method_type</span>
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a><span class="sd">        Depending upon the use case the method type can be either Supervised or Unsupervised. For Supervised use case, label_col is mandatory.</span>
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="sd">    encoding</span>
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a><span class="sd">        &quot;label_encoding&quot; or &quot;onehot_encoding&quot;</span>
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="sd">        In label encoding, each categorical value is assigned a unique integer based on alphabetical</span>
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a><span class="sd">        or frequency ordering (both ascending &amp; descending options are available that can be selected by index_order argument).</span>
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a><span class="sd">        In one-hot encoding, every unique value in the column will be added in a form of dummy/binary column.</span>
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a><span class="sd">    label_col</span>
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="sd">        Label/Target column</span>
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a><span class="sd">    event_label</span>
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a><span class="sd">        Value of (positive) event</span>
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a>
<a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a>    <span class="n">num_cols</span><span class="p">,</span> <span class="n">cat_cols</span><span class="p">,</span> <span class="n">other_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)</span>
<a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a>
<a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cat_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a>        <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a>            <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">cat_cols</span>
<a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a>            <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a>            <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-8-49" name="__codelineno-8-49" href="#__codelineno-8-49"></a>
<a id="__codelineno-8-50" name="__codelineno-8-50" href="#__codelineno-8-50"></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cat_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-8-51" name="__codelineno-8-51" href="#__codelineno-8-51"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-8-52" name="__codelineno-8-52" href="#__codelineno-8-52"></a>
<a id="__codelineno-8-53" name="__codelineno-8-53" href="#__codelineno-8-53"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">method_type</span> <span class="o">==</span> <span class="s2">&quot;supervised&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">label_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-8-54" name="__codelineno-8-54" href="#__codelineno-8-54"></a>
<a id="__codelineno-8-55" name="__codelineno-8-55" href="#__codelineno-8-55"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">cat_to_num_supervised</span><span class="p">(</span>
<a id="__codelineno-8-56" name="__codelineno-8-56" href="#__codelineno-8-56"></a>                <span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">label_col</span><span class="o">=</span><span class="n">label_col</span><span class="p">,</span> <span class="n">event_label</span><span class="o">=</span><span class="n">event_label</span>
<a id="__codelineno-8-57" name="__codelineno-8-57" href="#__codelineno-8-57"></a>            <span class="p">)</span>
<a id="__codelineno-8-58" name="__codelineno-8-58" href="#__codelineno-8-58"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-8-59" name="__codelineno-8-59" href="#__codelineno-8-59"></a>                <span class="n">label_col</span><span class="p">,</span>
<a id="__codelineno-8-60" name="__codelineno-8-60" href="#__codelineno-8-60"></a>                <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">label_col</span><span class="p">)</span> <span class="o">==</span> <span class="n">event_label</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>
<a id="__codelineno-8-61" name="__codelineno-8-61" href="#__codelineno-8-61"></a>            <span class="p">)</span>
<a id="__codelineno-8-62" name="__codelineno-8-62" href="#__codelineno-8-62"></a>
<a id="__codelineno-8-63" name="__codelineno-8-63" href="#__codelineno-8-63"></a>            <span class="k">return</span> <span class="n">odf</span>
<a id="__codelineno-8-64" name="__codelineno-8-64" href="#__codelineno-8-64"></a>
<a id="__codelineno-8-65" name="__codelineno-8-65" href="#__codelineno-8-65"></a>        <span class="k">elif</span> <span class="p">(</span><span class="n">method_type</span> <span class="o">==</span> <span class="s2">&quot;unsupervised&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">label_col</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-8-66" name="__codelineno-8-66" href="#__codelineno-8-66"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">cat_to_num_unsupervised</span><span class="p">(</span>
<a id="__codelineno-8-67" name="__codelineno-8-67" href="#__codelineno-8-67"></a>                <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-8-68" name="__codelineno-8-68" href="#__codelineno-8-68"></a>                <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-8-69" name="__codelineno-8-69" href="#__codelineno-8-69"></a>                <span class="n">method_type</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
<a id="__codelineno-8-70" name="__codelineno-8-70" href="#__codelineno-8-70"></a>                <span class="n">index_order</span><span class="o">=</span><span class="s2">&quot;frequencyDesc&quot;</span><span class="p">,</span>
<a id="__codelineno-8-71" name="__codelineno-8-71" href="#__codelineno-8-71"></a>            <span class="p">)</span>
<a id="__codelineno-8-72" name="__codelineno-8-72" href="#__codelineno-8-72"></a>
<a id="__codelineno-8-73" name="__codelineno-8-73" href="#__codelineno-8-73"></a>            <span class="k">return</span> <span class="n">odf</span>
<a id="__codelineno-8-74" name="__codelineno-8-74" href="#__codelineno-8-74"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-8-75" name="__codelineno-8-75" href="#__codelineno-8-75"></a>
<a id="__codelineno-8-76" name="__codelineno-8-76" href="#__codelineno-8-76"></a>        <span class="k">return</span> <span class="n">idf</span>
</code></pre></div>
</pre>
</details>
</dd>
<dt id="anovos.data_transformer.transformers.cat_to_num_unsupervised"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">cat_to_num_unsupervised</span></span>(<span class="n">spark, idf, list_of_cols='all', drop_cols=[], method_type='label_encoding', index_order='frequencyDesc', cardinality_threshold=50, pre_existing_model=False, model_path='NA', stats_unique={}, output_mode='replace', print_impact=False)</span>
</code></dt>
<dd>
<div class="desc"><p>This is unsupervised method of converting a categorical attribute into numerical attribute(s). This is among
the most important transformations required for any modelling exercise, as most of the machine learning
algorithms cannot process categorical values. It covers two popular encoding techniques – label encoding &amp;
one-hot encoding.</p>
<p>In label encoding, each categorical value is assigned a unique integer based on alphabetical or frequency
ordering (both ascending &amp; descending options are available – can be selected by index_order argument). One of
the pitfalls of using this technique is that the model may learn some spurious relationship, which doesn't exist
or might not make any logical sense in the real world settings. In one-hot encoding, every unique value in the
attribute will be added as a feature in a form of dummy/binary attribute. However, using this method on high
cardinality attributes can further aggravate the dimensionality issue.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>spark</code></strong></dt>
<dd>Spark Session</dd>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe</dd>
<dt><strong><code>list_of_cols</code></strong></dt>
<dd>List of categorical columns to transform e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
"all" can be passed to include all categorical columns for analysis. This is super useful instead of specifying all column names manually.
Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in
drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = "all")</dd>
<dt><strong><code>drop_cols</code></strong></dt>
<dd>List of columns to be dropped e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except
a few handful of them. (Default value = [])</dd>
<dt><strong><code>method_type</code></strong></dt>
<dd>"label_encoding" or "onehot_encoding"
In label encoding, each categorical value is assigned a unique integer based on alphabetical
or frequency ordering (both ascending &amp; descending options are available that can be selected by index_order argument).
In one-hot encoding, every unique value in the column will be added in a form of dummy/binary column. (Default value = 1)</dd>
<dt><strong><code>index_order</code></strong></dt>
<dd>"frequencyDesc", "frequencyAsc", "alphabetDesc", "alphabetAsc".
Valid only for Label Encoding method_type. (Default value = "frequencyDesc")</dd>
<dt><strong><code>cardinality_threshold</code></strong></dt>
<dd>Defines threshold to skip columns with higher cardinality values from encoding - a warning is issued. (Default value = 50)</dd>
<dt><strong><code>pre_existing_model</code></strong></dt>
<dd>Boolean argument - True or False. True if encoding model exists already, False Otherwise. (Default value = False)</dd>
<dt><strong><code>model_path</code></strong></dt>
<dd>If pre_existing_model is True, this argument is path for referring the pre-saved model.
If pre_existing_model is False, this argument can be used for saving the model.
Default "NA" means there is neither pre existing model nor there is a need to save one.</dd>
<dt><strong><code>stats_unique</code></strong></dt>
<dd>Takes arguments for read_dataset (data_ingest module) function in a dictionary format
to read pre-saved statistics on unique value count i.e. if measures_of_cardinality or
uniqueCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</dd>
<dt><strong><code>output_mode</code></strong></dt>
<dd>"replace", "append".
“replace” option replaces original columns with transformed column. “append” option append transformed
column to the input dataset with a postfix "<em n>index" for label encoding e.g. column X is appended as X_index, or
a postfix "</em>" for one hot encoding, n varies from 0 to unique value count e.g. column X is appended as X_0,
X_1, X_2 (n = 3 i.e. no. of unique values for X). (Default value = "replace")</dd>
<dt><strong><code>print_impact</code></strong></dt>
<dd>True, False (Default value = False)
This argument is to print out the change in schema (one hot encoding) or descriptive statistics (label encoding)</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>DataFrame</code></dt>
<dd>Encoded Dataframe</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">def</span> <span class="nf">cat_to_num_unsupervised</span><span class="p">(</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>    <span class="n">method_type</span><span class="o">=</span><span class="s2">&quot;label_encoding&quot;</span><span class="p">,</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>    <span class="n">index_order</span><span class="o">=</span><span class="s2">&quot;frequencyDesc&quot;</span><span class="p">,</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>    <span class="n">cardinality_threshold</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>    <span class="n">pre_existing_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>    <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>    <span class="n">stats_unique</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="p">):</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="sd">    This is unsupervised method of converting a categorical attribute into numerical attribute(s). This is among</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="sd">    the most important transformations required for any modelling exercise, as most of the machine learning</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="sd">    algorithms cannot process categorical values. It covers two popular encoding techniques – label encoding &amp;</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="sd">    one-hot encoding.</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="sd">    In label encoding, each categorical value is assigned a unique integer based on alphabetical or frequency</span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="sd">    ordering (both ascending &amp; descending options are available – can be selected by index_order argument). One of</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="sd">    the pitfalls of using this technique is that the model may learn some spurious relationship, which doesn&#39;t exist</span>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="sd">    or might not make any logical sense in the real world settings. In one-hot encoding, every unique value in the</span>
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="sd">    attribute will be added as a feature in a form of dummy/binary attribute. However, using this method on high</span>
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a><span class="sd">    cardinality attributes can further aggravate the dimensionality issue.</span>
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a><span class="sd">    Parameters</span>
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a><span class="sd">    ----------</span>
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a><span class="sd">    spark</span>
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a><span class="sd">    idf</span>
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a><span class="sd">        List of categorical columns to transform e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a><span class="sd">        &quot;all&quot; can be passed to include all categorical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a><span class="sd">    method_type</span>
<a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a><span class="sd">        &quot;label_encoding&quot; or &quot;onehot_encoding&quot;</span>
<a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a><span class="sd">        In label encoding, each categorical value is assigned a unique integer based on alphabetical</span>
<a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a><span class="sd">        or frequency ordering (both ascending &amp; descending options are available that can be selected by index_order argument).</span>
<a id="__codelineno-9-51" name="__codelineno-9-51" href="#__codelineno-9-51"></a><span class="sd">        In one-hot encoding, every unique value in the column will be added in a form of dummy/binary column. (Default value = 1)</span>
<a id="__codelineno-9-52" name="__codelineno-9-52" href="#__codelineno-9-52"></a><span class="sd">    index_order</span>
<a id="__codelineno-9-53" name="__codelineno-9-53" href="#__codelineno-9-53"></a><span class="sd">        &quot;frequencyDesc&quot;, &quot;frequencyAsc&quot;, &quot;alphabetDesc&quot;, &quot;alphabetAsc&quot;.</span>
<a id="__codelineno-9-54" name="__codelineno-9-54" href="#__codelineno-9-54"></a><span class="sd">        Valid only for Label Encoding method_type. (Default value = &quot;frequencyDesc&quot;)</span>
<a id="__codelineno-9-55" name="__codelineno-9-55" href="#__codelineno-9-55"></a><span class="sd">    cardinality_threshold</span>
<a id="__codelineno-9-56" name="__codelineno-9-56" href="#__codelineno-9-56"></a><span class="sd">        Defines threshold to skip columns with higher cardinality values from encoding - a warning is issued. (Default value = 50)</span>
<a id="__codelineno-9-57" name="__codelineno-9-57" href="#__codelineno-9-57"></a><span class="sd">    pre_existing_model</span>
<a id="__codelineno-9-58" name="__codelineno-9-58" href="#__codelineno-9-58"></a><span class="sd">        Boolean argument - True or False. True if encoding model exists already, False Otherwise. (Default value = False)</span>
<a id="__codelineno-9-59" name="__codelineno-9-59" href="#__codelineno-9-59"></a><span class="sd">    model_path</span>
<a id="__codelineno-9-60" name="__codelineno-9-60" href="#__codelineno-9-60"></a><span class="sd">        If pre_existing_model is True, this argument is path for referring the pre-saved model.</span>
<a id="__codelineno-9-61" name="__codelineno-9-61" href="#__codelineno-9-61"></a><span class="sd">        If pre_existing_model is False, this argument can be used for saving the model.</span>
<a id="__codelineno-9-62" name="__codelineno-9-62" href="#__codelineno-9-62"></a><span class="sd">        Default &quot;NA&quot; means there is neither pre existing model nor there is a need to save one.</span>
<a id="__codelineno-9-63" name="__codelineno-9-63" href="#__codelineno-9-63"></a><span class="sd">    stats_unique</span>
<a id="__codelineno-9-64" name="__codelineno-9-64" href="#__codelineno-9-64"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-9-65" name="__codelineno-9-65" href="#__codelineno-9-65"></a><span class="sd">        to read pre-saved statistics on unique value count i.e. if measures_of_cardinality or</span>
<a id="__codelineno-9-66" name="__codelineno-9-66" href="#__codelineno-9-66"></a><span class="sd">        uniqueCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-9-67" name="__codelineno-9-67" href="#__codelineno-9-67"></a><span class="sd">    output_mode</span>
<a id="__codelineno-9-68" name="__codelineno-9-68" href="#__codelineno-9-68"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-9-69" name="__codelineno-9-69" href="#__codelineno-9-69"></a><span class="sd">        “replace” option replaces original columns with transformed column. “append” option append transformed</span>
<a id="__codelineno-9-70" name="__codelineno-9-70" href="#__codelineno-9-70"></a><span class="sd">        column to the input dataset with a postfix &quot;_index&quot; for label encoding e.g. column X is appended as X_index, or</span>
<a id="__codelineno-9-71" name="__codelineno-9-71" href="#__codelineno-9-71"></a><span class="sd">        a postfix &quot;_{n}&quot; for one hot encoding, n varies from 0 to unique value count e.g. column X is appended as X_0,</span>
<a id="__codelineno-9-72" name="__codelineno-9-72" href="#__codelineno-9-72"></a><span class="sd">        X_1, X_2 (n = 3 i.e. no. of unique values for X). (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-9-73" name="__codelineno-9-73" href="#__codelineno-9-73"></a><span class="sd">    print_impact</span>
<a id="__codelineno-9-74" name="__codelineno-9-74" href="#__codelineno-9-74"></a><span class="sd">        True, False (Default value = False)</span>
<a id="__codelineno-9-75" name="__codelineno-9-75" href="#__codelineno-9-75"></a><span class="sd">        This argument is to print out the change in schema (one hot encoding) or descriptive statistics (label encoding)</span>
<a id="__codelineno-9-76" name="__codelineno-9-76" href="#__codelineno-9-76"></a>
<a id="__codelineno-9-77" name="__codelineno-9-77" href="#__codelineno-9-77"></a><span class="sd">    Returns</span>
<a id="__codelineno-9-78" name="__codelineno-9-78" href="#__codelineno-9-78"></a><span class="sd">    -------</span>
<a id="__codelineno-9-79" name="__codelineno-9-79" href="#__codelineno-9-79"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-9-80" name="__codelineno-9-80" href="#__codelineno-9-80"></a><span class="sd">        Encoded Dataframe</span>
<a id="__codelineno-9-81" name="__codelineno-9-81" href="#__codelineno-9-81"></a>
<a id="__codelineno-9-82" name="__codelineno-9-82" href="#__codelineno-9-82"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-9-83" name="__codelineno-9-83" href="#__codelineno-9-83"></a>
<a id="__codelineno-9-84" name="__codelineno-9-84" href="#__codelineno-9-84"></a>    <span class="n">cat_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-9-85" name="__codelineno-9-85" href="#__codelineno-9-85"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-9-86" name="__codelineno-9-86" href="#__codelineno-9-86"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">cat_cols</span>
<a id="__codelineno-9-87" name="__codelineno-9-87" href="#__codelineno-9-87"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-9-88" name="__codelineno-9-88" href="#__codelineno-9-88"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-9-89" name="__codelineno-9-89" href="#__codelineno-9-89"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-9-90" name="__codelineno-9-90" href="#__codelineno-9-90"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-9-91" name="__codelineno-9-91" href="#__codelineno-9-91"></a>
<a id="__codelineno-9-92" name="__codelineno-9-92" href="#__codelineno-9-92"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cat_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-9-93" name="__codelineno-9-93" href="#__codelineno-9-93"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-9-94" name="__codelineno-9-94" href="#__codelineno-9-94"></a>
<a id="__codelineno-9-95" name="__codelineno-9-95" href="#__codelineno-9-95"></a>    <span class="k">if</span> <span class="n">method_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;onehot_encoding&quot;</span><span class="p">,</span> <span class="s2">&quot;label_encoding&quot;</span><span class="p">):</span>
<a id="__codelineno-9-96" name="__codelineno-9-96" href="#__codelineno-9-96"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for method_type&quot;</span><span class="p">)</span>
<a id="__codelineno-9-97" name="__codelineno-9-97" href="#__codelineno-9-97"></a>    <span class="k">if</span> <span class="n">index_order</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
<a id="__codelineno-9-98" name="__codelineno-9-98" href="#__codelineno-9-98"></a>        <span class="s2">&quot;frequencyDesc&quot;</span><span class="p">,</span>
<a id="__codelineno-9-99" name="__codelineno-9-99" href="#__codelineno-9-99"></a>        <span class="s2">&quot;frequencyAsc&quot;</span><span class="p">,</span>
<a id="__codelineno-9-100" name="__codelineno-9-100" href="#__codelineno-9-100"></a>        <span class="s2">&quot;alphabetDesc&quot;</span><span class="p">,</span>
<a id="__codelineno-9-101" name="__codelineno-9-101" href="#__codelineno-9-101"></a>        <span class="s2">&quot;alphabetAsc&quot;</span><span class="p">,</span>
<a id="__codelineno-9-102" name="__codelineno-9-102" href="#__codelineno-9-102"></a>    <span class="p">):</span>
<a id="__codelineno-9-103" name="__codelineno-9-103" href="#__codelineno-9-103"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Encoding Index Order&quot;</span><span class="p">)</span>
<a id="__codelineno-9-104" name="__codelineno-9-104" href="#__codelineno-9-104"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">):</span>
<a id="__codelineno-9-105" name="__codelineno-9-105" href="#__codelineno-9-105"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for output_mode&quot;</span><span class="p">)</span>
<a id="__codelineno-9-106" name="__codelineno-9-106" href="#__codelineno-9-106"></a>
<a id="__codelineno-9-107" name="__codelineno-9-107" href="#__codelineno-9-107"></a>    <span class="k">if</span> <span class="n">stats_unique</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-9-108" name="__codelineno-9-108" href="#__codelineno-9-108"></a>        <span class="n">skip_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-9-109" name="__codelineno-9-109" href="#__codelineno-9-109"></a>            <span class="n">uniqueCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-9-110" name="__codelineno-9-110" href="#__codelineno-9-110"></a>            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;unique_values&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">cardinality_threshold</span><span class="p">)</span>
<a id="__codelineno-9-111" name="__codelineno-9-111" href="#__codelineno-9-111"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-9-112" name="__codelineno-9-112" href="#__codelineno-9-112"></a>            <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-9-113" name="__codelineno-9-113" href="#__codelineno-9-113"></a>            <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-9-114" name="__codelineno-9-114" href="#__codelineno-9-114"></a>        <span class="p">)</span>
<a id="__codelineno-9-115" name="__codelineno-9-115" href="#__codelineno-9-115"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-9-116" name="__codelineno-9-116" href="#__codelineno-9-116"></a>        <span class="n">skip_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-9-117" name="__codelineno-9-117" href="#__codelineno-9-117"></a>            <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_unique</span><span class="p">)</span>
<a id="__codelineno-9-118" name="__codelineno-9-118" href="#__codelineno-9-118"></a>            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;unique_values&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">cardinality_threshold</span><span class="p">)</span>
<a id="__codelineno-9-119" name="__codelineno-9-119" href="#__codelineno-9-119"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-9-120" name="__codelineno-9-120" href="#__codelineno-9-120"></a>            <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-9-121" name="__codelineno-9-121" href="#__codelineno-9-121"></a>            <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-9-122" name="__codelineno-9-122" href="#__codelineno-9-122"></a>        <span class="p">)</span>
<a id="__codelineno-9-123" name="__codelineno-9-123" href="#__codelineno-9-123"></a>    <span class="n">skip_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
<a id="__codelineno-9-124" name="__codelineno-9-124" href="#__codelineno-9-124"></a>        <span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">skip_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="ow">and</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">])</span>
<a id="__codelineno-9-125" name="__codelineno-9-125" href="#__codelineno-9-125"></a>    <span class="p">)</span>
<a id="__codelineno-9-126" name="__codelineno-9-126" href="#__codelineno-9-126"></a>
<a id="__codelineno-9-127" name="__codelineno-9-127" href="#__codelineno-9-127"></a>    <span class="k">if</span> <span class="n">skip_cols</span><span class="p">:</span>
<a id="__codelineno-9-128" name="__codelineno-9-128" href="#__codelineno-9-128"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-9-129" name="__codelineno-9-129" href="#__codelineno-9-129"></a>            <span class="s2">&quot;Columns dropped from encoding due to high cardinality: &quot;</span>
<a id="__codelineno-9-130" name="__codelineno-9-130" href="#__codelineno-9-130"></a>            <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">skip_cols</span><span class="p">)</span>
<a id="__codelineno-9-131" name="__codelineno-9-131" href="#__codelineno-9-131"></a>        <span class="p">)</span>
<a id="__codelineno-9-132" name="__codelineno-9-132" href="#__codelineno-9-132"></a>
<a id="__codelineno-9-133" name="__codelineno-9-133" href="#__codelineno-9-133"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
<a id="__codelineno-9-134" name="__codelineno-9-134" href="#__codelineno-9-134"></a>        <span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span> <span class="o">+</span> <span class="n">skip_cols</span><span class="p">])</span>
<a id="__codelineno-9-135" name="__codelineno-9-135" href="#__codelineno-9-135"></a>    <span class="p">)</span>
<a id="__codelineno-9-136" name="__codelineno-9-136" href="#__codelineno-9-136"></a>
<a id="__codelineno-9-137" name="__codelineno-9-137" href="#__codelineno-9-137"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-9-138" name="__codelineno-9-138" href="#__codelineno-9-138"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No Encoding Computation - No categorical column(s) to transform&quot;</span><span class="p">)</span>
<a id="__codelineno-9-139" name="__codelineno-9-139" href="#__codelineno-9-139"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-9-140" name="__codelineno-9-140" href="#__codelineno-9-140"></a>
<a id="__codelineno-9-141" name="__codelineno-9-141" href="#__codelineno-9-141"></a>    <span class="n">list_of_cols_vec</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-9-142" name="__codelineno-9-142" href="#__codelineno-9-142"></a>    <span class="n">list_of_cols_idx</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-9-143" name="__codelineno-9-143" href="#__codelineno-9-143"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-9-144" name="__codelineno-9-144" href="#__codelineno-9-144"></a>        <span class="n">list_of_cols_vec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_vec&quot;</span><span class="p">)</span>
<a id="__codelineno-9-145" name="__codelineno-9-145" href="#__codelineno-9-145"></a>        <span class="n">list_of_cols_idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_index&quot;</span><span class="p">)</span>
<a id="__codelineno-9-146" name="__codelineno-9-146" href="#__codelineno-9-146"></a>
<a id="__codelineno-9-147" name="__codelineno-9-147" href="#__codelineno-9-147"></a>    <span class="n">odf_indexed</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-9-148" name="__codelineno-9-148" href="#__codelineno-9-148"></a>    <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">pyspark</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;3.0.0&quot;</span><span class="p">):</span>
<a id="__codelineno-9-149" name="__codelineno-9-149" href="#__codelineno-9-149"></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-9-150" name="__codelineno-9-150" href="#__codelineno-9-150"></a>            <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-9-151" name="__codelineno-9-151" href="#__codelineno-9-151"></a>                <span class="n">indexerModel</span> <span class="o">=</span> <span class="n">StringIndexerModel</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
<a id="__codelineno-9-152" name="__codelineno-9-152" href="#__codelineno-9-152"></a>                    <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/cat_to_num_unsupervised/indexer-model/&quot;</span> <span class="o">+</span> <span class="n">i</span>
<a id="__codelineno-9-153" name="__codelineno-9-153" href="#__codelineno-9-153"></a>                <span class="p">)</span>
<a id="__codelineno-9-154" name="__codelineno-9-154" href="#__codelineno-9-154"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-9-155" name="__codelineno-9-155" href="#__codelineno-9-155"></a>                <span class="n">stringIndexer</span> <span class="o">=</span> <span class="n">StringIndexer</span><span class="p">(</span>
<a id="__codelineno-9-156" name="__codelineno-9-156" href="#__codelineno-9-156"></a>                    <span class="n">inputCol</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
<a id="__codelineno-9-157" name="__codelineno-9-157" href="#__codelineno-9-157"></a>                    <span class="n">outputCol</span><span class="o">=</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_index&quot;</span><span class="p">,</span>
<a id="__codelineno-9-158" name="__codelineno-9-158" href="#__codelineno-9-158"></a>                    <span class="n">stringOrderType</span><span class="o">=</span><span class="n">index_order</span><span class="p">,</span>
<a id="__codelineno-9-159" name="__codelineno-9-159" href="#__codelineno-9-159"></a>                    <span class="n">handleInvalid</span><span class="o">=</span><span class="s2">&quot;keep&quot;</span><span class="p">,</span>
<a id="__codelineno-9-160" name="__codelineno-9-160" href="#__codelineno-9-160"></a>                <span class="p">)</span>
<a id="__codelineno-9-161" name="__codelineno-9-161" href="#__codelineno-9-161"></a>                <span class="n">indexerModel</span> <span class="o">=</span> <span class="n">stringIndexer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a id="__codelineno-9-162" name="__codelineno-9-162" href="#__codelineno-9-162"></a>
<a id="__codelineno-9-163" name="__codelineno-9-163" href="#__codelineno-9-163"></a>                <span class="k">if</span> <span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span>
<a id="__codelineno-9-164" name="__codelineno-9-164" href="#__codelineno-9-164"></a>                    <span class="n">indexerModel</span><span class="o">.</span><span class="n">write</span><span class="p">()</span><span class="o">.</span><span class="n">overwrite</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
<a id="__codelineno-9-165" name="__codelineno-9-165" href="#__codelineno-9-165"></a>                        <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/cat_to_num_unsupervised/indexer-model/&quot;</span> <span class="o">+</span> <span class="n">i</span>
<a id="__codelineno-9-166" name="__codelineno-9-166" href="#__codelineno-9-166"></a>                    <span class="p">)</span>
<a id="__codelineno-9-167" name="__codelineno-9-167" href="#__codelineno-9-167"></a>
<a id="__codelineno-9-168" name="__codelineno-9-168" href="#__codelineno-9-168"></a>            <span class="n">odf_indexed</span> <span class="o">=</span> <span class="n">indexerModel</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">odf_indexed</span><span class="p">)</span>
<a id="__codelineno-9-169" name="__codelineno-9-169" href="#__codelineno-9-169"></a>
<a id="__codelineno-9-170" name="__codelineno-9-170" href="#__codelineno-9-170"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-9-171" name="__codelineno-9-171" href="#__codelineno-9-171"></a>        <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-9-172" name="__codelineno-9-172" href="#__codelineno-9-172"></a>            <span class="n">indexerModel</span> <span class="o">=</span> <span class="n">StringIndexerModel</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
<a id="__codelineno-9-173" name="__codelineno-9-173" href="#__codelineno-9-173"></a>                <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/cat_to_num_unsupervised/indexer&quot;</span>
<a id="__codelineno-9-174" name="__codelineno-9-174" href="#__codelineno-9-174"></a>            <span class="p">)</span>
<a id="__codelineno-9-175" name="__codelineno-9-175" href="#__codelineno-9-175"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-9-176" name="__codelineno-9-176" href="#__codelineno-9-176"></a>            <span class="n">stringIndexer</span> <span class="o">=</span> <span class="n">StringIndexer</span><span class="p">(</span>
<a id="__codelineno-9-177" name="__codelineno-9-177" href="#__codelineno-9-177"></a>                <span class="n">inputCols</span><span class="o">=</span><span class="n">list_of_cols</span><span class="p">,</span>
<a id="__codelineno-9-178" name="__codelineno-9-178" href="#__codelineno-9-178"></a>                <span class="n">outputCols</span><span class="o">=</span><span class="n">list_of_cols_idx</span><span class="p">,</span>
<a id="__codelineno-9-179" name="__codelineno-9-179" href="#__codelineno-9-179"></a>                <span class="n">stringOrderType</span><span class="o">=</span><span class="n">index_order</span><span class="p">,</span>
<a id="__codelineno-9-180" name="__codelineno-9-180" href="#__codelineno-9-180"></a>                <span class="n">handleInvalid</span><span class="o">=</span><span class="s2">&quot;keep&quot;</span><span class="p">,</span>
<a id="__codelineno-9-181" name="__codelineno-9-181" href="#__codelineno-9-181"></a>            <span class="p">)</span>
<a id="__codelineno-9-182" name="__codelineno-9-182" href="#__codelineno-9-182"></a>            <span class="n">indexerModel</span> <span class="o">=</span> <span class="n">stringIndexer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">odf_indexed</span><span class="p">)</span>
<a id="__codelineno-9-183" name="__codelineno-9-183" href="#__codelineno-9-183"></a>            <span class="k">if</span> <span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span>
<a id="__codelineno-9-184" name="__codelineno-9-184" href="#__codelineno-9-184"></a>                <span class="n">indexerModel</span><span class="o">.</span><span class="n">write</span><span class="p">()</span><span class="o">.</span><span class="n">overwrite</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
<a id="__codelineno-9-185" name="__codelineno-9-185" href="#__codelineno-9-185"></a>                    <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/cat_to_num_unsupervised/indexer&quot;</span>
<a id="__codelineno-9-186" name="__codelineno-9-186" href="#__codelineno-9-186"></a>                <span class="p">)</span>
<a id="__codelineno-9-187" name="__codelineno-9-187" href="#__codelineno-9-187"></a>        <span class="n">odf_indexed</span> <span class="o">=</span> <span class="n">indexerModel</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">odf_indexed</span><span class="p">)</span>
<a id="__codelineno-9-188" name="__codelineno-9-188" href="#__codelineno-9-188"></a>
<a id="__codelineno-9-189" name="__codelineno-9-189" href="#__codelineno-9-189"></a>    <span class="k">if</span> <span class="n">method_type</span> <span class="o">==</span> <span class="s2">&quot;onehot_encoding&quot;</span><span class="p">:</span>
<a id="__codelineno-9-190" name="__codelineno-9-190" href="#__codelineno-9-190"></a>        <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-9-191" name="__codelineno-9-191" href="#__codelineno-9-191"></a>            <span class="n">encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
<a id="__codelineno-9-192" name="__codelineno-9-192" href="#__codelineno-9-192"></a>                <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/cat_to_num_unsupervised/encoder&quot;</span>
<a id="__codelineno-9-193" name="__codelineno-9-193" href="#__codelineno-9-193"></a>            <span class="p">)</span>
<a id="__codelineno-9-194" name="__codelineno-9-194" href="#__codelineno-9-194"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-9-195" name="__codelineno-9-195" href="#__codelineno-9-195"></a>            <span class="n">encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span>
<a id="__codelineno-9-196" name="__codelineno-9-196" href="#__codelineno-9-196"></a>                <span class="n">inputCols</span><span class="o">=</span><span class="n">list_of_cols_idx</span><span class="p">,</span>
<a id="__codelineno-9-197" name="__codelineno-9-197" href="#__codelineno-9-197"></a>                <span class="n">outputCols</span><span class="o">=</span><span class="n">list_of_cols_vec</span><span class="p">,</span>
<a id="__codelineno-9-198" name="__codelineno-9-198" href="#__codelineno-9-198"></a>                <span class="n">handleInvalid</span><span class="o">=</span><span class="s2">&quot;keep&quot;</span><span class="p">,</span>
<a id="__codelineno-9-199" name="__codelineno-9-199" href="#__codelineno-9-199"></a>            <span class="p">)</span>
<a id="__codelineno-9-200" name="__codelineno-9-200" href="#__codelineno-9-200"></a>            <span class="k">if</span> <span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span>
<a id="__codelineno-9-201" name="__codelineno-9-201" href="#__codelineno-9-201"></a>                <span class="n">encoder</span><span class="o">.</span><span class="n">write</span><span class="p">()</span><span class="o">.</span><span class="n">overwrite</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
<a id="__codelineno-9-202" name="__codelineno-9-202" href="#__codelineno-9-202"></a>                    <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/cat_to_num_unsupervised/encoder&quot;</span>
<a id="__codelineno-9-203" name="__codelineno-9-203" href="#__codelineno-9-203"></a>                <span class="p">)</span>
<a id="__codelineno-9-204" name="__codelineno-9-204" href="#__codelineno-9-204"></a>
<a id="__codelineno-9-205" name="__codelineno-9-205" href="#__codelineno-9-205"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">odf_indexed</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">odf_indexed</span><span class="p">)</span>
<a id="__codelineno-9-206" name="__codelineno-9-206" href="#__codelineno-9-206"></a>
<a id="__codelineno-9-207" name="__codelineno-9-207" href="#__codelineno-9-207"></a>        <span class="n">new_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-9-208" name="__codelineno-9-208" href="#__codelineno-9-208"></a>        <span class="n">odf_sample</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-9-209" name="__codelineno-9-209" href="#__codelineno-9-209"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-9-210" name="__codelineno-9-210" href="#__codelineno-9-210"></a>            <span class="n">odf_schema</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">schema</span>
<a id="__codelineno-9-211" name="__codelineno-9-211" href="#__codelineno-9-211"></a>            <span class="n">uniq_cats</span> <span class="o">=</span> <span class="n">odf_sample</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asDict</span><span class="p">()[</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_vec&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
<a id="__codelineno-9-212" name="__codelineno-9-212" href="#__codelineno-9-212"></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">uniq_cats</span><span class="p">):</span>
<a id="__codelineno-9-213" name="__codelineno-9-213" href="#__codelineno-9-213"></a>                <span class="n">odf_schema</span> <span class="o">=</span> <span class="n">odf_schema</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<a id="__codelineno-9-214" name="__codelineno-9-214" href="#__codelineno-9-214"></a>                    <span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">T</span><span class="o">.</span><span class="n">IntegerType</span><span class="p">())</span>
<a id="__codelineno-9-215" name="__codelineno-9-215" href="#__codelineno-9-215"></a>                <span class="p">)</span>
<a id="__codelineno-9-216" name="__codelineno-9-216" href="#__codelineno-9-216"></a>                <span class="n">new_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
<a id="__codelineno-9-217" name="__codelineno-9-217" href="#__codelineno-9-217"></a>
<a id="__codelineno-9-218" name="__codelineno-9-218" href="#__codelineno-9-218"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
<a id="__codelineno-9-219" name="__codelineno-9-219" href="#__codelineno-9-219"></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span>
<a id="__codelineno-9-220" name="__codelineno-9-220" href="#__codelineno-9-220"></a>                    <span class="o">*</span><span class="n">x</span><span class="p">,</span>
<a id="__codelineno-9-221" name="__codelineno-9-221" href="#__codelineno-9-221"></a>                    <span class="o">*</span><span class="p">(</span><span class="n">DenseVector</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_vec&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">toArray</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span>
<a id="__codelineno-9-222" name="__codelineno-9-222" href="#__codelineno-9-222"></a>                <span class="p">)</span>
<a id="__codelineno-9-223" name="__codelineno-9-223" href="#__codelineno-9-223"></a>            <span class="p">)</span><span class="o">.</span><span class="n">toDF</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">odf_schema</span><span class="p">)</span>
<a id="__codelineno-9-224" name="__codelineno-9-224" href="#__codelineno-9-224"></a>
<a id="__codelineno-9-225" name="__codelineno-9-225" href="#__codelineno-9-225"></a>            <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-9-226" name="__codelineno-9-226" href="#__codelineno-9-226"></a>                <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_vec&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_index&quot;</span><span class="p">)</span>
<a id="__codelineno-9-227" name="__codelineno-9-227" href="#__codelineno-9-227"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-9-228" name="__codelineno-9-228" href="#__codelineno-9-228"></a>                <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_vec&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_index&quot;</span><span class="p">)</span>
<a id="__codelineno-9-229" name="__codelineno-9-229" href="#__codelineno-9-229"></a>
<a id="__codelineno-9-230" name="__codelineno-9-230" href="#__codelineno-9-230"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-9-231" name="__codelineno-9-231" href="#__codelineno-9-231"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf_indexed</span>
<a id="__codelineno-9-232" name="__codelineno-9-232" href="#__codelineno-9-232"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-9-233" name="__codelineno-9-233" href="#__codelineno-9-233"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-9-234" name="__codelineno-9-234" href="#__codelineno-9-234"></a>                <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_index&quot;</span><span class="p">,</span>
<a id="__codelineno-9-235" name="__codelineno-9-235" href="#__codelineno-9-235"></a>                <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
<a id="__codelineno-9-236" name="__codelineno-9-236" href="#__codelineno-9-236"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">IntegerType</span><span class="p">())</span>
<a id="__codelineno-9-237" name="__codelineno-9-237" href="#__codelineno-9-237"></a>                <span class="p">),</span>
<a id="__codelineno-9-238" name="__codelineno-9-238" href="#__codelineno-9-238"></a>            <span class="p">)</span>
<a id="__codelineno-9-239" name="__codelineno-9-239" href="#__codelineno-9-239"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-9-240" name="__codelineno-9-240" href="#__codelineno-9-240"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-9-241" name="__codelineno-9-241" href="#__codelineno-9-241"></a>                <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_index&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-9-242" name="__codelineno-9-242" href="#__codelineno-9-242"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">idf</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<a id="__codelineno-9-243" name="__codelineno-9-243" href="#__codelineno-9-243"></a>
<a id="__codelineno-9-244" name="__codelineno-9-244" href="#__codelineno-9-244"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-9-245" name="__codelineno-9-245" href="#__codelineno-9-245"></a>        <span class="k">if</span> <span class="n">method_type</span> <span class="o">==</span> <span class="s2">&quot;label_encoding&quot;</span><span class="p">:</span>
<a id="__codelineno-9-246" name="__codelineno-9-246" href="#__codelineno-9-246"></a>            <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;append&quot;</span><span class="p">:</span>
<a id="__codelineno-9-247" name="__codelineno-9-247" href="#__codelineno-9-247"></a>                <span class="n">new_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_index&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">]</span>
<a id="__codelineno-9-248" name="__codelineno-9-248" href="#__codelineno-9-248"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-9-249" name="__codelineno-9-249" href="#__codelineno-9-249"></a>                <span class="n">new_cols</span> <span class="o">=</span> <span class="n">list_of_cols</span>
<a id="__codelineno-9-250" name="__codelineno-9-250" href="#__codelineno-9-250"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before&quot;</span><span class="p">)</span>
<a id="__codelineno-9-251" name="__codelineno-9-251" href="#__codelineno-9-251"></a>            <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-9-252" name="__codelineno-9-252" href="#__codelineno-9-252"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After&quot;</span><span class="p">)</span>
<a id="__codelineno-9-253" name="__codelineno-9-253" href="#__codelineno-9-253"></a>            <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">new_cols</span><span class="p">)</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-9-254" name="__codelineno-9-254" href="#__codelineno-9-254"></a>
<a id="__codelineno-9-255" name="__codelineno-9-255" href="#__codelineno-9-255"></a>        <span class="k">if</span> <span class="n">method_type</span> <span class="o">==</span> <span class="s2">&quot;onehot_encoding&quot;</span><span class="p">:</span>
<a id="__codelineno-9-256" name="__codelineno-9-256" href="#__codelineno-9-256"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before&quot;</span><span class="p">)</span>
<a id="__codelineno-9-257" name="__codelineno-9-257" href="#__codelineno-9-257"></a>            <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<a id="__codelineno-9-258" name="__codelineno-9-258" href="#__codelineno-9-258"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After&quot;</span><span class="p">)</span>
<a id="__codelineno-9-259" name="__codelineno-9-259" href="#__codelineno-9-259"></a>            <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;append&quot;</span><span class="p">:</span>
<a id="__codelineno-9-260" name="__codelineno-9-260" href="#__codelineno-9-260"></a>                <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span> <span class="o">+</span> <span class="n">new_cols</span><span class="p">)</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<a id="__codelineno-9-261" name="__codelineno-9-261" href="#__codelineno-9-261"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-9-262" name="__codelineno-9-262" href="#__codelineno-9-262"></a>                <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">new_cols</span><span class="p">)</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<a id="__codelineno-9-263" name="__codelineno-9-263" href="#__codelineno-9-263"></a>        <span class="k">if</span> <span class="n">skip_cols</span><span class="p">:</span>
<a id="__codelineno-9-264" name="__codelineno-9-264" href="#__codelineno-9-264"></a>            <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-9-265" name="__codelineno-9-265" href="#__codelineno-9-265"></a>                <span class="s2">&quot;Columns dropped from encoding due to high cardinality: &quot;</span>
<a id="__codelineno-9-266" name="__codelineno-9-266" href="#__codelineno-9-266"></a>                <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">skip_cols</span><span class="p">)</span>
<a id="__codelineno-9-267" name="__codelineno-9-267" href="#__codelineno-9-267"></a>            <span class="p">)</span>
<a id="__codelineno-9-268" name="__codelineno-9-268" href="#__codelineno-9-268"></a>    <span class="k">return</span> <span class="n">odf</span>
</code></pre></div>
</pre>
</details>
</dd>
<dt id="anovos.data_transformer.transformers.expression_parser"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">expression_parser</span></span>(<span class="n">idf, list_of_expr, postfix='', print_impact=False)</span>
</code></dt>
<dd>
<div class="desc"><p>expression_parser can be used to evaluate a list of SQL expressions and output the result as new features. It
is able to handle column names containing special characters such as “.”, “-”, “@”, “^”, etc, by converting them
to “_” first before the evaluation and convert them back to the original names before returning the output
dataframe.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe</dd>
<dt><strong><code>list_of_expr</code></strong></dt>
<dd>List of expressions to evaluate as new features e.g., ["expr1","expr2"].
Alternatively, expressions can be specified in a string format,
where different expressions are separated by pipe delimiter “|” e.g., "expr1|expr2".</dd>
<dt><strong><code>postfix</code></strong></dt>
<dd>postfix for new feature name.Naming convention "f" + expression_index + postfix
e.g. with postfix of "new", new added features are named as f0new, f1new etc. (Default value = "")</dd>
<dt><strong><code>print_impact</code></strong></dt>
<dd>True, False
This argument is to print the descriptive statistics of the parsed features (Default value = False)</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>DataFrame</code></dt>
<dd>Parsed Dataframe</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">def</span> <span class="nf">expression_parser</span><span class="p">(</span><span class="n">idf</span><span class="p">,</span> <span class="n">list_of_expr</span><span class="p">,</span> <span class="n">postfix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="sd">    expression_parser can be used to evaluate a list of SQL expressions and output the result as new features. It</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="sd">    is able to handle column names containing special characters such as “.”, “-”, “@”, “^”, etc, by converting them</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="sd">    to “_” first before the evaluation and convert them back to the original names before returning the output</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="sd">    dataframe.</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="sd">    Parameters</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="sd">    ----------</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="sd">    idf</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="sd">    list_of_expr</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="sd">        List of expressions to evaluate as new features e.g., [&quot;expr1&quot;,&quot;expr2&quot;].</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="sd">        Alternatively, expressions can be specified in a string format,</span>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="sd">        where different expressions are separated by pipe delimiter “|” e.g., &quot;expr1|expr2&quot;.</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="sd">    postfix</span>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="sd">        postfix for new feature name.Naming convention &quot;f&quot; + expression_index + postfix</span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a><span class="sd">        e.g. with postfix of &quot;new&quot;, new added features are named as f0new, f1new etc. (Default value = &quot;&quot;)</span>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="sd">    print_impact</span>
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a><span class="sd">        True, False</span>
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a><span class="sd">        This argument is to print the descriptive statistics of the parsed features (Default value = False)</span>
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a><span class="sd">    Returns</span>
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a><span class="sd">    -------</span>
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a><span class="sd">        Parsed Dataframe</span>
<a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a>
<a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_expr</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a>        <span class="n">list_of_expr</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_expr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a>
<a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a>    <span class="n">special_chars</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a>        <span class="s2">&quot;&amp;&quot;</span><span class="p">,</span>
<a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a>        <span class="s2">&quot;$&quot;</span><span class="p">,</span>
<a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a>        <span class="s2">&quot;;&quot;</span><span class="p">,</span>
<a id="__codelineno-10-37" name="__codelineno-10-37" href="#__codelineno-10-37"></a>        <span class="s2">&quot;:&quot;</span><span class="p">,</span>
<a id="__codelineno-10-38" name="__codelineno-10-38" href="#__codelineno-10-38"></a>        <span class="s2">&quot;,&quot;</span><span class="p">,</span>
<a id="__codelineno-10-39" name="__codelineno-10-39" href="#__codelineno-10-39"></a>        <span class="s2">&quot;*&quot;</span><span class="p">,</span>
<a id="__codelineno-10-40" name="__codelineno-10-40" href="#__codelineno-10-40"></a>        <span class="s2">&quot;#&quot;</span><span class="p">,</span>
<a id="__codelineno-10-41" name="__codelineno-10-41" href="#__codelineno-10-41"></a>        <span class="s2">&quot;@&quot;</span><span class="p">,</span>
<a id="__codelineno-10-42" name="__codelineno-10-42" href="#__codelineno-10-42"></a>        <span class="s2">&quot;?&quot;</span><span class="p">,</span>
<a id="__codelineno-10-43" name="__codelineno-10-43" href="#__codelineno-10-43"></a>        <span class="s2">&quot;%&quot;</span><span class="p">,</span>
<a id="__codelineno-10-44" name="__codelineno-10-44" href="#__codelineno-10-44"></a>        <span class="s2">&quot;!&quot;</span><span class="p">,</span>
<a id="__codelineno-10-45" name="__codelineno-10-45" href="#__codelineno-10-45"></a>        <span class="s2">&quot;^&quot;</span><span class="p">,</span>
<a id="__codelineno-10-46" name="__codelineno-10-46" href="#__codelineno-10-46"></a>        <span class="s2">&quot;(&quot;</span><span class="p">,</span>
<a id="__codelineno-10-47" name="__codelineno-10-47" href="#__codelineno-10-47"></a>        <span class="s2">&quot;)&quot;</span><span class="p">,</span>
<a id="__codelineno-10-48" name="__codelineno-10-48" href="#__codelineno-10-48"></a>        <span class="s2">&quot;-&quot;</span><span class="p">,</span>
<a id="__codelineno-10-49" name="__codelineno-10-49" href="#__codelineno-10-49"></a>        <span class="s2">&quot;/&quot;</span><span class="p">,</span>
<a id="__codelineno-10-50" name="__codelineno-10-50" href="#__codelineno-10-50"></a>        <span class="s2">&quot;&#39;&quot;</span><span class="p">,</span>
<a id="__codelineno-10-51" name="__codelineno-10-51" href="#__codelineno-10-51"></a>        <span class="s2">&quot;.&quot;</span><span class="p">,</span>
<a id="__codelineno-10-52" name="__codelineno-10-52" href="#__codelineno-10-52"></a>        <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span>
<a id="__codelineno-10-53" name="__codelineno-10-53" href="#__codelineno-10-53"></a>    <span class="p">]</span>
<a id="__codelineno-10-54" name="__codelineno-10-54" href="#__codelineno-10-54"></a>    <span class="n">rename_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-10-55" name="__codelineno-10-55" href="#__codelineno-10-55"></a>    <span class="n">replace_chars</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-10-56" name="__codelineno-10-56" href="#__codelineno-10-56"></a>    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">special_chars</span><span class="p">:</span>
<a id="__codelineno-10-57" name="__codelineno-10-57" href="#__codelineno-10-57"></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">idf</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-10-58" name="__codelineno-10-58" href="#__codelineno-10-58"></a>            <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
<a id="__codelineno-10-59" name="__codelineno-10-59" href="#__codelineno-10-59"></a>                <span class="n">rename_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<a id="__codelineno-10-60" name="__codelineno-10-60" href="#__codelineno-10-60"></a>                <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">replace_chars</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-10-61" name="__codelineno-10-61" href="#__codelineno-10-61"></a>                    <span class="p">(</span><span class="n">replace_chars</span><span class="p">[</span><span class="n">col</span><span class="p">])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
<a id="__codelineno-10-62" name="__codelineno-10-62" href="#__codelineno-10-62"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-10-63" name="__codelineno-10-63" href="#__codelineno-10-63"></a>                    <span class="n">replace_chars</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">char</span><span class="p">]</span>
<a id="__codelineno-10-64" name="__codelineno-10-64" href="#__codelineno-10-64"></a>
<a id="__codelineno-10-65" name="__codelineno-10-65" href="#__codelineno-10-65"></a>    <span class="n">rename_mapping_to_new</span><span class="p">,</span> <span class="n">rename_mapping_to_old</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
<a id="__codelineno-10-66" name="__codelineno-10-66" href="#__codelineno-10-66"></a>    <span class="n">idf_renamed</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-10-67" name="__codelineno-10-67" href="#__codelineno-10-67"></a>    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">rename_cols</span><span class="p">:</span>
<a id="__codelineno-10-68" name="__codelineno-10-68" href="#__codelineno-10-68"></a>        <span class="n">new_col</span> <span class="o">=</span> <span class="n">col</span>
<a id="__codelineno-10-69" name="__codelineno-10-69" href="#__codelineno-10-69"></a>        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">replace_chars</span><span class="p">[</span><span class="n">col</span><span class="p">]:</span>
<a id="__codelineno-10-70" name="__codelineno-10-70" href="#__codelineno-10-70"></a>            <span class="n">new_col</span> <span class="o">=</span> <span class="n">new_col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
<a id="__codelineno-10-71" name="__codelineno-10-71" href="#__codelineno-10-71"></a>        <span class="n">rename_mapping_to_old</span><span class="p">[</span><span class="n">new_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span>
<a id="__codelineno-10-72" name="__codelineno-10-72" href="#__codelineno-10-72"></a>        <span class="n">rename_mapping_to_new</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_col</span>
<a id="__codelineno-10-73" name="__codelineno-10-73" href="#__codelineno-10-73"></a>
<a id="__codelineno-10-74" name="__codelineno-10-74" href="#__codelineno-10-74"></a>        <span class="n">idf_renamed</span> <span class="o">=</span> <span class="n">idf_renamed</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">new_col</span><span class="p">)</span>
<a id="__codelineno-10-75" name="__codelineno-10-75" href="#__codelineno-10-75"></a>
<a id="__codelineno-10-76" name="__codelineno-10-76" href="#__codelineno-10-76"></a>    <span class="n">list_of_expr_</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-10-77" name="__codelineno-10-77" href="#__codelineno-10-77"></a>    <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">list_of_expr</span><span class="p">:</span>
<a id="__codelineno-10-78" name="__codelineno-10-78" href="#__codelineno-10-78"></a>        <span class="n">new_expr</span> <span class="o">=</span> <span class="n">expr</span>
<a id="__codelineno-10-79" name="__codelineno-10-79" href="#__codelineno-10-79"></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">rename_cols</span><span class="p">:</span>
<a id="__codelineno-10-80" name="__codelineno-10-80" href="#__codelineno-10-80"></a>            <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">expr</span><span class="p">:</span>
<a id="__codelineno-10-81" name="__codelineno-10-81" href="#__codelineno-10-81"></a>                <span class="n">new_expr</span> <span class="o">=</span> <span class="n">new_expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">rename_mapping_to_new</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
<a id="__codelineno-10-82" name="__codelineno-10-82" href="#__codelineno-10-82"></a>        <span class="n">list_of_expr_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_expr</span><span class="p">)</span>
<a id="__codelineno-10-83" name="__codelineno-10-83" href="#__codelineno-10-83"></a>
<a id="__codelineno-10-84" name="__codelineno-10-84" href="#__codelineno-10-84"></a>    <span class="n">list_of_expr</span> <span class="o">=</span> <span class="n">list_of_expr_</span>
<a id="__codelineno-10-85" name="__codelineno-10-85" href="#__codelineno-10-85"></a>
<a id="__codelineno-10-86" name="__codelineno-10-86" href="#__codelineno-10-86"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf_renamed</span>
<a id="__codelineno-10-87" name="__codelineno-10-87" href="#__codelineno-10-87"></a>    <span class="n">new_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-10-88" name="__codelineno-10-88" href="#__codelineno-10-88"></a>    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">exp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_expr</span><span class="p">):</span>
<a id="__codelineno-10-89" name="__codelineno-10-89" href="#__codelineno-10-89"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="n">postfix</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">expr</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
<a id="__codelineno-10-90" name="__codelineno-10-90" href="#__codelineno-10-90"></a>        <span class="n">new_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;f&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="n">postfix</span><span class="p">)</span>
<a id="__codelineno-10-91" name="__codelineno-10-91" href="#__codelineno-10-91"></a>
<a id="__codelineno-10-92" name="__codelineno-10-92" href="#__codelineno-10-92"></a>    <span class="k">for</span> <span class="n">new_col</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">rename_mapping_to_old</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-10-93" name="__codelineno-10-93" href="#__codelineno-10-93"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">new_col</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
<a id="__codelineno-10-94" name="__codelineno-10-94" href="#__codelineno-10-94"></a>
<a id="__codelineno-10-95" name="__codelineno-10-95" href="#__codelineno-10-95"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-10-96" name="__codelineno-10-96" href="#__codelineno-10-96"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Columns Added: &quot;</span><span class="p">,</span> <span class="n">new_cols</span><span class="p">)</span>
<a id="__codelineno-10-97" name="__codelineno-10-97" href="#__codelineno-10-97"></a>        <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">new_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-10-98" name="__codelineno-10-98" href="#__codelineno-10-98"></a>
<a id="__codelineno-10-99" name="__codelineno-10-99" href="#__codelineno-10-99"></a>    <span class="k">return</span> <span class="n">odf</span>
</code></pre></div>
</pre>
</details>
</dd>
<dt id="anovos.data_transformer.transformers.feature_transformation"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">feature_transformation</span></span>(<span class="n">idf, list_of_cols='all', drop_cols=[], method_type='sqrt', N=None, output_mode='replace', print_impact=False)</span>
</code></dt>
<dd>
<div class="desc"><p>As the name indicates, feature_transformation performs mathematical transformation over selected attributes.
The following methods are supported for an input attribute x: ln(x), log10(x), log2(x), e^x, 2^x, 10^x, N^x,
square and cube root of x, x^2, x^3, x^N, trigonometric transformations of x (sin, cos, tan, asin, acos, atan),
radians, x%N, x!, 1/x, floor and ceiling of x and x rounded to N decimal places. Some transformations only work
with positive or non-negative input values such as log and square root and an error will be returned if violated.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe</dd>
<dt><strong><code>list_of_cols</code></strong></dt>
<dd>List of numerical columns to transform e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
"all" can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.
Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in
drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = "all")</dd>
<dt><strong><code>drop_cols</code></strong></dt>
<dd>List of columns to be dropped e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except
a few handful of them. (Default value = [])</dd>
<dt><strong><code>method_type</code></strong></dt>
<dd>"ln", "log10", "log2", "exp", "powOf2" (2^x), "powOf10" (10^x), "powOfN" (N^x),
"sqrt" (square root), "cbrt" (cube root), "sq" (square), "cb" (cube), "toPowerN" (x^N),
"sin", "cos", "tan", "asin", "acos", "atan", "radians",
"remainderDivByN" (x%N), "factorial" (x!), "mul_inv" (1/x),
"floor", "ceil", "roundN" (round to N decimal places) (Default value = "sqrt")</dd>
<dt><strong><code>N</code></strong></dt>
<dd>None by default. If method_type is "powOfN", "toPowerN", "remainderDivByN" or "roundN", N will
be used as the required constant.</dd>
<dt><strong><code>output_mode</code></strong></dt>
<dd>"replace", "append".
“replace” option replaces original columns with transformed columns.
“append” option append transformed columns with a postfix (E.g. "_ln", "_powOf<N>")
to the input dataset. (Default value = "replace")</dd>
<dt><strong><code>print_impact</code></strong></dt>
<dd>True, False
This argument is to print before and after descriptive statistics of the transformed features (Default value = False)</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>DataFrame</code></dt>
<dd>Transformed Dataframe</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">def</span> <span class="nf">feature_transformation</span><span class="p">(</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>    <span class="n">method_type</span><span class="o">=</span><span class="s2">&quot;sqrt&quot;</span><span class="p">,</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>    <span class="n">N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="p">):</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="sd">    As the name indicates, feature_transformation performs mathematical transformation over selected attributes.</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="sd">    The following methods are supported for an input attribute x: ln(x), log10(x), log2(x), e^x, 2^x, 10^x, N^x,</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="sd">    square and cube root of x, x^2, x^3, x^N, trigonometric transformations of x (sin, cos, tan, asin, acos, atan),</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="sd">    radians, x%N, x!, 1/x, floor and ceiling of x and x rounded to N decimal places. Some transformations only work</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="sd">    with positive or non-negative input values such as log and square root and an error will be returned if violated.</span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="sd">    Parameters</span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="sd">    ----------</span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="sd">    idf</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a><span class="sd">        List of numerical columns to transform e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a><span class="sd">        &quot;all&quot; can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a><span class="sd">    method_type</span>
<a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a><span class="sd">        &quot;ln&quot;, &quot;log10&quot;, &quot;log2&quot;, &quot;exp&quot;, &quot;powOf2&quot; (2^x), &quot;powOf10&quot; (10^x), &quot;powOfN&quot; (N^x),</span>
<a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a><span class="sd">        &quot;sqrt&quot; (square root), &quot;cbrt&quot; (cube root), &quot;sq&quot; (square), &quot;cb&quot; (cube), &quot;toPowerN&quot; (x^N),</span>
<a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a><span class="sd">        &quot;sin&quot;, &quot;cos&quot;, &quot;tan&quot;, &quot;asin&quot;, &quot;acos&quot;, &quot;atan&quot;, &quot;radians&quot;,</span>
<a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a><span class="sd">        &quot;remainderDivByN&quot; (x%N), &quot;factorial&quot; (x!), &quot;mul_inv&quot; (1/x),</span>
<a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a><span class="sd">        &quot;floor&quot;, &quot;ceil&quot;, &quot;roundN&quot; (round to N decimal places) (Default value = &quot;sqrt&quot;)</span>
<a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a><span class="sd">    N</span>
<a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a><span class="sd">        None by default. If method_type is &quot;powOfN&quot;, &quot;toPowerN&quot;, &quot;remainderDivByN&quot; or &quot;roundN&quot;, N will</span>
<a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a><span class="sd">        be used as the required constant.</span>
<a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a><span class="sd">    output_mode</span>
<a id="__codelineno-11-45" name="__codelineno-11-45" href="#__codelineno-11-45"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-11-46" name="__codelineno-11-46" href="#__codelineno-11-46"></a><span class="sd">        “replace” option replaces original columns with transformed columns.</span>
<a id="__codelineno-11-47" name="__codelineno-11-47" href="#__codelineno-11-47"></a><span class="sd">        “append” option append transformed columns with a postfix (E.g. &quot;_ln&quot;, &quot;_powOf&lt;N&gt;&quot;)</span>
<a id="__codelineno-11-48" name="__codelineno-11-48" href="#__codelineno-11-48"></a><span class="sd">        to the input dataset. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-11-49" name="__codelineno-11-49" href="#__codelineno-11-49"></a><span class="sd">    print_impact</span>
<a id="__codelineno-11-50" name="__codelineno-11-50" href="#__codelineno-11-50"></a><span class="sd">        True, False</span>
<a id="__codelineno-11-51" name="__codelineno-11-51" href="#__codelineno-11-51"></a><span class="sd">        This argument is to print before and after descriptive statistics of the transformed features (Default value = False)</span>
<a id="__codelineno-11-52" name="__codelineno-11-52" href="#__codelineno-11-52"></a>
<a id="__codelineno-11-53" name="__codelineno-11-53" href="#__codelineno-11-53"></a><span class="sd">    Returns</span>
<a id="__codelineno-11-54" name="__codelineno-11-54" href="#__codelineno-11-54"></a><span class="sd">    -------</span>
<a id="__codelineno-11-55" name="__codelineno-11-55" href="#__codelineno-11-55"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-11-56" name="__codelineno-11-56" href="#__codelineno-11-56"></a><span class="sd">        Transformed Dataframe</span>
<a id="__codelineno-11-57" name="__codelineno-11-57" href="#__codelineno-11-57"></a>
<a id="__codelineno-11-58" name="__codelineno-11-58" href="#__codelineno-11-58"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-11-59" name="__codelineno-11-59" href="#__codelineno-11-59"></a>
<a id="__codelineno-11-60" name="__codelineno-11-60" href="#__codelineno-11-60"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-11-61" name="__codelineno-11-61" href="#__codelineno-11-61"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-11-62" name="__codelineno-11-62" href="#__codelineno-11-62"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-11-63" name="__codelineno-11-63" href="#__codelineno-11-63"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-11-64" name="__codelineno-11-64" href="#__codelineno-11-64"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-11-65" name="__codelineno-11-65" href="#__codelineno-11-65"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-11-66" name="__codelineno-11-66" href="#__codelineno-11-66"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-11-67" name="__codelineno-11-67" href="#__codelineno-11-67"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-11-68" name="__codelineno-11-68" href="#__codelineno-11-68"></a>
<a id="__codelineno-11-69" name="__codelineno-11-69" href="#__codelineno-11-69"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">)):</span>
<a id="__codelineno-11-70" name="__codelineno-11-70" href="#__codelineno-11-70"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-11-71" name="__codelineno-11-71" href="#__codelineno-11-71"></a>
<a id="__codelineno-11-72" name="__codelineno-11-72" href="#__codelineno-11-72"></a>    <span class="k">if</span> <span class="n">method_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-11-73" name="__codelineno-11-73" href="#__codelineno-11-73"></a>        <span class="s2">&quot;ln&quot;</span><span class="p">,</span>
<a id="__codelineno-11-74" name="__codelineno-11-74" href="#__codelineno-11-74"></a>        <span class="s2">&quot;log10&quot;</span><span class="p">,</span>
<a id="__codelineno-11-75" name="__codelineno-11-75" href="#__codelineno-11-75"></a>        <span class="s2">&quot;log2&quot;</span><span class="p">,</span>
<a id="__codelineno-11-76" name="__codelineno-11-76" href="#__codelineno-11-76"></a>        <span class="s2">&quot;exp&quot;</span><span class="p">,</span>
<a id="__codelineno-11-77" name="__codelineno-11-77" href="#__codelineno-11-77"></a>        <span class="s2">&quot;powOf2&quot;</span><span class="p">,</span>
<a id="__codelineno-11-78" name="__codelineno-11-78" href="#__codelineno-11-78"></a>        <span class="s2">&quot;powOf10&quot;</span><span class="p">,</span>
<a id="__codelineno-11-79" name="__codelineno-11-79" href="#__codelineno-11-79"></a>        <span class="s2">&quot;powOfN&quot;</span><span class="p">,</span>
<a id="__codelineno-11-80" name="__codelineno-11-80" href="#__codelineno-11-80"></a>        <span class="s2">&quot;sqrt&quot;</span><span class="p">,</span>
<a id="__codelineno-11-81" name="__codelineno-11-81" href="#__codelineno-11-81"></a>        <span class="s2">&quot;cbrt&quot;</span><span class="p">,</span>
<a id="__codelineno-11-82" name="__codelineno-11-82" href="#__codelineno-11-82"></a>        <span class="s2">&quot;sq&quot;</span><span class="p">,</span>
<a id="__codelineno-11-83" name="__codelineno-11-83" href="#__codelineno-11-83"></a>        <span class="s2">&quot;cb&quot;</span><span class="p">,</span>
<a id="__codelineno-11-84" name="__codelineno-11-84" href="#__codelineno-11-84"></a>        <span class="s2">&quot;toPowerN&quot;</span><span class="p">,</span>
<a id="__codelineno-11-85" name="__codelineno-11-85" href="#__codelineno-11-85"></a>        <span class="s2">&quot;sin&quot;</span><span class="p">,</span>
<a id="__codelineno-11-86" name="__codelineno-11-86" href="#__codelineno-11-86"></a>        <span class="s2">&quot;cos&quot;</span><span class="p">,</span>
<a id="__codelineno-11-87" name="__codelineno-11-87" href="#__codelineno-11-87"></a>        <span class="s2">&quot;tan&quot;</span><span class="p">,</span>
<a id="__codelineno-11-88" name="__codelineno-11-88" href="#__codelineno-11-88"></a>        <span class="s2">&quot;asin&quot;</span><span class="p">,</span>
<a id="__codelineno-11-89" name="__codelineno-11-89" href="#__codelineno-11-89"></a>        <span class="s2">&quot;acos&quot;</span><span class="p">,</span>
<a id="__codelineno-11-90" name="__codelineno-11-90" href="#__codelineno-11-90"></a>        <span class="s2">&quot;atan&quot;</span><span class="p">,</span>
<a id="__codelineno-11-91" name="__codelineno-11-91" href="#__codelineno-11-91"></a>        <span class="s2">&quot;radians&quot;</span><span class="p">,</span>
<a id="__codelineno-11-92" name="__codelineno-11-92" href="#__codelineno-11-92"></a>        <span class="s2">&quot;remainderDivByN&quot;</span><span class="p">,</span>
<a id="__codelineno-11-93" name="__codelineno-11-93" href="#__codelineno-11-93"></a>        <span class="s2">&quot;factorial&quot;</span><span class="p">,</span>
<a id="__codelineno-11-94" name="__codelineno-11-94" href="#__codelineno-11-94"></a>        <span class="s2">&quot;mul_inv&quot;</span><span class="p">,</span>
<a id="__codelineno-11-95" name="__codelineno-11-95" href="#__codelineno-11-95"></a>        <span class="s2">&quot;floor&quot;</span><span class="p">,</span>
<a id="__codelineno-11-96" name="__codelineno-11-96" href="#__codelineno-11-96"></a>        <span class="s2">&quot;ceil&quot;</span><span class="p">,</span>
<a id="__codelineno-11-97" name="__codelineno-11-97" href="#__codelineno-11-97"></a>        <span class="s2">&quot;roundN&quot;</span><span class="p">,</span>
<a id="__codelineno-11-98" name="__codelineno-11-98" href="#__codelineno-11-98"></a>    <span class="p">]:</span>
<a id="__codelineno-11-99" name="__codelineno-11-99" href="#__codelineno-11-99"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input method_type&quot;</span><span class="p">)</span>
<a id="__codelineno-11-100" name="__codelineno-11-100" href="#__codelineno-11-100"></a>
<a id="__codelineno-11-101" name="__codelineno-11-101" href="#__codelineno-11-101"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-11-102" name="__codelineno-11-102" href="#__codelineno-11-102"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-11-103" name="__codelineno-11-103" href="#__codelineno-11-103"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-11-104" name="__codelineno-11-104" href="#__codelineno-11-104"></a>
<a id="__codelineno-11-105" name="__codelineno-11-105" href="#__codelineno-11-105"></a>    <span class="n">transformation_function</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-11-106" name="__codelineno-11-106" href="#__codelineno-11-106"></a>        <span class="s2">&quot;ln&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
<a id="__codelineno-11-107" name="__codelineno-11-107" href="#__codelineno-11-107"></a>        <span class="s2">&quot;log10&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">log10</span><span class="p">,</span>
<a id="__codelineno-11-108" name="__codelineno-11-108" href="#__codelineno-11-108"></a>        <span class="s2">&quot;log2&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">log2</span><span class="p">,</span>
<a id="__codelineno-11-109" name="__codelineno-11-109" href="#__codelineno-11-109"></a>        <span class="s2">&quot;exp&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">exp</span><span class="p">,</span>
<a id="__codelineno-11-110" name="__codelineno-11-110" href="#__codelineno-11-110"></a>        <span class="s2">&quot;powOf2&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">x</span><span class="p">)),</span>
<a id="__codelineno-11-111" name="__codelineno-11-111" href="#__codelineno-11-111"></a>        <span class="s2">&quot;powOf10&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">x</span><span class="p">)),</span>
<a id="__codelineno-11-112" name="__codelineno-11-112" href="#__codelineno-11-112"></a>        <span class="s2">&quot;powOfN&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">x</span><span class="p">)),</span>
<a id="__codelineno-11-113" name="__codelineno-11-113" href="#__codelineno-11-113"></a>        <span class="s2">&quot;sqrt&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">sqrt</span><span class="p">,</span>
<a id="__codelineno-11-114" name="__codelineno-11-114" href="#__codelineno-11-114"></a>        <span class="s2">&quot;cbrt&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">cbrt</span><span class="p">,</span>
<a id="__codelineno-11-115" name="__codelineno-11-115" href="#__codelineno-11-115"></a>        <span class="s2">&quot;sq&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-11-116" name="__codelineno-11-116" href="#__codelineno-11-116"></a>        <span class="s2">&quot;cb&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span>
<a id="__codelineno-11-117" name="__codelineno-11-117" href="#__codelineno-11-117"></a>        <span class="s2">&quot;toPowerN&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="n">N</span><span class="p">),</span>
<a id="__codelineno-11-118" name="__codelineno-11-118" href="#__codelineno-11-118"></a>        <span class="s2">&quot;sin&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">sin</span><span class="p">,</span>
<a id="__codelineno-11-119" name="__codelineno-11-119" href="#__codelineno-11-119"></a>        <span class="s2">&quot;cos&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">cos</span><span class="p">,</span>
<a id="__codelineno-11-120" name="__codelineno-11-120" href="#__codelineno-11-120"></a>        <span class="s2">&quot;tan&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">tan</span><span class="p">,</span>
<a id="__codelineno-11-121" name="__codelineno-11-121" href="#__codelineno-11-121"></a>        <span class="s2">&quot;asin&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">asin</span><span class="p">,</span>
<a id="__codelineno-11-122" name="__codelineno-11-122" href="#__codelineno-11-122"></a>        <span class="s2">&quot;acos&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">acos</span><span class="p">,</span>
<a id="__codelineno-11-123" name="__codelineno-11-123" href="#__codelineno-11-123"></a>        <span class="s2">&quot;atan&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">atan</span><span class="p">,</span>
<a id="__codelineno-11-124" name="__codelineno-11-124" href="#__codelineno-11-124"></a>        <span class="s2">&quot;radians&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">radians</span><span class="p">,</span>
<a id="__codelineno-11-125" name="__codelineno-11-125" href="#__codelineno-11-125"></a>        <span class="s2">&quot;remainderDivByN&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">N</span><span class="p">)),</span>
<a id="__codelineno-11-126" name="__codelineno-11-126" href="#__codelineno-11-126"></a>        <span class="s2">&quot;factorial&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">factorial</span><span class="p">,</span>
<a id="__codelineno-11-127" name="__codelineno-11-127" href="#__codelineno-11-127"></a>        <span class="s2">&quot;mul_inv&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">x</span><span class="p">),</span>
<a id="__codelineno-11-128" name="__codelineno-11-128" href="#__codelineno-11-128"></a>        <span class="s2">&quot;floor&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">floor</span><span class="p">,</span>
<a id="__codelineno-11-129" name="__codelineno-11-129" href="#__codelineno-11-129"></a>        <span class="s2">&quot;ceil&quot;</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">ceil</span><span class="p">,</span>
<a id="__codelineno-11-130" name="__codelineno-11-130" href="#__codelineno-11-130"></a>        <span class="s2">&quot;roundN&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">N</span><span class="p">)),</span>
<a id="__codelineno-11-131" name="__codelineno-11-131" href="#__codelineno-11-131"></a>    <span class="p">}</span>
<a id="__codelineno-11-132" name="__codelineno-11-132" href="#__codelineno-11-132"></a>
<a id="__codelineno-11-133" name="__codelineno-11-133" href="#__codelineno-11-133"></a>    <span class="k">def</span> <span class="nf">get_col_name</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
<a id="__codelineno-11-134" name="__codelineno-11-134" href="#__codelineno-11-134"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-11-135" name="__codelineno-11-135" href="#__codelineno-11-135"></a>            <span class="k">return</span> <span class="n">i</span>
<a id="__codelineno-11-136" name="__codelineno-11-136" href="#__codelineno-11-136"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-11-137" name="__codelineno-11-137" href="#__codelineno-11-137"></a>            <span class="k">if</span> <span class="n">method_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;powOfN&quot;</span><span class="p">,</span> <span class="s2">&quot;toPowerN&quot;</span><span class="p">,</span> <span class="s2">&quot;remainderDivByN&quot;</span><span class="p">,</span> <span class="s2">&quot;roundN&quot;</span><span class="p">]:</span>
<a id="__codelineno-11-138" name="__codelineno-11-138" href="#__codelineno-11-138"></a>                <span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">method_type</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a id="__codelineno-11-139" name="__codelineno-11-139" href="#__codelineno-11-139"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-11-140" name="__codelineno-11-140" href="#__codelineno-11-140"></a>                <span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">method_type</span>
<a id="__codelineno-11-141" name="__codelineno-11-141" href="#__codelineno-11-141"></a>
<a id="__codelineno-11-142" name="__codelineno-11-142" href="#__codelineno-11-142"></a>    <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-11-143" name="__codelineno-11-143" href="#__codelineno-11-143"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-11-144" name="__codelineno-11-144" href="#__codelineno-11-144"></a>        <span class="n">modify_col</span> <span class="o">=</span> <span class="n">get_col_name</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-11-145" name="__codelineno-11-145" href="#__codelineno-11-145"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">modify_col</span><span class="p">,</span> <span class="n">transformation_function</span><span class="p">[</span><span class="n">method_type</span><span class="p">](</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
<a id="__codelineno-11-146" name="__codelineno-11-146" href="#__codelineno-11-146"></a>        <span class="n">output_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modify_col</span><span class="p">)</span>
<a id="__codelineno-11-147" name="__codelineno-11-147" href="#__codelineno-11-147"></a>
<a id="__codelineno-11-148" name="__codelineno-11-148" href="#__codelineno-11-148"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-11-149" name="__codelineno-11-149" href="#__codelineno-11-149"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before:&quot;</span><span class="p">)</span>
<a id="__codelineno-11-150" name="__codelineno-11-150" href="#__codelineno-11-150"></a>        <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-11-151" name="__codelineno-11-151" href="#__codelineno-11-151"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After:&quot;</span><span class="p">)</span>
<a id="__codelineno-11-152" name="__codelineno-11-152" href="#__codelineno-11-152"></a>        <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">output_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-11-153" name="__codelineno-11-153" href="#__codelineno-11-153"></a>
<a id="__codelineno-11-154" name="__codelineno-11-154" href="#__codelineno-11-154"></a>    <span class="k">return</span> <span class="n">odf</span>
</code></pre></div>
</pre>
</details>
</dd>
<dt id="anovos.data_transformer.transformers.imputation_MMM"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">imputation_MMM</span></span>(<span class="n">spark, idf, list_of_cols='missing', drop_cols=[], method_type='median', pre_existing_model=False, model_path='NA', output_mode='replace', stats_missing={}, stats_mode={}, print_impact=False)</span>
</code></dt>
<dd>
<div class="desc"><p>This function handles missing value related issues by substituting null values by the measure of central
tendency (mode for categorical features and mean/median for numerical features). For numerical attributes,
it leverages <a href="&lt;https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.feature.Imputer&gt;
.html">Imputer</a> functionality of Spark MLlib. Though, Imputer can be used for categorical attributes but this feature is
available only in Spark3.x, therefore for categorical features, we compute mode or leverage mode computation from
Measures of Central Tendency.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>spark</code></strong></dt>
<dd>Spark Session</dd>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe</dd>
<dt><strong><code>list_of_cols</code></strong></dt>
<dd>List of columns to impute e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
"all" can be passed to include all (non-array) columns for analysis.
This is super useful instead of specifying all column names manually.
"missing" (default) can be passed to include only those columns with missing values.
One of the usecases where "all" may be preferable over "missing" is when the user wants to save
the imputation model for the future use e.g. a column may not have missing value in the training
dataset but missing values may possibly appear in the prediction dataset.
Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in
drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols.</dd>
<dt><strong><code>drop_cols</code></strong></dt>
<dd>List of columns to be dropped e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except
a few handful of them. (Default value = [])</dd>
<dt><strong><code>method_type</code></strong></dt>
<dd>"median", "mean" (valid only for for numerical columns attributes).
Mode is only option for categorical columns. (Default value = "median")</dd>
<dt><strong><code>pre_existing_model</code></strong></dt>
<dd>Boolean argument – True or False. True if imputation model exists already, False otherwise. (Default value = False)</dd>
<dt><strong><code>model_path</code></strong></dt>
<dd>If pre_existing_model is True, this argument is path for referring the pre-saved model.
If pre_existing_model is False, this argument can be used for saving the model.
Default "NA" means there is neither pre-existing model nor there is a need to save one.</dd>
<dt><strong><code>output_mode</code></strong></dt>
<dd>"replace", "append".
“replace” option replaces original columns with transformed column. “append” option append transformed
column to the input dataset with a postfix "_imputed" e.g. column X is appended as X_imputed. (Default value = "replace")</dd>
<dt><strong><code>stats_missing</code></strong></dt>
<dd>Takes arguments for read_dataset (data_ingest module) function in a dictionary format
to read pre-saved statistics on missing count/pct i.e. if measures_of_counts or
missingCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</dd>
<dt><strong><code>stats_mode</code></strong></dt>
<dd>Takes arguments for read_dataset (data_ingest module) function in a dictionary format
to read pre-saved statistics on most frequently seen values i.e. if measures_of_centralTendency or
mode_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</dd>
<dt><strong><code>print_impact</code></strong></dt>
<dd>True, False (Default value = False)
This argument is to print out before and after missing counts of imputed columns.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>DataFrame</code></dt>
<dd>Imputed Dataframe</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">def</span> <span class="nf">imputation_MMM</span><span class="p">(</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">,</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>    <span class="n">method_type</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">,</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>    <span class="n">pre_existing_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>    <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>    <span class="n">stats_missing</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>    <span class="n">stats_mode</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="p">):</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="sd">    This function handles missing value related issues by substituting null values by the measure of central</span>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="sd">    tendency (mode for categorical features and mean/median for numerical features). For numerical attributes,</span>
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="sd">    it leverages [Imputer](https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.feature.Imputer</span>
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="sd">    .html) functionality of Spark MLlib. Though, Imputer can be used for categorical attributes but this feature is</span>
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="sd">    available only in Spark3.x, therefore for categorical features, we compute mode or leverage mode computation from</span>
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a><span class="sd">    Measures of Central Tendency.</span>
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a><span class="sd">    Parameters</span>
<a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a><span class="sd">    ----------</span>
<a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a><span class="sd">    spark</span>
<a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a><span class="sd">    idf</span>
<a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a><span class="sd">        List of columns to impute e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a><span class="sd">        &quot;all&quot; can be passed to include all (non-array) columns for analysis.</span>
<a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a><span class="sd">        This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a><span class="sd">        &quot;missing&quot; (default) can be passed to include only those columns with missing values.</span>
<a id="__codelineno-12-36" name="__codelineno-12-36" href="#__codelineno-12-36"></a><span class="sd">        One of the usecases where &quot;all&quot; may be preferable over &quot;missing&quot; is when the user wants to save</span>
<a id="__codelineno-12-37" name="__codelineno-12-37" href="#__codelineno-12-37"></a><span class="sd">        the imputation model for the future use e.g. a column may not have missing value in the training</span>
<a id="__codelineno-12-38" name="__codelineno-12-38" href="#__codelineno-12-38"></a><span class="sd">        dataset but missing values may possibly appear in the prediction dataset.</span>
<a id="__codelineno-12-39" name="__codelineno-12-39" href="#__codelineno-12-39"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-12-40" name="__codelineno-12-40" href="#__codelineno-12-40"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols.</span>
<a id="__codelineno-12-41" name="__codelineno-12-41" href="#__codelineno-12-41"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-12-42" name="__codelineno-12-42" href="#__codelineno-12-42"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-12-43" name="__codelineno-12-43" href="#__codelineno-12-43"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-12-44" name="__codelineno-12-44" href="#__codelineno-12-44"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-12-45" name="__codelineno-12-45" href="#__codelineno-12-45"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-12-46" name="__codelineno-12-46" href="#__codelineno-12-46"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-12-47" name="__codelineno-12-47" href="#__codelineno-12-47"></a><span class="sd">    method_type</span>
<a id="__codelineno-12-48" name="__codelineno-12-48" href="#__codelineno-12-48"></a><span class="sd">        &quot;median&quot;, &quot;mean&quot; (valid only for for numerical columns attributes).</span>
<a id="__codelineno-12-49" name="__codelineno-12-49" href="#__codelineno-12-49"></a><span class="sd">        Mode is only option for categorical columns. (Default value = &quot;median&quot;)</span>
<a id="__codelineno-12-50" name="__codelineno-12-50" href="#__codelineno-12-50"></a><span class="sd">    pre_existing_model</span>
<a id="__codelineno-12-51" name="__codelineno-12-51" href="#__codelineno-12-51"></a><span class="sd">        Boolean argument – True or False. True if imputation model exists already, False otherwise. (Default value = False)</span>
<a id="__codelineno-12-52" name="__codelineno-12-52" href="#__codelineno-12-52"></a><span class="sd">    model_path</span>
<a id="__codelineno-12-53" name="__codelineno-12-53" href="#__codelineno-12-53"></a><span class="sd">        If pre_existing_model is True, this argument is path for referring the pre-saved model.</span>
<a id="__codelineno-12-54" name="__codelineno-12-54" href="#__codelineno-12-54"></a><span class="sd">        If pre_existing_model is False, this argument can be used for saving the model.</span>
<a id="__codelineno-12-55" name="__codelineno-12-55" href="#__codelineno-12-55"></a><span class="sd">        Default &quot;NA&quot; means there is neither pre-existing model nor there is a need to save one.</span>
<a id="__codelineno-12-56" name="__codelineno-12-56" href="#__codelineno-12-56"></a><span class="sd">    output_mode</span>
<a id="__codelineno-12-57" name="__codelineno-12-57" href="#__codelineno-12-57"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-12-58" name="__codelineno-12-58" href="#__codelineno-12-58"></a><span class="sd">        “replace” option replaces original columns with transformed column. “append” option append transformed</span>
<a id="__codelineno-12-59" name="__codelineno-12-59" href="#__codelineno-12-59"></a><span class="sd">        column to the input dataset with a postfix &quot;_imputed&quot; e.g. column X is appended as X_imputed. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-12-60" name="__codelineno-12-60" href="#__codelineno-12-60"></a><span class="sd">    stats_missing</span>
<a id="__codelineno-12-61" name="__codelineno-12-61" href="#__codelineno-12-61"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-12-62" name="__codelineno-12-62" href="#__codelineno-12-62"></a><span class="sd">        to read pre-saved statistics on missing count/pct i.e. if measures_of_counts or</span>
<a id="__codelineno-12-63" name="__codelineno-12-63" href="#__codelineno-12-63"></a><span class="sd">        missingCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-12-64" name="__codelineno-12-64" href="#__codelineno-12-64"></a><span class="sd">    stats_mode</span>
<a id="__codelineno-12-65" name="__codelineno-12-65" href="#__codelineno-12-65"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-12-66" name="__codelineno-12-66" href="#__codelineno-12-66"></a><span class="sd">        to read pre-saved statistics on most frequently seen values i.e. if measures_of_centralTendency or</span>
<a id="__codelineno-12-67" name="__codelineno-12-67" href="#__codelineno-12-67"></a><span class="sd">        mode_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-12-68" name="__codelineno-12-68" href="#__codelineno-12-68"></a><span class="sd">    print_impact</span>
<a id="__codelineno-12-69" name="__codelineno-12-69" href="#__codelineno-12-69"></a><span class="sd">        True, False (Default value = False)</span>
<a id="__codelineno-12-70" name="__codelineno-12-70" href="#__codelineno-12-70"></a><span class="sd">        This argument is to print out before and after missing counts of imputed columns.</span>
<a id="__codelineno-12-71" name="__codelineno-12-71" href="#__codelineno-12-71"></a>
<a id="__codelineno-12-72" name="__codelineno-12-72" href="#__codelineno-12-72"></a><span class="sd">    Returns</span>
<a id="__codelineno-12-73" name="__codelineno-12-73" href="#__codelineno-12-73"></a><span class="sd">    -------</span>
<a id="__codelineno-12-74" name="__codelineno-12-74" href="#__codelineno-12-74"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-12-75" name="__codelineno-12-75" href="#__codelineno-12-75"></a><span class="sd">        Imputed Dataframe</span>
<a id="__codelineno-12-76" name="__codelineno-12-76" href="#__codelineno-12-76"></a>
<a id="__codelineno-12-77" name="__codelineno-12-77" href="#__codelineno-12-77"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-12-78" name="__codelineno-12-78" href="#__codelineno-12-78"></a>    <span class="k">if</span> <span class="n">stats_missing</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-12-79" name="__codelineno-12-79" href="#__codelineno-12-79"></a>        <span class="n">missing_df</span> <span class="o">=</span> <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">)</span>
<a id="__codelineno-12-80" name="__codelineno-12-80" href="#__codelineno-12-80"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-12-81" name="__codelineno-12-81" href="#__codelineno-12-81"></a>        <span class="n">missing_df</span> <span class="o">=</span> <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_missing</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-12-82" name="__codelineno-12-82" href="#__codelineno-12-82"></a>            <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_count&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_pct&quot;</span>
<a id="__codelineno-12-83" name="__codelineno-12-83" href="#__codelineno-12-83"></a>        <span class="p">)</span>
<a id="__codelineno-12-84" name="__codelineno-12-84" href="#__codelineno-12-84"></a>
<a id="__codelineno-12-85" name="__codelineno-12-85" href="#__codelineno-12-85"></a>    <span class="n">missing_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-12-86" name="__codelineno-12-86" href="#__codelineno-12-86"></a>        <span class="n">missing_df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-12-87" name="__codelineno-12-87" href="#__codelineno-12-87"></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-12-88" name="__codelineno-12-88" href="#__codelineno-12-88"></a>        <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-12-89" name="__codelineno-12-89" href="#__codelineno-12-89"></a>        <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-12-90" name="__codelineno-12-90" href="#__codelineno-12-90"></a>    <span class="p">)</span>
<a id="__codelineno-12-91" name="__codelineno-12-91" href="#__codelineno-12-91"></a>
<a id="__codelineno-12-92" name="__codelineno-12-92" href="#__codelineno-12-92"></a>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_existing_model</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
<a id="__codelineno-12-93" name="__codelineno-12-93" href="#__codelineno-12-93"></a>        <span class="n">pre_existing_model</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-12-94" name="__codelineno-12-94" href="#__codelineno-12-94"></a>    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_existing_model</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
<a id="__codelineno-12-95" name="__codelineno-12-95" href="#__codelineno-12-95"></a>        <span class="n">pre_existing_model</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-12-96" name="__codelineno-12-96" href="#__codelineno-12-96"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-12-97" name="__codelineno-12-97" href="#__codelineno-12-97"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Non-Boolean input for pre_existing_model&quot;</span><span class="p">)</span>
<a id="__codelineno-12-98" name="__codelineno-12-98" href="#__codelineno-12-98"></a>
<a id="__codelineno-12-99" name="__codelineno-12-99" href="#__codelineno-12-99"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">missing_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pre_existing_model</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">model_path</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span><span class="p">):</span>
<a id="__codelineno-12-100" name="__codelineno-12-100" href="#__codelineno-12-100"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-12-101" name="__codelineno-12-101" href="#__codelineno-12-101"></a>
<a id="__codelineno-12-102" name="__codelineno-12-102" href="#__codelineno-12-102"></a>    <span class="n">num_cols</span><span class="p">,</span> <span class="n">cat_cols</span><span class="p">,</span> <span class="n">other_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)</span>
<a id="__codelineno-12-103" name="__codelineno-12-103" href="#__codelineno-12-103"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-12-104" name="__codelineno-12-104" href="#__codelineno-12-104"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span> <span class="o">+</span> <span class="n">cat_cols</span>
<a id="__codelineno-12-105" name="__codelineno-12-105" href="#__codelineno-12-105"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;missing&quot;</span><span class="p">:</span>
<a id="__codelineno-12-106" name="__codelineno-12-106" href="#__codelineno-12-106"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">missing_cols</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="o">+</span> <span class="n">cat_cols</span><span class="p">]</span>
<a id="__codelineno-12-107" name="__codelineno-12-107" href="#__codelineno-12-107"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-12-108" name="__codelineno-12-108" href="#__codelineno-12-108"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-12-109" name="__codelineno-12-109" href="#__codelineno-12-109"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-12-110" name="__codelineno-12-110" href="#__codelineno-12-110"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-12-111" name="__codelineno-12-111" href="#__codelineno-12-111"></a>
<a id="__codelineno-12-112" name="__codelineno-12-112" href="#__codelineno-12-112"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-12-113" name="__codelineno-12-113" href="#__codelineno-12-113"></a>
<a id="__codelineno-12-114" name="__codelineno-12-114" href="#__codelineno-12-114"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-12-115" name="__codelineno-12-115" href="#__codelineno-12-115"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No Imputation performed- No column(s) to impute&quot;</span><span class="p">)</span>
<a id="__codelineno-12-116" name="__codelineno-12-116" href="#__codelineno-12-116"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-12-117" name="__codelineno-12-117" href="#__codelineno-12-117"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="o">+</span> <span class="n">cat_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-12-118" name="__codelineno-12-118" href="#__codelineno-12-118"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-12-119" name="__codelineno-12-119" href="#__codelineno-12-119"></a>    <span class="k">if</span> <span class="n">method_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;median&quot;</span><span class="p">):</span>
<a id="__codelineno-12-120" name="__codelineno-12-120" href="#__codelineno-12-120"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for method_type&quot;</span><span class="p">)</span>
<a id="__codelineno-12-121" name="__codelineno-12-121" href="#__codelineno-12-121"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">):</span>
<a id="__codelineno-12-122" name="__codelineno-12-122" href="#__codelineno-12-122"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for output_mode&quot;</span><span class="p">)</span>
<a id="__codelineno-12-123" name="__codelineno-12-123" href="#__codelineno-12-123"></a>
<a id="__codelineno-12-124" name="__codelineno-12-124" href="#__codelineno-12-124"></a>    <span class="n">num_cols</span><span class="p">,</span> <span class="n">cat_cols</span><span class="p">,</span> <span class="n">other_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-12-125" name="__codelineno-12-125" href="#__codelineno-12-125"></a>
<a id="__codelineno-12-126" name="__codelineno-12-126" href="#__codelineno-12-126"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-12-127" name="__codelineno-12-127" href="#__codelineno-12-127"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">num_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-12-128" name="__codelineno-12-128" href="#__codelineno-12-128"></a>        <span class="n">recast_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-12-129" name="__codelineno-12-129" href="#__codelineno-12-129"></a>        <span class="n">recast_type</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-12-130" name="__codelineno-12-130" href="#__codelineno-12-130"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">num_cols</span><span class="p">:</span>
<a id="__codelineno-12-131" name="__codelineno-12-131" href="#__codelineno-12-131"></a>            <span class="k">if</span> <span class="n">get_dtype</span><span class="p">(</span><span class="n">idf</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;double&quot;</span><span class="p">):</span>
<a id="__codelineno-12-132" name="__codelineno-12-132" href="#__codelineno-12-132"></a>                <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">DoubleType</span><span class="p">()))</span>
<a id="__codelineno-12-133" name="__codelineno-12-133" href="#__codelineno-12-133"></a>                <span class="n">recast_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">)</span>
<a id="__codelineno-12-134" name="__codelineno-12-134" href="#__codelineno-12-134"></a>                <span class="n">recast_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_dtype</span><span class="p">(</span><span class="n">idf</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
<a id="__codelineno-12-135" name="__codelineno-12-135" href="#__codelineno-12-135"></a>
<a id="__codelineno-12-136" name="__codelineno-12-136" href="#__codelineno-12-136"></a>        <span class="c1"># For mode imputation</span>
<a id="__codelineno-12-137" name="__codelineno-12-137" href="#__codelineno-12-137"></a>        <span class="k">if</span> <span class="n">method_type</span> <span class="o">==</span> <span class="s2">&quot;mode&quot;</span><span class="p">:</span>
<a id="__codelineno-12-138" name="__codelineno-12-138" href="#__codelineno-12-138"></a>            <span class="k">if</span> <span class="n">stats_mode</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-12-139" name="__codelineno-12-139" href="#__codelineno-12-139"></a>                <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-12-140" name="__codelineno-12-140" href="#__codelineno-12-140"></a>                    <span class="nb">str</span><span class="p">(</span>
<a id="__codelineno-12-141" name="__codelineno-12-141" href="#__codelineno-12-141"></a>                        <span class="p">(</span>
<a id="__codelineno-12-142" name="__codelineno-12-142" href="#__codelineno-12-142"></a>                            <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-12-143" name="__codelineno-12-143" href="#__codelineno-12-143"></a>                            <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<a id="__codelineno-12-144" name="__codelineno-12-144" href="#__codelineno-12-144"></a>                            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-12-145" name="__codelineno-12-145" href="#__codelineno-12-145"></a>                            <span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-12-146" name="__codelineno-12-146" href="#__codelineno-12-146"></a>                            <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-12-147" name="__codelineno-12-147" href="#__codelineno-12-147"></a>                            <span class="o">.</span><span class="n">first</span><span class="p">()</span>
<a id="__codelineno-12-148" name="__codelineno-12-148" href="#__codelineno-12-148"></a>                            <span class="ow">or</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-12-149" name="__codelineno-12-149" href="#__codelineno-12-149"></a>                        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-12-150" name="__codelineno-12-150" href="#__codelineno-12-150"></a>                    <span class="p">)</span>
<a id="__codelineno-12-151" name="__codelineno-12-151" href="#__codelineno-12-151"></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">num_cols</span>
<a id="__codelineno-12-152" name="__codelineno-12-152" href="#__codelineno-12-152"></a>                <span class="p">]</span>
<a id="__codelineno-12-153" name="__codelineno-12-153" href="#__codelineno-12-153"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-12-154" name="__codelineno-12-154" href="#__codelineno-12-154"></a>                <span class="n">mode_df</span> <span class="o">=</span> <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_mode</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-12-155" name="__codelineno-12-155" href="#__codelineno-12-155"></a>                <span class="n">mode_df_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mode_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()[</span><span class="s2">&quot;attribute&quot;</span><span class="p">])</span>
<a id="__codelineno-12-156" name="__codelineno-12-156" href="#__codelineno-12-156"></a>                <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-12-157" name="__codelineno-12-157" href="#__codelineno-12-157"></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">num_cols</span><span class="p">:</span>
<a id="__codelineno-12-158" name="__codelineno-12-158" href="#__codelineno-12-158"></a>                    <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode_df_cols</span><span class="p">:</span>
<a id="__codelineno-12-159" name="__codelineno-12-159" href="#__codelineno-12-159"></a>                        <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-12-160" name="__codelineno-12-160" href="#__codelineno-12-160"></a>                            <span class="nb">str</span><span class="p">(</span>
<a id="__codelineno-12-161" name="__codelineno-12-161" href="#__codelineno-12-161"></a>                                <span class="p">(</span>
<a id="__codelineno-12-162" name="__codelineno-12-162" href="#__codelineno-12-162"></a>                                    <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-12-163" name="__codelineno-12-163" href="#__codelineno-12-163"></a>                                    <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<a id="__codelineno-12-164" name="__codelineno-12-164" href="#__codelineno-12-164"></a>                                    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-12-165" name="__codelineno-12-165" href="#__codelineno-12-165"></a>                                    <span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-12-166" name="__codelineno-12-166" href="#__codelineno-12-166"></a>                                    <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-12-167" name="__codelineno-12-167" href="#__codelineno-12-167"></a>                                    <span class="o">.</span><span class="n">first</span><span class="p">()</span>
<a id="__codelineno-12-168" name="__codelineno-12-168" href="#__codelineno-12-168"></a>                                    <span class="ow">or</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-12-169" name="__codelineno-12-169" href="#__codelineno-12-169"></a>                                <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-12-170" name="__codelineno-12-170" href="#__codelineno-12-170"></a>                            <span class="p">)</span>
<a id="__codelineno-12-171" name="__codelineno-12-171" href="#__codelineno-12-171"></a>                        <span class="p">)</span>
<a id="__codelineno-12-172" name="__codelineno-12-172" href="#__codelineno-12-172"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-12-173" name="__codelineno-12-173" href="#__codelineno-12-173"></a>                        <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-12-174" name="__codelineno-12-174" href="#__codelineno-12-174"></a>                            <span class="n">mode_df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-12-175" name="__codelineno-12-175" href="#__codelineno-12-175"></a>                            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">)</span>
<a id="__codelineno-12-176" name="__codelineno-12-176" href="#__codelineno-12-176"></a>                            <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<a id="__codelineno-12-177" name="__codelineno-12-177" href="#__codelineno-12-177"></a>                            <span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-12-178" name="__codelineno-12-178" href="#__codelineno-12-178"></a>                        <span class="p">)</span>
<a id="__codelineno-12-179" name="__codelineno-12-179" href="#__codelineno-12-179"></a>
<a id="__codelineno-12-180" name="__codelineno-12-180" href="#__codelineno-12-180"></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">num_cols</span><span class="p">):</span>
<a id="__codelineno-12-181" name="__codelineno-12-181" href="#__codelineno-12-181"></a>                <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-12-182" name="__codelineno-12-182" href="#__codelineno-12-182"></a>                    <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">,</span>
<a id="__codelineno-12-183" name="__codelineno-12-183" href="#__codelineno-12-183"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="n">parameters</span><span class="p">[</span><span class="n">index</span><span class="p">])</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span>
<a id="__codelineno-12-184" name="__codelineno-12-184" href="#__codelineno-12-184"></a>                <span class="p">)</span>
<a id="__codelineno-12-185" name="__codelineno-12-185" href="#__codelineno-12-185"></a>
<a id="__codelineno-12-186" name="__codelineno-12-186" href="#__codelineno-12-186"></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># For mean, median imputation</span>
<a id="__codelineno-12-187" name="__codelineno-12-187" href="#__codelineno-12-187"></a>            <span class="c1"># Building new imputer model or uploading the existing model</span>
<a id="__codelineno-12-188" name="__codelineno-12-188" href="#__codelineno-12-188"></a>            <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-12-189" name="__codelineno-12-189" href="#__codelineno-12-189"></a>                <span class="n">imputerModel</span> <span class="o">=</span> <span class="n">ImputerModel</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
<a id="__codelineno-12-190" name="__codelineno-12-190" href="#__codelineno-12-190"></a>                    <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/imputation_MMM/num_imputer-model&quot;</span>
<a id="__codelineno-12-191" name="__codelineno-12-191" href="#__codelineno-12-191"></a>                <span class="p">)</span>
<a id="__codelineno-12-192" name="__codelineno-12-192" href="#__codelineno-12-192"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-12-193" name="__codelineno-12-193" href="#__codelineno-12-193"></a>                <span class="n">imputer</span> <span class="o">=</span> <span class="n">Imputer</span><span class="p">(</span>
<a id="__codelineno-12-194" name="__codelineno-12-194" href="#__codelineno-12-194"></a>                    <span class="n">strategy</span><span class="o">=</span><span class="n">method_type</span><span class="p">,</span>
<a id="__codelineno-12-195" name="__codelineno-12-195" href="#__codelineno-12-195"></a>                    <span class="n">inputCols</span><span class="o">=</span><span class="n">num_cols</span><span class="p">,</span>
<a id="__codelineno-12-196" name="__codelineno-12-196" href="#__codelineno-12-196"></a>                    <span class="n">outputCols</span><span class="o">=</span><span class="p">[(</span><span class="n">e</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">num_cols</span><span class="p">],</span>
<a id="__codelineno-12-197" name="__codelineno-12-197" href="#__codelineno-12-197"></a>                <span class="p">)</span>
<a id="__codelineno-12-198" name="__codelineno-12-198" href="#__codelineno-12-198"></a>                <span class="n">imputerModel</span> <span class="o">=</span> <span class="n">imputer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">odf</span><span class="p">)</span>
<a id="__codelineno-12-199" name="__codelineno-12-199" href="#__codelineno-12-199"></a>
<a id="__codelineno-12-200" name="__codelineno-12-200" href="#__codelineno-12-200"></a>            <span class="c1"># Applying model</span>
<a id="__codelineno-12-201" name="__codelineno-12-201" href="#__codelineno-12-201"></a>            <span class="c1"># odf = recast_column(imputerModel.transform(odf), recast_cols, recast_type)</span>
<a id="__codelineno-12-202" name="__codelineno-12-202" href="#__codelineno-12-202"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">imputerModel</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">odf</span><span class="p">)</span>
<a id="__codelineno-12-203" name="__codelineno-12-203" href="#__codelineno-12-203"></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">recast_cols</span><span class="p">,</span> <span class="n">recast_type</span><span class="p">):</span>
<a id="__codelineno-12-204" name="__codelineno-12-204" href="#__codelineno-12-204"></a>                <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
<a id="__codelineno-12-205" name="__codelineno-12-205" href="#__codelineno-12-205"></a>
<a id="__codelineno-12-206" name="__codelineno-12-206" href="#__codelineno-12-206"></a>            <span class="c1"># Saving model if required</span>
<a id="__codelineno-12-207" name="__codelineno-12-207" href="#__codelineno-12-207"></a>            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pre_existing_model</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">):</span>
<a id="__codelineno-12-208" name="__codelineno-12-208" href="#__codelineno-12-208"></a>                <span class="n">imputerModel</span><span class="o">.</span><span class="n">write</span><span class="p">()</span><span class="o">.</span><span class="n">overwrite</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
<a id="__codelineno-12-209" name="__codelineno-12-209" href="#__codelineno-12-209"></a>                    <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/imputation_MMM/num_imputer-model&quot;</span>
<a id="__codelineno-12-210" name="__codelineno-12-210" href="#__codelineno-12-210"></a>                <span class="p">)</span>
<a id="__codelineno-12-211" name="__codelineno-12-211" href="#__codelineno-12-211"></a>
<a id="__codelineno-12-212" name="__codelineno-12-212" href="#__codelineno-12-212"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cat_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-12-213" name="__codelineno-12-213" href="#__codelineno-12-213"></a>        <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-12-214" name="__codelineno-12-214" href="#__codelineno-12-214"></a>            <span class="n">df_model</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span>
<a id="__codelineno-12-215" name="__codelineno-12-215" href="#__codelineno-12-215"></a>                <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/imputation_MMM/cat_imputer&quot;</span><span class="p">,</span>
<a id="__codelineno-12-216" name="__codelineno-12-216" href="#__codelineno-12-216"></a>                <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-12-217" name="__codelineno-12-217" href="#__codelineno-12-217"></a>                <span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-12-218" name="__codelineno-12-218" href="#__codelineno-12-218"></a>            <span class="p">)</span>
<a id="__codelineno-12-219" name="__codelineno-12-219" href="#__codelineno-12-219"></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-12-220" name="__codelineno-12-220" href="#__codelineno-12-220"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cat_cols</span><span class="p">:</span>
<a id="__codelineno-12-221" name="__codelineno-12-221" href="#__codelineno-12-221"></a>                <span class="n">mapped_value</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-12-222" name="__codelineno-12-222" href="#__codelineno-12-222"></a>                    <span class="n">df_model</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-12-223" name="__codelineno-12-223" href="#__codelineno-12-223"></a>                    <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;parameters&quot;</span><span class="p">)</span>
<a id="__codelineno-12-224" name="__codelineno-12-224" href="#__codelineno-12-224"></a>                    <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-12-225" name="__codelineno-12-225" href="#__codelineno-12-225"></a>                    <span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-12-226" name="__codelineno-12-226" href="#__codelineno-12-226"></a>                <span class="p">)</span>
<a id="__codelineno-12-227" name="__codelineno-12-227" href="#__codelineno-12-227"></a>                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapped_value</span><span class="p">)</span>
<a id="__codelineno-12-228" name="__codelineno-12-228" href="#__codelineno-12-228"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-12-229" name="__codelineno-12-229" href="#__codelineno-12-229"></a>            <span class="k">if</span> <span class="n">stats_mode</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-12-230" name="__codelineno-12-230" href="#__codelineno-12-230"></a>                <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-12-231" name="__codelineno-12-231" href="#__codelineno-12-231"></a>                    <span class="nb">str</span><span class="p">(</span>
<a id="__codelineno-12-232" name="__codelineno-12-232" href="#__codelineno-12-232"></a>                        <span class="p">(</span>
<a id="__codelineno-12-233" name="__codelineno-12-233" href="#__codelineno-12-233"></a>                            <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-12-234" name="__codelineno-12-234" href="#__codelineno-12-234"></a>                            <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<a id="__codelineno-12-235" name="__codelineno-12-235" href="#__codelineno-12-235"></a>                            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-12-236" name="__codelineno-12-236" href="#__codelineno-12-236"></a>                            <span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-12-237" name="__codelineno-12-237" href="#__codelineno-12-237"></a>                            <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-12-238" name="__codelineno-12-238" href="#__codelineno-12-238"></a>                            <span class="o">.</span><span class="n">first</span><span class="p">()</span>
<a id="__codelineno-12-239" name="__codelineno-12-239" href="#__codelineno-12-239"></a>                            <span class="ow">or</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-12-240" name="__codelineno-12-240" href="#__codelineno-12-240"></a>                        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-12-241" name="__codelineno-12-241" href="#__codelineno-12-241"></a>                    <span class="p">)</span>
<a id="__codelineno-12-242" name="__codelineno-12-242" href="#__codelineno-12-242"></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cat_cols</span>
<a id="__codelineno-12-243" name="__codelineno-12-243" href="#__codelineno-12-243"></a>                <span class="p">]</span>
<a id="__codelineno-12-244" name="__codelineno-12-244" href="#__codelineno-12-244"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-12-245" name="__codelineno-12-245" href="#__codelineno-12-245"></a>                <span class="n">mode_df</span> <span class="o">=</span> <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_mode</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-12-246" name="__codelineno-12-246" href="#__codelineno-12-246"></a>                <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-12-247" name="__codelineno-12-247" href="#__codelineno-12-247"></a>                    <span class="n">mode_df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-12-248" name="__codelineno-12-248" href="#__codelineno-12-248"></a>                    <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">)</span>
<a id="__codelineno-12-249" name="__codelineno-12-249" href="#__codelineno-12-249"></a>                    <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<a id="__codelineno-12-250" name="__codelineno-12-250" href="#__codelineno-12-250"></a>                    <span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-12-251" name="__codelineno-12-251" href="#__codelineno-12-251"></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cat_cols</span>
<a id="__codelineno-12-252" name="__codelineno-12-252" href="#__codelineno-12-252"></a>                <span class="p">]</span>
<a id="__codelineno-12-253" name="__codelineno-12-253" href="#__codelineno-12-253"></a>
<a id="__codelineno-12-254" name="__codelineno-12-254" href="#__codelineno-12-254"></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cat_cols</span><span class="p">):</span>
<a id="__codelineno-12-255" name="__codelineno-12-255" href="#__codelineno-12-255"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-12-256" name="__codelineno-12-256" href="#__codelineno-12-256"></a>                <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">,</span>
<a id="__codelineno-12-257" name="__codelineno-12-257" href="#__codelineno-12-257"></a>                <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="n">parameters</span><span class="p">[</span><span class="n">index</span><span class="p">])</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span>
<a id="__codelineno-12-258" name="__codelineno-12-258" href="#__codelineno-12-258"></a>            <span class="p">)</span>
<a id="__codelineno-12-259" name="__codelineno-12-259" href="#__codelineno-12-259"></a>
<a id="__codelineno-12-260" name="__codelineno-12-260" href="#__codelineno-12-260"></a>        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pre_existing_model</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">):</span>
<a id="__codelineno-12-261" name="__codelineno-12-261" href="#__codelineno-12-261"></a>            <span class="n">df_model</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
<a id="__codelineno-12-262" name="__codelineno-12-262" href="#__codelineno-12-262"></a>                <span class="nb">zip</span><span class="p">(</span><span class="n">cat_cols</span><span class="p">,</span> <span class="n">parameters</span><span class="p">),</span> <span class="n">schema</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;parameters&quot;</span><span class="p">]</span>
<a id="__codelineno-12-263" name="__codelineno-12-263" href="#__codelineno-12-263"></a>            <span class="p">)</span>
<a id="__codelineno-12-264" name="__codelineno-12-264" href="#__codelineno-12-264"></a>            <span class="n">df_model</span><span class="o">.</span><span class="n">repartition</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span>
<a id="__codelineno-12-265" name="__codelineno-12-265" href="#__codelineno-12-265"></a>                <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/imputation_MMM/cat_imputer&quot;</span><span class="p">,</span>
<a id="__codelineno-12-266" name="__codelineno-12-266" href="#__codelineno-12-266"></a>                <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-12-267" name="__codelineno-12-267" href="#__codelineno-12-267"></a>                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span><span class="p">,</span>
<a id="__codelineno-12-268" name="__codelineno-12-268" href="#__codelineno-12-268"></a>            <span class="p">)</span>
<a id="__codelineno-12-269" name="__codelineno-12-269" href="#__codelineno-12-269"></a>
<a id="__codelineno-12-270" name="__codelineno-12-270" href="#__codelineno-12-270"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="o">+</span> <span class="n">cat_cols</span><span class="p">:</span>
<a id="__codelineno-12-271" name="__codelineno-12-271" href="#__codelineno-12-271"></a>        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">missing_cols</span><span class="p">:</span>
<a id="__codelineno-12-272" name="__codelineno-12-272" href="#__codelineno-12-272"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">)</span>
<a id="__codelineno-12-273" name="__codelineno-12-273" href="#__codelineno-12-273"></a>        <span class="k">elif</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-12-274" name="__codelineno-12-274" href="#__codelineno-12-274"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-12-275" name="__codelineno-12-275" href="#__codelineno-12-275"></a>
<a id="__codelineno-12-276" name="__codelineno-12-276" href="#__codelineno-12-276"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-12-277" name="__codelineno-12-277" href="#__codelineno-12-277"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-12-278" name="__codelineno-12-278" href="#__codelineno-12-278"></a>            <span class="n">odf_print</span> <span class="o">=</span> <span class="n">missing_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-12-279" name="__codelineno-12-279" href="#__codelineno-12-279"></a>                <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;missingCount_before&quot;</span><span class="p">)</span>
<a id="__codelineno-12-280" name="__codelineno-12-280" href="#__codelineno-12-280"></a>            <span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-12-281" name="__codelineno-12-281" href="#__codelineno-12-281"></a>                <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">odf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-12-282" name="__codelineno-12-282" href="#__codelineno-12-282"></a>                    <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;missingCount_after&quot;</span><span class="p">)</span>
<a id="__codelineno-12-283" name="__codelineno-12-283" href="#__codelineno-12-283"></a>                <span class="p">),</span>
<a id="__codelineno-12-284" name="__codelineno-12-284" href="#__codelineno-12-284"></a>                <span class="s2">&quot;attribute&quot;</span><span class="p">,</span>
<a id="__codelineno-12-285" name="__codelineno-12-285" href="#__codelineno-12-285"></a>                <span class="s2">&quot;inner&quot;</span><span class="p">,</span>
<a id="__codelineno-12-286" name="__codelineno-12-286" href="#__codelineno-12-286"></a>            <span class="p">)</span>
<a id="__codelineno-12-287" name="__codelineno-12-287" href="#__codelineno-12-287"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-12-288" name="__codelineno-12-288" href="#__codelineno-12-288"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-12-289" name="__codelineno-12-289" href="#__codelineno-12-289"></a>                <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">)</span>
<a id="__codelineno-12-290" name="__codelineno-12-290" href="#__codelineno-12-290"></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="p">(</span><span class="n">num_cols</span> <span class="o">+</span> <span class="n">cat_cols</span><span class="p">)</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">missing_cols</span><span class="p">]</span>
<a id="__codelineno-12-291" name="__codelineno-12-291" href="#__codelineno-12-291"></a>            <span class="p">]</span>
<a id="__codelineno-12-292" name="__codelineno-12-292" href="#__codelineno-12-292"></a>            <span class="n">odf_print</span> <span class="o">=</span> <span class="n">missing_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-12-293" name="__codelineno-12-293" href="#__codelineno-12-293"></a>                <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;missingCount_before&quot;</span><span class="p">)</span>
<a id="__codelineno-12-294" name="__codelineno-12-294" href="#__codelineno-12-294"></a>            <span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-12-295" name="__codelineno-12-295" href="#__codelineno-12-295"></a>                <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">odf</span><span class="p">,</span> <span class="n">output_cols</span><span class="p">)</span>
<a id="__codelineno-12-296" name="__codelineno-12-296" href="#__codelineno-12-296"></a>                <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;attribute_after&quot;</span><span class="p">)</span>
<a id="__codelineno-12-297" name="__codelineno-12-297" href="#__codelineno-12-297"></a>                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-12-298" name="__codelineno-12-298" href="#__codelineno-12-298"></a>                    <span class="s2">&quot;attribute&quot;</span><span class="p">,</span>
<a id="__codelineno-12-299" name="__codelineno-12-299" href="#__codelineno-12-299"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">expr</span><span class="p">(</span><span class="s2">&quot;substring(attribute_after, 1, length(attribute_after)-8)&quot;</span><span class="p">),</span>
<a id="__codelineno-12-300" name="__codelineno-12-300" href="#__codelineno-12-300"></a>                <span class="p">)</span>
<a id="__codelineno-12-301" name="__codelineno-12-301" href="#__codelineno-12-301"></a>                <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">),</span>
<a id="__codelineno-12-302" name="__codelineno-12-302" href="#__codelineno-12-302"></a>                <span class="s2">&quot;attribute&quot;</span><span class="p">,</span>
<a id="__codelineno-12-303" name="__codelineno-12-303" href="#__codelineno-12-303"></a>                <span class="s2">&quot;inner&quot;</span><span class="p">,</span>
<a id="__codelineno-12-304" name="__codelineno-12-304" href="#__codelineno-12-304"></a>            <span class="p">)</span>
<a id="__codelineno-12-305" name="__codelineno-12-305" href="#__codelineno-12-305"></a>        <span class="n">odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">),</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-12-306" name="__codelineno-12-306" href="#__codelineno-12-306"></a>    <span class="k">return</span> <span class="n">odf</span>
</code></pre></div>
</pre>
</details>
</dd>
<dt id="anovos.data_transformer.transformers.imputation_matrixFactorization"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">imputation_matrixFactorization</span></span>(<span class="n">spark, idf, list_of_cols='missing', drop_cols=[], id_col='', output_mode='replace', stats_missing={}, print_impact=False)</span>
</code></dt>
<dd>
<div class="desc"><p>imputation_matrixFactorization uses collaborative filtering technique to impute missing values. Collaborative
filtering is commonly used in recommender systems to fill the missing user-item entries and PySpark provides an
implementation using alternating least squares (ALS) algorithm, which is used in this function. To fit our
problem into the ALS model, each attribute is treated as an item and an id column needs to be specified by the
user to generate the user-item pairs. In the case, ID column doesn't exist in the dataset and proxu ID column is
implicitly generated by the function. Subsequently, all user-item pairs with known values will be used to train
the ALS model and the trained model can be used to predict the user-item pairs with missing values.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>spark</code></strong></dt>
<dd>Spark Session</dd>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe</dd>
<dt><strong><code>list_of_cols</code></strong></dt>
<dd>List of columns to impute e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
"all" can be passed to include all (non-array) columns for analysis.
This is super useful instead of specifying all column names manually.
"missing" (default) can be passed to include only those columns with missing values.
One of the usecases where "all" may be preferable over "missing" is when the user wants to save
the imputation model for the future use e.g. a column may not have missing value in the training
dataset but missing values may possibly appear in the prediction dataset.
Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in
drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols.</dd>
<dt><strong><code>drop_cols</code></strong></dt>
<dd>List of columns to be dropped e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except
a few handful of them. (Default value = [])</dd>
<dt><strong><code>id_col</code></strong></dt>
<dd>ID column (Default value = "")</dd>
<dt><strong><code>output_mode</code></strong></dt>
<dd>"replace", "append".
“replace” option replaces original columns with transformed column. “append” option append transformed
column to the input dataset with a postfix "_imputed" e.g. column X is appended as X_imputed. (Default value = "replace")</dd>
<dt><strong><code>stats_missing</code></strong></dt>
<dd>Takes arguments for read_dataset (data_ingest module) function in a dictionary format
to read pre-saved statistics on missing count/pct i.e. if measures_of_counts or
missingCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</dd>
<dt><strong><code>print_impact</code></strong></dt>
<dd>True, False (Default value = False)
This argument is to print out before and after missing counts of imputed columns.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>DataFrame</code></dt>
<dd>Imputed Dataframe</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">def</span> <span class="nf">imputation_matrixFactorization</span><span class="p">(</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">,</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>    <span class="n">id_col</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>    <span class="n">stats_missing</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="p">):</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="sd">    imputation_matrixFactorization uses collaborative filtering technique to impute missing values. Collaborative</span>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="sd">    filtering is commonly used in recommender systems to fill the missing user-item entries and PySpark provides an</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="sd">    implementation using alternating least squares (ALS) algorithm, which is used in this function. To fit our</span>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="sd">    problem into the ALS model, each attribute is treated as an item and an id column needs to be specified by the</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="sd">    user to generate the user-item pairs. In the case, ID column doesn&#39;t exist in the dataset and proxu ID column is</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="sd">    implicitly generated by the function. Subsequently, all user-item pairs with known values will be used to train</span>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="sd">    the ALS model and the trained model can be used to predict the user-item pairs with missing values.</span>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a><span class="sd">    Parameters</span>
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a><span class="sd">    ----------</span>
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a><span class="sd">    spark</span>
<a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a><span class="sd">    idf</span>
<a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a><span class="sd">        List of columns to impute e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a><span class="sd">        &quot;all&quot; can be passed to include all (non-array) columns for analysis.</span>
<a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a><span class="sd">        This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a><span class="sd">        &quot;missing&quot; (default) can be passed to include only those columns with missing values.</span>
<a id="__codelineno-13-34" name="__codelineno-13-34" href="#__codelineno-13-34"></a><span class="sd">        One of the usecases where &quot;all&quot; may be preferable over &quot;missing&quot; is when the user wants to save</span>
<a id="__codelineno-13-35" name="__codelineno-13-35" href="#__codelineno-13-35"></a><span class="sd">        the imputation model for the future use e.g. a column may not have missing value in the training</span>
<a id="__codelineno-13-36" name="__codelineno-13-36" href="#__codelineno-13-36"></a><span class="sd">        dataset but missing values may possibly appear in the prediction dataset.</span>
<a id="__codelineno-13-37" name="__codelineno-13-37" href="#__codelineno-13-37"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-13-38" name="__codelineno-13-38" href="#__codelineno-13-38"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols.</span>
<a id="__codelineno-13-39" name="__codelineno-13-39" href="#__codelineno-13-39"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-13-40" name="__codelineno-13-40" href="#__codelineno-13-40"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-13-41" name="__codelineno-13-41" href="#__codelineno-13-41"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-13-42" name="__codelineno-13-42" href="#__codelineno-13-42"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-13-43" name="__codelineno-13-43" href="#__codelineno-13-43"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-13-44" name="__codelineno-13-44" href="#__codelineno-13-44"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-13-45" name="__codelineno-13-45" href="#__codelineno-13-45"></a><span class="sd">    id_col</span>
<a id="__codelineno-13-46" name="__codelineno-13-46" href="#__codelineno-13-46"></a><span class="sd">        ID column (Default value = &quot;&quot;)</span>
<a id="__codelineno-13-47" name="__codelineno-13-47" href="#__codelineno-13-47"></a><span class="sd">    output_mode</span>
<a id="__codelineno-13-48" name="__codelineno-13-48" href="#__codelineno-13-48"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-13-49" name="__codelineno-13-49" href="#__codelineno-13-49"></a><span class="sd">        “replace” option replaces original columns with transformed column. “append” option append transformed</span>
<a id="__codelineno-13-50" name="__codelineno-13-50" href="#__codelineno-13-50"></a><span class="sd">        column to the input dataset with a postfix &quot;_imputed&quot; e.g. column X is appended as X_imputed. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-13-51" name="__codelineno-13-51" href="#__codelineno-13-51"></a><span class="sd">    stats_missing</span>
<a id="__codelineno-13-52" name="__codelineno-13-52" href="#__codelineno-13-52"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-13-53" name="__codelineno-13-53" href="#__codelineno-13-53"></a><span class="sd">        to read pre-saved statistics on missing count/pct i.e. if measures_of_counts or</span>
<a id="__codelineno-13-54" name="__codelineno-13-54" href="#__codelineno-13-54"></a><span class="sd">        missingCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-13-55" name="__codelineno-13-55" href="#__codelineno-13-55"></a><span class="sd">    print_impact</span>
<a id="__codelineno-13-56" name="__codelineno-13-56" href="#__codelineno-13-56"></a><span class="sd">        True, False (Default value = False)</span>
<a id="__codelineno-13-57" name="__codelineno-13-57" href="#__codelineno-13-57"></a><span class="sd">        This argument is to print out before and after missing counts of imputed columns.</span>
<a id="__codelineno-13-58" name="__codelineno-13-58" href="#__codelineno-13-58"></a>
<a id="__codelineno-13-59" name="__codelineno-13-59" href="#__codelineno-13-59"></a><span class="sd">    Returns</span>
<a id="__codelineno-13-60" name="__codelineno-13-60" href="#__codelineno-13-60"></a><span class="sd">    -------</span>
<a id="__codelineno-13-61" name="__codelineno-13-61" href="#__codelineno-13-61"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-13-62" name="__codelineno-13-62" href="#__codelineno-13-62"></a><span class="sd">        Imputed Dataframe</span>
<a id="__codelineno-13-63" name="__codelineno-13-63" href="#__codelineno-13-63"></a>
<a id="__codelineno-13-64" name="__codelineno-13-64" href="#__codelineno-13-64"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-13-65" name="__codelineno-13-65" href="#__codelineno-13-65"></a>
<a id="__codelineno-13-66" name="__codelineno-13-66" href="#__codelineno-13-66"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-13-67" name="__codelineno-13-67" href="#__codelineno-13-67"></a>    <span class="k">if</span> <span class="n">stats_missing</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-13-68" name="__codelineno-13-68" href="#__codelineno-13-68"></a>        <span class="n">missing_df</span> <span class="o">=</span> <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">)</span>
<a id="__codelineno-13-69" name="__codelineno-13-69" href="#__codelineno-13-69"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-13-70" name="__codelineno-13-70" href="#__codelineno-13-70"></a>        <span class="n">missing_df</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-13-71" name="__codelineno-13-71" href="#__codelineno-13-71"></a>            <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_missing</span><span class="p">)</span>
<a id="__codelineno-13-72" name="__codelineno-13-72" href="#__codelineno-13-72"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_count&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span>
<a id="__codelineno-13-73" name="__codelineno-13-73" href="#__codelineno-13-73"></a>            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">num_cols</span><span class="p">))</span>
<a id="__codelineno-13-74" name="__codelineno-13-74" href="#__codelineno-13-74"></a>        <span class="p">)</span>
<a id="__codelineno-13-75" name="__codelineno-13-75" href="#__codelineno-13-75"></a>
<a id="__codelineno-13-76" name="__codelineno-13-76" href="#__codelineno-13-76"></a>    <span class="n">empty_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-13-77" name="__codelineno-13-77" href="#__codelineno-13-77"></a>        <span class="n">missing_df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-13-78" name="__codelineno-13-78" href="#__codelineno-13-78"></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-13-79" name="__codelineno-13-79" href="#__codelineno-13-79"></a>        <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-13-80" name="__codelineno-13-80" href="#__codelineno-13-80"></a>        <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-13-81" name="__codelineno-13-81" href="#__codelineno-13-81"></a>    <span class="p">)</span>
<a id="__codelineno-13-82" name="__codelineno-13-82" href="#__codelineno-13-82"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">empty_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-13-83" name="__codelineno-13-83" href="#__codelineno-13-83"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-13-84" name="__codelineno-13-84" href="#__codelineno-13-84"></a>            <span class="s2">&quot;Following columns dropped from the imputation as all values are null: &quot;</span>
<a id="__codelineno-13-85" name="__codelineno-13-85" href="#__codelineno-13-85"></a>            <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">empty_cols</span><span class="p">)</span>
<a id="__codelineno-13-86" name="__codelineno-13-86" href="#__codelineno-13-86"></a>        <span class="p">)</span>
<a id="__codelineno-13-87" name="__codelineno-13-87" href="#__codelineno-13-87"></a>
<a id="__codelineno-13-88" name="__codelineno-13-88" href="#__codelineno-13-88"></a>    <span class="n">missing_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-13-89" name="__codelineno-13-89" href="#__codelineno-13-89"></a>        <span class="n">missing_df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-13-90" name="__codelineno-13-90" href="#__codelineno-13-90"></a>        <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-13-91" name="__codelineno-13-91" href="#__codelineno-13-91"></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-13-92" name="__codelineno-13-92" href="#__codelineno-13-92"></a>        <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-13-93" name="__codelineno-13-93" href="#__codelineno-13-93"></a>        <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-13-94" name="__codelineno-13-94" href="#__codelineno-13-94"></a>    <span class="p">)</span>
<a id="__codelineno-13-95" name="__codelineno-13-95" href="#__codelineno-13-95"></a>
<a id="__codelineno-13-96" name="__codelineno-13-96" href="#__codelineno-13-96"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-13-97" name="__codelineno-13-97" href="#__codelineno-13-97"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-13-98" name="__codelineno-13-98" href="#__codelineno-13-98"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;missing&quot;</span><span class="p">:</span>
<a id="__codelineno-13-99" name="__codelineno-13-99" href="#__codelineno-13-99"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">missing_cols</span>
<a id="__codelineno-13-100" name="__codelineno-13-100" href="#__codelineno-13-100"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-13-101" name="__codelineno-13-101" href="#__codelineno-13-101"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-13-102" name="__codelineno-13-102" href="#__codelineno-13-102"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-13-103" name="__codelineno-13-103" href="#__codelineno-13-103"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-13-104" name="__codelineno-13-104" href="#__codelineno-13-104"></a>
<a id="__codelineno-13-105" name="__codelineno-13-105" href="#__codelineno-13-105"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
<a id="__codelineno-13-106" name="__codelineno-13-106" href="#__codelineno-13-106"></a>        <span class="nb">set</span><span class="p">(</span>
<a id="__codelineno-13-107" name="__codelineno-13-107" href="#__codelineno-13-107"></a>            <span class="p">[</span>
<a id="__codelineno-13-108" name="__codelineno-13-108" href="#__codelineno-13-108"></a>                <span class="n">e</span>
<a id="__codelineno-13-109" name="__codelineno-13-109" href="#__codelineno-13-109"></a>                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span>
<a id="__codelineno-13-110" name="__codelineno-13-110" href="#__codelineno-13-110"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">e</span> <span class="o">!=</span> <span class="n">id_col</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">empty_cols</span><span class="p">)</span>
<a id="__codelineno-13-111" name="__codelineno-13-111" href="#__codelineno-13-111"></a>            <span class="p">]</span>
<a id="__codelineno-13-112" name="__codelineno-13-112" href="#__codelineno-13-112"></a>        <span class="p">)</span>
<a id="__codelineno-13-113" name="__codelineno-13-113" href="#__codelineno-13-113"></a>    <span class="p">)</span>
<a id="__codelineno-13-114" name="__codelineno-13-114" href="#__codelineno-13-114"></a>
<a id="__codelineno-13-115" name="__codelineno-13-115" href="#__codelineno-13-115"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span>
<a id="__codelineno-13-116" name="__codelineno-13-116" href="#__codelineno-13-116"></a>        <span class="nb">len</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">missing_cols</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
<a id="__codelineno-13-117" name="__codelineno-13-117" href="#__codelineno-13-117"></a>    <span class="p">):</span>
<a id="__codelineno-13-118" name="__codelineno-13-118" href="#__codelineno-13-118"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No Imputation Performed - No Column(s) to Impute&quot;</span><span class="p">)</span>
<a id="__codelineno-13-119" name="__codelineno-13-119" href="#__codelineno-13-119"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-13-120" name="__codelineno-13-120" href="#__codelineno-13-120"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-13-121" name="__codelineno-13-121" href="#__codelineno-13-121"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-13-122" name="__codelineno-13-122" href="#__codelineno-13-122"></a>            <span class="s2">&quot;No Imputation Performed - Needs more than 1 column for matrix factorization&quot;</span>
<a id="__codelineno-13-123" name="__codelineno-13-123" href="#__codelineno-13-123"></a>        <span class="p">)</span>
<a id="__codelineno-13-124" name="__codelineno-13-124" href="#__codelineno-13-124"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-13-125" name="__codelineno-13-125" href="#__codelineno-13-125"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-13-126" name="__codelineno-13-126" href="#__codelineno-13-126"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-13-127" name="__codelineno-13-127" href="#__codelineno-13-127"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">):</span>
<a id="__codelineno-13-128" name="__codelineno-13-128" href="#__codelineno-13-128"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for output_mode&quot;</span><span class="p">)</span>
<a id="__codelineno-13-129" name="__codelineno-13-129" href="#__codelineno-13-129"></a>
<a id="__codelineno-13-130" name="__codelineno-13-130" href="#__codelineno-13-130"></a>    <span class="n">remove_id</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-13-131" name="__codelineno-13-131" href="#__codelineno-13-131"></a>    <span class="k">if</span> <span class="n">id_col</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
<a id="__codelineno-13-132" name="__codelineno-13-132" href="#__codelineno-13-132"></a>        <span class="n">idf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">monotonically_increasing_id</span><span class="p">())</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-13-133" name="__codelineno-13-133" href="#__codelineno-13-133"></a>            <span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">row_number</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">Window</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">))</span>
<a id="__codelineno-13-134" name="__codelineno-13-134" href="#__codelineno-13-134"></a>        <span class="p">)</span>
<a id="__codelineno-13-135" name="__codelineno-13-135" href="#__codelineno-13-135"></a>        <span class="n">id_col</span> <span class="o">=</span> <span class="s2">&quot;id&quot;</span>
<a id="__codelineno-13-136" name="__codelineno-13-136" href="#__codelineno-13-136"></a>        <span class="n">remove_id</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-13-137" name="__codelineno-13-137" href="#__codelineno-13-137"></a>
<a id="__codelineno-13-138" name="__codelineno-13-138" href="#__codelineno-13-138"></a>    <span class="n">key_and_val</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">create_map</span><span class="p">(</span>
<a id="__codelineno-13-139" name="__codelineno-13-139" href="#__codelineno-13-139"></a>        <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">([[</span><span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">]))</span>
<a id="__codelineno-13-140" name="__codelineno-13-140" href="#__codelineno-13-140"></a>    <span class="p">)</span>
<a id="__codelineno-13-141" name="__codelineno-13-141" href="#__codelineno-13-141"></a>    <span class="n">df_flatten</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">id_col</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="n">key_and_val</span><span class="p">))</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-13-142" name="__codelineno-13-142" href="#__codelineno-13-142"></a>        <span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&quot;_imputed&quot;</span><span class="p">))</span>
<a id="__codelineno-13-143" name="__codelineno-13-143" href="#__codelineno-13-143"></a>    <span class="p">)</span>
<a id="__codelineno-13-144" name="__codelineno-13-144" href="#__codelineno-13-144"></a>
<a id="__codelineno-13-145" name="__codelineno-13-145" href="#__codelineno-13-145"></a>    <span class="n">id_type</span> <span class="o">=</span> <span class="n">get_dtype</span><span class="p">(</span><span class="n">idf</span><span class="p">,</span> <span class="n">id_col</span><span class="p">)</span>
<a id="__codelineno-13-146" name="__codelineno-13-146" href="#__codelineno-13-146"></a>    <span class="k">if</span> <span class="n">id_type</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">:</span>
<a id="__codelineno-13-147" name="__codelineno-13-147" href="#__codelineno-13-147"></a>        <span class="n">id_indexer</span> <span class="o">=</span> <span class="n">StringIndexer</span><span class="p">()</span><span class="o">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="n">id_col</span><span class="p">)</span><span class="o">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s2">&quot;IDLabel&quot;</span><span class="p">)</span>
<a id="__codelineno-13-148" name="__codelineno-13-148" href="#__codelineno-13-148"></a>        <span class="n">id_indexer_model</span> <span class="o">=</span> <span class="n">id_indexer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df_flatten</span><span class="p">)</span>
<a id="__codelineno-13-149" name="__codelineno-13-149" href="#__codelineno-13-149"></a>        <span class="n">df_flatten</span> <span class="o">=</span> <span class="n">id_indexer_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df_flatten</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">id_col</span><span class="p">)</span>
<a id="__codelineno-13-150" name="__codelineno-13-150" href="#__codelineno-13-150"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-13-151" name="__codelineno-13-151" href="#__codelineno-13-151"></a>        <span class="n">df_flatten</span> <span class="o">=</span> <span class="n">df_flatten</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">id_col</span><span class="p">,</span> <span class="s2">&quot;IDLabel&quot;</span><span class="p">)</span>
<a id="__codelineno-13-152" name="__codelineno-13-152" href="#__codelineno-13-152"></a>
<a id="__codelineno-13-153" name="__codelineno-13-153" href="#__codelineno-13-153"></a>    <span class="n">indexer</span> <span class="o">=</span> <span class="n">StringIndexer</span><span class="p">()</span><span class="o">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s2">&quot;keyLabel&quot;</span><span class="p">)</span>
<a id="__codelineno-13-154" name="__codelineno-13-154" href="#__codelineno-13-154"></a>    <span class="n">indexer_model</span> <span class="o">=</span> <span class="n">indexer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df_flatten</span><span class="p">)</span>
<a id="__codelineno-13-155" name="__codelineno-13-155" href="#__codelineno-13-155"></a>    <span class="n">df_encoded</span> <span class="o">=</span> <span class="n">indexer_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df_flatten</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)</span>
<a id="__codelineno-13-156" name="__codelineno-13-156" href="#__codelineno-13-156"></a>    <span class="n">df_model</span> <span class="o">=</span> <span class="n">df_encoded</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">())</span>
<a id="__codelineno-13-157" name="__codelineno-13-157" href="#__codelineno-13-157"></a>    <span class="n">df_test</span> <span class="o">=</span> <span class="n">df_encoded</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">())</span>
<a id="__codelineno-13-158" name="__codelineno-13-158" href="#__codelineno-13-158"></a>    <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-13-159" name="__codelineno-13-159" href="#__codelineno-13-159"></a>        <span class="n">df_model</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;IDLabel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-13-160" name="__codelineno-13-160" href="#__codelineno-13-160"></a>        <span class="o">&lt;</span> <span class="n">df_encoded</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;IDLabel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-13-161" name="__codelineno-13-161" href="#__codelineno-13-161"></a>    <span class="p">):</span>
<a id="__codelineno-13-162" name="__codelineno-13-162" href="#__codelineno-13-162"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-13-163" name="__codelineno-13-163" href="#__codelineno-13-163"></a>            <span class="s2">&quot;The returned odf may not be fully imputed because values for all list_of_cols are null for some IDs&quot;</span>
<a id="__codelineno-13-164" name="__codelineno-13-164" href="#__codelineno-13-164"></a>        <span class="p">)</span>
<a id="__codelineno-13-165" name="__codelineno-13-165" href="#__codelineno-13-165"></a>    <span class="n">als</span> <span class="o">=</span> <span class="n">ALS</span><span class="p">(</span>
<a id="__codelineno-13-166" name="__codelineno-13-166" href="#__codelineno-13-166"></a>        <span class="n">maxIter</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<a id="__codelineno-13-167" name="__codelineno-13-167" href="#__codelineno-13-167"></a>        <span class="n">regParam</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
<a id="__codelineno-13-168" name="__codelineno-13-168" href="#__codelineno-13-168"></a>        <span class="n">userCol</span><span class="o">=</span><span class="s2">&quot;IDLabel&quot;</span><span class="p">,</span>
<a id="__codelineno-13-169" name="__codelineno-13-169" href="#__codelineno-13-169"></a>        <span class="n">itemCol</span><span class="o">=</span><span class="s2">&quot;keyLabel&quot;</span><span class="p">,</span>
<a id="__codelineno-13-170" name="__codelineno-13-170" href="#__codelineno-13-170"></a>        <span class="n">ratingCol</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
<a id="__codelineno-13-171" name="__codelineno-13-171" href="#__codelineno-13-171"></a>        <span class="n">coldStartStrategy</span><span class="o">=</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span>
<a id="__codelineno-13-172" name="__codelineno-13-172" href="#__codelineno-13-172"></a>    <span class="p">)</span>
<a id="__codelineno-13-173" name="__codelineno-13-173" href="#__codelineno-13-173"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">als</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df_model</span><span class="p">)</span>
<a id="__codelineno-13-174" name="__codelineno-13-174" href="#__codelineno-13-174"></a>    <span class="n">df_pred</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-13-175" name="__codelineno-13-175" href="#__codelineno-13-175"></a>        <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df_test</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>
<a id="__codelineno-13-176" name="__codelineno-13-176" href="#__codelineno-13-176"></a>    <span class="p">)</span>
<a id="__codelineno-13-177" name="__codelineno-13-177" href="#__codelineno-13-177"></a>    <span class="n">df_encoded_pred</span> <span class="o">=</span> <span class="n">df_model</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">df_pred</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">df_model</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
<a id="__codelineno-13-178" name="__codelineno-13-178" href="#__codelineno-13-178"></a>
<a id="__codelineno-13-179" name="__codelineno-13-179" href="#__codelineno-13-179"></a>    <span class="k">if</span> <span class="n">id_type</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">:</span>
<a id="__codelineno-13-180" name="__codelineno-13-180" href="#__codelineno-13-180"></a>        <span class="n">IDlabelReverse</span> <span class="o">=</span> <span class="n">IndexToString</span><span class="p">()</span><span class="o">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s2">&quot;IDLabel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="n">id_col</span><span class="p">)</span>
<a id="__codelineno-13-181" name="__codelineno-13-181" href="#__codelineno-13-181"></a>        <span class="n">df_encoded_pred</span> <span class="o">=</span> <span class="n">IDlabelReverse</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df_encoded_pred</span><span class="p">)</span>
<a id="__codelineno-13-182" name="__codelineno-13-182" href="#__codelineno-13-182"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-13-183" name="__codelineno-13-183" href="#__codelineno-13-183"></a>        <span class="n">df_encoded_pred</span> <span class="o">=</span> <span class="n">df_encoded_pred</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;IDLabel&quot;</span><span class="p">,</span> <span class="n">id_col</span><span class="p">)</span>
<a id="__codelineno-13-184" name="__codelineno-13-184" href="#__codelineno-13-184"></a>
<a id="__codelineno-13-185" name="__codelineno-13-185" href="#__codelineno-13-185"></a>    <span class="n">keylabelReverse</span> <span class="o">=</span> <span class="n">IndexToString</span><span class="p">()</span><span class="o">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s2">&quot;keyLabel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)</span>
<a id="__codelineno-13-186" name="__codelineno-13-186" href="#__codelineno-13-186"></a>    <span class="n">odf_imputed</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-13-187" name="__codelineno-13-187" href="#__codelineno-13-187"></a>        <span class="n">keylabelReverse</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df_encoded_pred</span><span class="p">)</span>
<a id="__codelineno-13-188" name="__codelineno-13-188" href="#__codelineno-13-188"></a>        <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">id_col</span><span class="p">)</span>
<a id="__codelineno-13-189" name="__codelineno-13-189" href="#__codelineno-13-189"></a>        <span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)</span>
<a id="__codelineno-13-190" name="__codelineno-13-190" href="#__codelineno-13-190"></a>        <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">))</span>
<a id="__codelineno-13-191" name="__codelineno-13-191" href="#__codelineno-13-191"></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-13-192" name="__codelineno-13-192" href="#__codelineno-13-192"></a>            <span class="p">[</span><span class="n">id_col</span><span class="p">]</span> <span class="o">+</span> <span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">missing_cols</span><span class="p">]</span>
<a id="__codelineno-13-193" name="__codelineno-13-193" href="#__codelineno-13-193"></a>        <span class="p">)</span>
<a id="__codelineno-13-194" name="__codelineno-13-194" href="#__codelineno-13-194"></a>    <span class="p">)</span>
<a id="__codelineno-13-195" name="__codelineno-13-195" href="#__codelineno-13-195"></a>
<a id="__codelineno-13-196" name="__codelineno-13-196" href="#__codelineno-13-196"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">odf_imputed</span><span class="p">,</span> <span class="n">id_col</span><span class="p">,</span> <span class="s2">&quot;left_outer&quot;</span><span class="p">)</span>
<a id="__codelineno-13-197" name="__codelineno-13-197" href="#__codelineno-13-197"></a>
<a id="__codelineno-13-198" name="__codelineno-13-198" href="#__codelineno-13-198"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-13-199" name="__codelineno-13-199" href="#__codelineno-13-199"></a>        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">missing_cols</span><span class="p">:</span>
<a id="__codelineno-13-200" name="__codelineno-13-200" href="#__codelineno-13-200"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">)</span>
<a id="__codelineno-13-201" name="__codelineno-13-201" href="#__codelineno-13-201"></a>        <span class="k">elif</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-13-202" name="__codelineno-13-202" href="#__codelineno-13-202"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-13-203" name="__codelineno-13-203" href="#__codelineno-13-203"></a>
<a id="__codelineno-13-204" name="__codelineno-13-204" href="#__codelineno-13-204"></a>    <span class="k">if</span> <span class="n">remove_id</span><span class="p">:</span>
<a id="__codelineno-13-205" name="__codelineno-13-205" href="#__codelineno-13-205"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
<a id="__codelineno-13-206" name="__codelineno-13-206" href="#__codelineno-13-206"></a>
<a id="__codelineno-13-207" name="__codelineno-13-207" href="#__codelineno-13-207"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-13-208" name="__codelineno-13-208" href="#__codelineno-13-208"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-13-209" name="__codelineno-13-209" href="#__codelineno-13-209"></a>            <span class="n">odf_print</span> <span class="o">=</span> <span class="n">missing_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-13-210" name="__codelineno-13-210" href="#__codelineno-13-210"></a>                <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;missingCount_before&quot;</span><span class="p">)</span>
<a id="__codelineno-13-211" name="__codelineno-13-211" href="#__codelineno-13-211"></a>            <span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-13-212" name="__codelineno-13-212" href="#__codelineno-13-212"></a>                <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">odf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-13-213" name="__codelineno-13-213" href="#__codelineno-13-213"></a>                    <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;missingCount_after&quot;</span><span class="p">)</span>
<a id="__codelineno-13-214" name="__codelineno-13-214" href="#__codelineno-13-214"></a>                <span class="p">),</span>
<a id="__codelineno-13-215" name="__codelineno-13-215" href="#__codelineno-13-215"></a>                <span class="s2">&quot;attribute&quot;</span><span class="p">,</span>
<a id="__codelineno-13-216" name="__codelineno-13-216" href="#__codelineno-13-216"></a>                <span class="s2">&quot;inner&quot;</span><span class="p">,</span>
<a id="__codelineno-13-217" name="__codelineno-13-217" href="#__codelineno-13-217"></a>            <span class="p">)</span>
<a id="__codelineno-13-218" name="__codelineno-13-218" href="#__codelineno-13-218"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-13-219" name="__codelineno-13-219" href="#__codelineno-13-219"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-13-220" name="__codelineno-13-220" href="#__codelineno-13-220"></a>                <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">missing_cols</span><span class="p">]</span>
<a id="__codelineno-13-221" name="__codelineno-13-221" href="#__codelineno-13-221"></a>            <span class="p">]</span>
<a id="__codelineno-13-222" name="__codelineno-13-222" href="#__codelineno-13-222"></a>            <span class="n">odf_print</span> <span class="o">=</span> <span class="n">missing_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-13-223" name="__codelineno-13-223" href="#__codelineno-13-223"></a>                <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;missingCount_before&quot;</span><span class="p">)</span>
<a id="__codelineno-13-224" name="__codelineno-13-224" href="#__codelineno-13-224"></a>            <span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-13-225" name="__codelineno-13-225" href="#__codelineno-13-225"></a>                <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">odf</span><span class="p">,</span> <span class="n">output_cols</span><span class="p">)</span>
<a id="__codelineno-13-226" name="__codelineno-13-226" href="#__codelineno-13-226"></a>                <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;attribute_after&quot;</span><span class="p">)</span>
<a id="__codelineno-13-227" name="__codelineno-13-227" href="#__codelineno-13-227"></a>                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-13-228" name="__codelineno-13-228" href="#__codelineno-13-228"></a>                    <span class="s2">&quot;attribute&quot;</span><span class="p">,</span>
<a id="__codelineno-13-229" name="__codelineno-13-229" href="#__codelineno-13-229"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">expr</span><span class="p">(</span><span class="s2">&quot;substring(attribute_after, 1, length(attribute_after)-8)&quot;</span><span class="p">),</span>
<a id="__codelineno-13-230" name="__codelineno-13-230" href="#__codelineno-13-230"></a>                <span class="p">)</span>
<a id="__codelineno-13-231" name="__codelineno-13-231" href="#__codelineno-13-231"></a>                <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">),</span>
<a id="__codelineno-13-232" name="__codelineno-13-232" href="#__codelineno-13-232"></a>                <span class="s2">&quot;attribute&quot;</span><span class="p">,</span>
<a id="__codelineno-13-233" name="__codelineno-13-233" href="#__codelineno-13-233"></a>                <span class="s2">&quot;inner&quot;</span><span class="p">,</span>
<a id="__codelineno-13-234" name="__codelineno-13-234" href="#__codelineno-13-234"></a>            <span class="p">)</span>
<a id="__codelineno-13-235" name="__codelineno-13-235" href="#__codelineno-13-235"></a>        <span class="n">odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">),</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-13-236" name="__codelineno-13-236" href="#__codelineno-13-236"></a>    <span class="k">return</span> <span class="n">odf</span>
</code></pre></div>
</pre>
</details>
</dd>
<dt id="anovos.data_transformer.transformers.imputation_sklearn"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">imputation_sklearn</span></span>(<span class="n">spark, idf, list_of_cols='missing', drop_cols=[], missing_threshold=1.0, method_type='regression', use_sampling=True, sample_method='random', strata_cols='all', stratified_type='population', sample_size=10000, sample_seed=42, persist=True, persist_option=StorageLevel(True, True, False, False, 1), pre_existing_model=False, model_path='NA', output_mode='replace', stats_missing={}, run_type='local', auth_key='NA', print_impact=False)</span>
</code></dt>
<dd>
<div class="desc"><p>The function "imputation_sklearn" leverages sklearn imputer algorithms. Two methods are supported via this function:
“KNN” and “regression”.</p>
<p>“KNN” option trains a sklearn.impute.KNNImputer which is based on k-Nearest Neighbors algorithm. The missing
values of a sample are imputed using the mean of its 5 nearest neighbors in the training set. “regression” option
trains a sklearn.impute.IterativeImputer which models attribute to impute as a function of rest of the attributes
and imputes using the estimation. Imputation is performed in an iterative way from attributes with fewest number
of missing values to most. All the hyperparameters used in the above mentioned imputers are their default values.</p>
<p>However, sklearn imputers are not scalable, which might be slow if the size of the input dataframe is large.
In fact, if the input dataframe size exceeds 10 GigaBytes, the model fitting step powered by sklearn might fail.
Thus, an input sample_size (the default value is 10,000) can be set to control the number of samples to be used
to train the imputer. If the total number of input dataset exceeds sample_size, the rest of the samples will be imputed
using the trained imputer in a scalable manner. This is one of the way to demonstrate how Anovos has been
designed as a scalable feature engineering library.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>spark</code></strong></dt>
<dd>Spark Session</dd>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe</dd>
<dt><strong><code>list_of_cols</code></strong></dt>
<dd>List of columns to impute e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
"all" can be passed to include all (non-array) columns for analysis.
This is super useful instead of specifying all column names manually.
"missing" (default) can be passed to include only those columns with missing values.
One of the usecases where "all" may be preferable over "missing" is when the user wants to save
the imputation model for the future use e.g. a column may not have missing value in the training
dataset but missing values may possibly appear in the prediction dataset.
Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in
drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols.</dd>
<dt><strong><code>drop_cols</code></strong></dt>
<dd>List of columns to be dropped e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except
a few handful of them. (Default value = [])</dd>
<dt><strong><code>missing_threshold</code></strong></dt>
<dd>Float argument - If list_of_cols is "missing", this argument is used to determined the missing threshold
for every column. The column that has more (count of missing value/ count of total value) &gt;= missing_threshold
will be excluded from the list of columns to be imputed. (Default value = 1.0)</dd>
<dt><strong><code>method_type</code></strong></dt>
<dd>"KNN", "regression".
"KNN" option trains a sklearn.impute.KNNImputer. "regression" option trains a sklearn.impute.IterativeImputer
(Default value = "regression")</dd>
<dt><strong><code>use_sampling</code></strong></dt>
<dd>Boolean argument - True or False. This argument is used to determine whether to use sampling on
source and target dataset, True will enable the use of sample method, otherwise False.
It is recommended to set this as True for large datasets. (Default value = True)</dd>
<dt><strong><code>sample_method</code></strong></dt>
<dd>If use_sampling is True, this argument is used to determine the sampling method.
"stratified" for Stratified sampling, "random" for Random Sampling.
For more details, please refer to <a href="https://docs.anovos.ai/api/data_ingest/data_sampling.html.">https://docs.anovos.ai/api/data_ingest/data_sampling.html.</a>
(Default value = "random")</dd>
<dt><strong><code>strata_cols</code></strong></dt>
<dd>If use_sampling is True and sample_method is "stratified", this argument is used to determine the list
of columns used to be treated as strata. For more details, please refer to
<a href="https://docs.anovos.ai/api/data_ingest/data_sampling.html.">https://docs.anovos.ai/api/data_ingest/data_sampling.html.</a> (Default value = "all")</dd>
<dt><strong><code>stratified_type</code></strong></dt>
<dd>If use_sampling is True and sample_method is "stratified", this argument is used to determine the stratified
sampling method. "population" stands for Proportionate Stratified Sampling,
"balanced" stands for Optimum Stratified Sampling. For more details, please refer to
<a href="https://docs.anovos.ai/api/data_ingest/data_sampling.html.">https://docs.anovos.ai/api/data_ingest/data_sampling.html.</a> (Default value = "population")</dd>
<dt><strong><code>sample_size</code></strong></dt>
<dd>If use_sampling is True, this argument is used to determine maximum rows for training the sklearn imputer
(Default value = 10000)</dd>
<dt><strong><code>sample_seed</code></strong></dt>
<dd>If use_sampling is True, this argument is used to determine the seed of sampling method.
(Default value = 42)</dd>
<dt><strong><code>persist</code></strong></dt>
<dd>Boolean argument - True or False. This argument is used to determine whether to persist on
binning result of source and target dataset, True will enable the use of persist, otherwise False.
It is recommended to set this as True for large datasets. (Default value = True)</dd>
<dt><strong><code>persist_option</code></strong></dt>
<dd>If persist is True, this argument is used to determine the type of persist.
For all the pyspark.StorageLevel option available in persist, please refer to
<a href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.StorageLevel.html">https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.StorageLevel.html</a>
(Default value = pyspark.StorageLevel.MEMORY_AND_DISK)</dd>
<dt><strong><code>pre_existing_model</code></strong></dt>
<dd>Boolean argument – True or False. True if imputation model exists already, False otherwise. (Default value = False)</dd>
<dt><strong><code>model_path</code></strong></dt>
<dd>If pre_existing_model is True, this argument is path for referring the pre-saved model.
If pre_existing_model is False, this argument can be used for saving the model.
Default "NA" means there is neither pre-existing model nor there is a need to save one.</dd>
<dt><strong><code>output_mode</code></strong></dt>
<dd>"replace", "append".
“replace” option replaces original columns with transformed column. “append” option append transformed
column to the input dataset with a postfix "_imputed" e.g. column X is appended as X_imputed. (Default value = "replace")</dd>
<dt><strong><code>stats_missing</code></strong></dt>
<dd>Takes arguments for read_dataset (data_ingest module) function in a dictionary format
to read pre-saved statistics on missing count/pct i.e. if measures_of_counts or
missingCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</dd>
<dt><strong><code>run_type</code></strong></dt>
<dd>"local", "emr", "databricks", "ak8s" (Default value = "local")</dd>
<dt><strong><code>auth_key</code></strong></dt>
<dd>Option to pass an authorization key to write to filesystems. Currently applicable only for ak8s run_type. Default value is kept as "NA"</dd>
<dt><strong><code>print_impact</code></strong></dt>
<dd>True, False (Default value = False)
This argument is to print out before and after missing counts of imputed columns.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>DataFrame</code></dt>
<dd>Imputed Dataframe</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">def</span> <span class="nf">imputation_sklearn</span><span class="p">(</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">,</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>    <span class="n">missing_threshold</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>    <span class="n">method_type</span><span class="o">=</span><span class="s2">&quot;regression&quot;</span><span class="p">,</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>    <span class="n">use_sampling</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>    <span class="n">sample_method</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>    <span class="n">strata_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>    <span class="n">stratified_type</span><span class="o">=</span><span class="s2">&quot;population&quot;</span><span class="p">,</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>    <span class="n">sample_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>    <span class="n">sample_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>    <span class="n">persist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>    <span class="n">persist_option</span><span class="o">=</span><span class="n">pyspark</span><span class="o">.</span><span class="n">StorageLevel</span><span class="o">.</span><span class="n">MEMORY_AND_DISK</span><span class="p">,</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>    <span class="n">pre_existing_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>    <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>    <span class="n">stats_missing</span><span class="o">=</span><span class="p">{},</span>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>    <span class="n">run_type</span><span class="o">=</span><span class="s2">&quot;local&quot;</span><span class="p">,</span>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>    <span class="n">auth_key</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a><span class="p">):</span>
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a><span class="sd">    The function &quot;imputation_sklearn&quot; leverages sklearn imputer algorithms. Two methods are supported via this function:</span>
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a><span class="sd">    “KNN” and “regression”.</span>
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a>
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a><span class="sd">    “KNN” option trains a sklearn.impute.KNNImputer which is based on k-Nearest Neighbors algorithm. The missing</span>
<a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a><span class="sd">    values of a sample are imputed using the mean of its 5 nearest neighbors in the training set. “regression” option</span>
<a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a><span class="sd">    trains a sklearn.impute.IterativeImputer which models attribute to impute as a function of rest of the attributes</span>
<a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a><span class="sd">    and imputes using the estimation. Imputation is performed in an iterative way from attributes with fewest number</span>
<a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a><span class="sd">    of missing values to most. All the hyperparameters used in the above mentioned imputers are their default values.</span>
<a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a>
<a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a><span class="sd">    However, sklearn imputers are not scalable, which might be slow if the size of the input dataframe is large.</span>
<a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a><span class="sd">    In fact, if the input dataframe size exceeds 10 GigaBytes, the model fitting step powered by sklearn might fail.</span>
<a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a><span class="sd">    Thus, an input sample_size (the default value is 10,000) can be set to control the number of samples to be used</span>
<a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a><span class="sd">    to train the imputer. If the total number of input dataset exceeds sample_size, the rest of the samples will be imputed</span>
<a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a><span class="sd">    using the trained imputer in a scalable manner. This is one of the way to demonstrate how Anovos has been</span>
<a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a><span class="sd">    designed as a scalable feature engineering library.</span>
<a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a>
<a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a>
<a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a><span class="sd">    Parameters</span>
<a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a><span class="sd">    ----------</span>
<a id="__codelineno-14-44" name="__codelineno-14-44" href="#__codelineno-14-44"></a><span class="sd">    spark</span>
<a id="__codelineno-14-45" name="__codelineno-14-45" href="#__codelineno-14-45"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-14-46" name="__codelineno-14-46" href="#__codelineno-14-46"></a><span class="sd">    idf</span>
<a id="__codelineno-14-47" name="__codelineno-14-47" href="#__codelineno-14-47"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-14-48" name="__codelineno-14-48" href="#__codelineno-14-48"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-14-49" name="__codelineno-14-49" href="#__codelineno-14-49"></a><span class="sd">        List of columns to impute e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-14-50" name="__codelineno-14-50" href="#__codelineno-14-50"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-14-51" name="__codelineno-14-51" href="#__codelineno-14-51"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-14-52" name="__codelineno-14-52" href="#__codelineno-14-52"></a><span class="sd">        &quot;all&quot; can be passed to include all (non-array) columns for analysis.</span>
<a id="__codelineno-14-53" name="__codelineno-14-53" href="#__codelineno-14-53"></a><span class="sd">        This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-14-54" name="__codelineno-14-54" href="#__codelineno-14-54"></a><span class="sd">        &quot;missing&quot; (default) can be passed to include only those columns with missing values.</span>
<a id="__codelineno-14-55" name="__codelineno-14-55" href="#__codelineno-14-55"></a><span class="sd">        One of the usecases where &quot;all&quot; may be preferable over &quot;missing&quot; is when the user wants to save</span>
<a id="__codelineno-14-56" name="__codelineno-14-56" href="#__codelineno-14-56"></a><span class="sd">        the imputation model for the future use e.g. a column may not have missing value in the training</span>
<a id="__codelineno-14-57" name="__codelineno-14-57" href="#__codelineno-14-57"></a><span class="sd">        dataset but missing values may possibly appear in the prediction dataset.</span>
<a id="__codelineno-14-58" name="__codelineno-14-58" href="#__codelineno-14-58"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-14-59" name="__codelineno-14-59" href="#__codelineno-14-59"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols.</span>
<a id="__codelineno-14-60" name="__codelineno-14-60" href="#__codelineno-14-60"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-14-61" name="__codelineno-14-61" href="#__codelineno-14-61"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-14-62" name="__codelineno-14-62" href="#__codelineno-14-62"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-14-63" name="__codelineno-14-63" href="#__codelineno-14-63"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-14-64" name="__codelineno-14-64" href="#__codelineno-14-64"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-14-65" name="__codelineno-14-65" href="#__codelineno-14-65"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-14-66" name="__codelineno-14-66" href="#__codelineno-14-66"></a><span class="sd">    missing_threshold</span>
<a id="__codelineno-14-67" name="__codelineno-14-67" href="#__codelineno-14-67"></a><span class="sd">        Float argument - If list_of_cols is &quot;missing&quot;, this argument is used to determined the missing threshold</span>
<a id="__codelineno-14-68" name="__codelineno-14-68" href="#__codelineno-14-68"></a><span class="sd">        for every column. The column that has more (count of missing value/ count of total value) &gt;= missing_threshold</span>
<a id="__codelineno-14-69" name="__codelineno-14-69" href="#__codelineno-14-69"></a><span class="sd">        will be excluded from the list of columns to be imputed. (Default value = 1.0)</span>
<a id="__codelineno-14-70" name="__codelineno-14-70" href="#__codelineno-14-70"></a><span class="sd">    method_type</span>
<a id="__codelineno-14-71" name="__codelineno-14-71" href="#__codelineno-14-71"></a><span class="sd">        &quot;KNN&quot;, &quot;regression&quot;.</span>
<a id="__codelineno-14-72" name="__codelineno-14-72" href="#__codelineno-14-72"></a><span class="sd">        &quot;KNN&quot; option trains a sklearn.impute.KNNImputer. &quot;regression&quot; option trains a sklearn.impute.IterativeImputer</span>
<a id="__codelineno-14-73" name="__codelineno-14-73" href="#__codelineno-14-73"></a><span class="sd">        (Default value = &quot;regression&quot;)</span>
<a id="__codelineno-14-74" name="__codelineno-14-74" href="#__codelineno-14-74"></a><span class="sd">    use_sampling</span>
<a id="__codelineno-14-75" name="__codelineno-14-75" href="#__codelineno-14-75"></a><span class="sd">        Boolean argument - True or False. This argument is used to determine whether to use sampling on</span>
<a id="__codelineno-14-76" name="__codelineno-14-76" href="#__codelineno-14-76"></a><span class="sd">        source and target dataset, True will enable the use of sample method, otherwise False.</span>
<a id="__codelineno-14-77" name="__codelineno-14-77" href="#__codelineno-14-77"></a><span class="sd">        It is recommended to set this as True for large datasets. (Default value = True)</span>
<a id="__codelineno-14-78" name="__codelineno-14-78" href="#__codelineno-14-78"></a><span class="sd">    sample_method</span>
<a id="__codelineno-14-79" name="__codelineno-14-79" href="#__codelineno-14-79"></a><span class="sd">        If use_sampling is True, this argument is used to determine the sampling method.</span>
<a id="__codelineno-14-80" name="__codelineno-14-80" href="#__codelineno-14-80"></a><span class="sd">        &quot;stratified&quot; for Stratified sampling, &quot;random&quot; for Random Sampling.</span>
<a id="__codelineno-14-81" name="__codelineno-14-81" href="#__codelineno-14-81"></a><span class="sd">        For more details, please refer to https://docs.anovos.ai/api/data_ingest/data_sampling.html.</span>
<a id="__codelineno-14-82" name="__codelineno-14-82" href="#__codelineno-14-82"></a><span class="sd">        (Default value = &quot;random&quot;)</span>
<a id="__codelineno-14-83" name="__codelineno-14-83" href="#__codelineno-14-83"></a><span class="sd">    strata_cols</span>
<a id="__codelineno-14-84" name="__codelineno-14-84" href="#__codelineno-14-84"></a><span class="sd">        If use_sampling is True and sample_method is &quot;stratified&quot;, this argument is used to determine the list</span>
<a id="__codelineno-14-85" name="__codelineno-14-85" href="#__codelineno-14-85"></a><span class="sd">        of columns used to be treated as strata. For more details, please refer to</span>
<a id="__codelineno-14-86" name="__codelineno-14-86" href="#__codelineno-14-86"></a><span class="sd">        https://docs.anovos.ai/api/data_ingest/data_sampling.html. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-14-87" name="__codelineno-14-87" href="#__codelineno-14-87"></a><span class="sd">    stratified_type</span>
<a id="__codelineno-14-88" name="__codelineno-14-88" href="#__codelineno-14-88"></a><span class="sd">        If use_sampling is True and sample_method is &quot;stratified&quot;, this argument is used to determine the stratified</span>
<a id="__codelineno-14-89" name="__codelineno-14-89" href="#__codelineno-14-89"></a><span class="sd">        sampling method. &quot;population&quot; stands for Proportionate Stratified Sampling,</span>
<a id="__codelineno-14-90" name="__codelineno-14-90" href="#__codelineno-14-90"></a><span class="sd">        &quot;balanced&quot; stands for Optimum Stratified Sampling. For more details, please refer to</span>
<a id="__codelineno-14-91" name="__codelineno-14-91" href="#__codelineno-14-91"></a><span class="sd">        https://docs.anovos.ai/api/data_ingest/data_sampling.html. (Default value = &quot;population&quot;)</span>
<a id="__codelineno-14-92" name="__codelineno-14-92" href="#__codelineno-14-92"></a><span class="sd">    sample_size</span>
<a id="__codelineno-14-93" name="__codelineno-14-93" href="#__codelineno-14-93"></a><span class="sd">        If use_sampling is True, this argument is used to determine maximum rows for training the sklearn imputer</span>
<a id="__codelineno-14-94" name="__codelineno-14-94" href="#__codelineno-14-94"></a><span class="sd">        (Default value = 10000)</span>
<a id="__codelineno-14-95" name="__codelineno-14-95" href="#__codelineno-14-95"></a><span class="sd">    sample_seed</span>
<a id="__codelineno-14-96" name="__codelineno-14-96" href="#__codelineno-14-96"></a><span class="sd">        If use_sampling is True, this argument is used to determine the seed of sampling method.</span>
<a id="__codelineno-14-97" name="__codelineno-14-97" href="#__codelineno-14-97"></a><span class="sd">        (Default value = 42)</span>
<a id="__codelineno-14-98" name="__codelineno-14-98" href="#__codelineno-14-98"></a><span class="sd">    persist</span>
<a id="__codelineno-14-99" name="__codelineno-14-99" href="#__codelineno-14-99"></a><span class="sd">        Boolean argument - True or False. This argument is used to determine whether to persist on</span>
<a id="__codelineno-14-100" name="__codelineno-14-100" href="#__codelineno-14-100"></a><span class="sd">        binning result of source and target dataset, True will enable the use of persist, otherwise False.</span>
<a id="__codelineno-14-101" name="__codelineno-14-101" href="#__codelineno-14-101"></a><span class="sd">        It is recommended to set this as True for large datasets. (Default value = True)</span>
<a id="__codelineno-14-102" name="__codelineno-14-102" href="#__codelineno-14-102"></a><span class="sd">    persist_option</span>
<a id="__codelineno-14-103" name="__codelineno-14-103" href="#__codelineno-14-103"></a><span class="sd">        If persist is True, this argument is used to determine the type of persist.</span>
<a id="__codelineno-14-104" name="__codelineno-14-104" href="#__codelineno-14-104"></a><span class="sd">        For all the pyspark.StorageLevel option available in persist, please refer to</span>
<a id="__codelineno-14-105" name="__codelineno-14-105" href="#__codelineno-14-105"></a><span class="sd">        https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.StorageLevel.html</span>
<a id="__codelineno-14-106" name="__codelineno-14-106" href="#__codelineno-14-106"></a><span class="sd">        (Default value = pyspark.StorageLevel.MEMORY_AND_DISK)</span>
<a id="__codelineno-14-107" name="__codelineno-14-107" href="#__codelineno-14-107"></a><span class="sd">    pre_existing_model</span>
<a id="__codelineno-14-108" name="__codelineno-14-108" href="#__codelineno-14-108"></a><span class="sd">        Boolean argument – True or False. True if imputation model exists already, False otherwise. (Default value = False)</span>
<a id="__codelineno-14-109" name="__codelineno-14-109" href="#__codelineno-14-109"></a><span class="sd">    model_path</span>
<a id="__codelineno-14-110" name="__codelineno-14-110" href="#__codelineno-14-110"></a><span class="sd">        If pre_existing_model is True, this argument is path for referring the pre-saved model.</span>
<a id="__codelineno-14-111" name="__codelineno-14-111" href="#__codelineno-14-111"></a><span class="sd">        If pre_existing_model is False, this argument can be used for saving the model.</span>
<a id="__codelineno-14-112" name="__codelineno-14-112" href="#__codelineno-14-112"></a><span class="sd">        Default &quot;NA&quot; means there is neither pre-existing model nor there is a need to save one.</span>
<a id="__codelineno-14-113" name="__codelineno-14-113" href="#__codelineno-14-113"></a><span class="sd">    output_mode</span>
<a id="__codelineno-14-114" name="__codelineno-14-114" href="#__codelineno-14-114"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-14-115" name="__codelineno-14-115" href="#__codelineno-14-115"></a><span class="sd">        “replace” option replaces original columns with transformed column. “append” option append transformed</span>
<a id="__codelineno-14-116" name="__codelineno-14-116" href="#__codelineno-14-116"></a><span class="sd">        column to the input dataset with a postfix &quot;_imputed&quot; e.g. column X is appended as X_imputed. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-14-117" name="__codelineno-14-117" href="#__codelineno-14-117"></a><span class="sd">    stats_missing</span>
<a id="__codelineno-14-118" name="__codelineno-14-118" href="#__codelineno-14-118"></a><span class="sd">        Takes arguments for read_dataset (data_ingest module) function in a dictionary format</span>
<a id="__codelineno-14-119" name="__codelineno-14-119" href="#__codelineno-14-119"></a><span class="sd">        to read pre-saved statistics on missing count/pct i.e. if measures_of_counts or</span>
<a id="__codelineno-14-120" name="__codelineno-14-120" href="#__codelineno-14-120"></a><span class="sd">        missingCount_computation (data_analyzer.stats_generator module) has been computed &amp; saved before. (Default value = {})</span>
<a id="__codelineno-14-121" name="__codelineno-14-121" href="#__codelineno-14-121"></a><span class="sd">    run_type</span>
<a id="__codelineno-14-122" name="__codelineno-14-122" href="#__codelineno-14-122"></a><span class="sd">        &quot;local&quot;, &quot;emr&quot;, &quot;databricks&quot;, &quot;ak8s&quot; (Default value = &quot;local&quot;)</span>
<a id="__codelineno-14-123" name="__codelineno-14-123" href="#__codelineno-14-123"></a><span class="sd">    auth_key</span>
<a id="__codelineno-14-124" name="__codelineno-14-124" href="#__codelineno-14-124"></a><span class="sd">        Option to pass an authorization key to write to filesystems. Currently applicable only for ak8s run_type. Default value is kept as &quot;NA&quot;</span>
<a id="__codelineno-14-125" name="__codelineno-14-125" href="#__codelineno-14-125"></a><span class="sd">    print_impact</span>
<a id="__codelineno-14-126" name="__codelineno-14-126" href="#__codelineno-14-126"></a><span class="sd">        True, False (Default value = False)</span>
<a id="__codelineno-14-127" name="__codelineno-14-127" href="#__codelineno-14-127"></a><span class="sd">        This argument is to print out before and after missing counts of imputed columns.</span>
<a id="__codelineno-14-128" name="__codelineno-14-128" href="#__codelineno-14-128"></a>
<a id="__codelineno-14-129" name="__codelineno-14-129" href="#__codelineno-14-129"></a><span class="sd">    Returns</span>
<a id="__codelineno-14-130" name="__codelineno-14-130" href="#__codelineno-14-130"></a><span class="sd">    -------</span>
<a id="__codelineno-14-131" name="__codelineno-14-131" href="#__codelineno-14-131"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-14-132" name="__codelineno-14-132" href="#__codelineno-14-132"></a><span class="sd">        Imputed Dataframe</span>
<a id="__codelineno-14-133" name="__codelineno-14-133" href="#__codelineno-14-133"></a>
<a id="__codelineno-14-134" name="__codelineno-14-134" href="#__codelineno-14-134"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-14-135" name="__codelineno-14-135" href="#__codelineno-14-135"></a>
<a id="__codelineno-14-136" name="__codelineno-14-136" href="#__codelineno-14-136"></a>    <span class="k">if</span> <span class="n">persist</span><span class="p">:</span>
<a id="__codelineno-14-137" name="__codelineno-14-137" href="#__codelineno-14-137"></a>        <span class="n">idf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">persist</span><span class="p">(</span><span class="n">persist_option</span><span class="p">)</span>
<a id="__codelineno-14-138" name="__codelineno-14-138" href="#__codelineno-14-138"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-14-139" name="__codelineno-14-139" href="#__codelineno-14-139"></a>    <span class="k">if</span> <span class="n">stats_missing</span> <span class="o">==</span> <span class="p">{}:</span>
<a id="__codelineno-14-140" name="__codelineno-14-140" href="#__codelineno-14-140"></a>        <span class="n">missing_df</span> <span class="o">=</span> <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">)</span>
<a id="__codelineno-14-141" name="__codelineno-14-141" href="#__codelineno-14-141"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-14-142" name="__codelineno-14-142" href="#__codelineno-14-142"></a>        <span class="n">missing_df</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-14-143" name="__codelineno-14-143" href="#__codelineno-14-143"></a>            <span class="n">read_dataset</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="o">**</span><span class="n">stats_missing</span><span class="p">)</span>
<a id="__codelineno-14-144" name="__codelineno-14-144" href="#__codelineno-14-144"></a>            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_count&quot;</span><span class="p">,</span> <span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span>
<a id="__codelineno-14-145" name="__codelineno-14-145" href="#__codelineno-14-145"></a>            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">num_cols</span><span class="p">))</span>
<a id="__codelineno-14-146" name="__codelineno-14-146" href="#__codelineno-14-146"></a>        <span class="p">)</span>
<a id="__codelineno-14-147" name="__codelineno-14-147" href="#__codelineno-14-147"></a>    <span class="n">empty_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-14-148" name="__codelineno-14-148" href="#__codelineno-14-148"></a>        <span class="n">missing_df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-14-149" name="__codelineno-14-149" href="#__codelineno-14-149"></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-14-150" name="__codelineno-14-150" href="#__codelineno-14-150"></a>        <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-14-151" name="__codelineno-14-151" href="#__codelineno-14-151"></a>        <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-14-152" name="__codelineno-14-152" href="#__codelineno-14-152"></a>    <span class="p">)</span>
<a id="__codelineno-14-153" name="__codelineno-14-153" href="#__codelineno-14-153"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">empty_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-14-154" name="__codelineno-14-154" href="#__codelineno-14-154"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-14-155" name="__codelineno-14-155" href="#__codelineno-14-155"></a>            <span class="s2">&quot;Following columns dropped from the imputation as all values are null: &quot;</span>
<a id="__codelineno-14-156" name="__codelineno-14-156" href="#__codelineno-14-156"></a>            <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">empty_cols</span><span class="p">)</span>
<a id="__codelineno-14-157" name="__codelineno-14-157" href="#__codelineno-14-157"></a>        <span class="p">)</span>
<a id="__codelineno-14-158" name="__codelineno-14-158" href="#__codelineno-14-158"></a>
<a id="__codelineno-14-159" name="__codelineno-14-159" href="#__codelineno-14-159"></a>    <span class="n">missing_cols</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-14-160" name="__codelineno-14-160" href="#__codelineno-14-160"></a>        <span class="n">missing_df</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-14-161" name="__codelineno-14-161" href="#__codelineno-14-161"></a>        <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">missing_threshold</span><span class="p">)</span>
<a id="__codelineno-14-162" name="__codelineno-14-162" href="#__codelineno-14-162"></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">)</span>
<a id="__codelineno-14-163" name="__codelineno-14-163" href="#__codelineno-14-163"></a>        <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-14-164" name="__codelineno-14-164" href="#__codelineno-14-164"></a>        <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-14-165" name="__codelineno-14-165" href="#__codelineno-14-165"></a>    <span class="p">)</span>
<a id="__codelineno-14-166" name="__codelineno-14-166" href="#__codelineno-14-166"></a>
<a id="__codelineno-14-167" name="__codelineno-14-167" href="#__codelineno-14-167"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-14-168" name="__codelineno-14-168" href="#__codelineno-14-168"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-14-169" name="__codelineno-14-169" href="#__codelineno-14-169"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;missing&quot;</span><span class="p">:</span>
<a id="__codelineno-14-170" name="__codelineno-14-170" href="#__codelineno-14-170"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">missing_cols</span>
<a id="__codelineno-14-171" name="__codelineno-14-171" href="#__codelineno-14-171"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-14-172" name="__codelineno-14-172" href="#__codelineno-14-172"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-14-173" name="__codelineno-14-173" href="#__codelineno-14-173"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-14-174" name="__codelineno-14-174" href="#__codelineno-14-174"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-14-175" name="__codelineno-14-175" href="#__codelineno-14-175"></a>
<a id="__codelineno-14-176" name="__codelineno-14-176" href="#__codelineno-14-176"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
<a id="__codelineno-14-177" name="__codelineno-14-177" href="#__codelineno-14-177"></a>        <span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">empty_cols</span><span class="p">)])</span>
<a id="__codelineno-14-178" name="__codelineno-14-178" href="#__codelineno-14-178"></a>    <span class="p">)</span>
<a id="__codelineno-14-179" name="__codelineno-14-179" href="#__codelineno-14-179"></a>
<a id="__codelineno-14-180" name="__codelineno-14-180" href="#__codelineno-14-180"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-14-181" name="__codelineno-14-181" href="#__codelineno-14-181"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-14-182" name="__codelineno-14-182" href="#__codelineno-14-182"></a>            <span class="s2">&quot;No Imputation Performed - No Column(s) or Insufficient Column(s) to Impute&quot;</span>
<a id="__codelineno-14-183" name="__codelineno-14-183" href="#__codelineno-14-183"></a>        <span class="p">)</span>
<a id="__codelineno-14-184" name="__codelineno-14-184" href="#__codelineno-14-184"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-14-185" name="__codelineno-14-185" href="#__codelineno-14-185"></a>
<a id="__codelineno-14-186" name="__codelineno-14-186" href="#__codelineno-14-186"></a>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_existing_model</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
<a id="__codelineno-14-187" name="__codelineno-14-187" href="#__codelineno-14-187"></a>        <span class="n">pre_existing_model</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-14-188" name="__codelineno-14-188" href="#__codelineno-14-188"></a>    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">pre_existing_model</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
<a id="__codelineno-14-189" name="__codelineno-14-189" href="#__codelineno-14-189"></a>        <span class="n">pre_existing_model</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-14-190" name="__codelineno-14-190" href="#__codelineno-14-190"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-14-191" name="__codelineno-14-191" href="#__codelineno-14-191"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Non-Boolean input for pre_existing_model&quot;</span><span class="p">)</span>
<a id="__codelineno-14-192" name="__codelineno-14-192" href="#__codelineno-14-192"></a>    <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-14-193" name="__codelineno-14-193" href="#__codelineno-14-193"></a>        <span class="p">(</span><span class="nb">len</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">missing_cols</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-14-194" name="__codelineno-14-194" href="#__codelineno-14-194"></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pre_existing_model</span><span class="p">)</span>
<a id="__codelineno-14-195" name="__codelineno-14-195" href="#__codelineno-14-195"></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="n">model_path</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span><span class="p">)</span>
<a id="__codelineno-14-196" name="__codelineno-14-196" href="#__codelineno-14-196"></a>    <span class="p">):</span>
<a id="__codelineno-14-197" name="__codelineno-14-197" href="#__codelineno-14-197"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-14-198" name="__codelineno-14-198" href="#__codelineno-14-198"></a>            <span class="s2">&quot;No Imputation Performed - No Column(s) to Impute and No Imputation Model to be saved&quot;</span>
<a id="__codelineno-14-199" name="__codelineno-14-199" href="#__codelineno-14-199"></a>        <span class="p">)</span>
<a id="__codelineno-14-200" name="__codelineno-14-200" href="#__codelineno-14-200"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-14-201" name="__codelineno-14-201" href="#__codelineno-14-201"></a>
<a id="__codelineno-14-202" name="__codelineno-14-202" href="#__codelineno-14-202"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-14-203" name="__codelineno-14-203" href="#__codelineno-14-203"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-14-204" name="__codelineno-14-204" href="#__codelineno-14-204"></a>    <span class="k">if</span> <span class="n">method_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;KNN&quot;</span><span class="p">,</span> <span class="s2">&quot;regression&quot;</span><span class="p">):</span>
<a id="__codelineno-14-205" name="__codelineno-14-205" href="#__codelineno-14-205"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for method_type&quot;</span><span class="p">)</span>
<a id="__codelineno-14-206" name="__codelineno-14-206" href="#__codelineno-14-206"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">):</span>
<a id="__codelineno-14-207" name="__codelineno-14-207" href="#__codelineno-14-207"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for output_mode&quot;</span><span class="p">)</span>
<a id="__codelineno-14-208" name="__codelineno-14-208" href="#__codelineno-14-208"></a>
<a id="__codelineno-14-209" name="__codelineno-14-209" href="#__codelineno-14-209"></a>    <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-14-210" name="__codelineno-14-210" href="#__codelineno-14-210"></a>        <span class="k">if</span> <span class="n">run_type</span> <span class="o">==</span> <span class="s2">&quot;emr&quot;</span><span class="p">:</span>
<a id="__codelineno-14-211" name="__codelineno-14-211" href="#__codelineno-14-211"></a>            <span class="n">bash_cmd</span> <span class="o">=</span> <span class="s2">&quot;aws s3 cp &quot;</span> <span class="o">+</span> <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/imputation_sklearn.sav .&quot;</span>
<a id="__codelineno-14-212" name="__codelineno-14-212" href="#__codelineno-14-212"></a>            <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">bash_cmd</span><span class="p">])</span>
<a id="__codelineno-14-213" name="__codelineno-14-213" href="#__codelineno-14-213"></a>            <span class="n">imputer</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;imputation_sklearn.sav&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
<a id="__codelineno-14-214" name="__codelineno-14-214" href="#__codelineno-14-214"></a>        <span class="k">elif</span> <span class="n">run_type</span> <span class="o">==</span> <span class="s2">&quot;ak8s&quot;</span><span class="p">:</span>
<a id="__codelineno-14-215" name="__codelineno-14-215" href="#__codelineno-14-215"></a>            <span class="n">bash_cmd</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-14-216" name="__codelineno-14-216" href="#__codelineno-14-216"></a>                <span class="s1">&#39;azcopy cp &quot;&#39;</span>
<a id="__codelineno-14-217" name="__codelineno-14-217" href="#__codelineno-14-217"></a>                <span class="o">+</span> <span class="n">model_path</span>
<a id="__codelineno-14-218" name="__codelineno-14-218" href="#__codelineno-14-218"></a>                <span class="o">+</span> <span class="s2">&quot;/imputation_sklearn.sav&quot;</span>
<a id="__codelineno-14-219" name="__codelineno-14-219" href="#__codelineno-14-219"></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">auth_key</span><span class="p">)</span>
<a id="__codelineno-14-220" name="__codelineno-14-220" href="#__codelineno-14-220"></a>                <span class="o">+</span> <span class="s1">&#39;&quot; .&#39;</span>
<a id="__codelineno-14-221" name="__codelineno-14-221" href="#__codelineno-14-221"></a>            <span class="p">)</span>
<a id="__codelineno-14-222" name="__codelineno-14-222" href="#__codelineno-14-222"></a>            <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">bash_cmd</span><span class="p">])</span>
<a id="__codelineno-14-223" name="__codelineno-14-223" href="#__codelineno-14-223"></a>            <span class="n">imputer</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;imputation_sklearn.sav&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
<a id="__codelineno-14-224" name="__codelineno-14-224" href="#__codelineno-14-224"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-14-225" name="__codelineno-14-225" href="#__codelineno-14-225"></a>            <span class="n">imputer</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/imputation_sklearn.sav&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
<a id="__codelineno-14-226" name="__codelineno-14-226" href="#__codelineno-14-226"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-14-227" name="__codelineno-14-227" href="#__codelineno-14-227"></a>        <span class="k">if</span> <span class="n">use_sampling</span><span class="p">:</span>
<a id="__codelineno-14-228" name="__codelineno-14-228" href="#__codelineno-14-228"></a>            <span class="n">count_idf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-14-229" name="__codelineno-14-229" href="#__codelineno-14-229"></a>            <span class="k">if</span> <span class="n">count_idf</span> <span class="o">&gt;</span> <span class="n">sample_size</span><span class="p">:</span>
<a id="__codelineno-14-230" name="__codelineno-14-230" href="#__codelineno-14-230"></a>                <span class="n">idf_model</span> <span class="o">=</span> <span class="n">data_sample</span><span class="p">(</span>
<a id="__codelineno-14-231" name="__codelineno-14-231" href="#__codelineno-14-231"></a>                    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-14-232" name="__codelineno-14-232" href="#__codelineno-14-232"></a>                    <span class="n">strata_cols</span><span class="o">=</span><span class="n">strata_cols</span><span class="p">,</span>
<a id="__codelineno-14-233" name="__codelineno-14-233" href="#__codelineno-14-233"></a>                    <span class="n">fraction</span><span class="o">=</span><span class="n">sample_size</span> <span class="o">/</span> <span class="n">count_idf</span><span class="p">,</span>
<a id="__codelineno-14-234" name="__codelineno-14-234" href="#__codelineno-14-234"></a>                    <span class="n">method_type</span><span class="o">=</span><span class="n">sample_method</span><span class="p">,</span>
<a id="__codelineno-14-235" name="__codelineno-14-235" href="#__codelineno-14-235"></a>                    <span class="n">stratified_type</span><span class="o">=</span><span class="n">stratified_type</span><span class="p">,</span>
<a id="__codelineno-14-236" name="__codelineno-14-236" href="#__codelineno-14-236"></a>                    <span class="n">seed_value</span><span class="o">=</span><span class="n">sample_seed</span><span class="p">,</span>
<a id="__codelineno-14-237" name="__codelineno-14-237" href="#__codelineno-14-237"></a>                <span class="p">)</span>
<a id="__codelineno-14-238" name="__codelineno-14-238" href="#__codelineno-14-238"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-14-239" name="__codelineno-14-239" href="#__codelineno-14-239"></a>                <span class="n">idf_model</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-14-240" name="__codelineno-14-240" href="#__codelineno-14-240"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-14-241" name="__codelineno-14-241" href="#__codelineno-14-241"></a>            <span class="n">idf_model</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-14-242" name="__codelineno-14-242" href="#__codelineno-14-242"></a>        <span class="k">if</span> <span class="n">persist</span><span class="p">:</span>
<a id="__codelineno-14-243" name="__codelineno-14-243" href="#__codelineno-14-243"></a>            <span class="n">idf_model</span> <span class="o">=</span> <span class="n">idf_model</span><span class="o">.</span><span class="n">persist</span><span class="p">(</span><span class="n">persist_option</span><span class="p">)</span>
<a id="__codelineno-14-244" name="__codelineno-14-244" href="#__codelineno-14-244"></a>        <span class="n">idf_pd</span> <span class="o">=</span> <span class="n">idf_model</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<a id="__codelineno-14-245" name="__codelineno-14-245" href="#__codelineno-14-245"></a>
<a id="__codelineno-14-246" name="__codelineno-14-246" href="#__codelineno-14-246"></a>        <span class="k">if</span> <span class="n">method_type</span> <span class="o">==</span> <span class="s2">&quot;KNN&quot;</span><span class="p">:</span>
<a id="__codelineno-14-247" name="__codelineno-14-247" href="#__codelineno-14-247"></a>            <span class="n">imputer</span> <span class="o">=</span> <span class="n">KNNImputer</span><span class="p">(</span>
<a id="__codelineno-14-248" name="__codelineno-14-248" href="#__codelineno-14-248"></a>                <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s2">&quot;uniform&quot;</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;nan_euclidean&quot;</span>
<a id="__codelineno-14-249" name="__codelineno-14-249" href="#__codelineno-14-249"></a>            <span class="p">)</span>
<a id="__codelineno-14-250" name="__codelineno-14-250" href="#__codelineno-14-250"></a>        <span class="k">if</span> <span class="n">method_type</span> <span class="o">==</span> <span class="s2">&quot;regression&quot;</span><span class="p">:</span>
<a id="__codelineno-14-251" name="__codelineno-14-251" href="#__codelineno-14-251"></a>            <span class="n">imputer</span> <span class="o">=</span> <span class="n">IterativeImputer</span><span class="p">()</span>
<a id="__codelineno-14-252" name="__codelineno-14-252" href="#__codelineno-14-252"></a>        <span class="n">imputer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">idf_pd</span><span class="p">)</span>
<a id="__codelineno-14-253" name="__codelineno-14-253" href="#__codelineno-14-253"></a>
<a id="__codelineno-14-254" name="__codelineno-14-254" href="#__codelineno-14-254"></a>        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pre_existing_model</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">):</span>
<a id="__codelineno-14-255" name="__codelineno-14-255" href="#__codelineno-14-255"></a>            <span class="k">if</span> <span class="n">run_type</span> <span class="o">==</span> <span class="s2">&quot;emr&quot;</span><span class="p">:</span>
<a id="__codelineno-14-256" name="__codelineno-14-256" href="#__codelineno-14-256"></a>                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">imputer</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;imputation_sklearn.sav&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
<a id="__codelineno-14-257" name="__codelineno-14-257" href="#__codelineno-14-257"></a>                <span class="n">bash_cmd</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-14-258" name="__codelineno-14-258" href="#__codelineno-14-258"></a>                    <span class="s2">&quot;aws s3 cp imputation_sklearn.sav &quot;</span>
<a id="__codelineno-14-259" name="__codelineno-14-259" href="#__codelineno-14-259"></a>                    <span class="o">+</span> <span class="n">model_path</span>
<a id="__codelineno-14-260" name="__codelineno-14-260" href="#__codelineno-14-260"></a>                    <span class="o">+</span> <span class="s2">&quot;/imputation_sklearn.sav&quot;</span>
<a id="__codelineno-14-261" name="__codelineno-14-261" href="#__codelineno-14-261"></a>                <span class="p">)</span>
<a id="__codelineno-14-262" name="__codelineno-14-262" href="#__codelineno-14-262"></a>                <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">bash_cmd</span><span class="p">])</span>
<a id="__codelineno-14-263" name="__codelineno-14-263" href="#__codelineno-14-263"></a>                <span class="n">imputer</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;imputation_sklearn.sav&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
<a id="__codelineno-14-264" name="__codelineno-14-264" href="#__codelineno-14-264"></a>            <span class="k">elif</span> <span class="n">run_type</span> <span class="o">==</span> <span class="s2">&quot;ak8s&quot;</span><span class="p">:</span>
<a id="__codelineno-14-265" name="__codelineno-14-265" href="#__codelineno-14-265"></a>                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">imputer</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;imputation_sklearn.sav&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
<a id="__codelineno-14-266" name="__codelineno-14-266" href="#__codelineno-14-266"></a>                <span class="n">bash_cmd</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-14-267" name="__codelineno-14-267" href="#__codelineno-14-267"></a>                    <span class="s1">&#39;azcopy cp &quot;imputation_sklearn.sav&quot; &quot;&#39;</span>
<a id="__codelineno-14-268" name="__codelineno-14-268" href="#__codelineno-14-268"></a>                    <span class="o">+</span> <span class="n">ends_with</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
<a id="__codelineno-14-269" name="__codelineno-14-269" href="#__codelineno-14-269"></a>                    <span class="o">+</span> <span class="s2">&quot;imputation_sklearn.sav&quot;</span>
<a id="__codelineno-14-270" name="__codelineno-14-270" href="#__codelineno-14-270"></a>                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">auth_key</span><span class="p">)</span>
<a id="__codelineno-14-271" name="__codelineno-14-271" href="#__codelineno-14-271"></a>                    <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
<a id="__codelineno-14-272" name="__codelineno-14-272" href="#__codelineno-14-272"></a>                <span class="p">)</span>
<a id="__codelineno-14-273" name="__codelineno-14-273" href="#__codelineno-14-273"></a>                <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">bash_cmd</span><span class="p">])</span>
<a id="__codelineno-14-274" name="__codelineno-14-274" href="#__codelineno-14-274"></a>                <span class="n">imputer</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;imputation_sklearn.sav&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
<a id="__codelineno-14-275" name="__codelineno-14-275" href="#__codelineno-14-275"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-14-276" name="__codelineno-14-276" href="#__codelineno-14-276"></a>                <span class="n">local_path</span> <span class="o">=</span> <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/imputation_sklearn.sav&quot;</span>
<a id="__codelineno-14-277" name="__codelineno-14-277" href="#__codelineno-14-277"></a>                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">local_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-14-278" name="__codelineno-14-278" href="#__codelineno-14-278"></a>                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">imputer</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
<a id="__codelineno-14-279" name="__codelineno-14-279" href="#__codelineno-14-279"></a>                <span class="n">imputer</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
<a id="__codelineno-14-280" name="__codelineno-14-280" href="#__codelineno-14-280"></a>                    <span class="nb">open</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/imputation_sklearn.sav&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
<a id="__codelineno-14-281" name="__codelineno-14-281" href="#__codelineno-14-281"></a>                <span class="p">)</span>
<a id="__codelineno-14-282" name="__codelineno-14-282" href="#__codelineno-14-282"></a>
<a id="__codelineno-14-283" name="__codelineno-14-283" href="#__codelineno-14-283"></a>    <span class="nd">@F</span><span class="o">.</span><span class="n">pandas_udf</span><span class="p">(</span><span class="n">returnType</span><span class="o">=</span><span class="n">T</span><span class="o">.</span><span class="n">ArrayType</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">DoubleType</span><span class="p">()))</span>
<a id="__codelineno-14-284" name="__codelineno-14-284" href="#__codelineno-14-284"></a>    <span class="k">def</span> <span class="nf">prediction</span><span class="p">(</span><span class="o">*</span><span class="n">cols</span><span class="p">):</span>
<a id="__codelineno-14-285" name="__codelineno-14-285" href="#__codelineno-14-285"></a>        <span class="n">input_pdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-14-286" name="__codelineno-14-286" href="#__codelineno-14-286"></a>        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">imputer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">input_pdf</span><span class="p">))</span>
<a id="__codelineno-14-287" name="__codelineno-14-287" href="#__codelineno-14-287"></a>
<a id="__codelineno-14-288" name="__codelineno-14-288" href="#__codelineno-14-288"></a>    <span class="n">result_df</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">prediction</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_cols</span><span class="p">))</span>
<a id="__codelineno-14-289" name="__codelineno-14-289" href="#__codelineno-14-289"></a>    <span class="k">if</span> <span class="n">persist</span><span class="p">:</span>
<a id="__codelineno-14-290" name="__codelineno-14-290" href="#__codelineno-14-290"></a>        <span class="n">result_df</span> <span class="o">=</span> <span class="n">result_df</span><span class="o">.</span><span class="n">persist</span><span class="p">(</span><span class="n">persist_option</span><span class="p">)</span>
<a id="__codelineno-14-291" name="__codelineno-14-291" href="#__codelineno-14-291"></a>
<a id="__codelineno-14-292" name="__codelineno-14-292" href="#__codelineno-14-292"></a>    <span class="n">odf_schema</span> <span class="o">=</span> <span class="n">result_df</span><span class="o">.</span><span class="n">schema</span>
<a id="__codelineno-14-293" name="__codelineno-14-293" href="#__codelineno-14-293"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-14-294" name="__codelineno-14-294" href="#__codelineno-14-294"></a>        <span class="n">odf_schema</span> <span class="o">=</span> <span class="n">odf_schema</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">FloatType</span><span class="p">()))</span>
<a id="__codelineno-14-295" name="__codelineno-14-295" href="#__codelineno-14-295"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-14-296" name="__codelineno-14-296" href="#__codelineno-14-296"></a>        <span class="n">result_df</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]))</span>
<a id="__codelineno-14-297" name="__codelineno-14-297" href="#__codelineno-14-297"></a>        <span class="o">.</span><span class="n">toDF</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">odf_schema</span><span class="p">)</span>
<a id="__codelineno-14-298" name="__codelineno-14-298" href="#__codelineno-14-298"></a>        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">)</span>
<a id="__codelineno-14-299" name="__codelineno-14-299" href="#__codelineno-14-299"></a>    <span class="p">)</span>
<a id="__codelineno-14-300" name="__codelineno-14-300" href="#__codelineno-14-300"></a>
<a id="__codelineno-14-301" name="__codelineno-14-301" href="#__codelineno-14-301"></a>    <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-14-302" name="__codelineno-14-302" href="#__codelineno-14-302"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-14-303" name="__codelineno-14-303" href="#__codelineno-14-303"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;append&quot;</span><span class="p">:</span>
<a id="__codelineno-14-304" name="__codelineno-14-304" href="#__codelineno-14-304"></a>            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">missing_cols</span><span class="p">:</span>
<a id="__codelineno-14-305" name="__codelineno-14-305" href="#__codelineno-14-305"></a>                <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">)</span>
<a id="__codelineno-14-306" name="__codelineno-14-306" href="#__codelineno-14-306"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-14-307" name="__codelineno-14-307" href="#__codelineno-14-307"></a>                <span class="n">output_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">)</span>
<a id="__codelineno-14-308" name="__codelineno-14-308" href="#__codelineno-14-308"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-14-309" name="__codelineno-14-309" href="#__codelineno-14-309"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_imputed&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-14-310" name="__codelineno-14-310" href="#__codelineno-14-310"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">idf</span><span class="o">.</span><span class="n">columns</span> <span class="o">+</span> <span class="n">output_cols</span><span class="p">)</span>
<a id="__codelineno-14-311" name="__codelineno-14-311" href="#__codelineno-14-311"></a>
<a id="__codelineno-14-312" name="__codelineno-14-312" href="#__codelineno-14-312"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-14-313" name="__codelineno-14-313" href="#__codelineno-14-313"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-14-314" name="__codelineno-14-314" href="#__codelineno-14-314"></a>            <span class="n">odf_print</span> <span class="o">=</span> <span class="n">missing_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-14-315" name="__codelineno-14-315" href="#__codelineno-14-315"></a>                <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;missingCount_before&quot;</span><span class="p">)</span>
<a id="__codelineno-14-316" name="__codelineno-14-316" href="#__codelineno-14-316"></a>            <span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-14-317" name="__codelineno-14-317" href="#__codelineno-14-317"></a>                <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">odf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-14-318" name="__codelineno-14-318" href="#__codelineno-14-318"></a>                    <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;missingCount_after&quot;</span><span class="p">)</span>
<a id="__codelineno-14-319" name="__codelineno-14-319" href="#__codelineno-14-319"></a>                <span class="p">),</span>
<a id="__codelineno-14-320" name="__codelineno-14-320" href="#__codelineno-14-320"></a>                <span class="s2">&quot;attribute&quot;</span><span class="p">,</span>
<a id="__codelineno-14-321" name="__codelineno-14-321" href="#__codelineno-14-321"></a>                <span class="s2">&quot;inner&quot;</span><span class="p">,</span>
<a id="__codelineno-14-322" name="__codelineno-14-322" href="#__codelineno-14-322"></a>            <span class="p">)</span>
<a id="__codelineno-14-323" name="__codelineno-14-323" href="#__codelineno-14-323"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-14-324" name="__codelineno-14-324" href="#__codelineno-14-324"></a>            <span class="n">odf_print</span> <span class="o">=</span> <span class="n">missing_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-14-325" name="__codelineno-14-325" href="#__codelineno-14-325"></a>                <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;missing_count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;missingCount_before&quot;</span><span class="p">)</span>
<a id="__codelineno-14-326" name="__codelineno-14-326" href="#__codelineno-14-326"></a>            <span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-14-327" name="__codelineno-14-327" href="#__codelineno-14-327"></a>                <span class="n">missingCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">odf</span><span class="p">,</span> <span class="n">output_cols</span><span class="p">)</span>
<a id="__codelineno-14-328" name="__codelineno-14-328" href="#__codelineno-14-328"></a>                <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="s2">&quot;attribute_after&quot;</span><span class="p">)</span>
<a id="__codelineno-14-329" name="__codelineno-14-329" href="#__codelineno-14-329"></a>                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-14-330" name="__codelineno-14-330" href="#__codelineno-14-330"></a>                    <span class="s2">&quot;attribute&quot;</span><span class="p">,</span>
<a id="__codelineno-14-331" name="__codelineno-14-331" href="#__codelineno-14-331"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">expr</span><span class="p">(</span><span class="s2">&quot;substring(attribute_after, 1, length(attribute_after)-8)&quot;</span><span class="p">),</span>
<a id="__codelineno-14-332" name="__codelineno-14-332" href="#__codelineno-14-332"></a>                <span class="p">)</span>
<a id="__codelineno-14-333" name="__codelineno-14-333" href="#__codelineno-14-333"></a>                <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;missing_pct&quot;</span><span class="p">),</span>
<a id="__codelineno-14-334" name="__codelineno-14-334" href="#__codelineno-14-334"></a>                <span class="s2">&quot;attribute&quot;</span><span class="p">,</span>
<a id="__codelineno-14-335" name="__codelineno-14-335" href="#__codelineno-14-335"></a>                <span class="s2">&quot;inner&quot;</span><span class="p">,</span>
<a id="__codelineno-14-336" name="__codelineno-14-336" href="#__codelineno-14-336"></a>            <span class="p">)</span>
<a id="__codelineno-14-337" name="__codelineno-14-337" href="#__codelineno-14-337"></a>        <span class="n">odf_print</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">),</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-14-338" name="__codelineno-14-338" href="#__codelineno-14-338"></a>    <span class="k">if</span> <span class="n">persist</span><span class="p">:</span>
<a id="__codelineno-14-339" name="__codelineno-14-339" href="#__codelineno-14-339"></a>        <span class="n">idf</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
<a id="__codelineno-14-340" name="__codelineno-14-340" href="#__codelineno-14-340"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-14-341" name="__codelineno-14-341" href="#__codelineno-14-341"></a>            <span class="n">idf_model</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
<a id="__codelineno-14-342" name="__codelineno-14-342" href="#__codelineno-14-342"></a>        <span class="n">result_df</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
<a id="__codelineno-14-343" name="__codelineno-14-343" href="#__codelineno-14-343"></a>    <span class="k">return</span> <span class="n">odf</span>
</code></pre></div>
</pre>
</details>
</dd>
<dt id="anovos.data_transformer.transformers.monotonic_binning"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">monotonic_binning</span></span>(<span class="n">spark, idf, list_of_cols='all', drop_cols=[], label_col='label', event_label=1, bin_method='equal_range', bin_size=10, bin_dtype='numerical', output_mode='replace')</span>
</code></dt>
<dd>
<div class="desc"><p>This function constitutes supervised way of binning the numerical attribute into discrete (integer or
categorical values) attribute. Instead of pre-defined fixed number of bins, number of bins are dynamically
computed to ensure the monotonic nature of bins i.e. % event should increase or decrease with the bin. Monotonic
nature of bins is evaluated by looking at spearman rank correlation, which should be either +1 or -1, between the
bin index and % event. In case, the monotonic nature is not attained, user defined fixed number of bins are used
for the binning.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>spark</code></strong></dt>
<dd>Spark Session</dd>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe</dd>
<dt><strong><code>list_of_cols</code></strong></dt>
<dd>List of numerical columns to transform e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
"all" can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.
Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in
drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = "all")</dd>
<dt><strong><code>drop_cols</code></strong></dt>
<dd>List of columns to be dropped e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except
a few handful of them. (Default value = [])</dd>
<dt><strong><code>label_col</code></strong></dt>
<dd>Label/Target column (Default value = "label")</dd>
<dt><strong><code>event_label</code></strong></dt>
<dd>Value of (positive) event (i.e label 1) (Default value = 1)</dd>
<dt><strong><code>bin_method</code></strong></dt>
<dd>"equal_frequency", "equal_range".
In "equal_range" method, each bin is of equal size/width and in "equal_frequency", each bin has
equal no. of rows, though the width of bins may vary. (Default value = "equal_range")</dd>
<dt><strong><code>bin_size</code></strong></dt>
<dd>Default number of bins in case monotonicity is not achieved.</dd>
<dt><strong><code>bin_dtype</code></strong></dt>
<dd>"numerical", "categorical".
With "numerical" option, original value is replaced with an Integer (1,2,…) and
with "categorical" option, original replaced with a string describing min and max value allowed
in the bin ("minval-maxval"). (Default value = "numerical")</dd>
<dt><strong><code>output_mode</code></strong></dt>
<dd>"replace", "append".
“replace” option replaces original columns with transformed column. “append” option append transformed
column to the input dataset with a postfix "_binned" e.g. column X is appended as X_binned. (Default value = "replace")</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>DataFrame</code></dt>
<dd>Binned Dataframe</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">def</span> <span class="nf">monotonic_binning</span><span class="p">(</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>    <span class="n">label_col</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>    <span class="n">event_label</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>    <span class="n">bin_method</span><span class="o">=</span><span class="s2">&quot;equal_range&quot;</span><span class="p">,</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>    <span class="n">bin_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>    <span class="n">bin_dtype</span><span class="o">=</span><span class="s2">&quot;numerical&quot;</span><span class="p">,</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="p">):</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="sd">    This function constitutes supervised way of binning the numerical attribute into discrete (integer or</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="sd">    categorical values) attribute. Instead of pre-defined fixed number of bins, number of bins are dynamically</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="sd">    computed to ensure the monotonic nature of bins i.e. % event should increase or decrease with the bin. Monotonic</span>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="sd">    nature of bins is evaluated by looking at spearman rank correlation, which should be either +1 or -1, between the</span>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="sd">    bin index and % event. In case, the monotonic nature is not attained, user defined fixed number of bins are used</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="sd">    for the binning.</span>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="sd">    Parameters</span>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="sd">    ----------</span>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="sd">    spark</span>
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="sd">    idf</span>
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="sd">        List of numerical columns to transform e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a><span class="sd">        &quot;all&quot; can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a><span class="sd">    label_col</span>
<a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a><span class="sd">        Label/Target column (Default value = &quot;label&quot;)</span>
<a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a><span class="sd">    event_label</span>
<a id="__codelineno-15-43" name="__codelineno-15-43" href="#__codelineno-15-43"></a><span class="sd">        Value of (positive) event (i.e label 1) (Default value = 1)</span>
<a id="__codelineno-15-44" name="__codelineno-15-44" href="#__codelineno-15-44"></a><span class="sd">    bin_method</span>
<a id="__codelineno-15-45" name="__codelineno-15-45" href="#__codelineno-15-45"></a><span class="sd">        &quot;equal_frequency&quot;, &quot;equal_range&quot;.</span>
<a id="__codelineno-15-46" name="__codelineno-15-46" href="#__codelineno-15-46"></a><span class="sd">        In &quot;equal_range&quot; method, each bin is of equal size/width and in &quot;equal_frequency&quot;, each bin has</span>
<a id="__codelineno-15-47" name="__codelineno-15-47" href="#__codelineno-15-47"></a><span class="sd">        equal no. of rows, though the width of bins may vary. (Default value = &quot;equal_range&quot;)</span>
<a id="__codelineno-15-48" name="__codelineno-15-48" href="#__codelineno-15-48"></a><span class="sd">    bin_size</span>
<a id="__codelineno-15-49" name="__codelineno-15-49" href="#__codelineno-15-49"></a><span class="sd">        Default number of bins in case monotonicity is not achieved.</span>
<a id="__codelineno-15-50" name="__codelineno-15-50" href="#__codelineno-15-50"></a><span class="sd">    bin_dtype</span>
<a id="__codelineno-15-51" name="__codelineno-15-51" href="#__codelineno-15-51"></a><span class="sd">        &quot;numerical&quot;, &quot;categorical&quot;.</span>
<a id="__codelineno-15-52" name="__codelineno-15-52" href="#__codelineno-15-52"></a><span class="sd">        With &quot;numerical&quot; option, original value is replaced with an Integer (1,2,…) and</span>
<a id="__codelineno-15-53" name="__codelineno-15-53" href="#__codelineno-15-53"></a><span class="sd">        with &quot;categorical&quot; option, original replaced with a string describing min and max value allowed</span>
<a id="__codelineno-15-54" name="__codelineno-15-54" href="#__codelineno-15-54"></a><span class="sd">        in the bin (&quot;minval-maxval&quot;). (Default value = &quot;numerical&quot;)</span>
<a id="__codelineno-15-55" name="__codelineno-15-55" href="#__codelineno-15-55"></a><span class="sd">    output_mode</span>
<a id="__codelineno-15-56" name="__codelineno-15-56" href="#__codelineno-15-56"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-15-57" name="__codelineno-15-57" href="#__codelineno-15-57"></a><span class="sd">        “replace” option replaces original columns with transformed column. “append” option append transformed</span>
<a id="__codelineno-15-58" name="__codelineno-15-58" href="#__codelineno-15-58"></a><span class="sd">        column to the input dataset with a postfix &quot;_binned&quot; e.g. column X is appended as X_binned. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-15-59" name="__codelineno-15-59" href="#__codelineno-15-59"></a>
<a id="__codelineno-15-60" name="__codelineno-15-60" href="#__codelineno-15-60"></a><span class="sd">    Returns</span>
<a id="__codelineno-15-61" name="__codelineno-15-61" href="#__codelineno-15-61"></a><span class="sd">    -------</span>
<a id="__codelineno-15-62" name="__codelineno-15-62" href="#__codelineno-15-62"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-15-63" name="__codelineno-15-63" href="#__codelineno-15-63"></a><span class="sd">        Binned Dataframe</span>
<a id="__codelineno-15-64" name="__codelineno-15-64" href="#__codelineno-15-64"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-15-65" name="__codelineno-15-65" href="#__codelineno-15-65"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-15-66" name="__codelineno-15-66" href="#__codelineno-15-66"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-15-67" name="__codelineno-15-67" href="#__codelineno-15-67"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-15-68" name="__codelineno-15-68" href="#__codelineno-15-68"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-15-69" name="__codelineno-15-69" href="#__codelineno-15-69"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-15-70" name="__codelineno-15-70" href="#__codelineno-15-70"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-15-71" name="__codelineno-15-71" href="#__codelineno-15-71"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-15-72" name="__codelineno-15-72" href="#__codelineno-15-72"></a>
<a id="__codelineno-15-73" name="__codelineno-15-73" href="#__codelineno-15-73"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
<a id="__codelineno-15-74" name="__codelineno-15-74" href="#__codelineno-15-74"></a>        <span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">drop_cols</span> <span class="o">+</span> <span class="p">[</span><span class="n">label_col</span><span class="p">])])</span>
<a id="__codelineno-15-75" name="__codelineno-15-75" href="#__codelineno-15-75"></a>    <span class="p">)</span>
<a id="__codelineno-15-76" name="__codelineno-15-76" href="#__codelineno-15-76"></a>
<a id="__codelineno-15-77" name="__codelineno-15-77" href="#__codelineno-15-77"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-15-78" name="__codelineno-15-78" href="#__codelineno-15-78"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-15-79" name="__codelineno-15-79" href="#__codelineno-15-79"></a>
<a id="__codelineno-15-80" name="__codelineno-15-80" href="#__codelineno-15-80"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-15-81" name="__codelineno-15-81" href="#__codelineno-15-81"></a>    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-15-82" name="__codelineno-15-82" href="#__codelineno-15-82"></a>        <span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
<a id="__codelineno-15-83" name="__codelineno-15-83" href="#__codelineno-15-83"></a>        <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-15-84" name="__codelineno-15-84" href="#__codelineno-15-84"></a>        <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-15-85" name="__codelineno-15-85" href="#__codelineno-15-85"></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-15-86" name="__codelineno-15-86" href="#__codelineno-15-86"></a>                <span class="n">attribute_binning</span><span class="p">(</span>
<a id="__codelineno-15-87" name="__codelineno-15-87" href="#__codelineno-15-87"></a>                    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-15-88" name="__codelineno-15-88" href="#__codelineno-15-88"></a>                    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-15-89" name="__codelineno-15-89" href="#__codelineno-15-89"></a>                    <span class="p">[</span><span class="n">col</span><span class="p">],</span>
<a id="__codelineno-15-90" name="__codelineno-15-90" href="#__codelineno-15-90"></a>                    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-15-91" name="__codelineno-15-91" href="#__codelineno-15-91"></a>                    <span class="n">method_type</span><span class="o">=</span><span class="n">bin_method</span><span class="p">,</span>
<a id="__codelineno-15-92" name="__codelineno-15-92" href="#__codelineno-15-92"></a>                    <span class="n">bin_size</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
<a id="__codelineno-15-93" name="__codelineno-15-93" href="#__codelineno-15-93"></a>                    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
<a id="__codelineno-15-94" name="__codelineno-15-94" href="#__codelineno-15-94"></a>                <span class="p">)</span>
<a id="__codelineno-15-95" name="__codelineno-15-95" href="#__codelineno-15-95"></a>                <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">label_col</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">col</span> <span class="o">+</span> <span class="s2">&quot;_binned&quot;</span><span class="p">)</span>
<a id="__codelineno-15-96" name="__codelineno-15-96" href="#__codelineno-15-96"></a>                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-15-97" name="__codelineno-15-97" href="#__codelineno-15-97"></a>                    <span class="n">label_col</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">label_col</span><span class="p">)</span> <span class="o">==</span> <span class="n">event_label</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-98" name="__codelineno-15-98" href="#__codelineno-15-98"></a>                <span class="p">)</span>
<a id="__codelineno-15-99" name="__codelineno-15-99" href="#__codelineno-15-99"></a>                <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">col</span> <span class="o">+</span> <span class="s2">&quot;_binned&quot;</span><span class="p">)</span>
<a id="__codelineno-15-100" name="__codelineno-15-100" href="#__codelineno-15-100"></a>                <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;mean_val&quot;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="n">label_col</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;mean_label&quot;</span><span class="p">))</span>
<a id="__codelineno-15-101" name="__codelineno-15-101" href="#__codelineno-15-101"></a>                <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<a id="__codelineno-15-102" name="__codelineno-15-102" href="#__codelineno-15-102"></a>            <span class="p">)</span>
<a id="__codelineno-15-103" name="__codelineno-15-103" href="#__codelineno-15-103"></a>            <span class="n">r</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">spearmanr</span><span class="p">(</span>
<a id="__codelineno-15-104" name="__codelineno-15-104" href="#__codelineno-15-104"></a>                <span class="n">tmp</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()[[</span><span class="s2">&quot;mean_val&quot;</span><span class="p">]],</span> <span class="n">tmp</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()[[</span><span class="s2">&quot;mean_label&quot;</span><span class="p">]]</span>
<a id="__codelineno-15-105" name="__codelineno-15-105" href="#__codelineno-15-105"></a>            <span class="p">)</span>
<a id="__codelineno-15-106" name="__codelineno-15-106" href="#__codelineno-15-106"></a>            <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
<a id="__codelineno-15-107" name="__codelineno-15-107" href="#__codelineno-15-107"></a>                <span class="n">odf</span> <span class="o">=</span> <span class="n">attribute_binning</span><span class="p">(</span>
<a id="__codelineno-15-108" name="__codelineno-15-108" href="#__codelineno-15-108"></a>                    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-15-109" name="__codelineno-15-109" href="#__codelineno-15-109"></a>                    <span class="n">odf</span><span class="p">,</span>
<a id="__codelineno-15-110" name="__codelineno-15-110" href="#__codelineno-15-110"></a>                    <span class="p">[</span><span class="n">col</span><span class="p">],</span>
<a id="__codelineno-15-111" name="__codelineno-15-111" href="#__codelineno-15-111"></a>                    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-15-112" name="__codelineno-15-112" href="#__codelineno-15-112"></a>                    <span class="n">method_type</span><span class="o">=</span><span class="n">bin_method</span><span class="p">,</span>
<a id="__codelineno-15-113" name="__codelineno-15-113" href="#__codelineno-15-113"></a>                    <span class="n">bin_size</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
<a id="__codelineno-15-114" name="__codelineno-15-114" href="#__codelineno-15-114"></a>                    <span class="n">bin_dtype</span><span class="o">=</span><span class="n">bin_dtype</span><span class="p">,</span>
<a id="__codelineno-15-115" name="__codelineno-15-115" href="#__codelineno-15-115"></a>                    <span class="n">output_mode</span><span class="o">=</span><span class="n">output_mode</span><span class="p">,</span>
<a id="__codelineno-15-116" name="__codelineno-15-116" href="#__codelineno-15-116"></a>                <span class="p">)</span>
<a id="__codelineno-15-117" name="__codelineno-15-117" href="#__codelineno-15-117"></a>                <span class="k">break</span>
<a id="__codelineno-15-118" name="__codelineno-15-118" href="#__codelineno-15-118"></a>            <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-15-119" name="__codelineno-15-119" href="#__codelineno-15-119"></a>            <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-15-120" name="__codelineno-15-120" href="#__codelineno-15-120"></a>        <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
<a id="__codelineno-15-121" name="__codelineno-15-121" href="#__codelineno-15-121"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">attribute_binning</span><span class="p">(</span>
<a id="__codelineno-15-122" name="__codelineno-15-122" href="#__codelineno-15-122"></a>                <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-15-123" name="__codelineno-15-123" href="#__codelineno-15-123"></a>                <span class="n">odf</span><span class="p">,</span>
<a id="__codelineno-15-124" name="__codelineno-15-124" href="#__codelineno-15-124"></a>                <span class="p">[</span><span class="n">col</span><span class="p">],</span>
<a id="__codelineno-15-125" name="__codelineno-15-125" href="#__codelineno-15-125"></a>                <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-15-126" name="__codelineno-15-126" href="#__codelineno-15-126"></a>                <span class="n">method_type</span><span class="o">=</span><span class="n">bin_method</span><span class="p">,</span>
<a id="__codelineno-15-127" name="__codelineno-15-127" href="#__codelineno-15-127"></a>                <span class="n">bin_size</span><span class="o">=</span><span class="n">bin_size</span><span class="p">,</span>
<a id="__codelineno-15-128" name="__codelineno-15-128" href="#__codelineno-15-128"></a>                <span class="n">bin_dtype</span><span class="o">=</span><span class="n">bin_dtype</span><span class="p">,</span>
<a id="__codelineno-15-129" name="__codelineno-15-129" href="#__codelineno-15-129"></a>                <span class="n">output_mode</span><span class="o">=</span><span class="n">output_mode</span><span class="p">,</span>
<a id="__codelineno-15-130" name="__codelineno-15-130" href="#__codelineno-15-130"></a>            <span class="p">)</span>
<a id="__codelineno-15-131" name="__codelineno-15-131" href="#__codelineno-15-131"></a>
<a id="__codelineno-15-132" name="__codelineno-15-132" href="#__codelineno-15-132"></a>    <span class="k">return</span> <span class="n">odf</span>
</code></pre></div>
</pre>
</details>
</dd>
<dt id="anovos.data_transformer.transformers.normalization"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">normalization</span></span>(<span class="n">idf, list_of_cols='all', drop_cols=[], pre_existing_model=False, model_path='NA', output_mode='replace', print_impact=False)</span>
</code></dt>
<dd>
<div class="desc"><h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe</dd>
<dt><strong><code>list_of_cols</code></strong></dt>
<dd>List of numerical columns to transform e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
"all" can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.
Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in
drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = "all")</dd>
<dt><strong><code>drop_cols</code></strong></dt>
<dd>List of columns to be dropped e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except
a few handful of them. (Default value = [])</dd>
<dt><strong><code>pre_existing_model</code></strong></dt>
<dd>Boolean argument – True or False. True if normalization/scalar model exists already, False Otherwise (Default value = False)</dd>
<dt><strong><code>model_path</code></strong></dt>
<dd>If pre_existing_model is True, this argument is path for referring the pre-saved model.
If pre_existing_model is False, this argument can be used for saving the model.
Default "NA" means there is neither pre-existing model nor there is a need to save one.</dd>
<dt><strong><code>output_mode</code></strong></dt>
<dd>"replace", "append".
“replace” option replaces original columns with transformed column. “append” option append transformed
column to the input dataset with a postfix "_scaled" e.g. column X is appended as X_scaled. (Default value = "replace")</dd>
<dt><strong><code>print_impact</code></strong></dt>
<dd>True, False (Default value = False)
This argument is to print out before and after descriptive statistics of rescaled columns.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>DataFrame</code></dt>
<dd>Rescaled Dataframe</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">def</span> <span class="nf">normalization</span><span class="p">(</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>    <span class="n">pre_existing_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>    <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="p">):</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="sd">    Parameters</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="sd">    ----------</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="sd">    idf</span>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="sd">        List of numerical columns to transform e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a><span class="sd">        &quot;all&quot; can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a><span class="sd">    pre_existing_model</span>
<a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a><span class="sd">        Boolean argument – True or False. True if normalization/scalar model exists already, False Otherwise (Default value = False)</span>
<a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a><span class="sd">    model_path</span>
<a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a><span class="sd">        If pre_existing_model is True, this argument is path for referring the pre-saved model.</span>
<a id="__codelineno-16-33" name="__codelineno-16-33" href="#__codelineno-16-33"></a><span class="sd">        If pre_existing_model is False, this argument can be used for saving the model.</span>
<a id="__codelineno-16-34" name="__codelineno-16-34" href="#__codelineno-16-34"></a><span class="sd">        Default &quot;NA&quot; means there is neither pre-existing model nor there is a need to save one.</span>
<a id="__codelineno-16-35" name="__codelineno-16-35" href="#__codelineno-16-35"></a><span class="sd">    output_mode</span>
<a id="__codelineno-16-36" name="__codelineno-16-36" href="#__codelineno-16-36"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-16-37" name="__codelineno-16-37" href="#__codelineno-16-37"></a><span class="sd">        “replace” option replaces original columns with transformed column. “append” option append transformed</span>
<a id="__codelineno-16-38" name="__codelineno-16-38" href="#__codelineno-16-38"></a><span class="sd">        column to the input dataset with a postfix &quot;_scaled&quot; e.g. column X is appended as X_scaled. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-16-39" name="__codelineno-16-39" href="#__codelineno-16-39"></a><span class="sd">    print_impact</span>
<a id="__codelineno-16-40" name="__codelineno-16-40" href="#__codelineno-16-40"></a><span class="sd">        True, False (Default value = False)</span>
<a id="__codelineno-16-41" name="__codelineno-16-41" href="#__codelineno-16-41"></a><span class="sd">        This argument is to print out before and after descriptive statistics of rescaled columns.</span>
<a id="__codelineno-16-42" name="__codelineno-16-42" href="#__codelineno-16-42"></a>
<a id="__codelineno-16-43" name="__codelineno-16-43" href="#__codelineno-16-43"></a><span class="sd">    Returns</span>
<a id="__codelineno-16-44" name="__codelineno-16-44" href="#__codelineno-16-44"></a><span class="sd">    -------</span>
<a id="__codelineno-16-45" name="__codelineno-16-45" href="#__codelineno-16-45"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-16-46" name="__codelineno-16-46" href="#__codelineno-16-46"></a><span class="sd">        Rescaled Dataframe</span>
<a id="__codelineno-16-47" name="__codelineno-16-47" href="#__codelineno-16-47"></a>
<a id="__codelineno-16-48" name="__codelineno-16-48" href="#__codelineno-16-48"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-16-49" name="__codelineno-16-49" href="#__codelineno-16-49"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-16-50" name="__codelineno-16-50" href="#__codelineno-16-50"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-16-51" name="__codelineno-16-51" href="#__codelineno-16-51"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-16-52" name="__codelineno-16-52" href="#__codelineno-16-52"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-16-53" name="__codelineno-16-53" href="#__codelineno-16-53"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-16-54" name="__codelineno-16-54" href="#__codelineno-16-54"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-16-55" name="__codelineno-16-55" href="#__codelineno-16-55"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-16-56" name="__codelineno-16-56" href="#__codelineno-16-56"></a>
<a id="__codelineno-16-57" name="__codelineno-16-57" href="#__codelineno-16-57"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-16-58" name="__codelineno-16-58" href="#__codelineno-16-58"></a>
<a id="__codelineno-16-59" name="__codelineno-16-59" href="#__codelineno-16-59"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-16-60" name="__codelineno-16-60" href="#__codelineno-16-60"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-16-61" name="__codelineno-16-61" href="#__codelineno-16-61"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-16-62" name="__codelineno-16-62" href="#__codelineno-16-62"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-16-63" name="__codelineno-16-63" href="#__codelineno-16-63"></a>            <span class="s2">&quot;No Normalization Performed - No numerical column(s) to transform&quot;</span>
<a id="__codelineno-16-64" name="__codelineno-16-64" href="#__codelineno-16-64"></a>        <span class="p">)</span>
<a id="__codelineno-16-65" name="__codelineno-16-65" href="#__codelineno-16-65"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-16-66" name="__codelineno-16-66" href="#__codelineno-16-66"></a>
<a id="__codelineno-16-67" name="__codelineno-16-67" href="#__codelineno-16-67"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">):</span>
<a id="__codelineno-16-68" name="__codelineno-16-68" href="#__codelineno-16-68"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for output_mode&quot;</span><span class="p">)</span>
<a id="__codelineno-16-69" name="__codelineno-16-69" href="#__codelineno-16-69"></a>
<a id="__codelineno-16-70" name="__codelineno-16-70" href="#__codelineno-16-70"></a>    <span class="n">idf_id</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;tempID&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">monotonically_increasing_id</span><span class="p">())</span>
<a id="__codelineno-16-71" name="__codelineno-16-71" href="#__codelineno-16-71"></a>    <span class="n">idf_partial</span> <span class="o">=</span> <span class="n">idf_id</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s2">&quot;tempID&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">list_of_cols</span><span class="p">)</span>
<a id="__codelineno-16-72" name="__codelineno-16-72" href="#__codelineno-16-72"></a>
<a id="__codelineno-16-73" name="__codelineno-16-73" href="#__codelineno-16-73"></a>    <span class="n">assembler</span> <span class="o">=</span> <span class="n">VectorAssembler</span><span class="p">(</span>
<a id="__codelineno-16-74" name="__codelineno-16-74" href="#__codelineno-16-74"></a>        <span class="n">inputCols</span><span class="o">=</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;list_of_cols_vector&quot;</span><span class="p">,</span> <span class="n">handleInvalid</span><span class="o">=</span><span class="s2">&quot;keep&quot;</span>
<a id="__codelineno-16-75" name="__codelineno-16-75" href="#__codelineno-16-75"></a>    <span class="p">)</span>
<a id="__codelineno-16-76" name="__codelineno-16-76" href="#__codelineno-16-76"></a>    <span class="n">assembled_data</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">idf_partial</span><span class="p">)</span>
<a id="__codelineno-16-77" name="__codelineno-16-77" href="#__codelineno-16-77"></a>    <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-16-78" name="__codelineno-16-78" href="#__codelineno-16-78"></a>        <span class="n">scalerModel</span> <span class="o">=</span> <span class="n">MinMaxScalerModel</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/normalization&quot;</span><span class="p">)</span>
<a id="__codelineno-16-79" name="__codelineno-16-79" href="#__codelineno-16-79"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-16-80" name="__codelineno-16-80" href="#__codelineno-16-80"></a>        <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span>
<a id="__codelineno-16-81" name="__codelineno-16-81" href="#__codelineno-16-81"></a>            <span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;list_of_cols_vector&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;list_of_cols_scaled&quot;</span>
<a id="__codelineno-16-82" name="__codelineno-16-82" href="#__codelineno-16-82"></a>        <span class="p">)</span>
<a id="__codelineno-16-83" name="__codelineno-16-83" href="#__codelineno-16-83"></a>        <span class="n">scalerModel</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">assembled_data</span><span class="p">)</span>
<a id="__codelineno-16-84" name="__codelineno-16-84" href="#__codelineno-16-84"></a>
<a id="__codelineno-16-85" name="__codelineno-16-85" href="#__codelineno-16-85"></a>        <span class="k">if</span> <span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span>
<a id="__codelineno-16-86" name="__codelineno-16-86" href="#__codelineno-16-86"></a>            <span class="n">scalerModel</span><span class="o">.</span><span class="n">write</span><span class="p">()</span><span class="o">.</span><span class="n">overwrite</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/normalization&quot;</span><span class="p">)</span>
<a id="__codelineno-16-87" name="__codelineno-16-87" href="#__codelineno-16-87"></a>
<a id="__codelineno-16-88" name="__codelineno-16-88" href="#__codelineno-16-88"></a>    <span class="n">scaledData</span> <span class="o">=</span> <span class="n">scalerModel</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">assembled_data</span><span class="p">)</span>
<a id="__codelineno-16-89" name="__codelineno-16-89" href="#__codelineno-16-89"></a>
<a id="__codelineno-16-90" name="__codelineno-16-90" href="#__codelineno-16-90"></a>    <span class="k">def</span> <span class="nf">vector_to_array</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
<a id="__codelineno-16-91" name="__codelineno-16-91" href="#__codelineno-16-91"></a>        <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">toArray</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-16-92" name="__codelineno-16-92" href="#__codelineno-16-92"></a>
<a id="__codelineno-16-93" name="__codelineno-16-93" href="#__codelineno-16-93"></a>    <span class="n">f_vector_to_array</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">udf</span><span class="p">(</span><span class="n">vector_to_array</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">ArrayType</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">FloatType</span><span class="p">()))</span>
<a id="__codelineno-16-94" name="__codelineno-16-94" href="#__codelineno-16-94"></a>
<a id="__codelineno-16-95" name="__codelineno-16-95" href="#__codelineno-16-95"></a>    <span class="n">odf_partial</span> <span class="o">=</span> <span class="n">scaledData</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-16-96" name="__codelineno-16-96" href="#__codelineno-16-96"></a>        <span class="s2">&quot;list_of_cols_array&quot;</span><span class="p">,</span> <span class="n">f_vector_to_array</span><span class="p">(</span><span class="s2">&quot;list_of_cols_scaled&quot;</span><span class="p">)</span>
<a id="__codelineno-16-97" name="__codelineno-16-97" href="#__codelineno-16-97"></a>    <span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="s2">&quot;list_of_cols_scaled&quot;</span><span class="p">,</span> <span class="s2">&quot;list_of_cols_vector&quot;</span><span class="p">])</span>
<a id="__codelineno-16-98" name="__codelineno-16-98" href="#__codelineno-16-98"></a>
<a id="__codelineno-16-99" name="__codelineno-16-99" href="#__codelineno-16-99"></a>    <span class="n">odf_schema</span> <span class="o">=</span> <span class="n">odf_partial</span><span class="o">.</span><span class="n">schema</span>
<a id="__codelineno-16-100" name="__codelineno-16-100" href="#__codelineno-16-100"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-16-101" name="__codelineno-16-101" href="#__codelineno-16-101"></a>        <span class="n">odf_schema</span> <span class="o">=</span> <span class="n">odf_schema</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">StructField</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">FloatType</span><span class="p">()))</span>
<a id="__codelineno-16-102" name="__codelineno-16-102" href="#__codelineno-16-102"></a>    <span class="n">odf_partial</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-16-103" name="__codelineno-16-103" href="#__codelineno-16-103"></a>        <span class="n">odf_partial</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;list_of_cols_array&quot;</span><span class="p">]))</span>
<a id="__codelineno-16-104" name="__codelineno-16-104" href="#__codelineno-16-104"></a>        <span class="o">.</span><span class="n">toDF</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">odf_schema</span><span class="p">)</span>
<a id="__codelineno-16-105" name="__codelineno-16-105" href="#__codelineno-16-105"></a>        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;list_of_cols_array&quot;</span><span class="p">)</span>
<a id="__codelineno-16-106" name="__codelineno-16-106" href="#__codelineno-16-106"></a>    <span class="p">)</span>
<a id="__codelineno-16-107" name="__codelineno-16-107" href="#__codelineno-16-107"></a>
<a id="__codelineno-16-108" name="__codelineno-16-108" href="#__codelineno-16-108"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf_id</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">odf_partial</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_cols</span><span class="p">),</span> <span class="s2">&quot;tempID&quot;</span><span class="p">,</span> <span class="s2">&quot;left_outer&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-16-109" name="__codelineno-16-109" href="#__codelineno-16-109"></a>        <span class="n">idf</span><span class="o">.</span><span class="n">columns</span>
<a id="__codelineno-16-110" name="__codelineno-16-110" href="#__codelineno-16-110"></a>        <span class="o">+</span> <span class="p">[</span>
<a id="__codelineno-16-111" name="__codelineno-16-111" href="#__codelineno-16-111"></a>            <span class="p">(</span>
<a id="__codelineno-16-112" name="__codelineno-16-112" href="#__codelineno-16-112"></a>                <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">)),</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
<a id="__codelineno-16-113" name="__codelineno-16-113" href="#__codelineno-16-113"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">)</span>
<a id="__codelineno-16-114" name="__codelineno-16-114" href="#__codelineno-16-114"></a>                <span class="p">)</span>
<a id="__codelineno-16-115" name="__codelineno-16-115" href="#__codelineno-16-115"></a>            <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">)</span>
<a id="__codelineno-16-116" name="__codelineno-16-116" href="#__codelineno-16-116"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span>
<a id="__codelineno-16-117" name="__codelineno-16-117" href="#__codelineno-16-117"></a>        <span class="p">]</span>
<a id="__codelineno-16-118" name="__codelineno-16-118" href="#__codelineno-16-118"></a>    <span class="p">)</span>
<a id="__codelineno-16-119" name="__codelineno-16-119" href="#__codelineno-16-119"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-16-120" name="__codelineno-16-120" href="#__codelineno-16-120"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-16-121" name="__codelineno-16-121" href="#__codelineno-16-121"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-16-122" name="__codelineno-16-122" href="#__codelineno-16-122"></a>        <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">idf</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<a id="__codelineno-16-123" name="__codelineno-16-123" href="#__codelineno-16-123"></a>
<a id="__codelineno-16-124" name="__codelineno-16-124" href="#__codelineno-16-124"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-16-125" name="__codelineno-16-125" href="#__codelineno-16-125"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-16-126" name="__codelineno-16-126" href="#__codelineno-16-126"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="n">list_of_cols</span>
<a id="__codelineno-16-127" name="__codelineno-16-127" href="#__codelineno-16-127"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-16-128" name="__codelineno-16-128" href="#__codelineno-16-128"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">]</span>
<a id="__codelineno-16-129" name="__codelineno-16-129" href="#__codelineno-16-129"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before: &quot;</span><span class="p">)</span>
<a id="__codelineno-16-130" name="__codelineno-16-130" href="#__codelineno-16-130"></a>        <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-16-131" name="__codelineno-16-131" href="#__codelineno-16-131"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After: &quot;</span><span class="p">)</span>
<a id="__codelineno-16-132" name="__codelineno-16-132" href="#__codelineno-16-132"></a>        <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">output_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-16-133" name="__codelineno-16-133" href="#__codelineno-16-133"></a>
<a id="__codelineno-16-134" name="__codelineno-16-134" href="#__codelineno-16-134"></a>    <span class="k">return</span> <span class="n">odf</span>
</code></pre></div>
</pre>
</details>
</dd>
<dt id="anovos.data_transformer.transformers.outlier_categories"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">outlier_categories</span></span>(<span class="n">spark, idf, list_of_cols='all', drop_cols=[], coverage=1.0, max_category=50, pre_existing_model=False, model_path='NA', output_mode='replace', print_impact=False)</span>
</code></dt>
<dd>
<div class="desc"><p>This function replaces less frequently seen values (called as outlier values in the current context) in a
categorical column by 'outlier_categories'. Outlier values can be defined in two ways –
a) Max N categories, where N is user defined value. In this method, top N-1 frequently seen categories are considered
and rest are clubbed under single category 'outlier_categories'. or Alternatively,
b) Coverage – top frequently seen categories are considered till it covers minimum N% of rows and rest lesser seen values
are mapped to 'outlier_categories'. Even if the Coverage is less, maximum category constraint is given priority. Further,
there is a caveat that when multiple categories have same rank. Then, number of categorical values can be more than
max_category defined by the user.</p>
<p>This function performs better when distinct values, in any column, are not more than 100. It is recommended that to drop those
columns from the computation which has more than 100 distinct values, to get better performance out of this function.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>spark</code></strong></dt>
<dd>Spark Session</dd>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe
list_of_cols
List of categorical columns to transform e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
"all" can be passed to include all categorical columns for analysis. This is super useful instead of specifying all column names manually.
Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in
drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = "all")</dd>
<dt><strong><code>drop_cols</code></strong></dt>
<dd>List of columns to be dropped e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except
a few handful of them. (Default value = [])</dd>
<dt><strong><code>coverage</code></strong></dt>
<dd>Defines the minimum % of rows that will be mapped to actual category name and the rest to be mapped
to 'outlier_categories' and takes value between 0 to 1. Coverage of 0.8 can be interpreted as top frequently seen
categories are considered till it covers minimum 80% of rows and rest lesser seen values are mapped to 'outlier_categories'. (Default value = 1.0)</dd>
<dt><strong><code>max_category</code></strong></dt>
<dd>Even if coverage is less, only (max_category - 1) categories will be mapped to actual name and rest to 'outlier_categories'.
Caveat is when multiple categories have same rank, then #categories can be more than max_category. (Default value = 50)</dd>
<dt><strong><code>pre_existing_model</code></strong></dt>
<dd>Boolean argument – True or False. True if the model with the outlier/other values
for each attribute exists already to be used, False Otherwise. (Default value = False)</dd>
<dt><strong><code>model_path</code></strong></dt>
<dd>If pre_existing_model is True, this argument is path for the pre-saved model.
If pre_existing_model is False, this field can be used for saving the model.
Default "NA" means there is neither pre-existing model nor there is a need to save one.</dd>
<dt><strong><code>output_mode</code></strong></dt>
<dd>"replace", "append".
“replace” option replaces original columns with transformed column. “append” option append transformed
column to the input dataset with a postfix "_outliered" e.g. column X is appended as X_outliered. (Default value = "replace")</dd>
<dt><strong><code>print_impact</code></strong></dt>
<dd>True, False
This argument is to print before and after unique count of the transformed features (Default value = False)</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>DataFrame</code></dt>
<dd>Transformed Dataframe</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">def</span> <span class="nf">outlier_categories</span><span class="p">(</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>    <span class="n">coverage</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>    <span class="n">max_category</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>    <span class="n">pre_existing_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>    <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="p">):</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="sd">    This function replaces less frequently seen values (called as outlier values in the current context) in a</span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="sd">    categorical column by &#39;outlier_categories&#39;. Outlier values can be defined in two ways –</span>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="sd">    a) Max N categories, where N is user defined value. In this method, top N-1 frequently seen categories are considered</span>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="sd">    and rest are clubbed under single category &#39;outlier_categories&#39;. or Alternatively,</span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="sd">    b) Coverage – top frequently seen categories are considered till it covers minimum N% of rows and rest lesser seen values</span>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="sd">    are mapped to &#39;outlier_categories&#39;. Even if the Coverage is less, maximum category constraint is given priority. Further,</span>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="sd">    there is a caveat that when multiple categories have same rank. Then, number of categorical values can be more than</span>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="sd">    max_category defined by the user.</span>
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a>
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="sd">    This function performs better when distinct values, in any column, are not more than 100. It is recommended that to drop those</span>
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="sd">    columns from the computation which has more than 100 distinct values, to get better performance out of this function.</span>
<a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a>
<a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a><span class="sd">    Parameters</span>
<a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a><span class="sd">    ----------</span>
<a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a><span class="sd">    spark</span>
<a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a><span class="sd">    idf</span>
<a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a><span class="sd">        list_of_cols</span>
<a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a><span class="sd">        List of categorical columns to transform e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a><span class="sd">        &quot;all&quot; can be passed to include all categorical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-17-39" name="__codelineno-17-39" href="#__codelineno-17-39"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-17-40" name="__codelineno-17-40" href="#__codelineno-17-40"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-17-41" name="__codelineno-17-41" href="#__codelineno-17-41"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-17-42" name="__codelineno-17-42" href="#__codelineno-17-42"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-17-43" name="__codelineno-17-43" href="#__codelineno-17-43"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-17-44" name="__codelineno-17-44" href="#__codelineno-17-44"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-17-45" name="__codelineno-17-45" href="#__codelineno-17-45"></a><span class="sd">    coverage</span>
<a id="__codelineno-17-46" name="__codelineno-17-46" href="#__codelineno-17-46"></a><span class="sd">        Defines the minimum % of rows that will be mapped to actual category name and the rest to be mapped</span>
<a id="__codelineno-17-47" name="__codelineno-17-47" href="#__codelineno-17-47"></a><span class="sd">        to &#39;outlier_categories&#39; and takes value between 0 to 1. Coverage of 0.8 can be interpreted as top frequently seen</span>
<a id="__codelineno-17-48" name="__codelineno-17-48" href="#__codelineno-17-48"></a><span class="sd">        categories are considered till it covers minimum 80% of rows and rest lesser seen values are mapped to &#39;outlier_categories&#39;. (Default value = 1.0)</span>
<a id="__codelineno-17-49" name="__codelineno-17-49" href="#__codelineno-17-49"></a><span class="sd">    max_category</span>
<a id="__codelineno-17-50" name="__codelineno-17-50" href="#__codelineno-17-50"></a><span class="sd">        Even if coverage is less, only (max_category - 1) categories will be mapped to actual name and rest to &#39;outlier_categories&#39;.</span>
<a id="__codelineno-17-51" name="__codelineno-17-51" href="#__codelineno-17-51"></a><span class="sd">        Caveat is when multiple categories have same rank, then #categories can be more than max_category. (Default value = 50)</span>
<a id="__codelineno-17-52" name="__codelineno-17-52" href="#__codelineno-17-52"></a><span class="sd">    pre_existing_model</span>
<a id="__codelineno-17-53" name="__codelineno-17-53" href="#__codelineno-17-53"></a><span class="sd">        Boolean argument – True or False. True if the model with the outlier/other values</span>
<a id="__codelineno-17-54" name="__codelineno-17-54" href="#__codelineno-17-54"></a><span class="sd">        for each attribute exists already to be used, False Otherwise. (Default value = False)</span>
<a id="__codelineno-17-55" name="__codelineno-17-55" href="#__codelineno-17-55"></a><span class="sd">    model_path</span>
<a id="__codelineno-17-56" name="__codelineno-17-56" href="#__codelineno-17-56"></a><span class="sd">        If pre_existing_model is True, this argument is path for the pre-saved model.</span>
<a id="__codelineno-17-57" name="__codelineno-17-57" href="#__codelineno-17-57"></a><span class="sd">        If pre_existing_model is False, this field can be used for saving the model.</span>
<a id="__codelineno-17-58" name="__codelineno-17-58" href="#__codelineno-17-58"></a><span class="sd">        Default &quot;NA&quot; means there is neither pre-existing model nor there is a need to save one.</span>
<a id="__codelineno-17-59" name="__codelineno-17-59" href="#__codelineno-17-59"></a><span class="sd">    output_mode</span>
<a id="__codelineno-17-60" name="__codelineno-17-60" href="#__codelineno-17-60"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-17-61" name="__codelineno-17-61" href="#__codelineno-17-61"></a><span class="sd">        “replace” option replaces original columns with transformed column. “append” option append transformed</span>
<a id="__codelineno-17-62" name="__codelineno-17-62" href="#__codelineno-17-62"></a><span class="sd">        column to the input dataset with a postfix &quot;_outliered&quot; e.g. column X is appended as X_outliered. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-17-63" name="__codelineno-17-63" href="#__codelineno-17-63"></a><span class="sd">    print_impact</span>
<a id="__codelineno-17-64" name="__codelineno-17-64" href="#__codelineno-17-64"></a><span class="sd">        True, False</span>
<a id="__codelineno-17-65" name="__codelineno-17-65" href="#__codelineno-17-65"></a><span class="sd">        This argument is to print before and after unique count of the transformed features (Default value = False)</span>
<a id="__codelineno-17-66" name="__codelineno-17-66" href="#__codelineno-17-66"></a>
<a id="__codelineno-17-67" name="__codelineno-17-67" href="#__codelineno-17-67"></a><span class="sd">    Returns</span>
<a id="__codelineno-17-68" name="__codelineno-17-68" href="#__codelineno-17-68"></a><span class="sd">    -------</span>
<a id="__codelineno-17-69" name="__codelineno-17-69" href="#__codelineno-17-69"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-17-70" name="__codelineno-17-70" href="#__codelineno-17-70"></a><span class="sd">        Transformed Dataframe</span>
<a id="__codelineno-17-71" name="__codelineno-17-71" href="#__codelineno-17-71"></a>
<a id="__codelineno-17-72" name="__codelineno-17-72" href="#__codelineno-17-72"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-17-73" name="__codelineno-17-73" href="#__codelineno-17-73"></a>    <span class="n">cat_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-17-74" name="__codelineno-17-74" href="#__codelineno-17-74"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-17-75" name="__codelineno-17-75" href="#__codelineno-17-75"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">cat_cols</span>
<a id="__codelineno-17-76" name="__codelineno-17-76" href="#__codelineno-17-76"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-17-77" name="__codelineno-17-77" href="#__codelineno-17-77"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-17-78" name="__codelineno-17-78" href="#__codelineno-17-78"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-17-79" name="__codelineno-17-79" href="#__codelineno-17-79"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-17-80" name="__codelineno-17-80" href="#__codelineno-17-80"></a>
<a id="__codelineno-17-81" name="__codelineno-17-81" href="#__codelineno-17-81"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-17-82" name="__codelineno-17-82" href="#__codelineno-17-82"></a>
<a id="__codelineno-17-83" name="__codelineno-17-83" href="#__codelineno-17-83"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cat_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-17-84" name="__codelineno-17-84" href="#__codelineno-17-84"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-17-85" name="__codelineno-17-85" href="#__codelineno-17-85"></a>
<a id="__codelineno-17-86" name="__codelineno-17-86" href="#__codelineno-17-86"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-17-87" name="__codelineno-17-87" href="#__codelineno-17-87"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-17-88" name="__codelineno-17-88" href="#__codelineno-17-88"></a>            <span class="s2">&quot;No Outlier Categories Computation - No categorical column(s) to transform&quot;</span>
<a id="__codelineno-17-89" name="__codelineno-17-89" href="#__codelineno-17-89"></a>        <span class="p">)</span>
<a id="__codelineno-17-90" name="__codelineno-17-90" href="#__codelineno-17-90"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-17-91" name="__codelineno-17-91" href="#__codelineno-17-91"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">coverage</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">coverage</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-17-92" name="__codelineno-17-92" href="#__codelineno-17-92"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Coverage Value&quot;</span><span class="p">)</span>
<a id="__codelineno-17-93" name="__codelineno-17-93" href="#__codelineno-17-93"></a>    <span class="k">if</span> <span class="n">max_category</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-17-94" name="__codelineno-17-94" href="#__codelineno-17-94"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Maximum No. of Categories Allowed&quot;</span><span class="p">)</span>
<a id="__codelineno-17-95" name="__codelineno-17-95" href="#__codelineno-17-95"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">):</span>
<a id="__codelineno-17-96" name="__codelineno-17-96" href="#__codelineno-17-96"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for output_mode&quot;</span><span class="p">)</span>
<a id="__codelineno-17-97" name="__codelineno-17-97" href="#__codelineno-17-97"></a>
<a id="__codelineno-17-98" name="__codelineno-17-98" href="#__codelineno-17-98"></a>    <span class="n">idf</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">persist</span><span class="p">(</span><span class="n">pyspark</span><span class="o">.</span><span class="n">StorageLevel</span><span class="o">.</span><span class="n">MEMORY_AND_DISK</span><span class="p">)</span>
<a id="__codelineno-17-99" name="__codelineno-17-99" href="#__codelineno-17-99"></a>
<a id="__codelineno-17-100" name="__codelineno-17-100" href="#__codelineno-17-100"></a>    <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-17-101" name="__codelineno-17-101" href="#__codelineno-17-101"></a>        <span class="n">df_model</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span>
<a id="__codelineno-17-102" name="__codelineno-17-102" href="#__codelineno-17-102"></a>            <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/outlier_categories&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-17-103" name="__codelineno-17-103" href="#__codelineno-17-103"></a>        <span class="p">)</span>
<a id="__codelineno-17-104" name="__codelineno-17-104" href="#__codelineno-17-104"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-17-105" name="__codelineno-17-105" href="#__codelineno-17-105"></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-17-106" name="__codelineno-17-106" href="#__codelineno-17-106"></a>            <span class="n">window</span> <span class="o">=</span> <span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">()</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">desc</span><span class="p">(</span><span class="s2">&quot;count_pct&quot;</span><span class="p">))</span>
<a id="__codelineno-17-107" name="__codelineno-17-107" href="#__codelineno-17-107"></a>            <span class="n">df_cats</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-17-108" name="__codelineno-17-108" href="#__codelineno-17-108"></a>                <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-17-109" name="__codelineno-17-109" href="#__codelineno-17-109"></a>                <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-17-110" name="__codelineno-17-110" href="#__codelineno-17-110"></a>                <span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-17-111" name="__codelineno-17-111" href="#__codelineno-17-111"></a>                <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<a id="__codelineno-17-112" name="__codelineno-17-112" href="#__codelineno-17-112"></a>                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-17-113" name="__codelineno-17-113" href="#__codelineno-17-113"></a>                    <span class="s2">&quot;count_pct&quot;</span><span class="p">,</span>
<a id="__codelineno-17-114" name="__codelineno-17-114" href="#__codelineno-17-114"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">F</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">()),</span>
<a id="__codelineno-17-115" name="__codelineno-17-115" href="#__codelineno-17-115"></a>                <span class="p">)</span>
<a id="__codelineno-17-116" name="__codelineno-17-116" href="#__codelineno-17-116"></a>                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;rank&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="p">))</span>
<a id="__codelineno-17-117" name="__codelineno-17-117" href="#__codelineno-17-117"></a>                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-17-118" name="__codelineno-17-118" href="#__codelineno-17-118"></a>                    <span class="s2">&quot;cumu&quot;</span><span class="p">,</span>
<a id="__codelineno-17-119" name="__codelineno-17-119" href="#__codelineno-17-119"></a>                    <span class="n">F</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;count_pct&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span>
<a id="__codelineno-17-120" name="__codelineno-17-120" href="#__codelineno-17-120"></a>                        <span class="n">window</span><span class="o">.</span><span class="n">rowsBetween</span><span class="p">(</span><span class="n">Window</span><span class="o">.</span><span class="n">unboundedPreceding</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-17-121" name="__codelineno-17-121" href="#__codelineno-17-121"></a>                    <span class="p">),</span>
<a id="__codelineno-17-122" name="__codelineno-17-122" href="#__codelineno-17-122"></a>                <span class="p">)</span>
<a id="__codelineno-17-123" name="__codelineno-17-123" href="#__codelineno-17-123"></a>                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;lag_cumu&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lag</span><span class="p">(</span><span class="s2">&quot;cumu&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="p">))</span>
<a id="__codelineno-17-124" name="__codelineno-17-124" href="#__codelineno-17-124"></a>                <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-17-125" name="__codelineno-17-125" href="#__codelineno-17-125"></a>                <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="p">((</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;cumu&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">coverage</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;lag_cumu&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">coverage</span><span class="p">)))</span>
<a id="__codelineno-17-126" name="__codelineno-17-126" href="#__codelineno-17-126"></a>                <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;rank&quot;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">max_category</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-17-127" name="__codelineno-17-127" href="#__codelineno-17-127"></a>                <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;attribute&quot;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;parameters&quot;</span><span class="p">))</span>
<a id="__codelineno-17-128" name="__codelineno-17-128" href="#__codelineno-17-128"></a>            <span class="p">)</span>
<a id="__codelineno-17-129" name="__codelineno-17-129" href="#__codelineno-17-129"></a>            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-17-130" name="__codelineno-17-130" href="#__codelineno-17-130"></a>                <span class="n">df_model</span> <span class="o">=</span> <span class="n">df_cats</span>
<a id="__codelineno-17-131" name="__codelineno-17-131" href="#__codelineno-17-131"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-17-132" name="__codelineno-17-132" href="#__codelineno-17-132"></a>                <span class="n">df_model</span> <span class="o">=</span> <span class="n">df_model</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">df_cats</span><span class="p">)</span>
<a id="__codelineno-17-133" name="__codelineno-17-133" href="#__codelineno-17-133"></a>
<a id="__codelineno-17-134" name="__codelineno-17-134" href="#__codelineno-17-134"></a>    <span class="n">df_params</span> <span class="o">=</span> <span class="n">df_model</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">groupByKey</span><span class="p">()</span><span class="o">.</span><span class="n">mapValues</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-17-135" name="__codelineno-17-135" href="#__codelineno-17-135"></a>    <span class="n">dict_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">df_params</span><span class="p">)</span>
<a id="__codelineno-17-136" name="__codelineno-17-136" href="#__codelineno-17-136"></a>    <span class="n">broadcast_params</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="n">dict_params</span><span class="p">)</span>
<a id="__codelineno-17-137" name="__codelineno-17-137" href="#__codelineno-17-137"></a>
<a id="__codelineno-17-138" name="__codelineno-17-138" href="#__codelineno-17-138"></a>    <span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
<a id="__codelineno-17-139" name="__codelineno-17-139" href="#__codelineno-17-139"></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-17-140" name="__codelineno-17-140" href="#__codelineno-17-140"></a>        <span class="n">dict_params</span> <span class="o">=</span> <span class="n">broadcast_params</span><span class="o">.</span><span class="n">value</span>
<a id="__codelineno-17-141" name="__codelineno-17-141" href="#__codelineno-17-141"></a>        <span class="n">params</span> <span class="o">=</span> <span class="n">dict_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<a id="__codelineno-17-142" name="__codelineno-17-142" href="#__codelineno-17-142"></a>        <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-17-143" name="__codelineno-17-143" href="#__codelineno-17-143"></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="n">params</span>
<a id="__codelineno-17-144" name="__codelineno-17-144" href="#__codelineno-17-144"></a>        <span class="k">return</span> <span class="n">parameters</span>
<a id="__codelineno-17-145" name="__codelineno-17-145" href="#__codelineno-17-145"></a>
<a id="__codelineno-17-146" name="__codelineno-17-146" href="#__codelineno-17-146"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-17-147" name="__codelineno-17-147" href="#__codelineno-17-147"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-17-148" name="__codelineno-17-148" href="#__codelineno-17-148"></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-17-149" name="__codelineno-17-149" href="#__codelineno-17-149"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-17-150" name="__codelineno-17-150" href="#__codelineno-17-150"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-17-151" name="__codelineno-17-151" href="#__codelineno-17-151"></a>                <span class="n">i</span><span class="p">,</span>
<a id="__codelineno-17-152" name="__codelineno-17-152" href="#__codelineno-17-152"></a>                <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
<a id="__codelineno-17-153" name="__codelineno-17-153" href="#__codelineno-17-153"></a>                    <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">()),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-17-154" name="__codelineno-17-154" href="#__codelineno-17-154"></a>                <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="s2">&quot;outlier_categories&quot;</span><span class="p">),</span>
<a id="__codelineno-17-155" name="__codelineno-17-155" href="#__codelineno-17-155"></a>            <span class="p">)</span>
<a id="__codelineno-17-156" name="__codelineno-17-156" href="#__codelineno-17-156"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-17-157" name="__codelineno-17-157" href="#__codelineno-17-157"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-17-158" name="__codelineno-17-158" href="#__codelineno-17-158"></a>                <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_outliered&quot;</span><span class="p">,</span>
<a id="__codelineno-17-159" name="__codelineno-17-159" href="#__codelineno-17-159"></a>                <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
<a id="__codelineno-17-160" name="__codelineno-17-160" href="#__codelineno-17-160"></a>                    <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">()),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-17-161" name="__codelineno-17-161" href="#__codelineno-17-161"></a>                <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="s2">&quot;outlier_categories&quot;</span><span class="p">),</span>
<a id="__codelineno-17-162" name="__codelineno-17-162" href="#__codelineno-17-162"></a>            <span class="p">)</span>
<a id="__codelineno-17-163" name="__codelineno-17-163" href="#__codelineno-17-163"></a>
<a id="__codelineno-17-164" name="__codelineno-17-164" href="#__codelineno-17-164"></a>    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pre_existing_model</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">):</span>
<a id="__codelineno-17-165" name="__codelineno-17-165" href="#__codelineno-17-165"></a>        <span class="n">df_model</span><span class="o">.</span><span class="n">repartition</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span>
<a id="__codelineno-17-166" name="__codelineno-17-166" href="#__codelineno-17-166"></a>            <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/outlier_categories&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span>
<a id="__codelineno-17-167" name="__codelineno-17-167" href="#__codelineno-17-167"></a>        <span class="p">)</span>
<a id="__codelineno-17-168" name="__codelineno-17-168" href="#__codelineno-17-168"></a>
<a id="__codelineno-17-169" name="__codelineno-17-169" href="#__codelineno-17-169"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-17-170" name="__codelineno-17-170" href="#__codelineno-17-170"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-17-171" name="__codelineno-17-171" href="#__codelineno-17-171"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="n">list_of_cols</span>
<a id="__codelineno-17-172" name="__codelineno-17-172" href="#__codelineno-17-172"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-17-173" name="__codelineno-17-173" href="#__codelineno-17-173"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_outliered&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">]</span>
<a id="__codelineno-17-174" name="__codelineno-17-174" href="#__codelineno-17-174"></a>        <span class="n">uniqueCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-17-175" name="__codelineno-17-175" href="#__codelineno-17-175"></a>            <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;unique_values&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;uniqueValues_before&quot;</span><span class="p">)</span>
<a id="__codelineno-17-176" name="__codelineno-17-176" href="#__codelineno-17-176"></a>        <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">),</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-17-177" name="__codelineno-17-177" href="#__codelineno-17-177"></a>        <span class="n">uniqueCount_computation</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">odf</span><span class="p">,</span> <span class="n">output_cols</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-17-178" name="__codelineno-17-178" href="#__codelineno-17-178"></a>            <span class="s2">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;unique_values&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;uniqueValues_after&quot;</span><span class="p">)</span>
<a id="__codelineno-17-179" name="__codelineno-17-179" href="#__codelineno-17-179"></a>        <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">),</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-17-180" name="__codelineno-17-180" href="#__codelineno-17-180"></a>
<a id="__codelineno-17-181" name="__codelineno-17-181" href="#__codelineno-17-181"></a>    <span class="n">idf</span><span class="o">.</span><span class="n">unpersist</span><span class="p">()</span>
<a id="__codelineno-17-182" name="__codelineno-17-182" href="#__codelineno-17-182"></a>
<a id="__codelineno-17-183" name="__codelineno-17-183" href="#__codelineno-17-183"></a>    <span class="k">return</span> <span class="n">odf</span>
</code></pre></div>
</pre>
</details>
</dd>
<dt id="anovos.data_transformer.transformers.z_standardization"><code class="name flex hljs csharp">
<span class="k">def</span> <span class="nf"><span class="ident">z_standardization</span></span>(<span class="n">spark, idf, list_of_cols='all', drop_cols=[], pre_existing_model=False, model_path='NA', output_mode='replace', print_impact=False)</span>
</code></dt>
<dd>
<div class="desc"><p>Standardization is commonly used in data pre-processing process. z_standardization standardizes the selected
attributes of an input dataframe by normalizing each attribute to have standard deviation of 1 and mean of 0. For
each attribute, the standard deviation (s) and mean (u) are calculated and a sample x will be standardized into (
x-u)/s. If the standard deviation of an attribute is 0, it will be excluded in standardization and a warning will
be shown. None values will be kept as None in the output dataframe.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>spark</code></strong></dt>
<dd>Spark Session</dd>
<dt><strong><code>idf</code></strong></dt>
<dd>Input Dataframe</dd>
<dt><strong><code>list_of_cols</code></strong></dt>
<dd>List of numerical columns to transform e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
"all" can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.
Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in
drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = "all")</dd>
<dt><strong><code>drop_cols</code></strong></dt>
<dd>List of columns to be dropped e.g., ["col1","col2"].
Alternatively, columns can be specified in a string format,
where different column names are separated by pipe delimiter “|” e.g., "col1|col2".
It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except
a few handful of them. (Default value = [])</dd>
<dt><strong><code>pre_existing_model</code></strong></dt>
<dd>Boolean argument – True or False. True if model files (Mean/stddev for each feature) exists already, False Otherwise (Default value = False)</dd>
<dt><strong><code>model_path</code></strong></dt>
<dd>If pre_existing_model is True, this argument is path for referring the pre-saved model.
If pre_existing_model is False, this argument can be used for saving the model.
Default "NA" means there is neither pre-existing model nor there is a need to save one.</dd>
<dt><strong><code>output_mode</code></strong></dt>
<dd>"replace", "append".
“replace” option replaces original columns with transformed column. “append” option append transformed
column to the input dataset with a postfix "_scaled" e.g. column X is appended as X_scaled. (Default value = "replace")</dd>
<dt><strong><code>print_impact</code></strong></dt>
<dd>True, False (Default value = False)
This argument is to print out the before and after descriptive statistics of rescaled columns.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>DataFrame</code></dt>
<dd>Rescaled Dataframe</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="k">def</span> <span class="nf">z_standardization</span><span class="p">(</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>    <span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>    <span class="n">idf</span><span class="p">,</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>    <span class="n">list_of_cols</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>    <span class="n">drop_cols</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>    <span class="n">pre_existing_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>    <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>    <span class="n">print_impact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="p">):</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="sd">    Standardization is commonly used in data pre-processing process. z_standardization standardizes the selected</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="sd">    attributes of an input dataframe by normalizing each attribute to have standard deviation of 1 and mean of 0. For</span>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="sd">    each attribute, the standard deviation (s) and mean (u) are calculated and a sample x will be standardized into (</span>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="sd">    x-u)/s. If the standard deviation of an attribute is 0, it will be excluded in standardization and a warning will</span>
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="sd">    be shown. None values will be kept as None in the output dataframe.</span>
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="sd">    Parameters</span>
<a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="sd">    ----------</span>
<a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="sd">    spark</span>
<a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a><span class="sd">        Spark Session</span>
<a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a><span class="sd">    idf</span>
<a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a><span class="sd">        Input Dataframe</span>
<a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a><span class="sd">    list_of_cols</span>
<a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a><span class="sd">        List of numerical columns to transform e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a><span class="sd">        &quot;all&quot; can be passed to include all numerical columns for analysis. This is super useful instead of specifying all column names manually.</span>
<a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a><span class="sd">        Please note that this argument is used in conjunction with drop_cols i.e. a column mentioned in</span>
<a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a><span class="sd">        drop_cols argument is not considered for analysis even if it is mentioned in list_of_cols. (Default value = &quot;all&quot;)</span>
<a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a><span class="sd">    drop_cols</span>
<a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a><span class="sd">        List of columns to be dropped e.g., [&quot;col1&quot;,&quot;col2&quot;].</span>
<a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a><span class="sd">        Alternatively, columns can be specified in a string format,</span>
<a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a><span class="sd">        where different column names are separated by pipe delimiter “|” e.g., &quot;col1|col2&quot;.</span>
<a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a><span class="sd">        It is most useful when coupled with the “all” value of list_of_cols, when we need to consider all columns except</span>
<a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a><span class="sd">        a few handful of them. (Default value = [])</span>
<a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a><span class="sd">    pre_existing_model</span>
<a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a><span class="sd">        Boolean argument – True or False. True if model files (Mean/stddev for each feature) exists already, False Otherwise (Default value = False)</span>
<a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a><span class="sd">    model_path</span>
<a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a><span class="sd">        If pre_existing_model is True, this argument is path for referring the pre-saved model.</span>
<a id="__codelineno-18-41" name="__codelineno-18-41" href="#__codelineno-18-41"></a><span class="sd">        If pre_existing_model is False, this argument can be used for saving the model.</span>
<a id="__codelineno-18-42" name="__codelineno-18-42" href="#__codelineno-18-42"></a><span class="sd">        Default &quot;NA&quot; means there is neither pre-existing model nor there is a need to save one.</span>
<a id="__codelineno-18-43" name="__codelineno-18-43" href="#__codelineno-18-43"></a><span class="sd">    output_mode</span>
<a id="__codelineno-18-44" name="__codelineno-18-44" href="#__codelineno-18-44"></a><span class="sd">        &quot;replace&quot;, &quot;append&quot;.</span>
<a id="__codelineno-18-45" name="__codelineno-18-45" href="#__codelineno-18-45"></a><span class="sd">        “replace” option replaces original columns with transformed column. “append” option append transformed</span>
<a id="__codelineno-18-46" name="__codelineno-18-46" href="#__codelineno-18-46"></a><span class="sd">        column to the input dataset with a postfix &quot;_scaled&quot; e.g. column X is appended as X_scaled. (Default value = &quot;replace&quot;)</span>
<a id="__codelineno-18-47" name="__codelineno-18-47" href="#__codelineno-18-47"></a><span class="sd">    print_impact</span>
<a id="__codelineno-18-48" name="__codelineno-18-48" href="#__codelineno-18-48"></a><span class="sd">        True, False (Default value = False)</span>
<a id="__codelineno-18-49" name="__codelineno-18-49" href="#__codelineno-18-49"></a><span class="sd">        This argument is to print out the before and after descriptive statistics of rescaled columns.</span>
<a id="__codelineno-18-50" name="__codelineno-18-50" href="#__codelineno-18-50"></a>
<a id="__codelineno-18-51" name="__codelineno-18-51" href="#__codelineno-18-51"></a><span class="sd">    Returns</span>
<a id="__codelineno-18-52" name="__codelineno-18-52" href="#__codelineno-18-52"></a><span class="sd">    -------</span>
<a id="__codelineno-18-53" name="__codelineno-18-53" href="#__codelineno-18-53"></a><span class="sd">    DataFrame</span>
<a id="__codelineno-18-54" name="__codelineno-18-54" href="#__codelineno-18-54"></a><span class="sd">        Rescaled Dataframe</span>
<a id="__codelineno-18-55" name="__codelineno-18-55" href="#__codelineno-18-55"></a>
<a id="__codelineno-18-56" name="__codelineno-18-56" href="#__codelineno-18-56"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-18-57" name="__codelineno-18-57" href="#__codelineno-18-57"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="n">attributeType_segregation</span><span class="p">(</span><span class="n">idf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-18-58" name="__codelineno-18-58" href="#__codelineno-18-58"></a>    <span class="k">if</span> <span class="n">list_of_cols</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-18-59" name="__codelineno-18-59" href="#__codelineno-18-59"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="n">num_cols</span>
<a id="__codelineno-18-60" name="__codelineno-18-60" href="#__codelineno-18-60"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-18-61" name="__codelineno-18-61" href="#__codelineno-18-61"></a>        <span class="n">list_of_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-18-62" name="__codelineno-18-62" href="#__codelineno-18-62"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_cols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-18-63" name="__codelineno-18-63" href="#__codelineno-18-63"></a>        <span class="n">drop_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
<a id="__codelineno-18-64" name="__codelineno-18-64" href="#__codelineno-18-64"></a>
<a id="__codelineno-18-65" name="__codelineno-18-65" href="#__codelineno-18-65"></a>    <span class="n">list_of_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_cols</span><span class="p">]))</span>
<a id="__codelineno-18-66" name="__codelineno-18-66" href="#__codelineno-18-66"></a>
<a id="__codelineno-18-67" name="__codelineno-18-67" href="#__codelineno-18-67"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">num_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-18-68" name="__codelineno-18-68" href="#__codelineno-18-68"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for Column(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-18-69" name="__codelineno-18-69" href="#__codelineno-18-69"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-18-70" name="__codelineno-18-70" href="#__codelineno-18-70"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-18-71" name="__codelineno-18-71" href="#__codelineno-18-71"></a>            <span class="s2">&quot;No Standardization Performed - No numerical column(s) to transform&quot;</span>
<a id="__codelineno-18-72" name="__codelineno-18-72" href="#__codelineno-18-72"></a>        <span class="p">)</span>
<a id="__codelineno-18-73" name="__codelineno-18-73" href="#__codelineno-18-73"></a>        <span class="k">return</span> <span class="n">idf</span>
<a id="__codelineno-18-74" name="__codelineno-18-74" href="#__codelineno-18-74"></a>
<a id="__codelineno-18-75" name="__codelineno-18-75" href="#__codelineno-18-75"></a>    <span class="k">if</span> <span class="n">output_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="s2">&quot;append&quot;</span><span class="p">):</span>
<a id="__codelineno-18-76" name="__codelineno-18-76" href="#__codelineno-18-76"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid input for output_mode&quot;</span><span class="p">)</span>
<a id="__codelineno-18-77" name="__codelineno-18-77" href="#__codelineno-18-77"></a>
<a id="__codelineno-18-78" name="__codelineno-18-78" href="#__codelineno-18-78"></a>    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-18-79" name="__codelineno-18-79" href="#__codelineno-18-79"></a>    <span class="n">excluded_cols</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-18-80" name="__codelineno-18-80" href="#__codelineno-18-80"></a>    <span class="k">if</span> <span class="n">pre_existing_model</span><span class="p">:</span>
<a id="__codelineno-18-81" name="__codelineno-18-81" href="#__codelineno-18-81"></a>        <span class="n">df_model</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/z_standardization&quot;</span><span class="p">)</span>
<a id="__codelineno-18-82" name="__codelineno-18-82" href="#__codelineno-18-82"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-18-83" name="__codelineno-18-83" href="#__codelineno-18-83"></a>            <span class="n">mapped_value</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-18-84" name="__codelineno-18-84" href="#__codelineno-18-84"></a>                <span class="n">df_model</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-18-85" name="__codelineno-18-85" href="#__codelineno-18-85"></a>                <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;parameters&quot;</span><span class="p">)</span>
<a id="__codelineno-18-86" name="__codelineno-18-86" href="#__codelineno-18-86"></a>                <span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-18-87" name="__codelineno-18-87" href="#__codelineno-18-87"></a>                <span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-18-88" name="__codelineno-18-88" href="#__codelineno-18-88"></a>            <span class="p">)</span>
<a id="__codelineno-18-89" name="__codelineno-18-89" href="#__codelineno-18-89"></a>            <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapped_value</span><span class="p">)</span>
<a id="__codelineno-18-90" name="__codelineno-18-90" href="#__codelineno-18-90"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-18-91" name="__codelineno-18-91" href="#__codelineno-18-91"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span><span class="p">:</span>
<a id="__codelineno-18-92" name="__codelineno-18-92" href="#__codelineno-18-92"></a>            <span class="n">mean</span><span class="p">,</span> <span class="n">stddev</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">stddev</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<a id="__codelineno-18-93" name="__codelineno-18-93" href="#__codelineno-18-93"></a>            <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-18-94" name="__codelineno-18-94" href="#__codelineno-18-94"></a>                <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span> <span class="k">if</span> <span class="n">mean</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">stddev</span><span class="p">)</span> <span class="k">if</span> <span class="n">stddev</span> <span class="k">else</span> <span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-18-95" name="__codelineno-18-95" href="#__codelineno-18-95"></a>            <span class="p">)</span>
<a id="__codelineno-18-96" name="__codelineno-18-96" href="#__codelineno-18-96"></a>            <span class="k">if</span> <span class="n">stddev</span><span class="p">:</span>
<a id="__codelineno-18-97" name="__codelineno-18-97" href="#__codelineno-18-97"></a>                <span class="k">if</span> <span class="nb">round</span><span class="p">(</span><span class="n">stddev</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
<a id="__codelineno-18-98" name="__codelineno-18-98" href="#__codelineno-18-98"></a>                    <span class="n">excluded_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-18-99" name="__codelineno-18-99" href="#__codelineno-18-99"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-18-100" name="__codelineno-18-100" href="#__codelineno-18-100"></a>                <span class="n">excluded_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-18-101" name="__codelineno-18-101" href="#__codelineno-18-101"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">excluded_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-18-102" name="__codelineno-18-102" href="#__codelineno-18-102"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-18-103" name="__codelineno-18-103" href="#__codelineno-18-103"></a>            <span class="s2">&quot;The following column(s) are excluded from standardization because the standard deviation is zero:&quot;</span>
<a id="__codelineno-18-104" name="__codelineno-18-104" href="#__codelineno-18-104"></a>            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">excluded_cols</span><span class="p">)</span>
<a id="__codelineno-18-105" name="__codelineno-18-105" href="#__codelineno-18-105"></a>        <span class="p">)</span>
<a id="__codelineno-18-106" name="__codelineno-18-106" href="#__codelineno-18-106"></a>
<a id="__codelineno-18-107" name="__codelineno-18-107" href="#__codelineno-18-107"></a>    <span class="n">odf</span> <span class="o">=</span> <span class="n">idf</span>
<a id="__codelineno-18-108" name="__codelineno-18-108" href="#__codelineno-18-108"></a>    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">):</span>
<a id="__codelineno-18-109" name="__codelineno-18-109" href="#__codelineno-18-109"></a>        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">excluded_cols</span><span class="p">:</span>
<a id="__codelineno-18-110" name="__codelineno-18-110" href="#__codelineno-18-110"></a>            <span class="n">modify_col</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;append&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">i</span>
<a id="__codelineno-18-111" name="__codelineno-18-111" href="#__codelineno-18-111"></a>            <span class="n">odf</span> <span class="o">=</span> <span class="n">odf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
<a id="__codelineno-18-112" name="__codelineno-18-112" href="#__codelineno-18-112"></a>                <span class="n">modify_col</span><span class="p">,</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">parameters</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">parameters</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-18-113" name="__codelineno-18-113" href="#__codelineno-18-113"></a>            <span class="p">)</span>
<a id="__codelineno-18-114" name="__codelineno-18-114" href="#__codelineno-18-114"></a>
<a id="__codelineno-18-115" name="__codelineno-18-115" href="#__codelineno-18-115"></a>    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pre_existing_model</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">model_path</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span><span class="p">):</span>
<a id="__codelineno-18-116" name="__codelineno-18-116" href="#__codelineno-18-116"></a>        <span class="n">df_model</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
<a id="__codelineno-18-117" name="__codelineno-18-117" href="#__codelineno-18-117"></a>            <span class="nb">zip</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">,</span> <span class="n">parameters</span><span class="p">),</span> <span class="n">schema</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="s2">&quot;parameters&quot;</span><span class="p">]</span>
<a id="__codelineno-18-118" name="__codelineno-18-118" href="#__codelineno-18-118"></a>        <span class="p">)</span>
<a id="__codelineno-18-119" name="__codelineno-18-119" href="#__codelineno-18-119"></a>        <span class="n">df_model</span><span class="o">.</span><span class="n">coalesce</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span>
<a id="__codelineno-18-120" name="__codelineno-18-120" href="#__codelineno-18-120"></a>            <span class="n">model_path</span> <span class="o">+</span> <span class="s2">&quot;/z_standardization&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span>
<a id="__codelineno-18-121" name="__codelineno-18-121" href="#__codelineno-18-121"></a>        <span class="p">)</span>
<a id="__codelineno-18-122" name="__codelineno-18-122" href="#__codelineno-18-122"></a>
<a id="__codelineno-18-123" name="__codelineno-18-123" href="#__codelineno-18-123"></a>    <span class="k">if</span> <span class="n">print_impact</span><span class="p">:</span>
<a id="__codelineno-18-124" name="__codelineno-18-124" href="#__codelineno-18-124"></a>        <span class="k">if</span> <span class="n">output_mode</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
<a id="__codelineno-18-125" name="__codelineno-18-125" href="#__codelineno-18-125"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="n">list_of_cols</span>
<a id="__codelineno-18-126" name="__codelineno-18-126" href="#__codelineno-18-126"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-18-127" name="__codelineno-18-127" href="#__codelineno-18-127"></a>            <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-18-128" name="__codelineno-18-128" href="#__codelineno-18-128"></a>                <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_scaled&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_cols</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">excluded_cols</span>
<a id="__codelineno-18-129" name="__codelineno-18-129" href="#__codelineno-18-129"></a>            <span class="p">]</span>
<a id="__codelineno-18-130" name="__codelineno-18-130" href="#__codelineno-18-130"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before: &quot;</span><span class="p">)</span>
<a id="__codelineno-18-131" name="__codelineno-18-131" href="#__codelineno-18-131"></a>        <span class="n">idf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">list_of_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-18-132" name="__codelineno-18-132" href="#__codelineno-18-132"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After: &quot;</span><span class="p">)</span>
<a id="__codelineno-18-133" name="__codelineno-18-133" href="#__codelineno-18-133"></a>        <span class="n">odf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">output_cols</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-18-134" name="__codelineno-18-134" href="#__codelineno-18-134"></a>
<a id="__codelineno-18-135" name="__codelineno-18-135" href="#__codelineno-18-135"></a>    <span class="k">return</span> <span class="n">odf</span>
</code></pre></div>
</pre>
</details>
</dd>
</dl>


  




                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="geospatial.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: &lt;code&gt;geospatial&lt;/code&gt;" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              <code>geospatial</code>
            </div>
          </div>
        </a>
      
      
        
        <a href="../drift_stability/_index.html" class="md-footer__link md-footer__link--next" aria-label="Next: Overview" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Overview
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/anovos" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://join.slack.com/t/featureengineers/shared_invite/zt-17pkc3f5d-33SUtV8Wx48CpiIRNuQ7JA" target="_blank" rel="noopener" title="join.slack.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://twitter.com/anovos" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
    
  </body>
</html>